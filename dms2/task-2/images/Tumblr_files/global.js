webpackJsonp([32],[function(e,t,i){i(1761),i(1762),i(1763),i(1764),i(1765),i(1766),i(1767),i(1768),i(1769),i(1770),i(1771),i(1772),i(1773),i(1774),i(1775),i(1776),i(1777),i(1778),i(1779),i(1780),i(1781),i(1782),i(1783),i(1784),i(1785),i(1786),i(1787),i(1788),i(1789),i(1790),i(1791),i(1792),i(1793),i(1794),i(1795),i(1796),i(1797),i(1798),i(1799),i(1800),i(1801),i(1802),i(1803),i(1804),i(1805),i(1806),i(1807),i(1808),i(1809),i(1810),i(1811),i(1812),i(1813),i(1814),i(1815),i(1816),i(1817),i(1818),i(1819),e.exports=i(1820)},,,,,function(e,t,i){"use strict";var s=i(3),n=i(6).sprintf,o=i(7),r=i(9),a=i(126),l=i(135);l();var c=i(129),u=i(132),h=i(137),d=i(138),p=i(140),g=i(183),_=i(783),f=i(786),m=i(787),v=i(1034),b=i(1038),y=i(487),w=i(1069),k=a.extend({getName:function(){return this.name=c.get("Context/name"),n("Context/%s",this.name)},logs:function(){var e=[i(1072),i(1087),i(1088),i(1089),i(1090),i(1091),i(1092),i(1093),i(1094),i(1095),i(1096),i(1097),i(1098),i(1099),i(1100),i(1101),i(1102),i(1103),i(1104),i(1105).default,i(1108).default,i(1114),i(1115),i(1116),i(1117),i(1118),i(1119),i(1120),i(1121),i(1122),i(1123)];return s.union(e,a.prototype.logs.apply(this))},constructor:function(){a.apply(this,arguments),this.startHistory(),this.initializeApp()},bootloader:function(e){a.prototype.bootloader.apply(this,arguments),d.init(),u.log("Exec","Bootstrap/DOMEventor"),u.log("Exec","Bootstrap/Legacy"),i(1124)},initializeApp:function(){h.bool("is_mobile_handset")&&h.bool("responsive_help_docs")?new b:new g,new _,new f,h.bool("indash_blogs")&&(this.peepr=new m),h.bool("ask_form")&&(this.askForm=new v({user:p()})),h.bool("livephotos_web")&&(this.livePhotos=y.getInstance()),r.locale(c.get("Context.language")),h.bool("lrec_on_blog_pages_peepr")&&(this.yamPlusAd=new w)},startHistory:function(e){o.History.started||s.isEmpty(this.routes)||(this.routeFound=o.history.start({pushState:"pushState"in window.history,hashChange:!!e&&!("pushState"in window.history),root:this.root}))}});e.exports=k},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(127),r=i(129),a=i(130),l=i(132),c=i(134),u=n.Router.extend({root:"/",constructor:function(e){e||(e={}),e.bootstrap||(e.bootstrap=o()),this.bootloader(e.bootstrap),n.Router.apply(this,arguments)},getName:function(){return"Prima/Router"},logs:function(){return[]},bootloader:function(e){s.isEmpty(e),r.setup(e),l.log("Exec","Bootstrap/Data"),a.setup(e.Translations,s.get(e,"Context.language_simple","en")),l.log("Exec","Bootstrap/Translations"),c.startLogs(this.logs()),l.log("Exec","Bootstrap/logs")}},{start:function(e){return new this(e)}});e.exports=u},function(e,t,i){"use strict";var s=i(128),n=function(){var e=s("JSON"),t={},i=document.getElementById("bootloader");if(i){try{t=e.parse(i.getAttribute("data-bootstrap"))}catch(e){}i.parentNode.removeChild(i)}return t};e.exports=n},function(e,t){"use strict";function i(e,t){if(e in s)return s[e];var i=window[e];if(!t||!t(i)){var n=document.createElement("iframe");document.body.appendChild(n),i=n.contentWindow[e],document.body.removeChild(n)}return s[e]=i,i}var s={};e.exports=i},function(e,t,i){"use strict";function s(e){if(!r)throw new Error("Data hasn't been initialized with `setup`.");if(!a.isString(e))return null;var t=a.get(r,e.replace(/\//g,"."));return a.cloneDeep(t)}function n(e){if(!r)throw new Error("Data hasn't been initialized with `setup`.");return a.isString(e)?a.has(r,e.replace(/\//g,".")):null}function o(e){r=a.isObject(e)?e:{}}var r,a=i(3);e.exports={get:s,has:n,setup:a.once(o)}},function(e,t,i){"use strict";function s(e,t){r.addEntries(n.isObject(e)?e:{}),this.locale=t}var n=i(3),o=i(131),r=new o({name:"Translations"}),a=n.bind(r.get,r);a.setup=n.once(s),e.exports=a},function(e,t,i){"use strict";function s(e){e=n.extend({entries:{},name:"Dictionary"},e),this._hadLastLookup=!1,this._entries=e.entries,this._name=e.name}var n=i(3),o=(i(132),i(6).sprintf),r=function(e,t,i){null!=i||(i=this);var s=e.apply(i,t);return t=Array.prototype.slice.call(t,1),t.unshift(s),t};s.prototype.addEntries=function(e){return n.extend(this._entries,e),this},s.prototype.lookup=function(e){return n.has(this._entries,e)?(this._hadLastLookup=!0,this._entries[e]):(this._hadLastLookup=!1,e)},s.prototype.lookupWithFormatting=function(e){var t;return arguments.length>1?(t=this.lookup(o.apply(this,arguments)),this._hadLastLookup||(t=o.apply(this,r(this.lookup,arguments,this)))):t=this.lookup(e),t},s.prototype.get=function(e){var t=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup&&this.logMissing,t},s.prototype.getEntries=function(){return n.cloneDeep(this._entries)},e.exports=s},,,function(e,t,i){"use strict";var s=i(3),n={loadedLogs:[],startLogs:function(e){s.each(e,function(e){var t=e.start();this.loadedLogs.push(t.logKey)},this)},startLog:function(e){this.startLogs([e])}};e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(6).sprintf,o=i(130),r=i(136),a=(i(132),{__:o,sprintf:n,_subview:r}),l=function(){return s.extend(s.templateSettings.imports,a),a};e.exports=l},function(e,t){"use strict";e.exports=function(e){return'<noscript data-subview="'+e+'"></noscript>'}},,function(e,t,i){"use strict";function s(){g.documentHeight=p.documentHeight,p.documentHeight=h.height(),g.windowHeight=p.windowHeight,p.windowHeight=d.height(),g.windowWidth=p.windowWidth,p.windowWidth=d.width(),g.windowScrollTop=g.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop()}function n(){function e(e){s(),u.trigger("DOMEventor:flatresize",p),t=!1}var t;d.on("resize.DOMEventor-nextResizeLoop",function(){t||(f(e),t=!0)})}function o(){function e(e){i--||(g.documentHeight=p.documentHeight,p.documentHeight=h.height(),i=1),g.windowScrollTop=g.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=d.scrollTop(),u.trigger("DOMEventor:flatscroll",p),t=!1}var t,i=0;d.on("scroll.DOMEventor-nextScrollLoop",function(){t||(f(e),t=!0)})}function r(){h.off("keydown.DOMEventor keyup.DOMEventor"),u.on("DOMEventor:startKeyboardObserver",_),u.off("DOMEventor:stopKeyboardObserver")}function a(){s(),o(),n(),_(),u.on("DOMEventor:updateRect",s)}var l=i(3),c=i(8),u=i(139),h=c(document),d=c(window),p={},g={};p.documentHeight=g.documentHeight=null,p.windowHeight=g.windowHeight=null,p.windowWidth=g.windowHeight=null,p.windowScrollTop=g.windowScrollTop=null,p.windowScrollY=g.windowScrollY=null;var _,f=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(e){window.setTimeout(function(){e()},50)};_=function(){var e=[],t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};h.on("keydown.DOMEventor keyup.DOMEventor",function(i){var s=i.type;if("keyup"===s||"keydown"===s){var n=c(i.target),o=i.which;if(!((n.is("input")||n.is("textarea")||n.is("select"))&&o>=48&&o<=90)||i.metaKey||i.ctrlKey||i.altKey){o>=48&&o<=90&&"keydown"===s&&(e[o]=1);var r="";for(var a in e)"keydown"===s&&o!==parseInt(a,10)&&(r+=t[a]?t[a]+"+":"");var l=s+":"+(i.altKey&&18!==o?"alt+":"")+(i.ctrlKey&&17!==o?"ctrl+":"")+(i.metaKey&&91!==o&&92!==o&&93!==o?"meta+":"")+(i.shiftKey&&16!==o?"shift+":"")+(r||"")+(t[o]||"");u.trigger("DOMEventor:"+l,i,l),"keyup"===s&&(e=[])}}}),u.off("DOMEventor:startKeyboardObserver"),u.on("DOMEventor:stopKeyboardObserver",r)};var m={init:l.once(a),rect:function(){return p},lastRect:function(){return g}};e.exports=m},function(e,t,i){"use strict";var s=i(3),n=i(7),o=function(){};o.extend=n.Model.extend,s.extend(o.prototype,n.Events),o.prototype.trigger=function(){return s.isObject(arguments[1])&&(arguments[1].loggingData=arguments[1].loggingData||{}),n.Events.trigger.apply(this,arguments)},e.exports=new o},function(e,t,i){"use strict";var s,n=i(141),o=i(129),r=i(139),a=function(){if(null==s){var e=o.get("Context/userinfo");s=!(!e||!e.name)&&new n(e),s&&(s.listenTo(r,"post:like:set",s.incrementLikeCount),s.listenTo(r,"post:unlike:set",s.decrementLikeCount),s.listenTo(r,"tumblelog:follow",s.incrementFollowingCount),s.listenTo(r,"tumblelog:unfollow",s.decrementFollowingCount))}return s};e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(142),o=i(143),r=i(147),a=n.extend({idAttribute:"name",initialize:function(e){this.channels=new r(e.channels)},incrementLikeCount:function(){var e=this.get("liked_post_count");this.set("liked_post_count",e+1)},decrementLikeCount:function(){var e=this.get("liked_post_count");e>0&&this.set("liked_post_count",e-1)},incrementFollowingCount:function(){var e=this.get("friend_count");this.set("friend_count",e+1)},decrementFollowingCount:function(){var e=this.get("friend_count");e>0&&this.set("friend_count",e-1)},getUnreadCount:function(){return this.channels.reduce(function(e,t){return parseInt(e,10)+parseInt(t.get("unread_count"),10)},0)},getChannel:function(e){return null==e&&(e=this.get("primary")),this.channels.findWhere({name:e})},canMessage:function(){return this.get("can_message")},isSoundsEnabled:function(){return this.get("is_sounds_enabled")},isVerifiedEmail:function(){return this.get("is_verified_email")},getChannelsEnabledForMessaging:function(){return this.channels.where({can_send_messages:!0})},getCurrentMessagingChannelUuid:function(){var e;return s.isEmpty(this._currentMessagingChannelUuid)&&(e=this.channels.findWhere({is_current:!0,can_send_messages:!0})||s.first(this.getChannelsEnabledForMessaging()),e&&(this._currentMessagingChannelUuid=e.get("uuid"))),this._currentMessagingChannelUuid},setCurrentMessagingChannelUuid:function(e){this._currentMessagingChannelUuid=e},toJSON:function(){var e=o.prototype.toJSON.apply(this,arguments);return e.channels=this.channels.toJSON(),e},getChannelProperty:function(e,t){var i=this.getChannel(e);if(!(i&&"get"in i))return null;var s=i.get(t);return"undefined"==typeof s?null:s}});e.exports=a},function(e,t,i){"use strict";function s(e,t){function i(e,t){var i,s;if(!n.isObject(e))throw new Error("SingletonModel requires attributes");if(i=e[d],n.isEmpty(i)&&!n.isNumber(i)&&n.defer(function(){throw new Error('SingletonModel attributes require a "'+d+'"')}),s=u[i],h[i]++||(h[i]=1),s)n.keys(e).length>=2&&s.set(e,t),s.collection!==!0&&(s.collection=!0);else{u[i]=this;try{Object.defineProperty(this,"collection",{value:!0,configurable:!1,enumerable:!0,writable:!1})}finally{this.collection||(this.collection=!0)}this.constructor.__super__.constructor.call(this,e,t),c.add(this)}return s||this}function s(){return this.id}function a(){return c}function l(){0===--h[this.id]&&(delete u[this.id],delete h[this.id],c.remove(this))}e||(e={}),t||(t={});var c=new o.Collection,u=Object.create(null),h=Object.create(null),d=e.idAttribute||r.prototype.idAttribute;return e.constructor=i,e.release=l,e.toString=s,e.toJSON=e.toJSON||r.prototype.toJSON,t.getCollection=a,r.extend(e,t)}var n=i(3),o=i(7),r=i(143);e.exports.extend=s},function(e,t,i){"use strict";var s=i(7),n=i(144),o=i(146),r=s.Model.extend({});n.applyTo(r.prototype),o.applyTo(r),e.exports=r},function(e,t,i){"use strict";var s=i(145),n=new s({before:{sync:function(e,t,i){i.withFormKey=!0}}});e.exports=n},function(e,t,i){"use strict";function s(e,t){u.each(t,function(t,i){var s=e[i];e[i]=function(){return t.apply(this,arguments),s.apply(this,arguments)}})}function n(e,t){u.each(t,function(t,i){var s=e[i];e[i]=function(){var e=s.apply(this,arguments);return t.apply(this,arguments),e}})}function o(e,t){u.each(t,function(t,i){var s=e[i];e[i]=function(){var e=u.toArray(arguments);return e.unshift(u.bind(s,this)),t.apply(this,e)}})}function r(e,t){u.each(t,function(t,i){var s=i in e&&e[i];e[i]=function(){var e=u.toArray(arguments),i=s?u.bind(s,this):u.noop;return e.unshift(i),t.apply(this,e)}})}function a(e,t){u.defaults(e,t)}function l(e,t){u.extend(e,t)}function c(){this.mixins=u.filter(arguments,function(e){return e instanceof c}),this.properties=arguments[this.mixins.length]||{}}var u=i(3);c.prototype.mixins=null,c.prototype.properties=null,c.prototype.applyTo=function(e){var t=this.properties;a(e,t.defaults),l(e,t.extend),u.extend(e,u.omit(t,"before","after","around","onto","defaults","extend","applyTo")),u.invoke(this.mixins,"applyTo",e),s(e,t.before),n(e,t.after),o(e,t.around),r(e,t.onto),u.isFunction(t.applyTo)&&t.applyTo.apply(this,arguments)},c.before=s,c.after=n,c.around=o,c.onto=r,e.exports=c},function(e,t,i){"use strict";function s(e){var t=r.apply(this,arguments);return o.has(e,"mixins")&&e.mixins.forEach(function(e){e.applyTo(t.prototype)}),t}function n(e){e.extend=s}var o=i(3),r=i(7).Model.extend;e.exports.applyTo=n},function(e,t,i){"use strict";var s=i(148),n=i(149),o=s.extend({model:n});e.exports=o},function(e,t,i){"use strict";var s=i(7).Collection,n=i(144),o=i(146),s=s.extend();n.applyTo(s.prototype),o.applyTo(s),e.exports=s},function(e,t,i){"use strict";function s(e,t,i){var s=a.Deferred(),n={data:{tumblelog:e.get("name")}};["placement_id","pt","source","context","tlt","offset"].forEach(function(e){i.hasOwnProperty(e)&&(n.data[e]=i[e])});var o=function(){i.wait||e.set({following:t.following},i)},r=function(n,o){i.wait||e.set({following:!t.following},i),s.reject(o)},l=function(){i.wait&&e.set({following:t.following},i),s.resolve()},c=t.following?"/svc/follow":"/svc/unfollow";return a.ajax({beforeSend:o,cache:!i.force,data:n,error:r,type:"POST",success:l,url:c,withFormKey:!0}),s.promise()}function n(e,t){var i=a.Deferred(),s={};l.has(t,"is_tumblelog_popover")&&(s.is_tumblelog_popover=t.is_tumblelog_popover),l.has(t,"is_user_mention")&&(s.is_user_mention=t.is_user_mention);var n=function(e,t){i.reject(t)},o=function(t){l.has(t,"highlighted_posts")||(t={highlighted_posts:t}),e.set(t),i.resolve()};return a.ajax({cache:!t.force,data:s,error:n,type:"GET",success:o,url:p(e),withFormKey:!0}),i.promise()}function o(e,t){return c.promise(function(i,s){var n={tumblelog:e.get("name")};l.has(t,"include_member_data")&&(n.include_member_data=t.include_member_data),l.has(t,"include_activity_data")&&l.has(t,"include_member_data")&&(n.include_activity_data=t.include_activity_data),l.has(t,"include_activity_notifications")&&l.has(t,"include_member_data")&&(n.include_activity_notifications=t.include_activity_notifications);var o=function(e,t){s(t)},r=function(t){e.set(t.response),i()};a.ajax({data:n,type:"GET",error:o,success:r,url:"/svc/data/tumblelog",withFormKey:!0})})}function r(e,t){return a.ajax({cache:!t.force,data:t.data,type:"GET",url:"/svc/tumblelog_popover/"+e,withFormKey:!0})}var a=i(8),l=i(3),c=i(150),u=i(139),h=i(171),d=i(142),p=function(){function e(e){return e.has("avatar_url")&&e.has("global_theme_params")}return function(t){return e(t)?"/svc/"+t.get("name")+"/posts/highlighted":"/svc/tumblelog_popover/"+t.get("name")}}(),g=d.extend({save_following:function(e,t){t||(t={}),e||(e={}),e.following=!!e.following;var i=this;return t.force||i.get("following")!==e.following?s(i,e,t).then(l.bindKey(i,"save_following",e)):a.when(i.get("following"))},fetch_popover_data:function(e){e||(e={}),e.is_user_mention=!!e.is_user_mention,e.is_tumblelog_popover=!!e.is_tumblelog_popover;var t=this;return!e.force&&t.has("highlighted_posts")?a.when(t.get("highlighted_posts")):n(t,e).then(l.bindKey(t,"fetch_popover_data",null))},fetch_analytics_data:function(){return o(this,{include_member_data:!0,include_activity_data:!0})},fetch_activity_notifications:function(){return o(this,{include_member_data:!0,include_activity_data:!0,include_activity_notifications:!0})},toggle_spam:function(){return a.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_nsfw:function(){return a.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_adult:function(){return a.ajax({url:"/adult/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_uniblock:function(){return a.ajax({url:"/uniblock/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},toggle_suspended:function(){return a.ajax({url:"/suspended/toggle",type:"POST",data:{tumblelog:this.id},withFormKey:!0})},follow:function(e){this.save_following({following:!0},e)},_unfollow:function(e){this.save_following({following:!1},e)},requestUnfollow:function(e){var t=c.defer();return t.promise.then(l.bind(this._unfollow,this,e)).catch(l.noop),t},block:function(){return h.block({blockedTumblelog:this.id})},unblock:function(){return h.unblock({blockedTumblelog:this.id})},toggleSubscription:function(e){var t=this.get("name"),i=!!this.get("is_subscribed"),s=i?"DELETE":"POST",n={url:"/svc/blog/"+t+"/subscription",type:s,withFormKey:!0};return e&&(n.data={source:e}),c.promise(function(e,t){a.ajax(l.assign(n,{success:e,error:t}))}).then(l.bind(function(){this.set({is_subscribed:!i})},this))},defaults:null,idAttribute:"name",initialize:function(){this.bindEvents()},bindEvents:function(){var e=this.get("name");this.on("change:following",function(){if(this.previous("following")){var t=this.get("following")?"tumblelog:follow":"tumblelog:unfollow";u.trigger(t,{name:e,loggingData:e})}this._updateSubscriptionStatus()},this),this.on("change:twitter_send_posts",this._updateUserSocial),this.on("change:facebook_opengraph_send_posts",this._updateUserSocial)},_updateSubscriptionStatus:function(){this.get("following")?this.set("can_subscribe",!0):this.set({can_subscribe:!1,is_subscribed:!1})},_updateUserSocial:function(){var e={tumblelog_name_or_id:this.get("name"),page:"tumblelog","tumblelog[facebook_opengraph_send_posts]":this.get("facebook_opengraph_send_posts")?"on":"off","tumblelog[twitter_send_posts]":this.get("twitter_send_posts")?"on":"off"};a.ajax({data:e,type:"POST",url:"/settings/save",withFormKey:!0})},getDisplayName:function(){return this.get("is_legacy_private_channel")?this.get("directory_safe_title"):this.get("name")},parse:function(e){return e},validate:function(){return!1},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},{collection:null,modelFromToken:function(e){var t,i=g.getCollection(),s=a.Deferred(),n=i.findWhere({token:e});return n?s.resolve(n):(t={data:{is_user_mention:!0}},r(e,t).then(function(t){var i=new g(t);i.set({token:e}),s.resolve(i)},function(){s.reject()})),s.promise()}});g.collection=g.getCollection(),e.exports=g},,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(130),r=i(129),a=i(172),l=i(150),c={_getCurrentTumblelog:function(){var e="",t=r.get("Context/userinfo");return t&&n.each(t.channels,function(t){t.is_current&&(e=t.name)}),e},block:function(e){e=e||{};var t={};return t.tumblelog=e.currentTumblelog||this._getCurrentTumblelog(),e.blockedTumblelog?t.blocked_tumblelog=e.blockedTumblelog:e.blockedPost&&(t.blocked_post=e.blockedPost),e.context&&(t.block_context=e.context),s.ajax({url:"/svc/block/add",type:"POST",data:t,withFormKey:!0})},unblock:function(e){e=e||{};var t={};return t.tumblelog=e.currentTumblelog||this._getCurrentTumblelog(),t.blocked_tumblelog=e.blockedTumblelog,s.ajax({url:"/svc/block/remove",type:"POST",data:t,withFormKey:!0})},confirmBlock:function(e){e=e||{};var t,i=e.currentTumblelog||this._getCurrentTumblelog(),s=l.defer();if(e.blockedTumblelog)t=o("%1$sAre you sure you want to block %2$s from %3$s?%4$sThey won't be able to follow %3$s, send %3$s messages, see %3$s in search results, or interact with any of %3$s's posts.%5$s","<h3>",e.blockedTumblelog,i,"</h3><small>","</small>");else{if(!e.blockedPost)return s.reject(),s.promise;t=o("%1$sBlock messages from this sender?%2$sAny further messages sent from their IP address will be blocked from your inbox. This can't be undone, by the way.%3$s","<h3>","</h3><small>","</small>")}return a.confirm(t,function(){s.resolve(e.blockedTumblelog?e.blockedTumblelog:e.blockedPost)},function(){s.reject()},o("Block"),o("Nevermind")),s.promise.catch(n.noop),s.promise}};e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(177),r=n.extend({name:"Dialog",initialize:function(e){this.dialogView=o,this.options=s.extend({},this.defaults,e)},alert:function(e,t,i){return this.dialogView.alert.call(this.dialogView,e,t,i)},confirm:function(e,t,i,s,n){return this.dialogView.confirm.call(this.dialogView,e,t,i,s,n)},dialog:function(e){return this.dialogView.dialog.call(this.dialogView,e)},isActive:function(e){return this.dialogView.isActive.call(this.dialogView,e)},close:function(e){return this.dialogView.close.call(this.dialogView,e)},getDialogEl:function(){return this.dialogView.getDialogEl.call(this.dialogView)},__:function(e){return this.dialogView.__.call(this.dialogView,e)}});e.exports=new r},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(174),r=i(129),a=(i(132),i(175)),l=i(176),c=["selector","container","rootEl","view","viewOptions","autoAppend"],u=o.extend({name:null,rootEl:null,selector:null,view:null,viewOptions:{},autoAppend:!1,defaults:{},constructor:function(e){e||(e={}),this.cid=s.uniqueId("component"),s.extend(this,s.pick(e,c));var t=s.result(this,"defaults"),i=s.extend({},t,s.pick(e,s.keys(t)));this.attributes={},this.set(i,{silent:!0}),this.changed={},(this.autoAppend||this.selector)&&this.setContainer(),this.selector||(this.selector=this.defaultSelector);var o=s.isFunction(this.viewOptions)?this.viewOptions.call(this.viewOptions,this):this.viewOptions;this.view&&this.view.prototype&&this.view.prototype instanceof n.View?this.view=new this.view(o):s.isFunction(this.view)&&(this.view=this.view.call(this,o)),this.initialize.apply(this,arguments),this.autoAppend&&this.append()},initialize:s.noop,setContainer:function(){return this.selector||(this.selector=this.defaultSelector),this.container=this.selector,this.container},getOwnData:function(){return this.data},remove:function(){s.result(this,"beforeRemove"),this.view&&s.isFunction(this.view.remove)&&this.view.remove();var e=["container","view","defaults","attributes"];return s.each(e,s.bind(function(e){this[e]&&delete this[e]},this)),this.stopListening(),this.trigger("remove"),this},append:function(){return this.view&&s.isFunction(this.view.render)&&(this.container?this.container.appendChild(this.view.render().el):this.view.render()),this.trigger("append"),this}});Object.defineProperties(u.prototype,{defaultSelector:{get:function(){return"[prima-component="+this.name+"]"},set:function(){}},container:{get:function(){return this._container},set:function(e){var t=a(e,this.rootEl);this._container=t}},data:{get:function(){return this._data||(this._data=r.get("Components/"+this.name)),this._data},set:function(e){this._data=e}}}),l.mixin.applyTo(u.prototype),e.exports=u},function(e,t,i){"use strict";function s(){}var n=i(7),o=i(146);s.extend=n.Model.extend,o.applyTo(s),e.exports=s},function(e,t,i){"use strict";function s(e){return e&&e.nodeType&&1===e.nodeType}var n=i(3);e.exports=function(e,t){if(s(e))return e;if(n.isString(e)){var i=(t||document).querySelector(e);if(s(i))return i}return!(!e||!e.jquery)&&e.get(0)}},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(145),r=n.Model.prototype,a={get:r.get,has:r.has,set:r.set,unset:r.unset,clear:r.clear,hasChanged:r.hasChanged,changedAttributes:r.changedAttributes,previous:r.previous,toJSON:r.toJSON,toggle:function(e){this.set(e,!this.get(e))},_validate:s.constant(!0)},l=new o(s.extend({},a,{defaults:s.extend({},n.Events)}));e.exports={props:a,mixin:l}},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(178),r=i(139),a=i(130),l=i(179),c=o.extend({el:".ui_dialog",translations:{},defaultTemplates:{dialog:i(180),content:i(181),button:i(182)},events:{"click .ui_button":"buttonClick"},defaultDialog:{text:"",type:"default",has_form:"auto",visible_glass:!0,confirm_by_enter:!0,close_by_space:!0,key_tab:!0,key_close:!0,scroll_lock:!1,keycommand_maintain:!1,animate:!0,animate_in:{dialog_el:".ui_dialog",dialog_class:"fade-in-up"},on_close:function(){},on_open:function(){}},initialize:function(e){this.options=n.extend(this.defaults,this.options),this.templates=this.defaultTemplates,this.is_visible=!1,this.dialogQueueOrder=[],this.dialogQueue={},this.queueCounter=0,this.currentDialog=!1,this.currentDialogId=0,this.uid=0,this.$body=s("body"),this._initClickLock(),this._setupKeys(),r&&!t.Dialog&&(this.listenTo(r,"dialog:dialog",this.dialog),this.listenTo(r,"dialog:confirm",this.confirm),this.listenTo(r,"dialog:confirm:promise",this.confirmPromise),this.listenTo(r,"dialog:alert",this.alert),this.listenTo(r,"dialog:close",this.close))},dialog:function(e){return!!n.isObject(e)&&this._dialog(e)},confirm:function(e,t,i,s,o){n.isString(e)&&(e={text:e});var r={callback_ok:t,callback_cancel:i,text_ok:s,text_cancel:o};e=n.extend(this.defaultDialog,r,e);var l={text:e.text,customClass:e.customClass||null,type:"confirm",visible_glass:!0,keycommand_maintain:e.keycommand_maintain||!1,templates:e.templates||null,escape_button:0,animate_in:{dialog_el:e.animate_in.dialog_el||".ui_dialog",dialog_class:e.animate_in.dialog_class||"fade-in-up"},buttons:{0:{text:e.text_cancel||a("Cancel"),close:!0,callback:n.isFunction(e.callback_cancel)?e.callback_cancel:function(){}},1:{text:e.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:n.isFunction(e.callback_ok)?e.callback_ok:function(){}}}};return this._dialog(l)},confirmPromise:function(e,t){this.confirm(t,e.resolve,e.reject)},alert:function(e,t,i){n.isString(e)&&(e={text:e});var s={callback_ok:t,text_ok:i};e=n.extend({},s,e);var o={text:e.text,customClass:e.customClass||null,type:"alert",visible_glass:!0,keycommand_maintain:e.keycommand_maintain||!1,templates:e.templates||null,escape_button:0,buttons:{0:{text:e.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:n.isFunction(e.callback_ok)?e.callback_ok:function(){}}}};return this._dialog(o)},getDialogEl:function(){return this.el},buttonClick:function(e){var t=s(e.currentTarget),i=t.data("btn-id");if(n.isUndefined(this.currentDialog.buttons[i])||t.hasClass("disabled"))return!1;var o=this.currentDialog.buttons[i],r=null;n.isFunction(o.callback)&&(r=o.callback(this)),r!==!1&&(!n.isUndefined(o.close)&&o.close||n.isUndefined(o.close))&&this.close()},isActive:function(e){return this.currentDialog!==!1&&this.currentDialog.uid===e},close:function(e){if(this.currentDialog===!1)return!1;if(n.isUndefined(e)&&(e=!1),e!==!1&&this.currentDialog.uid!==e)return!1;if(this.$dialog_lock.removeClass("opaque"),this.$dialog_el.addClass("fade-out-down"),l.transition(this.$dialog_lock,n.bind(function(){this.$dialog_lock.hide()},this)),l.animation(this.$dialog_el,n.bind(function(){s(".ui_dialog_pos").remove()},this)),this.is_visible=!1,this.currentDialog.keycommand_maintain||r.trigger("keycommands:resume"),n.isFunction(this.currentDialog.on_close)&&this.currentDialog.on_close(),r.trigger("dialog:closed"),this.currentDialog=!1,s("html").removeClass("dialog_lock"),this.dialogQueueOrder.length>0){var t=this.dialogQueueOrder.shift(),i=this.dialogQueue[t];delete this.dialogQueue[t],this._dialog(i)}},_tab:function(e){var t=this.$el.find(".buttons .tab_frame"),i=t.filter(".focus"),s=t.index(i),n=t.length,o=!1;o=s+1<n?s+1:0,i.removeClass("focus init_focus");var r=t.eq(o);r.length>0&&(r.addClass("focus"),r.find("button").focus())},_formIsTabToButton:function(e,t){var i=this.$el.find(":focus");if(0===i.length)return!0;var s=this.$el.find(".buttons .tab_frame"),n=this.$el.find(":input:visible"),o=n.index(i);if(t&&o===n.length-1)return this.$el.find(":input:visible:first").focus(),e.preventDefault(),s.removeClass("focus init_focus"),!1;if(o>=0){var r=this.$el.find(":input:visible:eq("+(o+1)+")");if(r.length>0&&r.hasClass("ui_button"))return!0}return s.removeClass("focus init_focus"),!1},_select:function(e){var t=this.$el.find(".buttons .tab_frame.focus"),i=t;1===i.length&&i.find(".ui_button").click()},_formIsFocusOnButton:function(e){var t=this.$el.find(":focus");return 0!==t.length&&t.hasClass("ui_button")},_escape:function(e){if(!n.isUndefined(this.currentDialog.escape_button)){var t=this.$el.find(".btn_"+this.currentDialog.escape_button);t.length&&t.click()}},_dialog:function(e){if(n.isUndefined(e.uid)&&(e.uid=this._getUid()),this.currentDialog!==!1)return this.dialogQueueOrder.push(this.queueCounter),this.dialogQueue[this.queueCounter]=e,this.queueCounter++,e.uid;n.defaults(e,this.defaultDialog);var t=this._buildButtons(e.buttons);n.extend(e,{buttons_html:t});var i=this.templates;n.isObject(e.templates)&&(i=n.extend({},this.templates,e.templates));var o=n.isString(i.dialog)?n.template(i.dialog):i.dialog,a=n.isString(i.content)?n.template(i.content):i.content;e.content_html=a(e);var l=o(e);this.$dialog_lock.show(),n.isUndefined(e.visible_glass)?this.$dialog_lock.removeClass("opaque"):e.visible_glass&&n.defer(n.bind(function(){this.$dialog_lock.addClass("opaque")},this)),!n.isUndefined(e.scroll_lock)&&e.scroll_lock&&s("html").addClass("dialog_lock"),this.currentDialogId=e.uid,this.currentDialog=e;var c=s('<div id="dialog_'+this.currentDialogId+'" class="ui_dialog_pos">'+l+"</div>");return n.isString(e.customClass)&&c.addClass(e.customClass),c.appendTo(this.$body),this.setElement(c),this.is_visible=!0,this.$dialog_el=this.$el.find(e.animate_in.dialog_el),e.animate&&n.isObject(e.animate_in)&&this.$dialog_el.length&&this.$dialog_el.addClass(e.animate_in.dialog_class),this._focus(),this.currentDialog.keycommand_maintain||r.trigger("keycommands:suspend"),n.isUndefined(e.has_form)&&(e.has_form="auto"),"auto"===e.has_form&&(e.has_form=this.$el.find("form, input").length>0),n.isFunction(e.on_open)&&e.on_open(),this.el=this.$el[0],this.delegateEvents(),r.trigger("dialog:opened"),e.uid},_button:function(e,t,i,s){var o=n.isString(this.templates.button)?n.template(this.templates.button):this.templates.button,r=o({btn_class:t,text:e,btn_id:n.isUndefined(i)?"":i});return r='<div class="tab_frame">'+r+"</div>"},_focus:function(){if(!this.currentDialog)return!1;for(var e in this.currentDialog.buttons){var t=this.currentDialog.buttons[e];if(!n.isUndefined(t.selected)&&t.selected){var i=this.$el.find(".btn_"+e);i.length>0&&i.parent().addClass("focus init_focus")}}},_setupKeys:function(){s(document).on("keydown",n.bind(function(e){var t=e.ctrlKey||e.shiftKey||e.metaKey;if(this.is_visible&&!t){var i=e.keyCode||e.which;if(9===i&&this.currentDialog.key_tab){if(this.currentDialog.has_form&&!this._formIsTabToButton(e,!0))return;e.preventDefault(),this._tab(e)}if(13===i&&this.currentDialog.confirm_by_enter||32===i&&this.currentDialog.close_by_space){if(this.currentDialog.has_form&&32===i&&!this._formIsFocusOnButton(e))return;e.preventDefault(),this._select(e)}27===i&&this.currentDialog.key_close&&(e.preventDefault(),this._escape(e))}},this))},_buildButtons:function(e){if(!n.isObject(e))return"";var t=0;for(var i in e)e.hasOwnProperty(i)&&t++;for(var s="",o=0;o<t;o++)if(!n.isUndefined(e[o])){var r=n.isUndefined(e[o].text)?"":e[o].text,a=n.isUndefined(e[o].btn_class)?"":e[o].btn_class,l=!n.isUndefined(e[o].selected)&&e[o].selected;
s+=this._button(r,a,o,l)}return s},_initClickLock:function(){var e=this.$dialog_lock=s("<div>",{class:"ui_dialog_lock",css:{display:"none"}});s(document).ready(function(){e.prependTo("body")})},_getUid:function(){return this.uid++},__:function(e){return a(e)}});e.exports=new c},function(e,t,i){"use strict";function s(e,t){t||(t={}),e||(e=[]),n.each(e,function(e){n.isFunction(this[e])&&this[e].call(this,t)},this)}var n=i(3),o=i(7),r=i(146),a=["model","collection","el","id","attributes","className","tagName","events"],l=["_setup"],c=o.View.extend({constructor:function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,a)),this._elAttributes=this.attributes,this.attributes={},this._ensureElement(),this.setupMethods=n.union(l,this.constructor.__super__.setupMethods,this.setupMethods),s.call(this,this.setupMethods,e),this.initialize.apply(this,arguments),this.delegateEvents()},_setup:n.noop,_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"_elAttributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className"));var t=o.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}}});r.applyTo(c),e.exports=c},function(e,t,i){"use strict";function s(){var e,t,i={animation:null,transition:null},s=document.createElement("div"),n={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in n)if(t in s.style){i.animation=n[t];break}var o={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in o)if(e in s.style){i.transition=o[e];break}return i}function n(e,t){a.animation?r(e).one(a.animation,function(e){t(e)}):setTimeout(function(e){t(e)},0)}function o(e,t){a.transition?r(e).one(a.transition,function(e){t(e)}):setTimeout(function(e){t(e)},0)}var r=i(8),a=s();e.exports={animation:n,transition:o}},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ui_dialog '+(null==(__t=type)?"":__t)+'"> '+(null==(__t=content_html)?"":__t)+' <div class="buttons">'+(null==(__t=buttons_html)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="text">'+(null==(__t=text)?"":__t)+"</span>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<button class="ui_button btn_'+(null==(__t=btn_id)?"":__t)+" chrome "+(null==(__t=btn_class)?"":__t)+'" data-btn-id="'+(null==(__t=btn_id)?"":__t)+'"><span>'+(null==(__t=text)?"":__t)+"</span></button>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s,n=i(173),o=i(184),r=n.extend({name:"header",autoAppend:!0,append:function(){this.headerView=new o({el:this.container}),this.enableFunctionality()},enableFunctionality:function(){this.headerView.enableCompose()},disableSticky:function(){this.headerView.disableSticky()}});e.exports=function(){return s||(s=new r),s}},function(e,t,i){"use strict";var s=i(8),n=i(185),o=i(137),r=i(139),a=i(188),l=i(190),c=i(589),u=i(590),h=i(601),d=i(644),p=i(140),g=n.extend({defaults:{headerHeight:52,headerTop:0},events:{"click .tab_discover > a":"onClickExplore",mouseenter:"__mouseenter",mouseleave:"__mouseleave"},initialize:function(){var e=o.bool("is_logged_in");this.logo=new c({el:'[prima-component="header-logo"]'}),e&&(this.accountMenu=new u({el:".tab_nav_account"}),s(".tab_activity").length&&(this.activityMenu=new h({el:".tab_activity"})),this._initializeMessaging()),this.set("headerTop",this.$el.position().top),this.listenTo(r,"Header:hide",this.hide),this.listenTo(r,"Header:show",this.show),this.listenTo(r,"Header:setTransparent",this.setTransparent),this.$window=s(window)},enableCompose:function(){this.composeBtn=new a,this.switcher=new l},disableSticky:function(){this.$el.addClass("l-header-container--unstuck")},setTransparent:function(e){this.$el.toggleClass("l-header-container--transparent",!!e)},hide:function(){var e=this.$window.scrollTop()+this.get("headerTop"),t=e<this.get("headerHeight")?e:this.get("headerHeight");this.$el.css({position:"absolute",top:e+"px"}),this.$el.velocity({translateY:[-t,0],translateZ:"0px"},150).velocity({translateY:"0px",translateZ:"0px",top:0},0)},show:function(){var e=this.$window.scrollTop(),t=e<this.get("headerHeight")?e:this.get("headerHeight");this.$el.css({position:"absolute",top:e+"px",transform:"translateY("+-t+"px) translateZ(0)"}),this.$el.velocity({translateY:[0,-t],translateZ:"0px"},150).css({position:"fixed",top:this.get("headerTop")})},onClickExplore:function(){r.trigger("explore-links:click",{loggingData:{source:"app-header"}})},_initializeMessaging:function(){var e=p(),t=this.$(".tab_messaging"),i=o.bool("is_logged_in")&&t.length>0&&e.canMessage();i?this.messaging=new d({inboxAnchorEl:t,inboxPopoverOptions:{isFixedPosition:"fixed"===this.$el.css("position")}}).render():t.length&&t.hide()},__mouseenter:function(){r.trigger("Header:mouseenter")},__mouseleave:function(){r.trigger("Header:mouseleave")}});e.exports=g},function(e,t,i){"use strict";function s(e,t,i){return n.isFunction(e)&&(e=e(t,i)),e instanceof o?e:t.$(e)}var n=i(3),o=i(8),r=i(7),a=i(150),l=i(186),c=i(187),u=i(176),h=i(178),d=h.extend({rendered:!1,disposed:!1,keepElement:!1,_setup:function(e){e||(e={});var t=n.extend({},n.result(this.constructor.__super__,"defaults"),n.result(this,"defaults"));n.extend(t,n.pick(e,n.keys(t))),this.attributes={},this.set(t),this.changed={};var i=this.render;this.render=n.bind(function(){this._beforeRender.apply(this,arguments),this.beforeRender.apply(this,arguments);var e=i.apply(this,arguments);return this.afterRender.apply(this,arguments),this._afterRender.apply(this,arguments),e},this);var s=this.remove;this.remove=n.bind(function(){if(this.disposed)return this;this._beforeRemove.apply(this,arguments),this.beforeRemove.apply(this,arguments);var e=s.apply(this,arguments);return this.afterRemove.apply(this,arguments),this._afterRemove.apply(this,arguments),e},this),this.subviews=n.extend({},this.subviews,e.subviews)},initialize:n.noop,_registerSubview:function(e){return this._subviews||(this._subviews=[]),this._subviews.push(e),e},appendSubview:function(e,t){return n.isString(t)&&(t=this.$(t)),this._registerSubview(e),e.render(),(t||this.$el).append(e.el),e},removeSubviews:function(){var e=n.flatten(this._subviews);e&&(n.invoke(e,"remove"),delete this._subviews)},renderSubviews:function(){this.subviews&&n.forEach(this.subviews,function(e,t){e instanceof r.View?this.renderSubview(e,{name:t}):e.collection?this.renderCollectionSubviews(t):this.renderSubview(t)},this)},_createDefaultContainerFunction:function(e){return n.bind(function(){return this.$('[data-subview="'+e+'[]"]')},this)},_createDefaultPrepareViewFunction:function(e){var t=this.subviews[e];return n.bind(function(i,s){var n=new t.constructor(s);return n.$el.attr("data-subview",e),i.append(n.$el),n},this)},renderCollectionSubviews:function(e){var t=this.subviews[e];if(t){var i=t.container||this._createDefaultContainerFunction(e),s=t.prepareView||this._createDefaultPrepareViewFunction(e),n=t.options||{},o=this.createCollectionSubviewRenderer(t.collection,i,s,n,e);this.rendered?o():this.once("rendered",o,this)}},renderSubview:function(e,t){var i,s,o,a;if(n.isString(e)){if(a=e,e=this.subviews[a],!e)return;i=e.container||'[data-subview="'+a+'"]',o=e.options||{},s=e.prepareView||function(t,i){if(!n.isEmpty(t)){var s=new e.constructor(i);return s.$el.attr("data-subview",a),t.replaceWith(s.$el),s}}}else e instanceof r.View&&(t||(t={}),a=t.name||"",i=t.container||'[data-subview="'+a+'"]',o=t.options||{},s=t.prepareView||function(t){return e.$el.attr("data-subview",a),t.replaceWith(e.$el),e});var l=this.createSubviewRenderer(i,s,o,a);this.rendered?l():this.once("rendered",l,this)},createSubviewRenderer:function(e,t,i,o){return n.bind(function(){if(this.el){i=i||{},n.isFunction(i)&&(i=i.call(i,this));var r=s(e,this,o);if(!n.isEmpty(r)){var a=t.call(this,r,i);o&&n.set(this,o,a),a.render(),this._registerSubview(a)}}},this)},createCollectionSubviewRenderer:function(e,t,i,o,a,l,c){var u;return n.bind(function(){if(this.el){var h=0;if(a&&(l?h=this[a].length:this[a]=[]),e===!0&&(e=this.collection),n.isFunction(e)&&(e=e(this)),e instanceof r.Collection&&(e=e.models),!n.isEmpty(e)){var d=s(t,this,a);n.isEmpty(d)||(l||(u=d,d=u.clone()),n.forEach(e,function(e,t){var s;s=n.isFunction(o)?o.call(o,this,e)||{}:n.extend({},o),s.model||(s.model=e);var r="";a&&(r=a+"["+(h+t)+"]"),c&&n.extend(s,c),this.createSubviewRenderer(d,i,s,r).call(this)},this),l||u.replaceWith(d))}}},this)},_beforeRender:n.noop,beforeRender:n.noop,render:function(){return!this.disposed&&(this.renderWithTemplate(),this)},afterRender:n.noop,_afterRender:function(){this.renderSubviews(),this.rendered=!0,this.trigger("rendered",this),this._verifySubviewsRendered()},getTemplateData:function(){var e=l(this);return this.model&&(e.model=l(this.model)),this.collection&&(e.collection={items:l(this.collection),length:this.collection.length}),e},renderWithTemplate:function(e){if(n.isUndefined(this.template))throw new Error("Template function needed.");var t;return t=n.isFunction(this.template)?this.template(e||this.getTemplateData()):this.template,this.$el.html(t),this},afterRenderSubviews:n.noop,_verifySubviewsRendered:function(){var e=n.bind(function(){this.afterRenderSubviews(),this.trigger("renderedSubviews")},this),t=n.reject(this._subviews,function(e){return e.rendered===!0||e._rendered===!0});n.isEmpty(t)?e():a.map(t,function(e){return a.promise(n.partial(function(t,i){e.once("rendered",t)},e))}).then(e)},_beforeRemove:function(){this.removeSubviews()},beforeRemove:n.noop,remove:function(){return this.keepElement?(this.undelegateEvents(),this.stopListening()):h.prototype.remove.apply(this,arguments),this},afterRemove:n.noop,_afterRemove:function(){var e=["el","$el","options","model","collection","subviews","_subviews","defaults","attributes"];n.forEach(e,n.bind(function(e){this[e]&&delete this[e]},this)),this.rendered=!1,this.disposed=!0}},{subviewWithOptions:function(e){return c.call(null,this,e)}});u.mixin.applyTo(d.prototype),e.exports=d},function(e,t,i){"use strict";function s(e){return n.isFunction(e.serialize)?e.serialize():n.isFunction(e.toJSON)?e.toJSON():void 0}var n=i(3);e.exports=s},function(e,t,i){"use strict";function s(e,t){return{constructor:e,options:function(e){var i=n.isFunction(t)?t(e):t;return n.extend(n.pick(e,e.viewOptionKeys),i)}}}var n=i(3);e.exports=s},function(e,t,i){"use strict";var s=i(137),n=i(178),o=i(139),r=i(189),a=n.extend({mixins:[r],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),s.bool("dashboard_refresh")?(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close)):(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close))},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(e,t){s.bool("dashboard_refresh")?t?o.trigger("fastCompose:init",{loggingData:this.loggingData}):o.trigger("fastCompose:dismiss",{loggingData:this.loggingData}):t?o.trigger("fastCompose:init"):o.trigger("fastCompose:dismiss")}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(145),r=i(176),a=new o(s.extend({},r.props,{defaults:s.extend({},n.Events),before:{initialize:function(){var e=s.defaults({},s.result(this,"defaults"));this.attributes={},this.set(e),this.changed={}}}}));e.exports=a},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(173),r=i(139),a=i(191),l=i(193),c=o.extend({name:"switcher",mixins:[a],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=s("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(r,"keycommands:suspend",this.suspend),this.listenTo(r,"keycommands:resume",this.resume),this.listenTo(r,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(r,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(r,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(e){"MacIntel"===navigator.platform&&this.initFastCompose(e)},winFastCompose:function(e){"Win32"===navigator.platform&&this.initFastCompose(e)},initFastCompose:function(e){this.suspended||this.fastCompose||(this.determineSource(e),this.fastCompose=new l({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),r.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),r.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=s("<div>",{class:"glass show"}).appendTo(this.$body),n.defer(n.bind(function(){this.$glass.addClass("blue")},this)),r.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,r.trigger("drawer:resume")},determineSource:function(e){this.loggingData.source="fast-compose",e&&(e.originalEvent instanceof window.KeyboardEvent?this.loggingData.source="keycommand":e.loggingData&&e.loggingData.source&&(this.loggingData.source=e.loggingData.source))}});e.exports=c},function(e,t,i){"use strict";var s=i(145),n=i(139),o=i(3),r=i(192),a=new s({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),r.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(e,t){this.listenTo(n,"DOMEventor:"+t,this.__keyFn)},__keyFn:function(e,t){!this.__keysDisabled&&r.shouldRun(t,this.__keyId)&&this[this.keycommands[t]].apply(this,arguments)},focusKeys:function(){r.focus(this.__keyId)},unfocusKeys:function(){r.unfocus(this.__keyId)},soloKeys:function(e){r.solo(this.__keyId,e)},unSoloKeys:function(){r.unSolo(this.__keyId)},disableKeys:function(){this.__keysDisabled=!0},enableKeys:function(){this.__keysDisabled=!1},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keysDisabled=!1,this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(e){(o.isEmpty(e)||e===this)&&r.remove(this.__keyId)}}});e.exports=a},function(e,t,i){"use strict";var s=i(174),n=i(3),o=s.extend({soloId:null,constructor:function(){this.keySets=[],this.soloBubblingWhitelist=[]},add:function(e){this.keySets.unshift(e)},remove:function(e){var t=this.getSetForId(e);t&&(this.unSolo(e),this.keySets=n.without(this.keySets,t),this.soloBubblingWhitelist=n.without(this.soloBubblingWhitelist,e))},focus:function(e){var t=this.getSetForId(e);t&&(this.keySets=n.without(this.keySets,t),this.keySets.unshift(t))},unfocus:function(e){var t=this.getSetForId(e);t&&(this.keySets=n.without(this.keySets,t),this.keySets.push(t))},solo:function(e,t){var i=this.getSetForId(e);i&&(this.soloId=e,t===!0&&this.soloBubblingWhitelist.push(e))},unSolo:function(e){this.soloId===e&&(this.soloId=null,this.soloBubblingWhitelist=n.without(this.soloBubblingWhitelist,e))},getSetForId:function(e){return this.keySets[n.findIndex(this.keySets,{id:e})]},getSetsWithKey:function(e){return n.where(this.keySets,{keys:[e]})},shouldRun:function(e,t){var i=this.getSetsWithKey(e);return this.soloId===t||!(!n.isEmpty(this.soloBubblingWhitelist)&&!n.contains(this.soloBubblingWhitelist,t))&&(!(i.length>1)||i[0].id===t)}});e.exports=new o},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(194),r=i(129),a=i(130),l=i(150),c=i(178),u=i(139),h=i(137),d=i(191),p=i(189),g=i(195),_=i(588),f=c.extend({template:_,className:"fast-compose",defaults:{tabIndex:-1,icons:[{name:"text",label:"Text"},{name:"photo",label:"Photo"},{name:"quote",label:"Quote"},{name:"link",label:"Link"},{name:"chat",label:"Chat"},{name:"audio",label:"Audio"},{name:"video",label:"Video"}]},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[p,d],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(e){this.loggingData=e?e.loggingData:{},n.forEach(this.get("icons"),function(e){e.label=a(e.label)}),this.$body=s("body"),this.$glass=null,this.$plexiInstance=s('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0},bindEvents:function(){this.listenTo(u,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(u,"DOMEventor:keydown:shift+tab",this.disableKey),this.listenTo(this,"change:tabIndex",function(e,t){this.$(".selected").removeClass("selected"),this.$('[data-index="'+t+'"]').addClass("selected")})},render:function(){return this.$el.append(this.template(this.toJSON())),this.bindEvents(),this},open:function(){n.defer(n.bind(this.show,this))},show:function(){u.trigger("keycommands:suspend");var e=50;n.forEach(this.$(".tab-post-type"),function(t,i){var n=s(t),r=n.find(".post-type-icon"),a=n.find(".post-type-name");o.animate(r,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:i*e}),o.animate(a,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:i*e})},this),s(".post-tab-switching").addClass("finish-animating")},enterCreate:function(e){var t=this.$(".selected");if(t.length){var i=t.attr("data-post-type");this.createNew(i),this.close()}},clickCreate:function(e){this.createNew(s(e.currentTarget).data("postType"))},disableKey:function(e){e.preventDefault()},mouseoverIcon:function(e){this.$(".selected").removeClass("selected"),this.set("tabIndex",s(e.currentTarget).data("index"))},nextIcon:function(e){var t=this.get("tabIndex")+1;t>=this.get("icons").length&&(t=0),this.set("tabIndex",t)},previousIcon:function(e){var t=this.get("tabIndex")-1;t<0&&(t=this.get("icons").length-1),this.set("tabIndex",t)},createNew:function(e){this.resumeKeycommandsOnClose=!1,r.has("Components/PostFormBuilder")?u.trigger("postForms:open",{updateURL:!1,postFormType:g.containerType("modal"),postType:e,fastCompose:!0,loggingData:this.loggingData}):u.trigger("fastCompose:create",{type:e,loggingData:this.loggingData})},close:function(){var e=50,t=this.$(".tab-post-type"),i=Math.floor(.5*(t.length-1));l.all(n.map(t,function(t,n){var r=s(t),a=Math.floor(Math.abs(n-i))*e;return o.animate(r,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:a})},this)).then(function(){u.trigger("fastCompose:close:complete")})},teardown:function(){return this.resumeKeycommandsOnClose&&u.trigger("keycommands:resume"),this.remove()}});e.exports=h.bool("is_logged_in")?f:n.noop},,function(e,t,i){"use strict";var s=(i(196),i(3)),n=i(8),o=i(150),r=i(197),a=i(199),l=i(173),c=i(139),u=i(138),h=(i(132),i(7)),d=(i(200),i(201)),p=i(202),g=i(205),_="/dashboard",f=i(130),m=n("body"),v=i(206),b=i(172),y=i(140),w=i(210),k=i(314),C=i(579),x=i(580),S=i(582),T=i(587),E=l.extend({name:"PostFormBuilder",initialize:function(){var e=this.data;if(this.user=y(),this.user){v(s.bind(function(e){this.PostFormComponent=e},this));var t={baseRoute:null,currentChannel:null,supportImageSearch:!1,minFullWidthSize:300,redirectTo:!1,reblogActionContext:!1,updateURL:!0};s.extend(this,t,s.pick(e,s.keys(t))),this._addGlobalEventListeners(),this.user.set(e.limits),this.user.set(e.dashboardSettings),this.user.set("language",e.language||"en_US"),k.setEmbedRegexes(e.embedRegexes),this.glass=new C,this.modal=new x,this.modalContainer=new S({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new T({el:"#new_post"}),this.postButtonsContainer=new S({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new d,this.saveHook=new p(s.extend({$postButtonsContainer:this.postButtonsContainer.$el},e)),this.legacyEvents(),this._updateData=s.once(this.updateData),this.render()}},updateData:function(){var e=n.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",withFormKey:!0,data:{}});return e.then(s.bind(function(e){var t=e.response;return s.forEach(t.channels,function(e){var t=!!e.name&&this.user.getChannel(e.name);t&&t.set(s.omit(e,"name"))},this),this.user.set(t.limits),t},this))},legacyEvents:function e(){var e={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["post:form:show","keycommands:suspend"]};s.forEach(e,function(e,t){this.listenTo(c,t,function(){var t=s.toArray(arguments);s.each(e,function(e){c.trigger.apply(c,[].concat(e,t))},this)})},this)},_addGlobalEventListeners:function(){this.listenTo(c,"postForms:open",this.fetchAndCreatePostFormComponent),this.listenTo(c,"postForms:new",this._createPostFormNew),this.listenTo(c,"postForms:edit",this._createPostFormEdit),this.listenTo(c,"postForms:reblog",this._createPostFormReblog),this.listenTo(c,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(c,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(c,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(e){this.stopListening(c,"postForms:close"),e&&this._registerDismissListener()},_registerDismissListener:function(){this.listenTo(c,"postForms:close",this.dismissPostForm)},createInlineContainer:function(e){return!!e&&new S({el:e.parent(),originalContent:e,transitionBackground:!0})},fetchAndCreatePostFormComponent:function(e){s.isEmpty(this.PostFormComponent)?v(s.bind(function(t){this.PostFormComponent=t,this._createPostForm(e)},this)):this._createPostForm(e)},_createPostFormNew:function(e){this.fetchAndCreatePostFormComponent(e)},_createPostFormEdit:function(e){e.postEl&&(e.containerView=this.createInlineContainer(e.postEl),e.postFormType=g.inline),this.fetchAndCreatePostFormComponent(e)},_createPostFormReblog:function(e){this.fetchAndCreatePostFormComponent(e)},_createPostForm:function(e){if(this.postForm)return this.destroyPostForm(e).then(s.bind(function(){return this._createPostForm(e)},this));e=s.extend({fastCompose:!1,supportImageSearch:this.supportImageSearch,minFullWidthSize:this.minFullWidthSize,updateURL:this.updateURL,glass:!0,postFormType:g.modal},e),s.defaults(e,{containerView:e.postFormType===g.inline?this.postButtonsContainer:null}),e.post||(e.post=this._createPostModel(e)),e.url||(e.url=this._postFormUrl(e.post)),e.containerView===this.postButtonsContainer&&this.postButtons.setPostType(e.post.get("type")),this._updateData();var t=e.postFormType===g.modal,i=["supportImageSearch","minFullWidthSize","post"];"photo"===e.post.get("type")&&i.push("showPhotoBooth");var a=this.postForm=new this.PostFormComponent(s.extend(s.pick(e,i),{isModal:t,popoverContainer:t?this.modal.$el:m,redirectTo:this.redirectTo,reblogActionContext:this.reblogActionContext,fastCompose:e.fastCompose})),l=this.postFormContainer=e.containerView||this.modalContainer;if(!l)throw new Error("No post form container!");this.listenTo(a,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(a,"resumeScrollHelper",this.resumeScrollHelper),l.isRendered()||l.render(),l.setPostFormComponent(a);var d=s.once(s.bind(function(){return e.glass?this.glass.show():o.resolve()},this)),p=r([function(){return c.trigger("Header:hide"),o.join(l.prepare(d),a.whenRendered(!0))},function(){return a.disable(),l.attach(d)},function(){return e.updateURL&&h.history.navigate(e.url,{replace:!0}),function(){var e=u.rect(),i=e.windowScrollTop,o=e.windowHeight,r=a.getRect(),h=r.offsetHeight,d=l.$el.offset().top,p=d+h,g=20,_=n("[prima-component=header]").height()||0,f=h+2*g<o,m=this.scrollHelper.calculateScrollTop(d-g,p+g+_,o,f),v=400,b=t?this.modal.$el:null;l===this.postButtonsContainer&&i<m&&o>h&&(m=i),this.previousScrollPosition=!t&&i,this.scrollHelper.scrollToPosition(m,v,b),this.listenTo(c,"Photoset:dragScroll",function(e,t){s.isNumber(t)||(t=50);var i=u.rect().windowScrollTop+e;this.scrollHelper.scrollToPosition(i,t,b)}),this.listenTo(c,"Photoset:scrollToRow",function(e,t,i){s.isNumber(i)||(i=50),e+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:e,offsetHeight:t}})})}.call(this),l.showPostForm(d)},function(){return d()},function(){a.enable()}],this).then(s.bind(function(){return c.trigger("postForms:opened"),m.addClass("postforms-open"),a},this),s.bind(function(){this.destroyPostForm()},this));return e.postFormType===g.inline&&p.then(s.bind(function(){this.scrollHelper.start({el:l.$el})},this)),p.catch(function(e){e instanceof Error&&s.defer(function(){throw e})}),p},_postFormStateChanged:function(e){if(this.postForm){var t=this.postForm.initialPostState,i=this.postForm.post;return i.deepHasChanged(t)}return!1},dismissPostForm:function(){this.postForm&&!this.postForm.isEnabled()||(this._postFormStateChanged()?this._buildDismissPrompt():this.destroyPostForm())},_buildDismissPrompt:function(){var e=f("Discard this post?");this.postForm&&this.postForm.post&&"edit"===this.postForm.post.get("mode")&&(e=f("Discard edits to this post?"));var t={text:e,text_ok:f("Discard"),text_cancel:f("Nevermind"),keycommand_maintain:!0};b.confirm(t,s.bind(function(){this.destroyPostForm(),c.trigger("postForms:dismissListener:resume")},this),function(){s.defer(function(){c.trigger("postForms:dismissListener:resume")})}),c.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(e,t){e=s.extend({updateURL:this.updateURL,url:this.baseRoute,glass:!0},e),this.scrollHelper.stop();var i=this.postForm,n=this.postFormContainer,a=!!i.fastCompose;this.postForm=null,this.postFormContainer=null,this.stopListening(i),this.stopListening(c,"Photoset:dragScroll");var l=s.once(s.bind(function(){return e.glass?this.glass.hide():o.resolve()},this)),u=i&&!!i.postForm.get("saved"),d=r([function(){u&&this.saveHook.preExecute(t)},function(){i&&i.disable()},function(){if(function(){if(this.previousScrollPosition!==!1){var e=this.previousScrollPosition,t=400;this.scrollHelper.scrollToPosition(e,t)}}.call(this),n)return n.hidePostForm(l).then(function(){n.teardown()})},function(){if(i&&i.remove(),e.updateURL){var t=h.history.root||"",s=e.url?e.url.replace(new RegExp("^"+t),""):"";h.history.navigate(s,{replace:!0})}},function(){return l()},function(){u&&t&&(this.saveHook.$inlinePostEl=n.$el,this.saveHook.execute(t,{fastCompose:a}))}],this).then(function(){return c.trigger("postForms:closed"),c.trigger("Header:show"),m.removeClass("postforms-open"),i});return d.catch(function(e){e instanceof Error&&s.defer(function(){throw e})}),d},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(e){"string"==typeof e&&(e={postType:e});var t=s.extend({tumblelog:e.channelId||this.currentChannel||this.user.getChannel().get("name"),editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute}},s.pick(e,"tags","sourceUrl","loggingData"));return e.reblogId?s.defaults(t,{lookupData:{reblog_id:e.reblogId,reblog_key:e.reblogKey,carousel_index:e.carousel_index},mode:"reblog",pt:e.pt,reblogSource:e.reblogSource}):e.editId?s.defaults(t,{lookupData:{post_id:e.editId,channel_id:e.channelId||this.redirectChannel},mode:"edit"}):s.defaults(t,{type:e.postType||e.type||"text",mode:"new"}),new w(t)},_postFormUrl:function(e){if(e){if(e.has("lookupData")){var t=e.get("lookupData");return t.reblog_id?this._reblogPostUrl(t.reblog_id,t.reblog_key):t.post_id?this._editPostUrl(t.post_id):this._newPostUrl(e.get("type"))}return e.has("reblog_id")?this._reblogPostUrl(e.get("reblog_id"),e.get("reblog_key")):e.has("id")?this._editPostUrl(e.get("id")):this._newPostUrl(e.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(e){var t=this.baseRoute!==_?this.baseRoute:"";return t+"/new/"+e},_editPostUrl:function(e){return"/edit/"+e},_reblogPostUrl:function(e,t){return"/reblog/"+e+"/"+t},render:function(){return this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this},updateBaseRoute:function(e){var t;e?this.baseRoute=e:(t=h&&h.history?h.history.location.pathname:_,this.baseRoute=t)}},{containerType:function(e){return g[e]}});a.applyTo(E.prototype),e.exports=E},function(e,t,i){"use strict";function s(e,t){t=t||"Exposer";var i=window;n.each(e,function(e,s){if(n.has(i,s))throw new Error('"'+s+'" already exists');o.log(t,"%s.%s",i,s),n.set(i,s,e)})}var n=i(3),o=i(132);e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(198),o=function(e,t){e=s.map(e,function(e){return s.bind(e,this)},t||this);var i=Array.prototype.slice.call(arguments,1);return i[0]=e,n.apply(null,i)};e.exports=o},function(e,t,i){var s;/** @license MIT License (c) copyright 2011-2013 original author or authors */
!function(n){s=function(e){var t=i(150),s=t.Promise.all,n=Array.prototype.slice;return function(e){function i(e){return o.push(e),o}var o=[];return s(n.call(arguments,1)).then(function(s){return t.reduce(e,function(e,n){return t(n.apply(void 0,s),i)},o)})}}.call(t,i,t,e),!(void 0!==s&&(e.exports=s))}(i(155))},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(145),r=new o({defaults:{whenEvent:function(e,t){return 1===arguments.length&&(t=e,e=this),n.promise(s.bind(function(i,s){this.listenToOnce(e,t,function(){i.call(null,arguments)})},this))}}});e.exports=r},function(e,t){"use strict";var i=1,s=function(e){return e*i};s.get=function(){return i},s.set=function(e){i=e},e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(194).animate,r=i(200),a=i(174),l=i(7),c=i(138),u=i(139),h=(i(132),n("html")),d=a.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(e){return this._running&&this.stop(),this._running=!0,e&&!s.isPlainObject(e)&&(e={el:e}),this.options=e=s.extend({},this.defaults,e),this.$el=n(e.el),this.updateContentRect(),this.listenTo(u,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:function(){this._running&&(this._ignoreScroll=!0)},resume:function(){this._running&&this._ignoreScroll&&(this._ignoreScroll=!1,this.checkScrollBounds())},updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var e=this.$el.offset();return this.contentRect.offsetTop=e.top,this.contentRect.offsetLeft=e.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=s.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(e,t,i,s){return s?e:t-i},checkScrollBounds:function(e,t){if(!this._ignoreScroll){t=t?s.extend({},this.defaults,this.options,t):this.options,e||(e=c.rect());var i,n,o=t.contentRect||this.updateContentRect(),r=t.triggerPadding||0,a=t.contentPadding||0,l=o.offsetHeight,u=o.offsetTop,h=u+l,d=e.windowHeight,p=Math.max(0,e.windowScrollTop),g=p+d;return t.keepInside?(i=p-u,n=h-g):(i=p-h,n=u-g),n>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,l+2*a>d),this.enforceScrollBounds(t),!0):i>r?(this._scrollTop=this.calculateScrollTop(u-a,h+a,d,t.bottom||l+2*a<d),this.enforceScrollBounds(t),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(e){var t=null!=e.scrollTop?e.scrollTop:this._scrollTop,i=e.scrollSpeedMs,n=e.debounceMs,o=e.container;n?this._enforceTimeout||(this._enforceTimeout=s.delay(s.bind(function(){null==e.scrollTop&&(t=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(t,i,o)},this),n)):this.scrollToPosition(t,i,o)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(e,t,i){this._ignoreScroll=!0,o(h,"stop"),o(h,"scroll",{offset:e,container:i,duration:r(t||this.defaults.scrollSpeedMs)}).then(s.bind(function(){this._ignoreScroll=!1},this))}});s.extend(d.prototype,l.Events),e.exports=d},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(203),r=i(139),a=i(204),l=i(140),c=function(){var e=".post_container",t=".post:not([data-is-pinned])",i=["dashboard","drafts","inbox"],c={preExecute:function(){if("queue"===this.contextData.contextPage)return n(window).off("beforeunload"),void window.location.replace(this.contextData.baseRoute)},execute:function(e,t){if(t=s.merge({fastCompose:!1},t||{}),this.saveResponse=e.responseJSON,i.indexOf(this.contextData.contextPage)!==-1){var r=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,a="post_dashboard_html"in this.saveResponse,c=!(!this.saveResponse.post||!this.saveResponse.post.is_edit)&&this.contextData.contextPage!==this.saveResponse.post_context_page&&this.$inlinePostEl.hasClass("post_container");if(r?this._fetchMorePosts():a&&(c?this._removeInline():this._updateInline()),this._displayNotification(this.saveResponse,t),this.saveResponse.context_tumblelog){var u=this.saveResponse.context_tumblelog.name_or_id,h=n('#dashboard_controls_open_blog[data-blog-name="'+u+'"]');s.forEach(this.saveResponse.context_tumblelog,function(e,t){if(t.match(/_count$/i)){var i=h.find('[data-blog-controls-count="'+t+'"]');i.toggleClass("count_0",e<="0"),i.find(".count").text(o(e).format("0,0"))}},this);var d=l().getChannel(u),p=s.pick(this.saveResponse.context_tumblelog,d.keys());d.set(p)}}},_fetchMorePosts:function(){var e=this.contextData.baseRoute.replace(/^\/|\/$/g,""),t="drafts"===this.contextData.contextPage?"after":"before",i=this._findLatestPostId(),n=new a;n.fetch({pageRoot:e,direction:t,refPostID:i,success:s.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(i){var s=n(i.get("dashboardHTML")),o=this.contextData.$postButtonsContainer.nextAll(e).has(t).first();0===o.length?this.contextData.$postButtonsContainer.parent().append(s):s.insertBefore(o),n(".no_posts_found").remove(),r.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_findLatestPostId:function(){var i=this.contextData.$postButtonsContainer.nextAll(e).find(t).first().data("post-id");return i},_updateInline:function(){var e=n(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(e.eq(0)),r.trigger("posts:load")},_removeInline:function(){var e=this.contextData.baseRoute.split("/");e.splice(-1,1);var t=this.$inlinePostEl;if(t.fadeOut(200,function(){t.remove()}),n("#posts .post").not(".new_post").length<=1)return void(window.location=e.join("/"))},_displayNotification:function(e,t){var i=this.contextData.baseRoute.split("/"),n=i[1]||"",o=e.message,a=s.parseInt(this.contextData.notificationDelay),l={type:"dashboard"===e.post_context_page?"dashReblog":e.post_context_page,url:e.post_tumblelog.post_url,tumblelog:{name:e.post_tumblelog.name_or_id,url:e.post_tumblelog.url,avatar:e.post_tumblelog.avatar}};(!e.created_post||e.post.is_reblog||t&&t.fastCompose||"tagged"===n.toLowerCase())&&s.delay(function(){r.trigger("postForms:saveHook:toast",o,l)},a)}},u=function(e){this.contextData=s.defaults(e||{},{notificationDelay:250}),s.extend(this,c)};return u}();e.exports=c},,function(e,t,i){"use strict";var s=i(3),n=i(6).sprintf,o=i(143),r=o.extend({endpoint:"/svc/post/%s/%s/%s",parse:function(e){return{dashboardHTML:e.trim()}},sync:function(e,t,i){if("read"!==e)throw new Error("The DashboardPostFetch model may only READ from server!");if(i=s.defaults(i||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(i.pageRoot&&i.direction))throw new Error(n("These two fetch params must be passed: pageRoot [%s], direction [%s]",i.pageRoot,i.direction));return s.defaults(i,{dataType:"html",emulateHTTP:!0,url:n(this.endpoint,i.pageRoot,i.direction,i.refPostID)}),o.prototype.sync.call(this,e,t,i)}});e.exports=r},function(e,t){"use strict";var i={modal:1,inline:2};e.exports=i},function(e,t,i){"use strict";var s=i(207),n=function(e){i.e(1,function(t){try{e(i(208))}catch(e){s(e,"post-form")}})};e.exports=n},function(e,t,i){"use strict";var s=i(130),n=i(172),o=function(e,t,i){var o=s("Sorry, we seem to be having technical trouble. Please try again later.");throw"function"==typeof i?i(e):n.alert("string"==typeof i?i:o),new Error("require.ensure error: "+t+": "+e)};e.exports=o},,function(e,t,i){"use strict";var s=i(3),n=[16,24,30,40,48,64,96,128,512],o=s.last(n),r=128,a=function(e){return e>=o?o:s.find(n,function(t){return t>=e})},l=function(e,t){var i=function(t){return t=null==t?r:a(t),(e||"").replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+t+"$3")};return i.toString=function(){return this()},null!=t?i(t):i};e.exports=l},function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(3),o=i(143),r=i(196),a=i(211),l=i(212),c=i(214),u=i(222),h=i(223),d=i(226),p=i(227),g=i(228),_=i(230),f=i(231),m=i(213),v=i(224),b=i(225),y=o.extend({mixins:[a],typeDelegateMap:{text:l,photo:c,quote:u,link:h,chat:d,audio:p,video:g,note:_},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2",private:"private",unapproved:"0 3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{published:"published",0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled",private:"private"},defaults:{allow_photo_replies:Boolean(),carouselDisplay:!1,postDate:String(),customUrl:String(),sourceUrl:String(),carouselLinkUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new",contentStats:{},loading:!1,hasLoadingInlineImages:!1,members_only:!1,owner_flagged_nsfw:!1,canBeLiked:!0,canBeReblogged:!0,enableCTA:!1,ctaTextCode:"0",ctaLinkUrl:String(),ctaAndroidLinkUrl:String()},shortUrlLength:29,typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],allowAnswerFields:[],_syntheticAttributes:{pseudoState:function(){var e=this.get("state"),t=this.get("publish_on");return"published"===e&&1===parseInt(this.get("is_private"),10)&&(e="private"),"queued"===e?n.isEmpty(t)?"queued":"scheduled":e},formattedSourceUrl:function(){var e,t=this.get("sourceUrl");return n.isEmpty(t)?"":(e=v.addProtocolIfMissing(t,"https:"),b.isUrl(e)?e:t)},formattedCarouselLinkUrl:function(){var e,t=this.get("carouselLinkUrl");return n.isEmpty(t)?"":(e=v.addProtocolIfMissing(t,"https:"),b.isUrl(e)?e:t)},formattedCTALinkUrl:function(){var e,t=this.get("ctaLinkUrl");return n.isEmpty(t)?"":(e=v.addProtocolIfMissing(t,"https:"),b.isUrl(e)?e:t)}},initialize:function(e,t){n.has(e,"tags")||this.set("tags",[]),this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var e=this.get("type"),t=n.bind(function(e){return e in this.typeDelegateMap&&this.typeDelegateMap[e].prototype},this);e?(this.delegateObject(t(e)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(e,i){this.delegateObject(t(i)),this.afterDelegate()})},afterDelegate:function(){n.defaults(this.attributes,this.typeAttributes)},_normalizeType:function(e,t){var i={regular:"text",conversation:"chat"};return t===!1&&(i=n.invert(i)),e in i?i[e]:e},get:function(e){return(this._syntheticAttributes[e]||o.prototype.get).apply(this,arguments)},getHtmlStripped:function(e,t,i){return"undefined"!=typeof t||(t=!0),"undefined"!=typeof i||(i=" "),n.trim(m.stripHtml(this.get(e)||"",t,i))},fetch:function(e){var t={data:e};return o.prototype.fetch.call(this,t)},parse:function(e,t){if(t.parse===!1)return this.attributes;var i=e.post,s=t.data,o={},r=i.id?"edit":"reblog";o.type=this._normalizeType(i.type,!0),o.can_reblog_as=n.map(i.can_reblog_as,n.bind(function(e){return this._normalizeType(e,!0)},this)),this.set("type",o.type),n.forEach(this.genericFieldMap,function(e,t){o[e]=i[t]});var a=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return n.extend(o,n.omit(i,a),{createdPost:!!e.created_post,postTumblelog:e.post_tumblelog||{},postContextPage:e.post_context_page}),"edit"===r?(o["post-id"]=i.id,o.tags=i.tags?i.tags.split(","):[],o.tumblelog=o.postTumblelog.name_or_id||!1):"reblog"===r&&n.extend(o,n.pick(s,["reblog_id","reblog_key"])),"state"in i&&(o.state=this._extractState(i)),i.from_app&&1===n.parseInt(i.format)||(o.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[n.parseInt(i.format||0)]),o.editorType||(o.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),n.has(i,"custom_tweet")&&(o.customTweet=i.custom_tweet),n.extend(o,{sourceUrl:o.source_url||"",carouselLinkUrl:o.carousel_link_url||"",carouselDisplay:o.carousel_display||!1,htmlEdited:"rich"!==o.format&&!(this.editorField&&!i[this.editorField]),postDate:o.date||"",customUrl:o.slug||"",canBeLiked:o.can_be_liked,canBeReblogged:o.can_be_reblogged},n.mapValues(n.pick(o,["allow_answers","allow_photo_replies","html_mode","members_only","carousel_display","owner_flagged_nsfw"]),f)),n.has(i,"ads_cta.cta_link_url")&&(o.enableCTA=!0,o.ctaTextCode=i.ads_cta.cta_text_code||"0",o.ctaLinkUrl=i.ads_cta.cta_link_url||"",o.ctaAndroidLinkUrl=i.ads_cta.cta_android_link_url||""),"edit"!==r||"queued"!==o.state||n.isEmpty(i.publish_on)||(o.state="scheduled",o.publish_on=i.publish_on),this.parseForType(o,i)},parseForType:function(e,t){return e},sync:function(e,t,i){var s={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return n.defaults(i||(i={}),{emulateHTTP:!0,forServer:!0,url:s[e]}),i.parse="read"===e,o.prototype.sync.call(this,e,t,i)},toJSON:function(e){return e=n.defaults(e||{},{forServer:!1}),e.forServer?this.serializeForServer(e):o.prototype.toJSON.call(this,e)},serializeForServer:function(){var e=this,t=e.attributes,i={channel_id:t.tumblelog,post_id:t["post-id"],"post[date]":t.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":t.publish_on,"post[slug]":t.customUrl,"post[tags]":t.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:t.editorType,send_to_twitter:t.send_to_twitter,custom_tweet:t.customTweet,send_to_fbog:t.send_to_fbog,loggingData:t.loggingData,allow_photo_replies:t.allow_photo_replies,carousel_display:t.carouselDisplay,carousel_link_url:e.get("formattedCarouselLinkUrl"),members_only:t.members_only,owner_flagged_nsfw:t.owner_flagged_nsfw,content_stats:t.contentStats,carousel_index:t.carousel_index,can_be_liked:t.canBeLiked,can_be_reblogged:t.canBeReblogged,enable_cta:t.enableCTA,cta_link_url:e.get("formattedCTALinkUrl"),cta_text_code:t.ctaTextCode,cta_android_link_url:t.ctaAndroidLinkUrl};"edit"===t.mode&&(i.edit_post_id=t["post-id"]),i["post[source_url]"]=e.get("formattedSourceUrl"),i["post[state]"]=e._VALID_STATES[t.state],i["post[type]"]=this._normalizeType(t.type,!1);var s={reblog:t.is_reblog,reblog_key:t.reblog_key,reblog_post_id:t.reblog_id,pt:t.pt,remove_reblog_tree:t.remove_reblog_tree,reblog_source:t.reblogSource};n.extend(i,n.pick(s,function(e){return!n.isUndefined(e)})),t.allow_answers&&(i.allow_answers="on"),this.getAttributeFromGeneric("thumbnail")&&(i.thumbnail_pre_upload="1");var o=this.getContextPage();return n.extend(i,{context_id:t.tumblelog,context_page:o,"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(i["is_rich_text["+this.editorField+"]"]="1"),t.reblogActionContext&&(i.reblog_source=t.reblogActionContext),t.shareData&&n.isObject(t.shareData)&&(t.shareData.canonicalUrl=i["post[source_url]"],i.share_data=t.shareData),i},validate:function(e,t){var i="errors"in t?t.errors:[];if(e.state&&(n.has(this._VALID_STATES,e.state)||i.push('Invalid "state" value')),e.hasLoadingInlineImages&&i.push("There are still pending images."),n.each(this.defaults,function(t,n){("undefined"==typeof t?"undefined":s(t))!==s(e[n])&&i.push('Invalid "'+n+'" type. Expected '+("undefined"==typeof t?"undefined":s(t))+", got "+s(e[n])+".")}),i.length)return i},_extractState:function(e){var t=this._STATE_CODE_TO_TEXT[e.state];return 1===parseInt(e.is_private,10)&&(t="private"),t},findBlogChannelByName:function(e){if(this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection)return this.attributes.tumblelog.collection.findWhere({name_or_id:e})},getPreservedData:function(){return this.resetPreserveFields.some(n.bind(function(e){return this.get(e)&&this.get(e).length>0},this))},softReset:function(){n.forEach(this.resetAttributes,function(e){n.has(this.typeAttributes,e)?this.set(e,this.typeAttributes[e]):n.has(this.defaults,e)?this.set(e,this.defaults[e]):this.unset(e)},this)},getLookupData:function(){if("reblog"===this.get("mode"))return{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}},getContextPage:function(){var e=this.attributes,t="dashboard";return e.contextData&&"baseRoute"in e.contextData&&(t=e.contextData.baseRoute.split("/").pop()),t},getAttributeFromGeneric:function(e){return this.get(this.genericFieldMap[e])},getTweetText:function(){var e=this.get("customTweet");return n.isString(e)||(e=this.generateTweetText(140-this.shortUrlLength-1),e?e+=" [URL]":e="[URL]"),e},getTweetTextLength:function(e){n.isString(e)||(e=this.getTweetText()),e=n.trim(e).replace(/([^\s])\[URL\]/gi,"$1 [URL]").replace(/\[URL\]([^\s])/gi,"[URL] $1");var t=e.length;return t+=(this.shortUrlLength-5)*(e.match(/\[URL\]/gi)||"").length},generateTweetText:function(e){return""},canEditMedia:function(){return!this.get("is_reblog")},isReblog:function(){return!!this.get("is_reblog")},allowsTypeSwitch:function(e){return!1},canPreview:function(){return this.isValid()},deepHasChanged:function(e){var t=this.toJSON(),i=this.get("mode"),s=n.keys(e),o=n.keys(t);if(n.isEqual(e,t))return!1;if("new"!==i)return!0;var r=n.difference(o,s),a=n.reduce(r,function(e,i){var s=t[i],o=n.isUndefined(s)||n.isNull(s)?0:s.length;return e+o},0);return a>0||(e=n.omit(e,r),t=n.omit(t,r),!n.isEqual(e,t))}});r({"Tumblr.Prima.PostForms.Post":y}),e.exports=y},function(e,t,i){"use strict";var s=i(3),n=i(145),o=new n({delegateObject:function(e){var t={},i={};e&&(s.each(e,function(e,s){"undefined"!=typeof e&&("function"==typeof e?t[s]=e:i[s]=e)},this),n.onto(this,t),s.extend(this,i))}});e.exports=o},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(6).sprintf,r=i(213).truncateLongStrings;s.prototype.genericFieldMap={one:"title",two:"body"},s.prototype.editorField="two",s.prototype.typeAttributes={title:"",body:""},s.prototype.allowAnswerFields=["title","body"],s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("title"),s=this.getHtmlStripped("body");s=s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var n;return n=i&&s?o("%s - %s",i,s):i||s||"",r(n,t)},s.prototype.validate=function(e,t,i){var s=[],o=!n.isUndefined(t.reblog_tree)&&t.reblog_tree!==!1&&""!==t.reblog_tree;return(!t.body||t.body.length<1)&&(!t.title||t.title.length<1)&&(o||s.push("Post body empty.")),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";var s=i(3),n={normalizeSpace:function(e){return e.trim().replace(" "," ").replace(/\s\s+/," ")},stripScripts:function(e){return e.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>","img"),"")},stripTags:function(e){return e.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},truncateLongStrings:function(e,t,i){return s.isString(e)||(e=""),i||(i="…"),e.length<=t?e:s.trunc(e,t-i.length,i)},stripHtml:function(e,t,i){if(!e)return"";"undefined"==typeof t&&(t=!0);var n=e;"string"==typeof i&&(n=s.trim(n.replace(/(<br\s*\/?>)/gi,"$1"+i).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi,"$1"+i)));try{var o=document.implementation.createHTMLDocument("");o.body.innerHTML=this.stripScripts(n),n=o.body.textContent||o.body.innerText||"",n=n.trim()}catch(e){n=this.stripScripts(this.stripTags(n)).trim()}return t&&(n=this.normalizeSpace(n)),n}};e.exports=n},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(215),r=i(213).truncateLongStrings;s.prototype.genericFieldMap={two:"caption",three:"linkthrough"},s.prototype.editorField="two",s.prototype.typeAttributes={caption:"",layout:"",linkthrough:"",photos:[]},s.prototype.allowAnswerFields=["caption"],s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,t)},s.prototype.MAX_IMAGES=10,s.prototype.resetPreserveFields=["caption","tags"],s.prototype.afterDelegate=function(e){e.apply(this,n.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(e,t){this.photos.reset(t,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this,this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},s.prototype.parseForType=function(e,t,i){return t.layout=i.photoset_layout,delete t.photoset_layout,t},s.prototype.serializeForServer=function(e){var t=this,i=e.apply(this,n.rest(arguments));return n.forEach(this.photos.toJSON(),function(e){i["images["+e.id+"]"]=e.uploadUrl,i["caption["+e.id+"]"]=(e.caption||"").substr(0,200),e.photoRaw&&(i.photo_raw=e.photoRaw,i.is_selfie_gif=e.isSelfieGif,i.is_selfie=e.isSelfie)}),i["post[carousel_display]"]=t.get("carouselDisplay"),i["post[carousel_link_url]"]=t.get("carouselLinkUrl"),i["post[photoset_layout]"]=t.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},s.prototype.canAddPhotos=function(e){return this.photos.length<this.MAX_IMAGES},s.prototype.validate=function(e,t,i){var s=[];0===this.photos.length&&s.push("No photos specified.");var n=this.photos.all(function(e){return e.getUploadUrl()||!e.has("upload")});return n||s.push("Uploads in progress."),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(216),r=n.extend({model:o,add:function(e,t){return e&&!s.isArray(e)&&(e=[e]),s.forEach(e,function(e,t){e.id||(s.isFunction(e.set)?e.set("id",this.generateId(t)):e.id=this.generateId(t))},this),n.prototype.add.apply(this,arguments)},generateId:function(e){var t=1+(e||0),i=s.map(s.range(this.length+1),function(e){return"o"+(t+e)});return s.find(i,function(e){return!this.get(e)},this)},setIdOrder:function(e,t){t||(t={}),this.models=s.map(e,function(e){return this.get(e)},this),t.silent||this.trigger("sort",this,t)}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(217),r=i(143),a=i(218),l=i(219),c=i(221),u=1080,h=r.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:"",livephotoUrl:"",livephotoStillImageTime:""},initialize:function(){this.on("change:externalUrl",function(e,t){t&&this.readUrl(t),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(e,t){t&&this.readFile(t),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(e,t){t||(t="photo:readUrl"),a.load(e).then(s.bind(function(e){this.set({url:e.src,width:e.width,height:e.height}),this.trigger(t,!0,this)},this),s.bind(function(i){this.set({url:e,width:null,height:null}),this.trigger(t,!1,this)},this))},readFile:function(e){return l.canReadFiles()?void l.read(e).then(s.bind(function(e){if(!e.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(e.objectUrl||e.base64,"photo:readFile");var t=n("<img/>");t.attr("src",e.objectUrl||e.base64),a.load(e.objectUrl||e.base64).then(s.bind(function(i){var s=c.drawScaledAndRotated(t,i.width,i.height,e.rotation,e.mirrored,u);return this.readUrl(s.toDataURL(e.file.type),"photo:readFile")},this))},this),s.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):this.get("base64")?this.get("base64"):this.get("url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},parse:function(e){return o(e,0)},toJSON:function(){var e=r.prototype.toJSON.apply(this,arguments);return e.displayUrl=this.getDisplayUrl(),e.uploadUrl=this.getUploadUrl(),e}});e.exports=h},function(e,t,i){"use strict";var s=i(3),n=function e(t,i){return null==i?i=5:s.isNumber(i)||(i=0),s.transform(t,function(t,n,o){i&&s.isObject(n)&&(n=e(n,i-1)),t[s.camelCase(o)]=n})};e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(174),r=o.extend({constructor:function(e){null!=e&&this.load(e)},load:function(e,t){if(this.src=e,!e)return n.reject("No URL to load");var i=this,o=n.promise(function(n,o){var r=new Image;r.src=e,i._img=r;var a;if(r.onload=function(){n(r),r.onload=null,r.error=null,clearInterval(a)},r.onerror=function(){o(r),r.onload=null,r.error=null,clearInterval(a)},r.complete)r.naturalWidth||r.naturalHeight?"function"==typeof r.onload&&r.onload():"function"==typeof r.onerror&&r.onerror();else if(t){var l=function(){return!(!r.naturalWidth&&!r.naturalHeight)&&("function"==typeof r.onload&&r.onload(),!0)};l()||(s.isNumber(t)||(t=100),a=setInterval(l,t))}});return this.promise=o=o.then(s.bind(this._onLoad,this),s.bind(this._onError,this)),o},_onLoad:function(e){return this._img===e?(this.width=e.naturalWidth,this.height=e.naturalHeight,this.src=e.src,this.loaded=!0,n.resolve({width:this.width,height:this.height,src:this.src})):this.promise},_onError:function(e){return this._img===e?(this.width=null,this.height=null,this.src=e.src,this.loaded=!1,n.reject(this.src+" failed to load")):this.promise}},{load:function(e,t){var i=new r(e,t);return i.promise}});e.exports=r},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(3),r=i(150),a=i(220),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,c=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,u=[],h=function(){function e(t){s(this,e),null!=t&&this.read(t)}return n(e,[{key:"read",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.file=e,!e)return r.reject("No file to read");if(!l)return r.reject("FileReader is not supported");e.type.match(/image\/(jpg|jpeg)/i)||(i=!1);var s=void 0;return s=i&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(e).then(function(i){try{var s=new a.JpegFile(i.binary,e.name);i.rotation=function(e){switch(e){case 1:return 0;case 2:return 0;case 3:return 180;case 4:return 180;case 5:return 270;case 6:return 90;case 7:return 90;case 8:return 270;default:return 0}}(s.tiff.Orientation.value),i.mirrored=function(e){switch(e){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(s.tiff.Orientation.value)}catch(e){}return t.readDataUrl(e).then(function(e){return o.extend(i,e)})}):this.readDataUrl(e),this.promise=s,s}},{key:"readDataUrl",value:function(e){var t=new FileReader;return"readAsDataURL"in t?r.promise(function(i,s){t.onload=function(e){var s=e.target.result;i(s),t.onload=null,t.onerror=null},t.onerror=function(){s(),t.onload=null,t.onerror=null},t.readAsDataURL(e)}).then(o.bind(this._onLoadDataUrl,this),o.bind(this._onError,this)):r.reject("FileReader.readAsDataURL is not supported")}},{key:"_onLoadDataUrl",value:function(e){var t={base64:e,file:this.file};return c&&(t.objectUrl=c(this.file),u.push(t.objectUrl)),r.resolve(t)}},{key:"readBinaryString",value:function(e){var t=new FileReader;return"readAsBinaryString"in t?r.promise(function(i,s){t.onload=function(e){var s=e.target.result;i(s),t.onload=null,t.onerror=null},t.onerror=function(){s(),t.onload=null,t.onerror=null},t.readAsBinaryString(e)}).then(o.bind(this._onLoadBinaryString,this),o.bind(this._onError,this)):r.reject("FileReader.readAsBinaryString is not supported")}},{key:"_onLoadBinaryString",value:function(e){return r.resolve({binary:e,file:this.file})}},{key:"_onError",value:function(e){return r.reject("Failed to read file")}}],[{key:"read",value:function(t,i){var s=new e(t,i);return s.promise}},{key:"canReadFiles",value:function(){return l}}]),e}();e.exports=h},function(e,t,i){"use strict";var s=function(){},n=e.exports={};n.stringIsClean=function(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)<32)return!1;return!0},n.parseNum=function(e,t,i,s){var n,o,r=">"===e;for(void 0===i&&(i=0),void 0===s&&(s=t.length-i),n=r?i:i+s-1;r?n<i+s:n>=i;r?n++:n--)o<<=8,o+=t.charCodeAt(n);return o},n.parseSnum=function(e,t,i,s){var n,o,r,a=">"===e;for(void 0===i&&(i=0),void 0===s&&(s=t.length-i),n=a?i:i+s-1;a?n<i+s:n>=i;a?n++:n--)void 0===r&&(r=128===(128&t.charCodeAt(n))),o<<=8,o+=r?255&~t.charCodeAt(n):t.charCodeAt(n);return r&&(o+=1,o*=-1),o},n.Rational=function(e,t){return this.num=e,this.den=t||1,this},n.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},n.Rational.prototype.asFloat=function(){return this.num/this.den},n.MetaGroup=function(e,t){return this.fieldName=e,this.description=t,this.metaProps={},this},n.MetaGroup.prototype._addProperty=function(e,t,i){var s=new n.MetaProp(e,t,i);this[s.fieldName]=s,this.metaProps[s.fieldName]=s},n.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},n.MetaProp=function(e,t,i){return this.fieldName=e,this.description=t,this.value=i,this},n.MetaProp.prototype.toString=function(){return""+this.value},n.JpegFile=function(e,t){var i=this._SOS;this.metaGroups={},this._binary_data=e,this.filename=t;var s,o,r,a,l,c,u,h=0,d=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(h+=2;h<this._binary_data.length&&(s=this._binary_data.charCodeAt(h++),o=this._binary_data.charCodeAt(h++),d=h,s==this._DELIM)&&o!==i;){for(l=n.parseNum(">",this._binary_data,h,2),h+=l;h<this._binary_data.length;)if(s=this._binary_data.charCodeAt(h++),s==this._DELIM&&(r=this._binary_data.charCodeAt(h++),0!==r)){h-=2;break}a=h-d,this._markers[o]?(c=this._markers[o][0],u=this._markers[o][1]):(c="UNKN",u=void 0),u&&this[u](o,d+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},n.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},n.JpegFile.prototype._SOI_MARKER="ÿØ",n.JpegFile.prototype._DELIM=255,n.JpegFile.prototype._EOI=217,n.JpegFile.prototype._SOS=218,n.JpegFile.prototype._sofHandler=function(e,t){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",n.parseNum(">",this._binary_data,t,1)),this.general._addProperty("pixelHeight","Pixel Height",n.parseNum(">",this._binary_data,t+1,2)),this.general._addProperty("pixelWidth","Pixel Width",n.parseNum(">",this._binary_data,t+3,2)),this.general._addProperty("type","Type",this._markers[e][2])},n.JpegFile.prototype._JFIF_IDENT="JFIF\0",n.JpegFile.prototype._JFXX_IDENT="JFXX\0",n.JpegFile.prototype._EXIF_IDENT="Exif\0",n.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},n.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{
1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},n.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},n.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},n.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},n.JpegFile.prototype._addMetaGroup=function(e,t){var i=new n.MetaGroup(e,t);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},n.JpegFile.prototype._parseIfd=function(e,t,i,o,r,a,l){var c,u,h,d,p,g,_,f,m,v,b,y=n.parseNum(e,t,i+o,2);b=this._addMetaGroup(a,l);for(var w=0;w<y;w++)if(c=i+o+2+12*w,u=n.parseNum(e,t,c,2),d=n.parseNum(e,t,c+2,2),g=n.parseNum(e,t,c+4,4),_=n.parseNum(e,t,c+8,4),void 0!==this._types[d]){if(h=this._types[d][0],p=this._types[d][1],_=p*g<=4?c+8:i+_,"UNDEFINED"==h)f=void 0;else if("ASCII"==h)f=t.slice(_,_+g),f=f.split("\0")[0],n.stringIsClean(f)||(f="");else{f=[];for(var k=0;k<g;k++,_+=p)"BYTE"!=h&&"SHORT"!=h&&"LONG"!=h||f.push(n.parseNum(e,t,_,p)),"SBYTE"!=h&&"SSHORT"!=h&&"SLONG"!=h||f.push(n.parseSnum(e,t,_,p)),"RATIONAL"==h&&(m=n.parseNum(e,t,_,4),v=n.parseNum(e,t,_+4,4),f.push(new n.Rational(m,v))),"SRATIONAL"==h&&(m=n.parseSnum(e,t,_,4),v=n.parseSnum(e,t,_+4,4),f.push(new n.Rational(m,v))),f.push();1===g&&(f=f[0])}r.hasOwnProperty(u)?b._addProperty(r[u][1],r[u][0],f):s("WARNING(jpegmeta.js): Unknown tag: ",u)}},n.JpegFile.prototype._jfifHandler=function(e,t){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(t+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(t+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(t+7)),this.jfif._addProperty("Xdensity","X density",n.parseNum(">",this._binary_data,t+8,2)),this.jfif._addProperty("Ydensity","Y Density",n.parseNum(">",this._binary_data,t+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",n.parseNum(">",this._binary_data,t+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",n.parseNum(">",this._binary_data,t+13,1))},n.JpegFile.prototype._app0Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._JFIF_IDENT?this._jfifHandler(e,t):i==this._JFXX_IDENT},n.JpegFile.prototype._app1Handler=function(e,t){var i=this._binary_data.slice(t,t+5);i==this._EXIF_IDENT&&this._exifHandler(e,t+6)},n.JpegFile.prototype._exifHandler=function(e,t){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,s,o,r=this._binary_data.slice(t,t+2);if("II"===r)i="<";else{if("MM"!==r)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+r);i=">"}if(s=n.parseNum(i,this._binary_data,t+2,2),42!==s)throw new Error("Malformed TIFF meta-data. Bad magic: "+s);if(o=n.parseNum(i,this._binary_data,t+4,4),this._parseIfd(i,this._binary_data,t,o,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,t,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,t,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var a;a=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(a=-a),this.gps._addProperty("latitude","Dec. Latitude",a)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},function(e,t,i){"use strict";var s=i(8),n=i(3),o=function(e,t,i){if(0===i)return 0;var s=null==i?t:t/i;return 2===arguments.length?Math.round(e*s):void 0},r=function(e,t,i){if(0===i)return 0;var s=null==i?t:t/i;return Math.round(e/s)},a=function(e,t,i,s){var n=e,a=t,l=e/t,c=i/s;return(e>i||t>s)&&(l>c?(n=i,a=r(n,l)):(a=s,n=o(a,l))),{width:n,height:a}},l=function(e,t,i,s,n,a){null!=n||(n=.5),null!=a||(a=.5);var l=0,c=0,u=e,h=t,d=e/t,p=i/s;return d>p?(u=o(t,p),l=Math.round(n*(e-u))):d<p&&(h=r(e,p),l=Math.round(a*(t-h))),{left:l,top:c,width:u,height:h}},c=function(e){var t;e instanceof s?(t=e,e=t.get(0)):t=s(e);var i=document.createElement("canvas");return i.width=e.width||t.width(),i.height=e.height||t.height(),i},u=function(e){var t=e.$(".needs-drawing");n.each(t,function(e){var t=e.getContext("2d"),i=new Image,n=4;t.mozImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1;var o=function(){t.fillStyle="#FFF",t.fillRect(0,0,e.width,e.height),t.drawImage(i,0,0,n,n),t.drawImage(e,0,0,n,n,0,0,e.width,e.height)};i.onload=o,i.src=s(e).data("image-url")}),t.removeClass("needs-drawing")},h=function(e,t,i){var n;e instanceof s?(n=e,e=n.get(0)):n=s(e),t?t instanceof s&&(t=t.get(0)):t=c(e);var o=t.width,r=t.height,a=t.getContext("2d");return a.save(),i&&(a.translate(t.width,0),a.scale(-1,1)),a.drawImage(e,0,0,o,r),a.restore(),t},d=function(e,t,i,n,o,a){var l;e instanceof s?(l=e,e=l.get(0)):l=s(e);var c=90===n||270===n;c?a&&i>a&&(t=r(a,i,t),i=a):a&&t>a&&(i=r(a,t,i),t=a);var u=document.createElement("canvas");c?(u.width=i,u.height=t):(u.width=t,u.height=i);var h=u.getContext("2d");return h.save(),h.translate(.5*u.width,.5*u.height),h.rotate(n*Math.PI/180),o&&h.scale(-1,1),h.drawImage(e,-.5*t,-.5*i,t,i),h.restore(),u},p={widthForHeight:o,heightForWidth:r,maxSize:a,cropBox:l,createCanvasForEl:c,drawElToCanvas:h,drawScaledAndRotated:d,drawPixelatedImages:u};e.exports=p},function(e,t,i){"use strict";function s(){}var n=i(6).sprintf,o=i(213).truncateLongStrings;s.prototype.genericFieldMap={one:"quote",two:"source"},s.prototype.typeAttributes={quote:"",source:""},s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("quote"),s=this.getHtmlStripped("source");s=s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var r;return r=s&&i.length+(s.length>1?7:6)<=t?r=n("“%s” - %s",i,s):i?n("“%s”",o(i,t-2)):s,o(r,t)},s.prototype.editorField="two",s.prototype.validate=function(e,t,i){var s=[];return(!t.quote||t.quote.length<1)&&s.push("No quote."),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(6).sprintf,r=i(224),a=i(213).truncateLongStrings,l=i(225);s.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail",excerpt:"excerpt",author:"author"},s.prototype.typeAttributes={title:"",url:"",caption:"",excerpt:"",author:""},s.prototype.allowAnswerFields=["caption"],s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("title"),s=this.getHtmlStripped("url"),n=this.getHtmlStripped("caption");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var l;return l=i&&n?o("%s - %s",i,n):i||n||r.parseUrl(s).host||"",a(l,t)},s.prototype.editorField="three",s.prototype.typeAttributes={title:"",url:"",excerpt:"",author:""},s.prototype.resetPreserveFields=["caption","tags"],s.prototype.resetAttributes=["title","url","thumbnail","excerpt","author"],s.prototype.softReset=function(e){e.apply(this,n.rest(arguments)),n.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},s.prototype.serializeForServer=function(e){var t=e.apply(this,n.rest(arguments));return this.get("remove_thumbnail")&&(t.remove_thumbnail=this.get("remove_thumbnail")),n.extend(t,{author:this.getAttributeFromGeneric("author"),excerpt:this.getAttributeFromGeneric("excerpt")}),t},s.prototype.validate=function(e,t,i){var s=[];return t.loading&&s.push("Loading OpenGraph data."),(!t.url||t.url.length<1)&&s.push("No url."),l.isUrl(t.url)||s.push("Not a valid URL"),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(3),o={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],_setUrl:function(e){return this.aElement.setAttribute("href",e),this.aElement.setAttribute("href",this.aElement.href),this.aElement.href},parseUrl:function(e){if(!n.startsWith(e,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this._setUrl(e),{url:e,href:this.aElement.href,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(e){try{e.indexOf("://")===-1&&(e="http://"+e);var t=this.parseUrl(e),i=!1;if(n.endsWith(t.host,"tumblr.com")?i=t.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):n.endsWith(t.host,"tumblr.net")?i=t.host.match(/(?:^|\/\/)(?:([\w\-\_]+)\.)(?:[\w\-\_]+\.)*tumblr\.net/i):n.endsWith(t.host,"t.dev")&&(i=t.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),i){var s=i[1];if("www"===s)return!1;var o={tumblelog_name:s},r=t.path.match(/post\/([0-9]+)/i);return r&&(o.post_id=r[1]),o}return!1}catch(e){return!1}},isTumblelogUrl:function(e){return this.parseTumblelogUrl(e)!==!1},parseTumblelogShortUrl:function(e){try{e.indexOf("://")===-1&&(e="http://"+e);var t=this.parseUrl(e);return"tmblr.co"===t.host&&(n.startsWith(t.path,"/m")?{mentionKey:t.path.match(/^\/m([^\/]+)/)[0]}:!!n.startsWith(t.path,"/Z")&&{postTinyUrlHash:t.path.match(/^\/Z([^\/]+)/)[0]})}catch(e){return!1}},isTumblelogShortUrl:function(e){return this.parseTumblelogShortUrl(e)!==!1},isTumblrMediaUrl:function(e){return!!e&&(e.indexOf("://")===-1&&(e="http://"+e),!!e.match(/^https?:\/\/(\d+\.)media\.tumblr\.com\//i))},hasAllowedProtocol:function(e){this._setUrl(e);var t=this.aElement.protocol;if(":"===t&&(t=location.protocol),this.acceptedProtocols.indexOf(t)===-1)throw new Error("Unsupported protocol detected in URL: "+e);return!0},isAbsoluteUrl:function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return!!t.test(e||"")},getParameter:function(e){var t=new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)"),i=t.exec(location.search)||[null,""],s=i[1].replace(/\+/g,"%20"),n=decodeURIComponent(s);return n||null},httpBuildQuery:function(e,t){var i=[];for(var n in e)if(e.hasOwnProperty(n)){var o=t?t+"["+n+"]":n,r=e[n];if(!r)continue;i.push("object"===("undefined"==typeof r?"undefined":s(r))?this.httpBuildQuery(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return i.join("&")},buildUrl:function(e,t){var i=this.httpBuildQuery(t);return e+(n.isEmpty(i)?"":"?"+i)},getQueryStringHash:function(e){var t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,i,s,n){t[i]=n}),t},isProtocolRelative:function(e){var t=new RegExp("^//[^/]","i");return t.test(e||"")},getExtension:function(e){var t,i;return this.isProtocolRelative(e)&&(e=this.addProtocolIfMissing(e,"http:")),n.startsWith(e,"http")&&(i=this.parseUrl(e),n.isEmpty(i.path)||(t=i.path)),t||(t=e),n.last(t.split("."))},addProtocolIfMissing:function(e,t){if(n.any(this.acceptedProtocols,function(t){return n.startsWith(e,t)}))return e;if(this.acceptedProtocols.indexOf(t)===-1)throw new Error("Attempting to add an unsupported protocol: "+t);return(this.isProtocolRelative(e)?t:t+"//")+e}};e.exports=o},function(e,t){"use strict";var i={isUrl:function(e){var t="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",s='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+t+")+@",n="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",o="("+n+"(\\."+n+"){3})",r="a-zA-Z0-9\\-\\_\\~",a="\\u00C0-\\u9FFF",l="(["+r+a+"]+\\.)+([a-zA-Z]{2,})",c="[0-9]+",u="("+o+"|localhost|"+l+")(:"+c+")?",h=r+a+".:\\[\\]@!$&'()*+,;=",d="(["+h+"]|"+t+")*",p=d+"(\\/"+d+")*",g="\\?(["+h+"/?]|"+t+")*",_="\\#(["+h+"/?]|"+t+")*",f=new RegExp("^"+i+"("+s+")?"+u+"(\\/?("+p+")?("+g+")?("+_+")?)?$");return f.test(e)===!0},isImageUrl:function(e){var t=i.isUrl(e),s=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(e)===!0;return t&&s}};e.exports=i},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(6).sprintf,r=i(213).truncateLongStrings;s.prototype.genericFieldMap={one:"title",two:"chat"},s.prototype.typeAttributes={title:"",chat:""},s.prototype.generateTweetText=function(e,t){var i,s=this.getHtmlStripped("title"),n=this.getHtmlStripped("chat");return i=s&&n?o("%s - %s",s,n):s||n||"",r(i,t)},s.prototype.validate=function(e,t,i){var s=[];return(!t.chat||t.chat.length<1)&&s.push("No chat."),e.call(this,t,{errors:s})},s.prototype.serializeForServer=function(e){var t=this,i=e.apply(this,n.rest(arguments));return i["post[two]"]=t.get("chat").replace(/\u00A0/gm," "),i},e.exports=s},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(130),r=i(213).truncateLongStrings;s.prototype.genericFieldMap={two:"caption",three:"url"},s.prototype.editorField="two",s.prototype.allowsTypeSwitch=function(){return"new"===this.get("mode")},s.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},s.prototype.allowAnswerFields=["caption"],s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),r(i,t)},s.prototype.resetPreserveFields=["caption","tags"],s.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt","copyrightFallback"],s.prototype.parseForType=function(e,t,i){i.service&&"direct"!==i.service||(t.url=i.audio_url),delete t.audio_url,t.albumArt=i.audio_artwork,delete t.audio_artwork;var s=i.id3_tags||{};return delete t.id3_tags,t.trackTitle=s.Title||"",t.trackArtist=s.Artist||"",t.trackAlbum=s.Album||"",t},s.prototype.serializeForServer=function(e){var t=e.apply(this,n.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&n.isEmpty(this.get("albumArt")),copyright_fallback:this.get("copyrightFallback")};return n.extend(t,n.pick(i,function(e){return!n.isUndefined(e)})),n.isEmpty(t.preuploaded_url)||(t["post[three]"]=null),t},s.prototype.validate=function(e,t,i){var s=[];return n.isEmpty(t.url)?s.push(o("Please choose an audio source before continuing.")):t.preuploadUrl?t.confirmTos||s.push(o("You must agree that you have permission to share this file.")):n.isEmpty(t.url)&&s.push(o("Please choose an audio source before continuing.")),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(130),r=i(229),a=i(217),l=i(213).truncateLongStrings;s.prototype.genericFieldMap={one:"embedCode",two:"caption"},s.prototype.allowAnswerFields=["caption"],s.prototype.editorField="two",s.prototype.resetPreserveFields=["caption","tags"],s.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos","copyrightFallback"],s.prototype.typeAttributes={caption:"",confirmTos:!1},s.prototype.generateTweetText=function(e,t){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),l(i,t)},s.prototype.validate=function(e,t,i){var s=[];return t.embedCode?0===t.embedCode.length&&s.push("No embed specified."):t.preuploadUrl?t.confirmTos||s.push(o("You must agree that you have permission to share this file.")):t.video?0===t.video.embed_code.length&&s.push("Direct embed missing."):s.push("No video specified."),e.call(this,t,{errors:s})},s.prototype.canPreview=function(){return!this.get("preuploadKey")&&this.isValid()},s.prototype.serializeForServer=function(e){var t=e.apply(this,n.rest(arguments)),i=n.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos"),copyright_fallback:this.get("copyrightFallback")},n.isUndefined);return n.extend(t,i),t=r(t,{embedCode:"embed_code"})},s.prototype.getEmbedData=function(e){var t=!1;return this.has("video")?(t=a(this.get("video")),t={isNativeVideo:!0,embedRenderContext:"inline",width:t.dimensions.width,height:t.dimensions.height,previewIframe:t.previewIframe,embedCode:t.embedCode}):this.has("video_embed")&&(t=a(this.get("video_embed"))),t},e.exports=s},function(e,t,i){"use strict";function s(e,t){return o.zipObject(e,o.map(e,t))}function n(e,t){return o.isFunction(t)&&(t=s(o.keys(e),t)),o.transform(e,function(e,i,s){e[o.result(t,s)||s]=i},{})}var o=i(3);n.createKeyMap=s,e.exports=n},function(e,t,i){"use strict";function s(){}var n=i(3),o=i(213).truncateLongStrings;s.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},s.prototype.editorField="three",s.prototype.typeAttributes={ask:"",answer:"",caption:""},s.prototype.generateTweetText=function(e,t){return o(this.getHtmlStripped("ask"),t)},s.prototype.parseForType=function(e,t,i){return t.ask=n.escape(t.ask),t},s.prototype.validate=function(e,t,i){var s=[];return t.ask||s.push("Post question empty."),e.call(this,t,{errors:s})},e.exports=s},function(e,t,i){"use strict";var s=i(3),n=function(e){if(s.isString(e)){if(e=e.toLowerCase(),"true"===e||"1"===e||"on"===e)return!0;if("false"===e||""===e||"off"===e)return!1;if(e=s.parseInt(e),s.isNaN(e))return!0}return!!e};e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(233),r=i(150),a=n.extend({model:o,_listenToUploadModel:function(e){this.listenTo(e,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(e){this.stopListening(e)},_onUploadModelChange:function(e){s.has(e.changed,"complete")&&this.trigger("complete",this,e),s.has(e.changed,"error")&&e.get("error")&&this.trigger("error",this,e),s.has(e.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(e){return s.isArray(e)?s.forEach(e,this._listenToUploadModel,this):this._listenToUploadModel(e),n.prototype.add.apply(this,arguments)},remove:function(e){return s.isArray(e)?s.forEach(e,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(e),n.prototype.remove.apply(this,arguments)},removeIncomplete:function(e){var t=this.where({uploading:!1,complete:!1});return this.remove(t,e)},removeFailed:function(e){var t=this.filter(function(e){return e.get("error")});return this.remove(t,e)},allComplete:function(){return!!this.length&&this.every(function(e){return e.get("complete")})},anyUploading:function(){return this.length>0&&this.any(function(e){return e.get("uploading")})},getProgress:function(){var e=0,t=0;return this.forEach(function(i){i.get("error")&&(e+=i.get("bytesLoaded")||0,t+=i.get("bytesTotal")||0)}),t?e/t:0},promise:function e(){if(this.allComplete())return r.resolve(this);var e=r.promise(s.bind(function(e,t){var i,n;i=s.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",n),e.apply(this,arguments)},this),n=s.bind(function(){this.stopListening(this,"uploads:allComplete",i),this.stopListening(this,"uploads:error",n),t.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",i),this.listenToOnce(this,"uploads:error",n)},this));return e}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(143),o=n.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(e,t){this.options=s.extend({},t),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(e){return this.jqXHR=e,e.then(function(){}),e},_uploadDone:function(){this.set({error:!1,uploading:!1,complete:!0})},_uploadFail:function(){this.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var e;return this.jqXHR&&(e=this.jqXHR.abort(),this.jqXHR=null),e},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoaded")/this.get("bytesTotal"):0}});e.exports=o},,function(e,t,i){"use strict";var s=i(3),n=i(145),o=new n({defaults:{teardown:function(){return this},beforeTeardown:function(){},afterTeardown:function(){return this.teardownSubViews()},render:function(){return this},beforeRender:function(){},afterRender:function(){return this.renderSubViews()},attachSubView:function(e,t){if(1===arguments.length)if("string"==typeof e){if(t=e,e=this.subViews[t],!e)return this}else t=e.$el.data("subview")||"";var i=this.$('[data-subview="'+t+'"]');return i.length>1&&(i=i.first()),e&&i.length&&(i.replaceWith(e.$el),e.$el.attr("data-subview",t)),this},attachSubViews:function(e){return s.forEach(this.subViews,this.attachSubView,this),this},teardownSubViews:function(){return s.forEach(this.subViews,function(e,t){e&&s.isFunction(e.teardown)&&e.teardown(),this.subViews[t]=null},this),this.subViews={},this},renderSubViews:function(){return s.forEach(this.subViews,function(e){e&&s.isFunction(e.render)&&e.render()},this),this},isInitialized:function(){return this._initialized},isRendered:function(){return this._rendered},isRendering:function(){return this._rendering},isRemoved:function(){return this._removed}},around:{initialize:function(e){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=!1,this.subViews={};var t=e.apply(this,s.rest(arguments));return this._initialized=!0,t},teardown:function(e){var t=s.rest(arguments);s.isFunction(this.beforeTeardown)&&this.beforeTeardown.apply(this,t);var i=e.apply(this,t);return s.isFunction(this.afterTeardown)&&this.afterTeardown.apply(this,t),this._rendered=!1,i},render:function(e){var t=s.rest(arguments);this._rendering=!0,s.isFunction(this.beforeRender)&&this.beforeRender.apply(this,t);var i=e.apply(this,t);return s.isFunction(this.afterRender)&&this.afterRender.apply(this,t),this._rendering=!1,this._rendered=!0,this.trigger("rendered"),i}},after:{remove:function(){this._removed=!0,this.subViews=null}}});e.exports=o},function(e,t,i){"use strict";function s(e){return n.trim(e)}var n=i(3),o=i(145),r=function(e,t){return e=s(e),t&&n.isFunction(this.$$)&&this.$$.cache.delete(e),e},a=function(e){if(this.$$)return e=s(e),this.$(e)},l=function(e){this.$$&&(e=s(e),this.$$.cache.delete(e))},c=function(e){if(this.$$)return e=s(e),this.$$.cache.delete(e),this.$(e)},u=function(){this.$$&&(this.$$.cache=new n.memoize.Cache)},h=function(e){return"[data-js-"+e+"]"},d=function(e){return function(){var e=n.memoize(n.bind(a,this),n.bind(r,this));e.update=n.bind(c,this),e.remove=n.bind(l,this),e.empty=n.bind(u,this);var t=function(t,i){return e(h(t),i)};return t.update=function(t){e.update(h(t))},t.remove=function(t){e.remove(h(t))},this.$$=e,this.js$=t,this.$$initialize=n.noop,e}.call(e)},p=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(e){return"undefined"==typeof e&&(e=this.$$cacheKeys),n.forEach(e,function(e){this.$$.update(e)},this),this},$$initialize:function(){return d(this)},$$:function(){return d(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){n.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){n.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){n.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});e.exports=p},,,,,,function(e,t,i){"use strict";function s(e){return o.noop}var n=i(8),o=i(3),r=(i(6).sprintf,i(145)),a=i(139),l=!1,c=n("body"),u=n(window),h=i(243),d=new r({removeAutoTeardown:function(){this._popoverBase.clickOutside&&(this._popoverBase.clickOutside.remove(),this._popoverBase.clickOutside=null)},setupAutoTeardown:function(){this.isRendered()&&(this.removeAutoTeardown(),this._popoverBase.autoTeardown&&(this._popoverBase.clickOutside=new h(this.el,this.options),this._popoverBase.clickOutside.on("click:outside",this.onClickOutside,this)))},onClickOutside:function(){this._popoverBase.shouldTeardown?(this._popoverBase.lastAutoTeardown=o.now(),this.teardown()):this._popoverBase.shouldTeardown=!0},reposition:function(){if(!this.$pinned.closest("body").length)return void this.$el.css("visibility","hidden");var e=this.pinnedRect(),t={scrollTop:this.isContainerBody?0:this.$container.scrollTop(),scrollLeft:this.isContainerBody?0:this.$container.scrollLeft(),realTop:this.isContainerBody?0:this.$container.offset().top,realLeft:this.isContainerBody?0:this.$container.offset().left},i=this._popoverBase.shift,s=this._popoverBase.pinnedSide,n={visibility:"visible"},r={},a=this.$el.width(),l=null,c=null,u=null,h=null;this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O",s,i,e),this._popoverBase.isFixedPosition&&(n.position="fixed"),"top"===s||"bottom"===s?(o.extend(n,{left:e.left+Math.floor(e.width/2)+i.x}),r={top:e.top+t.scrollTop-i.y,bottom:e.top+t.scrollTop+e.height+i.y,
left:e.left+t.scrollLeft-i.x,right:e.left+t.scrollLeft+e.width+i.x},r.center=(r.right-r.left)/2,l=t.realTop+r.top-this.$el.height(),c=t.realTop+r.bottom+this.$el.height(),"top"===s&&this._crossesViewportEdge("top",l)&&!this._crossesViewportEdge("bottom",c)&&(s="bottom"),"bottom"===s&&this._crossesViewportEdge("bottom",c)&&!this._crossesViewportEdge("top",l)&&(s="top"),"bottom"===s?o.extend(n,{top:r.bottom,transform:"translateX(-50%)"}):"top"===s&&o.extend(n,{top:r.top,right:"",transform:"translateX(-50%) translateY(-100%)"}),u=t.realLeft+(r.center+r.left)-a/2,h=t.realLeft+(r.center+r.left)+a/2,this._crossesViewportEdge("left",u)&&!this._crossesViewportEdge("right",h)&&o.extend(n,{left:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===s?"translateX(0) translateY(-100%)":"translateX(0)"}),!this._crossesViewportEdge("left",u)&&this._crossesViewportEdge("right",h)&&o.extend(n,{left:"auto",right:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===s?"translateX(0) translateY(-100%)":"translateX(0)"})):"left"===s||"right"===s?(o.extend(n,{top:e.top-i.y}),r={left:e.left+t.scrollLeft-i.x,right:e.left+t.scrollLeft+e.width+i.x},u=t.realLeft+r.left-this.$el.width(),h=t.realLeft+r.right+this.$el.width(),"left"===s&&this._crossesViewportEdge("left",u)&&!this._crossesViewportEdge("right",h)&&(s="right"),"right"===s&&this._crossesViewportEdge("right",h)&&!this._crossesViewportEdge("left",u)&&(s="left"),"left"===s?o.extend(n,{left:r.left,transform:"translateX(-100%) translateY(-50%)"}):"right"===s&&o.extend(n,{left:r.right,transform:"translateY(-50%)"})):o.extend(n,{top:e.top-i.y,left:e.left+i.x,transform:""}),o.extend(n,{transform:n.transform}),this.$el.css(n),this.debug("reposition: ad-hoc css %O",n),this.$el.removeClass("top bottom left right").addClass(s)},_crossesViewportEdge:function(e,t){var i=n(window),s={top:i.scrollTop(),left:i.scrollLeft(),right:i.scrollLeft()+i.width(),bottom:i.scrollTop()+i.height()};return s=this._popoverBase.isFixedPosition?{top:0,left:0,right:i.width(),bottom:i.height()}:{top:i.scrollTop(),left:i.scrollLeft(),right:i.scrollLeft()+i.width(),bottom:i.scrollTop()+i.height()},this.debug("viewportCheck against %s side (%s) coordinate=[%s]",e,s[e],t),"top"===e?s.top>t:"bottom"===e?s.bottom<t:"left"===e?s.left>t:"right"===e?s.right<t:void 0},isRendered:function(){return this.rendered||this._rendered},isOrWasRecentlyRendered:function(e){o.isNumber(e)||(e=100);var t=this._popoverBase.lastAutoTeardown,i=o.now()-t;return i<e||this.isRendered()},setPinnedSide:function(e){return this._popoverBase.pinnedSide=e,this},setPinnedTarget:function(e){return this.$pinned=n(e).addClass("pinned-target"),this.debug("setPinnedTarget: %O",this.$pinned),this},setPopoverContainer:function(e){return this.$container=n(e),this.isContainerBody=this.$container.is(c),this.debug("setPopoverContainer: %O, isContainerBody=%s",this.$container,this.isContainerBody),this},setShift:function(e){if(!o.isObject(e)||!o.isNumber(e.x)||!o.isNumber(e.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");return this._popoverBase.shift.x=e.x,this._popoverBase.shift.y=e.y,this},getShift:function(){return this._popoverBase.shift},_initializeDebugger:function(){this.debug=l?s(this):o.noop},defaults:{pinnedRect:function(){var e,t,i=this.$container.offset();e=this.$pinned.offset(),t=e,this._popoverBase.isFixedPosition&&(this.isContainerBody?e.top-=u.scrollTop():e.top-=this.$container.scrollTop());var s={};return s.height=this.$pinned.outerHeight(),s.width=this.$pinned.outerWidth(),s.top=Math.round(e.top-i.top),s.left=Math.round(t.left-i.left),s.bottom=Math.round(s.top+s.height),s.right=Math.round(s.left+s.width),this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O",this.$container,this.$pinned,i,t),this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s",s.height,s.width,s.top,s.left,s.bottom,s.right),s},teardown:o.noop},after:{initialize:function(e){var t={identifier:"popover",pinnedSide:"bottom",className:"popover--base",autoTeardown:!0,teardownOnEscape:!0,minDistanceFromContainer:10,shift:{x:0,y:0},clickOutside:null,lastAutoTeardown:0,shouldTeardown:!0,isFixedPosition:!1};this._popoverBase=o.defaults(o.pick(e||{},o.keys(t)),t),this._initializeDebugger(),this.setPinnedTarget(e.pinnedTarget||null),this.setPopoverContainer(e.popoverContainer||c),this._popoverBase.autoTeardown&&this.listenTo(this,"rendered",this.setupAutoTeardown)},render:function(){this.$el.addClass(this._popoverBase.className),this.$el.appendTo(this.$container);var e=this.$el.children().first(),t=e.width();e.width(t-t%2),this.reposition(),this.isContainerBody&&(this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"),this.listenTo(a,"DOMEventor:flatresize",this.reposition),this._popoverBase.isFixedPosition||this.listenTo(a,"DOMEventor:flatscroll",this.reposition)),this._popoverBase.teardownOnEscape&&this.listenTo(a,"DOMEventor:keyup:escape",this.teardown),this.trigger("open",this),a.trigger(this._popoverBase.identifier+":open",this)},teardown:function(){this.$pinned.removeClass("pinned-target"),this._popoverBase.teardownOnEscape&&this.stopListening(a,"DOMEventor:keyup:escape"),this.removeAutoTeardown(),this.trigger("close",this),a.trigger(this._popoverBase.identifier+":close",this)}},before:{teardown:function(){this.$el.off("mousewheel DOMMouseScroll")}}});e.exports=d},function(e,t,i){"use strict";function s(e,t){this.options=n.extend({preventInteraction:!1,ignoreSelectors:[]},t),this._onClick=n.bind(this._onClick,this,e),document.addEventListener("click",this._onClick,!0)}var n=i(3),o=i(8),r=i(7);s.prototype._isForcedInsideTarget=function(e){return!n.isEmpty(this.options.ignoreSelectors)&&!n.isEmpty(e.closest(this.options.ignoreSelectors.join(",")))},s.prototype._onClick=function(e,t){var i=o(t.target);e===t.target||o.contains(e,t.target)||this._isForcedInsideTarget(i)?this.trigger("click:inside",t):(this.trigger("click:outside"),this.options.preventInteraction&&(t.preventDefault(),t.stopPropagation()))},s.prototype.remove=function(){return document.removeEventListener("click",this._onClick,!0),this.off(),this},n.extend(s.prototype,r.Events),e.exports=s},,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(178),r=i(139),a=i(252),l=i(235),c=i(236),u=i(189),h=i(271),d=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1,smartQuotesEnabled:!1},events:{},mixins:[u,l,c],template:h,initialize:function(e){this.set(e),this.onChange=e.onChange||s.noop,this.onClientEvent=e.onClientEvent||s.noop,this.pasteHook=e.pasteHook||s.noop,this.smartQuotesEnabled=e.smartQuotesEnabled,this.disableEdit=e.disableEdit||!1;var t=this.get("name");t&&this.get("syncWithModel")&&this.$el.attr("data-name",t)},_initializeEditor:function(e,t){var i={placeholder:t,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},smartQuotes:{enabled:this.smartQuotesEnabled}};this.editor=new a.PlainTextEditor(e,i),this.disableEdit&&this.disable()},_composeOnChange:function(){var e=[this.onChange],t=this;return this.get("syncWithModel")&&e.unshift(this.updateModelFromEditor),function(i){s.each(e,function(e){e.call(t,i)})}},_composeOnClientEvent:function(){var e=this.onClientEvent,t=this;return function(i){r.trigger("plainTextEditor:onClientEvent",i,t.editor),e.call(this,i)}},render:function(){this.$el.html(this.template({ariaLabel:this.get("ariaLabel")}));var e=this.js$("plainTextEditor").get(0);if(this._initializeEditor(e,this.get("placeholder")),this.get("syncWithModel")){var t=this._modelValue().length>0;t&&this.set("placeholder",!1),this.updateEditorFromModel()}return this},teardown:function(){return this.$el.empty(),delete this.editor,this},serialize:function(){return this.toJSON()},getEditorValue:function(e){return"undefined"!=typeof e||(e=!0),this.editor?this.editor.getData(e):null},setEditorValue:function(e){this.editor&&this.editor.setData(e)},updateModelFromEditor:function(){if(!this.editor)return!1;var e=this.get("name"),t=this.getEditorValue();""!==t?n(this.editor.element).addClass("has-text"):n(this.editor.element).removeClass("has-text"),this.model.get(e)!==t&&this.model.set(e,t)},updateEditorFromModel:function(){var e=this.getEditorValue(),t=this._modelValue();t.trim()&&t.trim()!==e.trim()&&this.setEditorValue(t)},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(e){this.editor&&this.editor.focus(e)},blur:function(){this.editor&&this.editor.element.blur()},setCursorToEnd:function(){this.editor&&s.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()},enable:function(){n(this.editor.element).attr("contenteditable",!0)},disable:function(){n(this.editor.element).removeAttr("contenteditable")}});e.exports=d},function(e,t,i){var s=i(3),n=i(253);e.exports=s.extend(n,{RichTextEditor:i(254),PlainTextEditor:i(270),SelectionContext:i(264),SelectionPersistence:i(258),Utils:i(257),HumanKeys:i(269)})},function(e,t){var i={debugMode:!1};e.exports=i},function(e,t,i){var s=i(3),n=i(8),o=i(255).animate,r=i(256),a=i(261),l=i(262),c=i(258),u=i(264),h=i(265),d=i(257),p=i(266),g=i(267),_=i(268),f=i(269),m=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,v=i(260),b=function(){function e(e,t){return s.mapValues(e,function(e,t){return t.match(/^on[A-Z]/)&&s.isFunction(e)?s.bind(e,this):e},t)}function t(){U.call(this,de);var e=n("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),t=n("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");n(this.element).wrap(e).wrap(t),t=n(this.element).parent(),this.wrapper=t.parent().get(0),this.placeholderElement=n("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),this.placeholderElement.on("click",s.bind(function(e){this.focus()},this)),t.append(this.contextualControls.element),t.append(this.linkControl.element),t.append(this.placeholderElement),t.append(this.inlineControls.element),L.call(this),this.controlBar=n("<div />",{"data-js":"control-bar",class:"control-bar disabled"});var o=n("<div />",{class:"static-controls control"});this.controlBar.append(o),this.controlBar.append(this.staticControls.element);var r=this;o.on("mousedown",function(e){e.preventDefault(),e.stopPropagation();var t=u.getNodeList();r.staticControls.setActives(s.pluck(t,"nodeName"));var i=n(this).position();return r.staticControls.isShown?r.staticControls.hide():r.staticControls.open(i.left+n(this).width()/2,0),r.contextualControls.hide(),r.linkControl.close(),!1}),this.config.showStaticControls&&n(this.wrapper).append(this.controlBar),i.call(this),T.call(this)}function i(){var e=this,t=function(){var t=e.inlineControls.isTrayOpen||e.contextualControls.isShown||e.staticControls.isShown||e.linkControl.isShown;return t};n(this.element).on("input keydown keyup keypress mousedown mouseup",function(t){e.controlBar.removeClass("disabled"),e.config.onClientEvent.call(e,t)});var i=function(){O.call(this),this.onChange()};n(this.element).on("keydown",function(i){if(i.keyCode===ye.shift)e.keyModifiers.shift=!0;else if(s.contains([ye.metaLeft,ye.metaRight],i.keyCode))e.keyModifiers.meta=!0;else{if(i.keyCode===ye.esc)return void(t()&&(e.contextualControls.hide(),e.staticControls.hide(),e.inlineControls.isTrayOpen&&e.inlineControls.toggleTrayWithIntent(!1),i.stopPropagation()));i.keyCode===ye.backspace?(S.call(e,i),K.call(e)):i.keyCode===ye.enter&&(k.call(e,i),w.call(e,i),d.browser.safari&&i.shiftKey&&(i.preventDefault(),y.call(e)))}var n=s.contains(s.values(s.omit(ye,"enter")),i.keyCode);!b.call(e)||n||e.keyModifiers.meta||(e.keyModifiers.meta=!1,i.preventDefault()),F.call(e,i),O.call(e,i)}),n(this.element).on("keyup",function(t){t.keyCode===ye.shift?e.keyModifiers.shift=!1:s.contains([ye.metaLeft,ye.metaRight],t.keyCode)?e.keyModifiers.meta=!1:t.keyCode===ye.enter?K.call(e):t.keyCode!==ye.backspace&&t.keyCode!==ye.delete||(j.call(e),s.defer(function(){x.call(e)}));var n=!1;t.keyCode===ye.right&&!t.shiftKey&&e.inlineControls&&(n=e.inlineControls.isShown),t.keyCode===ye.esc||n||i.call(e)}),n(this.element).on("input",function(){i.call(e)});var o=!1;n(this.element).on("mouseup",function(){o=!1,O.call(e)}),n(this.element).on("mousedown",function(e){o=!0}),document.addEventListener("mousedown",function(t){var i=function(){o=!1,C.call(e),e.controlBar.addClass("disabled")};e.wrapper===t.target||n.contains(e.wrapper,t.target)||e.config.documentMousedownHook(t,i)||i()},!0),document.addEventListener("mouseup",function(t){o&&(O.call(e),o=!1)},!0),n(this.element).on("focus",function(){if(e.controlBar.removeClass("disabled"),!W.call(e)){var t=n(e.element).children(ge.join());if(t.length){var i=t.first().get(0);c.setToStart(i)}}s.defer(function(){e.onChange()})}),n(this.element).on("blur",function(i){var n=function(i){if(!t()){var n=u.getSelection();n&&u.isInContext(n,e.element)&&n.removeAllRanges(),O.call(e,function(){e.onChange(),s.isFunction(i)&&i()})}};e.config.blurHook(i,n)||s.defer(n)}),n(this.element).on("paste",function(t){var i=(t.originalEvent||t).clipboardData;i&&(e.config.pasteHook(i,e.keyModifiers.shift)||V.call(e,i),$.call(e),t.preventDefault())}),n(this.element).on("cut",function(t){e.contextualControls.hide(),e.staticControls.hide(),e.linkControl.close(),s.defer(function(){x.call(e),$.call(e),e.onChange()})})}function b(){return!!this.config.characterLimit&&this.element.innerText.length>this.config.characterLimit}function y(){for(var e=W.call(this),t=s.contains(fe,e.nodeName)?"\n":"<br>",i=u.isCursorAtEnd(e)&&!u.isCursorAtStart(e)?1:0,n=0;n<i;n++)t+=t;H.call(this,t)}function w(e){var t,i,o=u.getNodeByNames(fe);o&&!this.keyModifiers.shift&&u.isCursorAtEnd(o)&&(i=n(o),t=i.text(),e.preventDefault(),t.match(/\n\n$/)?(s.last(i.contents()).remove(),this.insertNewParagraphAfter(o)):(i.append("\n\n"),c.setToEnd(o)))}function k(e){var t=u.getNodeByNames(["BLOCKQUOTE"]);if(t&&!this.keyModifiers.shift&&u.isCursorAtEnd(t,!0)){var i="P"===t.lastElementChild.nodeName?t.lastChild:null;i&&i.previousSibling&&this.dataFilter.isEmptyElement(i,!0)&&(e.preventDefault(),n(i).remove(),this.insertNewParagraphAfter(t))}}function C(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function x(){if(!n(this.element).has(be.join()).length){var e=n(this.element).find("ul:not(:has(li)),ol:not(:has(li))");e.remove();var t=s.some(n(this.element).children().toArray(),function(e){return e.textContent.length>0});t||(U.call(this,""),K.call(this),L.call(this))}}function S(e){var t=u.getSelection();if(t.isCollapsed){var i=W.call(this);if(i&&!(c.saveSelection(i).start>0)){var s=n(i).prev().get(0);s&&ce.call(this,s)&&(n(s).remove(),e.preventDefault())}}}function T(){var e=this,t=n(e.element).offset().top,i=null,o="dragstart dragenter dragleave dragover dragend drop",r=!1,a=function(e){var t=e.dataTransfer.types&&s.some(e.dataTransfer.types,function(e){return"Files"===e});return t},l=function(e){return"false"===n(e.target||e.srcElement).attr("contenteditable")},c=function(t,i,n){t.length&&(e.onChange(),s.each(t,function(t){e.config.onFileAdded.call(e,t,i,n)}),O.call(e))},u=function(e,t){return e<t.top+.66*t.height},h=function(e,i){var s=n(i).offset().top-t,o=n(i).get(0).getBoundingClientRect().height,r=e>s+.66*o;return{element:i,top:s,bottom:s+o,height:o,isAfter:r}},d=function(){n(e.element).find(".over-top, .over-bottom").each(function(){n(this).removeClass("over-top").removeClass("over-bottom"),""===n(this).attr("class").trim()&&n(this).removeAttr("class")})},p=function(s){var o=null,r=s.pageY-t,a=n(e.element).children();i&&r>i.top&&u(r,i)||(a.each(function(){var e=h(r,this);if(u(r,e)&&(s.target||s.srcElement)!==this)return o=e,!1}),o||(o=h(r,a.last().get(0)),o.isAfter=!0),o&&i&&i.element===o.element&&i.isAfter===o.isAfter||(d(),i=o))};n(e.element).unbind(o),n(e.element).on("dragleave",function(e){d()}),n(e.element).on("dragover",function(e){return r?(s.debounce(p,100)(e.originalEvent),i&&(n(i.element).addClass(i.isAfter?"over-bottom":"over-top"),a(e.originalEvent)&&e.stopPropagation()),void e.preventDefault()):(e.preventDefault(),void e.stopPropagation())}),n(e.element).on("dragenter",function(e){e.preventDefault(),a(e.originalEvent)&&(r="file")}),n(e.element).on("dragstart",function(t){if(C.call(e),l(t.originalEvent)){r="media";var i=t.originalEvent.target||t.originalEvent.srcElement,o=t.originalEvent.dataTransfer;if(o){o.effectAllowed="move",o.dropEffect="move";try{var a=n(i).find("img").attr("src")||"";a.match(/^\s*data:/)&&(a=""),o.setData("text/uri-list",a),o.setData("text/plain",a)}catch(e){}}s.defer(function(){n(i).addClass("dragging")})}}),n(e.element).on("drop",function(e){d(),a(e.originalEvent)&&c(e.originalEvent.dataTransfer.files,i.element,i.isAfter?1:-1),e.stopPropagation(),e.preventDefault()}),n(e.element).on("dragend",function(t){if(l(t.originalEvent)){d();var s=t.originalEvent.target||t.originalEvent.srcElement,o=n(s).data("origHeight"),a=s;if(i&&a!==i.element){var c=n(s).remove();i.isAfter?n(i.element).after(c):n(i.element).before(c),oe.call(e,c)}n(a).animate({height:o},200,function(){n(a).removeClass("dragging")}),e.onChange(),O.call(e)}r=!1})}function E(e,t,i){var s=n(this.element),o=c.saveSelection(this.element);s.find(i).wrap("<"+t+">"),s.find(i).contents().unwrap(),c.restoreSelection(o),window.document.execCommand(e),s.find(t).wrap("<"+i+">"),s.find(t).contents().unwrap(),c.restoreSelection(o)}function P(e,t,i){var o=this,r=function(){window.document.execCommand(e),o.config.flattenBlocks&&M.call(o)},a=function(){var e=c.saveSelection(o.element),t=200,s=240;!i||i.isAnimating||e.selection.isCollapsed||setTimeout(function(){n(o.linkControl.linkEditInput).focus();var r=function(i,s){var r=i-n(o.wrapper).offset().left,a=s-n(o.wrapper).offset().top;o.linkControl.size(t),o.linkControl.show(r,a),o.linkControl.createLink(e)};i.closeWithShim(i.element.find(".link").get(0),t,s,r),e.selection.removeAllRanges(),o.blur(!0)},30)},l=function(e){var t=c.saveSelection(o.element),i=u.getRootElements();switch(s.each(_e,function(e){var t=u.getNodesByNames(i,[e]);t.length&&I.call(o,"formatBlock",e)}),A.call(o),e.toLowerCase()){case"blockquote":i=u.getRootElements();var r=[],a=[];i=s.each(i,function(e){s.contains(ve,e.nodeName.toUpperCase())?a.push(e):(r.push(a),a=[])}),a.length&&r.push(a),s.each(r,function(t){n(t).wrapAll(document.createElement(e))});break;case"pre":window.document.execCommand("formatBlock",!1,"<"+e+">"),N.call(this);break;default:window.document.execCommand("formatBlock",!1,"<"+e+">")}c.restoreSelection(t)},h=function(){var e=o.contextualControls.controls,t=o.contextualControls.getActiveStates();s.each(t,function(t,i){var s=e[i];t&&I.call(o,s.command,s.el)}),window.document.execCommand("removeFormat")};switch(e){case"formatBlock":l(t);break;case"createLink":a();break;case"insertOrderedList":r();break;case"insertUnorderedList":r();break;case"removeFormat":h();break;case"insertHTML":E.call(this,"underline","U",t);break;default:window.document.execCommand(e)}O.call(this),j.call(this),o.onChange()}function I(e,t){var i=this;switch(e){case"formatBlock":var o=c.saveSelection(this.element);A.call(i),s.each(u.getRootElements(),function(e){i.dataFilter.unBlock(e),"pre"===e.nodeName.toLowerCase()&&(e.innerHTML=e.innerHTML.replace("\n","<br>"));var t=e.nodeName.toUpperCase();if(s.contains(_e,t)){var o=n(e).contents();n(o).wrapAll("<p>"),n(e.firstChild).unwrap()}}),c.restoreSelection(o);break;case"insertOrderedList":A.call(this);break;case"insertUnorderedList":A.call(this);break;case"createLink":window.document.execCommand("unlink");break;case"insertHTML":E.call(this,"underline","U",t);break;default:window.document.execCommand(e)}j.call(this),O.call(this),this.onChange()}function F(e){var t=function(){var e=u.getNodeByNames(["UL","OL"]);return!!e};e.keyCode===ye.tab&&t()&&(e.preventDefault(),e.stopPropagation(),e.shiftKey?(P.call(this,"outdent"),t()||P.call(this,"formatBlock","p")):P.call(this,"indent"))}function N(){var e=u.getNodeByNames(fe);e&&n(e).find("br").replaceWith("\n")}function A(){var e=u.getNodeByNames(me);if(e){do window.document.execCommand("outdent");while(u.getNodeByNames(me));u.getNodeByNames(["H2"])||window.document.execCommand("formatBlock",!1,"<p>"),this.dataFilter.blockifyInlineNodes(this.element)}}function M(){var e=c.saveSelection(this.element),t=u.getNodeList(null,!0);this.dataFilter.unwrapParentBlocks(t),c.restoreSelection(e)}function j(){var e=c.saveSelection(this.element),t=u.getNodeList(),i=this.dataFilter.scrubSpansAndBadAttrs(t);i&&e.end>e.start&&c.restoreSelection(e)}function O(e){var t=this;setTimeout(function(){var i=u.getSelection();return i?(i.isCollapsed?R.call(t,i):D.call(t,i),ie.call(t),G.call(t),t.config.onSelection.call(t,i),u.isInContext(i,t.element)&&(t.lastSelection=c.saveSelection(t.element)),$.call(t),L.call(t),void(s.isFunction(e)&&e())):(ie.call(t),void(s.isFunction(e)&&e()))},20)}function D(e){if(u.isInContext(e,this.element)){var t=u.getContextCoordinates(n(this.element).parent().parent()),i=u.getNodeList(e);this.contextualControls.setActives(s.pluck(i,"nodeName")),this.staticControls.setActives(s.pluck(i,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==e.toString().trim()&&t&&!this.staticControls.isShown&&this.contextualControls.open(t.x,t.y)}}function R(e){this.contextualControls.hide();var t=u.getNodeList(e),i=s.find(t,function(e){return"A"===e.nodeName});if(this.linkControl.isValidLink(i)){var o=u.getContextCoordinates(n(this.element).parent().parent(),i);this.linkControl.showOptions(i),this.linkControl.showOverTarget(o.x,o.y)}else this.linkControl.close();this.staticControls.setActives(s.pluck(t,"nodeName"))}function $(){var e=u.getSelection(),t=e&&e.isCollapsed;if(!t||!u.isInContext(e,this.element))return void this.inlineControls.close();var i=W.call(this);if(i&&"P"===i.nodeName&&this.dataFilter.isEmptyElement(i)&&!this.isEmpty())this.inlineControls.open(i);else if(this.isEmpty()){this.inlineControls.open(i);var s=d.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(i,s)}else this.inlineControls.close()}function L(){var e=this.isEmpty()?this.config.placeholder:"",t=n(this.placeholderElement);t.html(e);var i=t.outerHeight();i&&n(this.element).css("min-height",Math.max(parseInt(t.css("min-height"),10)||0,i))}function B(e){var t=this.element.innerText.length,i=this.config.characterLimit;if(t+e.length>=i){var s=i-t,n=s>0?s:0;e=e.slice(0,n)}return e}function V(e){var t="";if(e.items&&e.items.length){var i=s.find(e.items,function(e){return/image\/\w+/.test(e.type)});if(i){var o=i.getAsFile();if(o)return void this.config.onFileAdded.call(this,o)}}s.contains(e.types,"text/html")?t=e.getData("text/html"):(t=e.getData("text/plain"),t=this.dataFilter.filterPlaintext(t,!0)),t=t.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),t=t.replace(/\u00a0/g," "),t=this.dataFilter.filterHTML(t),t=this.dataFilter.convertToBrowserSpaces(t),this.config.characterLimit&&(t=B.call(this,t));var r=document.createElement("div");r.innerHTML=t,this.dataFilter.flattenBlocksDown(r,!0),n(r).find(be.join()).remove();var a=s.some(r.children,function(e){return s.contains(ge,e.nodeName)});if(a){var l=u.getSelection(),c=l.getRangeAt(0);c.deleteContents();var h=W.call(this);if(""===n(h).text().trim()){var d=n(h).index(),p=n(h).parent(),g=d+r.children.length-1;n(h).replaceWith(r.children);var _=n(p).children().eq(g).get(0);c.selectNodeContents(_),c.collapse(!1),l.removeAllRanges(),l.addRange(c)}else this.dataFilter.inlinify(r),H.call(this,r.innerHTML)}else H.call(this,r.innerHTML);this.onChange()}function U(e){n(this.element).html(e)}function z(){return n(this.element).html().trim()}function H(e){if(!e)return void v.warn("Cannot insert empty data");var t=u.getSelection();if(!t||!t.focusNode)return void v.warn("Cannot insert without the editor having a cursor or selection");var i=t.getRangeAt(0);i.deleteContents(),e=this.dataFilter.convertToBrowserSpaces(e);var s=document.createElement("div");s.innerHTML=e;for(var n,o=s.lastChild,r=document.createDocumentFragment();n=s.firstChild;)r.appendChild(n);i.insertNode(r),i.setStartAfter(o),i.collapse(!1),t.removeAllRanges(),t.addRange(i)}function q(){var e=W.call(this);if(!e){var t=n(this.element).children(ge.join());if(!t.length)return null;e=t.last().get(0)}return e}function W(){var e=u.getSelection()||this.lastSelection;return u.getNodeByNames(ge,!0,e)}function K(){var e=q.call(this);if(e){if("div"===e.nodeName.toLowerCase())try{window.document.execCommand("formatBlock",!1,"<p>")}catch(e){}}else U.call(this,de),this.setCursorToStart()}function G(){var e=n(this.element).children(ve.join()).last().get(0);e||n(this.element).append(de)}function Q(e,t,i,o,r){var a=this,l=function(e){var l,c,u,h,d=s.uniqueId(),p=0===e.lastIndexOf("data:",0)?"file":e;a.mediaTracker[d]={originalSource:p,file:t},c=n("<img />",{src:e}),l=c.get(0),h=n("<figure />"),u=h.get(0),c.attr(a.config.imgKeyAttr,d),h.append(c),ee.call(a,u,i,o,r),Y.call(a,l,function(i){J.call(a,l,i),a.config.onAsyncImageAdded.call(a,d,e,t,i||{})}),a.onChange()};if(!e&&t)if(m)l(m(t));else{var c=new FileReader;c.onload=function(e){l(e.target.result)},c.readAsDataURL(t)}else{if("string"!=typeof e)return void a.config.onAsyncImageFailed.call(a);l(e)}}function J(e,t){var i,o={},r=this.config,a=n(e).parent("figure").get(0),l={toImg:e,toImgParent:a};r.addImgAttrs&&(i=s.reduce(l,function(e,t,i){return r.addImgAttrs!==!0&&r.addImgAttrs[i]!==!0||e.push(t),e},[])),s.isEmpty(i)||!r.imgSizeAttrs||s.isEmpty(t)||(r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.height]=t.height),r.imgSizeAttrs.height&&(o[r.imgSizeAttrs.width]=t.width),n(i).attr(o))}function Y(e,t){var i=function(e){var i={width:e.naturalWidth,height:e.naturalHeight};s.isFunction(t)&&t.call(this,i)};e.complete?i.call(this,e):n(e).one({"load.getImageAttributes":s.bind(s.partial(i,e),this),error:s.bind(function(){n(e).off(".getImageAttributes"),t.call(this,null)},this)})}function X(e){return n(this.element).find("img["+this.config.imgKeyAttr+'="'+e+'"]').get(0)}function Z(e,t,i){var o=X.call(this,e);s.isEmpty(i)||o&&J.call(this,o,i),t&&(n(o).attr("src",t),this.mediaTracker[e].updatedSource=t)}function ee(e,t,i,s){var o;t=t||q.call(this),o=this.dataFilter.isEmptyElement(t.outerHTML,!0)?0:u.isCursorAtStart(t)?-1:1,i="number"==typeof i?i:o;var r=n(e).get(0),a=ne.call(this,r);oe.call(this,a),i<0?n(t).before(a):i>0?n(t).after(a):0===i&&n(t).replaceWith(a),C.call(this);var l=n(a).nextAll(ve.join()).get(0);l||(l=n(de).get(0),n(a).after(l)),s||(this.focus(!0),c.setToStart(l)),te.call(this,a,!1,O)}function te(e,t,i){var r=this;t=t||!1,i=i||s.noop;var a=n(e),l=a.find("figure"),c=a.find(".media-button"),u=200;return a.length&&l.length?(t&&c.length&&c.hide(),o(l,{opacity:t?0:[1,0],translateY:t?-25:[0,-25]},{duration:.9*u,easing:"easeOutQuad",complete:function(){l.removeAttr("style")}}),void o(e,t?"slideUp":"slideDown",{duration:u,easing:"easeOutQuart",begin:function(){a.css("pointer-events","none")},complete:function(){a.css("pointer-events",""),i.call(r,e)}})):void i.call(r)}function ie(){var e=this,t=W.call(this);n(t).removeClass(e.config.fakeClass),n(e.element).children("p").each(function(i,s){t!==s&&e.dataFilter.isEmptyElement(s)&&(0===i&&ce.call(e,n(s).next().get(0))||n(s).is(":last-child")&&ce.call(e,n(s).prev().get(0))?se.call(e,s):ce.call(e,n(s).prev().get(0))&&ce.call(e,n(s).next().get(0))?se.call(e,s):n(s).hasClass(e.config.fakeClass)&&n(s).remove()),void 0!==n(s).attr("class")&&""===n(s).attr("class").trim()&&n(s).removeAttr("class")}),n(this.element).children("."+this.config.mediaHolderClass).each(function(t,i){var s=n(this).next().get(0);s&&!ce.call(e,s)||n(this).after(se.call(e));var o=n(this).prev().get(0);o||n(this).before(se.call(e))})}function se(e){return e=e||n(de).get(0),n(e).addClass(this.config.fakeClass),e}function ne(e){var t=n(e),i=n("<div />",{class:this.config.mediaHolderClass,contentEditable:!1,draggable:!0});t.wrap(i),i=t.parent(),s.isFunction(this.config.mediaHolderCallback)&&this.config.mediaHolderCallback(this,e,t,i);var o=n(this.config.mediaKillerMarkup);o.addClass("media-killer"),i.append(o);var r=!i.hasClass("media-holder-draggable");if(r){var a=n(this.config.mediaMoverMarkup);a.addClass("media-mover"),i.append(a)}return i}function oe(e){var t=this,i=e?n(e):n(this.element).find('[contenteditable="false"]'),s=this.config.mediaHolderEvents;i.each(function(e,i){var o=n(i),r=null;o.off("keydown").on("keydown",function(e){s.keydown.call(null,e,o),e.isPropagationStopped()||(e.keyCode!==ye.delete&&e.keyCode!==ye.backspace||o.remove(),e.preventDefault(),e.stopPropagation())}),o.off("keyup").on("keyup",function(e){s.keyup.call(null,e,o)}),o.on("mousedown",function(e){r=e.originalEvent.target,s.mousedown.call(null,e,o,r)}),o.on("mouseup",function(e){s.mouseup.call(null,e,o,r);var i=n(r);i.hasClass("media-killer")&&r===e.target&&te.call(t,o,!0,function(){o.remove(),x.call(t),O.call(t),t.onChange()})}),o.on("mouseenter",function(e){n(e.currentTarget).addClass("show-controls"),s.mouseenter.call(null,e,o,r)}),o.on("mouseleave",function(e){n(e.currentTarget).removeClass("show-controls"),s.mouseleave.call(null,e,o,r)}),o.on("dragstart",function(e){var t=n(r);t.hasClass("media-killer")&&(e.preventDefault(),e.stopPropagation()),o.hasClass("media-holder-draggable")||t.hasClass("media-mover")||(e.preventDefault(),e.stopPropagation()),s.dragstart.call(null,e,o,r)})})}function re(e){s.each(n(e).find("."+this.config.mediaHolderClass),function(e){n(e).find(".media-killer, .media-mover").remove();var t=n(e).children().first();t.length?n(t).unwrap():(n(e).contents().wrap("<div>"),n(e).children().first().unwrap().contents().unwrap())})}function ae(e){var t=this,i=n(e).find("."+this.config.fakeClass+", ."+this.config.fakeClass+"-intent");s.each(i,function(e){t.dataFilter.isEmptyElement(e)&&n(e).remove()})}function le(){var e=this;s.each(n(this.element).find(be.join()),function(t){var i=u.getParentNodes(t),n=s.some(i,function(e){return s.contains(be,e.nodeName)});ue.call(e,t)||n||ne.call(e,t)})}function ce(e){return n(e).hasClass(this.config.mediaHolderClass)}function ue(e){var t=n(e).closest("[class="+this.config.mediaHolderClass+"]");return t.length?t.get(0):null}function he(e,t,i){var o,r;return t=!!s.isBoolean(t)&&t,e=e||q.call(this),o=n(e)[t?"prev":"next"](),!i&&o.length>0&&this.dataFilter.isEmptyElement(o)?(c.setToStart(o.get(0)),o):(r=n(de).get(0),n(e)[t?"before":"after"](r),c.setToStart(r),r)}var de="<p><br></p>",pe="<p></p>",ge=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","DIV","PRE"],_e=["H2","BLOCKQUOTE","PRE"],fe=["PRE"],me=["UL","OL"],ve=["P","H2","BLOCKQUOTE","UL","OL","PRE"],be=["IMG","IFRAME","FIGURE","HR"],ye={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39,metaLeft:91,metaRight:93,leftArrow:37,rightArrow:38,upArrow:39,downArrow:40},we=function(i,o){if(!i)throw new Error("A valid element parameter is required to initalize the editor");o=o||{},this.element=i,this.humanKeys=new f,this.keyComboEvents=o.keyComboEvents||new _({element:this.element,humanKeys:this.humanKeys});var d=s.template("<%= title %> (<%= shortcut %>)"),m=s.bind(function(e,t){return d({title:e,shortcut:this.humanKeys.pretty(t)})},this);this.config={labels:{},placeholder:!1,characterLimit:null,onChange:s.noop,onSelection:function(e){},onAsyncImageAdded:function(e,t,i,s){},onAsyncImageFailed:function(){v.warn("Unknown source type for inserting an image.")},onFileAdded:function(e,t,i){},onClientEvent:function(e){},flattenBlocks:!0,smartQuotes:{enabled:!1,config:{}},runIFrameSanitization:!1,mediaHolderClass:"media-holder",
mediaHolderCallback:function(e,t,i,n){i.is("hr, img, figure")&&s.isEmpty(i.find("iframe"))&&n.addClass("media-holder-draggable"),n.addClass("media-holder-"+i.prop("tagName").toLowerCase())},mediaHolderEvents:{keydown:s.noop,keyup:s.noop,mousedown:s.noop,mouseup:s.noop,mouseenter:s.noop,mouseleave:s.noop,click:s.noop,dragstart:s.noop},imgKeyAttr:"data-img-key",imgSizeAttrs:{width:"data-orig-width",height:"data-orig-height"},addImgAttrs:{toImg:!1,toImgParent:!1},fakeClass:"fake",mediaKillerMarkup:"<div>×</div>",mediaMoverMarkup:"<div>&#8597;</div>",pasteHook:function(e,t){return!1},blurHook:function(e){return!1},documentMousedownHook:function(e){return!1},filterForSetData:function(e){return e},filterForGetData:function(e){return e},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr","pre","sub","sup","small"],attributes:{a:["href","title"],img:["src","alt","data-orig-width","data-orig-height"],hr:["data-label"],iframe:["src","width","height","frameborder"],figure:["data-orig-width","data-orig-height"]},classnames:{hr:["read-more"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},animateShowControls:function(e){e.element.show()},animateHideControls:function(e){e.element.hide()},linkConfig:{bypassClasses:[],labels:o.labels,onChange:function(){this.onChange.call(this)},onDismiss:function(){this.lastSelection&&(c.restoreSelection(this.lastSelection),O.call(this))}},inlineControlsConfig:{openTray:h.prototype.openTray,closeTray:h.prototype.closeTray,onTrayOpened:function(e){},onTrayClosed:function(e){},keyboardEvents:this.keyComboEvents},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:m("Bold","meta+b"),keyboard:"meta+b"},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:m("Italic","meta+i"),keyboard:"meta+i"},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:m("Headline","meta+shift+2"),keyboard:"meta+shift+2"},link:{el:"a",className:"link",command:"createLink",type:"inline",title:m("Link","meta+k"),keyboard:"meta+k"},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:m("Strikethrough","meta+shift+6"),keyboard:"meta+shift+6"},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:m("Ordered List","meta+shift+7"),keyboard:"meta+shift+7"},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:m("Unordered List","meta+shift+8"),keyboard:"meta+shift+8"},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:m("Blockquote","meta+shift+9"),keyboard:"meta+shift+9"},clear:{el:"",command:"removeFormat",type:"inline",keyboard:"meta+shift+0"},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:"meta+alt+1"},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:"meta+dot"},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:"meta+comma"},small:{el:"small",command:"insertHTML",type:"inline",keyboard:"meta+shift+minus",keyboardInverse:"meta+shift+plus"}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"],onShow:function(e){s.isFunction(this.animateShowControls)?this.animateShowControls.call(this,e):e.element.show()},onHide:function(e){s.isFunction(this.animateHideControls)?this.animateHideControls.call(this,e):e.element.hide()},onAction:function(e){var t=u.getNodeList();e.setActives(t)}},showStaticControls:!0},s.merge(this.config,o||{}),this.applyCommand=s.bind(P,this),this.inverseCommand=s.bind(I,this),this.animateShowControls=s.bind(this.config.animateShowControls,this),this.animateHideControls=s.bind(this.config.animateHideControls,this),this.onChange=function(e){var t=z.call(this);this.previousRawData!==t&&(L.call(this),this.config.onChange.call(this),this.previousRawData=t)};var b=e(this.config.linkConfig,this);this.linkControl=new r(b);var y=e(this.config.inlineControlsConfig,this);this.inlineControls=new h(y);var w=e(s.defaults({keyboardEvents:this.keyComboEvents},this.config.formattingControlsConfig),this);this.contextualControls=new a(this.applyCommand,this.inverseCommand,w);var k=this.config.formattingControlsConfig.onShow,C=this.config.formattingControlsConfig.onHide,x=e(s.defaults({onShow:function(e){k.apply(this,arguments),e.listener=e.listener||function(t){var i=u.getNodeList();e.setActives(i),document.removeEventListener("mousedown",e.listener,!1)},document.addEventListener("mousedown",e.listener)},onHide:function(e){C.apply(this,arguments),document.removeEventListener("mousedown",e.listener,!1)}},this.config.formattingControlsConfig),this);this.staticControls=new a(this.applyCommand,this.inverseCommand,x),this.dataFilter=new l(this.config.filterRules),this.keyModifiers={shift:!1,meta:!1},this.undoManager=new p(this,s.bind(function(){for(var e in this.mediaTracker){var t=this.mediaTracker[e].updatedSource;if(t){var i=X.call(this,e);n(i).attr("src",t)}}$.call(this)},this)),this.config.smartQuotes.enabled&&(this.smartQuoter=new g(this,this.config.smartQuotes.config)),this.mediaTracker={},t.call(this)};return we.prototype.getData=function(e,t){var i=this,o=z.call(this);o=this.config.filterForGetData.call(this,o),this.config.runIFrameSanitization&&(o=this.dataFilter.unSanitizeIFrames(o));var r=document.createElement("div");if(r.innerHTML=o,re.call(this,r),ae.call(this,r),t||n(r).find("["+i.config.imgKeyAttr+"]").removeAttr(i.config.imgKeyAttr),e)for(var a=function(e){var t=n(r).children(":"+e+"-child").get(0);return t&&i.dataFilter.isEmptyElement(t,!0)?t:null},l=function(){return s.compact([a("first"),a("last")])};l().length;)s.forEach(l(),function(e){n(e).remove()});return r.innerHTML},we.prototype.setData=function(e,t,i){t&&(e=this.config.filterForSetData.call(this,e),e=this.dataFilter.filterHTML(e)),this.config.runIFrameSanitization&&(e=this.dataFilter.sanitizeIFrames(e)),U.call(this,e),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyInlineNodes(this.element),K.call(this),le.call(this),oe.call(this),G.call(this),this.onChange()},we.prototype.insertData=function(e,t,i){t&&(e=this.dataFilter.filterHTML(e)),H.call(this,e),i&&this.dataFilter.flattenBlocksDown(u.getNearestElement()),this.onChange()},we.prototype.blur=function(e){return e||C.call(this),n(this.element).blur()},we.prototype.focus=function(e){var t=n(this.element).focus();return e||this.setCursorToEnd(),t},we.prototype.hasFocus=function(){return n(this.element).is(":focus")},we.prototype.setPlaceholder=function(e){this.config.placeholder=e,L.call(this)},we.prototype.insertMedia=function(e,t,i,s){t&&(e=this.dataFilter.filterHTML(e)),ee.call(this,e,i,s),this.onChange()},we.prototype.addControl=function(e){var t=n(this.wrapper).find("[data-js=control-bar]");t.append(e)},we.prototype.isEmpty=function(){var e=z.call(this);return""===e||"<br>"===e||e===de||e===pe},we.prototype.getCurrentElement=function(){return u.getNearestElement()},we.prototype.getAsyncImage=function(e){return X.call(this,e)},we.prototype.insertAsyncImage=function(e,t,i,s,n){Q.call(this,e,t,i,s,n),this.onChange()},we.prototype.updateAsyncImage=function(e,t,i){Z.call(this,e,t,i),this.onChange("updateAsyncImage")},we.prototype.setCursorToStart=function(e,t){var i=n(this.element);e=e&&i.find(e).first().get(0)||i.children().first().get(0),e&&c.setToStart(e),t||O.call(this)},we.prototype.setCursorToEnd=function(e,t){var i=n(this.element);e=e&&i.find(e).last().get(0)||i.children().last().get(0),e&&c.setToEnd(e),t||O.call(this)},we.prototype.insertNewParagraphAfter=function(e,t){return he.call(this,e,!1,t)},we.prototype.insertNewParagraphBefore=function(e,t){return he.call(this,e,!0,t)},we.prototype.isEmptyElement=function(e){return e=e||q.call(this),this.dataFilter.isEmptyElement(e)},we.prototype.hasSelection=function(e){return e=e||q.call(this),u.hasSelection(e)},we.prototype.isCursorAtEnd=function(e){return e=e||q.call(this),u.isCursorAtEnd(e)},we.prototype.isCursorAtStart=function(e){return e=e||q.call(this),u.isCursorAtStart(e)},we.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},we}();e.exports=b},function(e,t){/*! VelocityJS.org (1.4.3). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */
/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */
!function(e){"use strict";function t(e){var t=e.length,s=i.type(e);return"function"!==s&&!i.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===s||0===t||"number"==typeof t&&t>0&&t-1 in e))}if(!e.jQuery){var i=function(e,t){return new i.fn.init(e,t)};i.isWindow=function(e){return e&&e===e.window},i.type=function(e){return e?"object"==typeof e||"function"==typeof e?n[r.call(e)]||"object":typeof e:e+""},i.isArray=Array.isArray||function(e){return"array"===i.type(e)},i.isPlainObject=function(e){var t;if(!e||"object"!==i.type(e)||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!o.call(e,"constructor")&&!o.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return void 0===t||o.call(e,t)},i.each=function(e,i,s){var n,o=0,r=e.length,a=t(e);if(s){if(a)for(;o<r&&(n=i.apply(e[o],s),n!==!1);o++);else for(o in e)if(e.hasOwnProperty(o)&&(n=i.apply(e[o],s),n===!1))break}else if(a)for(;o<r&&(n=i.call(e[o],o,e[o]),n!==!1);o++);else for(o in e)if(e.hasOwnProperty(o)&&(n=i.call(e[o],o,e[o]),n===!1))break;return e},i.data=function(e,t,n){if(void 0===n){var o=e[i.expando],r=o&&s[o];if(void 0===t)return r;if(r&&t in r)return r[t]}else if(void 0!==t){var a=e[i.expando]||(e[i.expando]=++i.uuid);return s[a]=s[a]||{},s[a][t]=n,n}},i.removeData=function(e,t){var n=e[i.expando],o=n&&s[n];o&&(t?i.each(t,function(e,t){delete o[t]}):delete s[n])},i.extend=function(){var e,t,s,n,o,r,a=arguments[0]||{},l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[l]||{},l++),"object"!=typeof a&&"function"!==i.type(a)&&(a={}),l===c&&(a=this,l--);l<c;l++)if(o=arguments[l])for(n in o)o.hasOwnProperty(n)&&(e=a[n],s=o[n],a!==s&&(u&&s&&(i.isPlainObject(s)||(t=i.isArray(s)))?(t?(t=!1,r=e&&i.isArray(e)?e:[]):r=e&&i.isPlainObject(e)?e:{},a[n]=i.extend(u,r,s)):void 0!==s&&(a[n]=s)));return a},i.queue=function(e,s,n){function o(e,i){var s=i||[];return e&&(t(Object(e))?!function(e,t){for(var i=+t.length,s=0,n=e.length;s<i;)e[n++]=t[s++];if(i!==i)for(;void 0!==t[s];)e[n++]=t[s++];return e.length=n,e}(s,"string"==typeof e?[e]:e):[].push.call(s,e)),s}if(e){s=(s||"fx")+"queue";var r=i.data(e,s);return n?(!r||i.isArray(n)?r=i.data(e,s,o(n)):r.push(n),r):r||[]}},i.dequeue=function(e,t){i.each(e.nodeType?[e]:e,function(e,s){t=t||"fx";var n=i.queue(s,t),o=n.shift();"inprogress"===o&&(o=n.shift()),o&&("fx"===t&&n.unshift("inprogress"),o.call(s,function(){i.dequeue(s,t)}))})},i.fn=i.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(e){for(var t=e.offsetParent;t&&"html"!==t.nodeName.toLowerCase()&&t.style&&"static"===t.style.position;)t=t.offsetParent;return t||document}var t=this[0],s=e(t),n=this.offset(),o=/^(?:body|html)$/i.test(s.nodeName)?{top:0,left:0}:i(s).offset();return n.top-=parseFloat(t.style.marginTop)||0,n.left-=parseFloat(t.style.marginLeft)||0,s.style&&(o.top+=parseFloat(s.style.borderTopWidth)||0,o.left+=parseFloat(s.style.borderLeftWidth)||0),{top:n.top-o.top,left:n.left-o.left}}};var s={};i.expando="velocity"+(new Date).getTime(),i.uuid=0;for(var n={},o=n.hasOwnProperty,r=n.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),l=0;l<a.length;l++)n["[object "+a[l]+"]"]=a[l].toLowerCase();i.fn.init.prototype=i.fn,e.Velocity={Utilities:i}}}(window),function(t){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=t():"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";return function(e,t,i,s){function n(e){for(var t=-1,i=e?e.length:0,s=[];++t<i;){var n=e[t];n&&s.push(n)}return s}function o(e){return b.isWrapped(e)?e=v.call(e):b.isNode(e)&&(e=[e]),e}function r(e){var t=g.data(e,"velocity");return null===t?s:t}function a(e,t){var i=r(e);i&&i.delayTimer&&!i.delayPaused&&(i.delayRemaining=i.delay-t+i.delayBegin,i.delayPaused=!0,clearTimeout(i.delayTimer.setTimeout))}function l(e,t){var i=r(e);i&&i.delayTimer&&i.delayPaused&&(i.delayPaused=!1,i.delayTimer.setTimeout=setTimeout(i.delayTimer.next,i.delayRemaining))}function c(e){return function(t){return Math.round(t*e)*(1/e)}}function u(e,i,s,n){function o(e,t){return 1-3*t+3*e}function r(e,t){return 3*t-6*e}function a(e){return 3*e}function l(e,t,i){return((o(t,i)*e+r(t,i))*e+a(t))*e}function c(e,t,i){return 3*o(t,i)*e*e+2*r(t,i)*e+a(t)}function u(t,i){for(var n=0;n<_;++n){var o=c(i,e,s);if(0===o)return i;var r=l(i,e,s)-t;i-=r/o}return i}function h(){for(var t=0;t<b;++t)C[t]=l(t*y,e,s)}function d(t,i,n){var o,r,a=0;do r=i+(n-i)/2,o=l(r,e,s)-t,o>0?n=r:i=r;while(Math.abs(o)>m&&++a<v);return r}function p(t){for(var i=0,n=1,o=b-1;n!==o&&C[n]<=t;++n)i+=y;--n;var r=(t-C[n])/(C[n+1]-C[n]),a=i+r*y,l=c(a,e,s);return l>=f?u(t,a):0===l?a:d(t,i,i+y)}function g(){x=!0,e===i&&s===n||h()}var _=4,f=.001,m=1e-7,v=10,b=11,y=1/(b-1),w="Float32Array"in t;if(4!==arguments.length)return!1;for(var k=0;k<4;++k)if("number"!=typeof arguments[k]||isNaN(arguments[k])||!isFinite(arguments[k]))return!1;e=Math.min(e,1),s=Math.min(s,1),e=Math.max(e,0),s=Math.max(s,0);var C=w?new Float32Array(b):new Array(b),x=!1,S=function(t){return x||g(),e===i&&s===n?t:0===t?0:1===t?1:l(p(t),i,n)};S.getControlPoints=function(){return[{x:e,y:i},{x:s,y:n}]};var T="generateBezier("+[e,i,s,n]+")";return S.toString=function(){return T},S}function h(e,t){var i=e;return b.isString(e)?C.Easings[e]||(i=!1):i=b.isArray(e)&&1===e.length?c.apply(null,e):b.isArray(e)&&2===e.length?x.apply(null,e.concat([t])):!(!b.isArray(e)||4!==e.length)&&u.apply(null,e),i===!1&&(i=C.Easings[C.defaults.easing]?C.defaults.easing:k),i}function d(e){if(e){var t=C.timestamp&&e!==!0?e:m.now(),i=C.State.calls.length;i>1e4&&(C.State.calls=n(C.State.calls),i=C.State.calls.length);for(var o=0;o<i;o++)if(C.State.calls[o]){var a=C.State.calls[o],l=a[0],c=a[2],u=a[3],h=!!u,f=null,v=a[5],y=a[6];if(u||(u=C.State.calls[o][3]=t-16),v){if(v.resume!==!0)continue;u=a[3]=Math.round(t-y-16),a[5]=null}y=a[6]=t-u;for(var w=Math.min(y/c.duration,1),k=0,x=l.length;k<x;k++){var T=l[k],P=T.element;if(r(P)){var I=!1;if(c.display!==s&&null!==c.display&&"none"!==c.display){if("flex"===c.display){var F=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];g.each(F,function(e,t){S.setPropertyValue(P,"display",t)})}S.setPropertyValue(P,"display",c.display)}c.visibility!==s&&"hidden"!==c.visibility&&S.setPropertyValue(P,"visibility",c.visibility);for(var N in T)if(T.hasOwnProperty(N)&&"element"!==N){var A,M=T[N],j=b.isString(M.easing)?C.Easings[M.easing]:M.easing;if(b.isString(M.pattern)){var O=1===w?function(e,t,i){var s=M.endValue[t];return i?Math.round(s):s}:function(e,t,i){var s=M.startValue[t],n=M.endValue[t]-s,o=s+n*j(w,c,n);return i?Math.round(o):o};A=M.pattern.replace(/{(\d+)(!)?}/g,O)}else if(1===w)A=M.endValue;else{var D=M.endValue-M.startValue;A=M.startValue+D*j(w,c,D)}if(!h&&A===M.currentValue)continue;if(M.currentValue=A,"tween"===N)f=A;else{var R;if(S.Hooks.registered[N]){R=S.Hooks.getRoot(N);var $=r(P).rootPropertyValueCache[R];$&&(M.rootPropertyValue=$)}var L=S.setPropertyValue(P,N,M.currentValue+(_<9&&0===parseFloat(A)?"":M.unitType),M.rootPropertyValue,M.scrollData);S.Hooks.registered[N]&&(S.Normalizations.registered[R]?r(P).rootPropertyValueCache[R]=S.Normalizations.registered[R]("extract",null,L[1]):r(P).rootPropertyValueCache[R]=L[1]),"transform"===L[0]&&(I=!0)}}c.mobileHA&&r(P).transformCache.translate3d===s&&(r(P).transformCache.translate3d="(0px, 0px, 0px)",I=!0),I&&S.flushTransformCache(P)}}c.display!==s&&"none"!==c.display&&(C.State.calls[o][2].display=!1),c.visibility!==s&&"hidden"!==c.visibility&&(C.State.calls[o][2].visibility=!1),c.progress&&c.progress.call(a[1],a[1],w,Math.max(0,u+c.duration-t),u,f),1===w&&p(o)}}C.State.isTicking&&E(d)}function p(e,t){if(!C.State.calls[e])return!1;for(var i=C.State.calls[e][0],n=C.State.calls[e][1],o=C.State.calls[e][2],a=C.State.calls[e][4],l=!1,c=0,u=i.length;c<u;c++){var h=i[c].element;t||o.loop||("none"===o.display&&S.setPropertyValue(h,"display",o.display),"hidden"===o.visibility&&S.setPropertyValue(h,"visibility",o.visibility));var d=r(h);if(o.loop!==!0&&(g.queue(h)[1]===s||!/\.velocityQueueEntryFlag/i.test(g.queue(h)[1]))&&d){d.isAnimating=!1,d.rootPropertyValueCache={};var p=!1;g.each(S.Lists.transforms3D,function(e,t){var i=/^scale/.test(t)?1:0,n=d.transformCache[t];d.transformCache[t]!==s&&new RegExp("^\\("+i+"[^.]").test(n)&&(p=!0,delete d.transformCache[t])}),o.mobileHA&&(p=!0,delete d.transformCache.translate3d),p&&S.flushTransformCache(h),S.Values.removeClass(h,"velocity-animating")}if(!t&&o.complete&&!o.loop&&c===u-1)try{o.complete.call(n,n)}catch(e){setTimeout(function(){throw e},1)}a&&o.loop!==!0&&a(n),d&&o.loop===!0&&!t&&(g.each(d.tweensContainer,function(e,t){if(/^rotate/.test(e)&&(parseFloat(t.startValue)-parseFloat(t.endValue))%360===0){var i=t.startValue;t.startValue=t.endValue,t.endValue=i}/^backgroundPosition/.test(e)&&100===parseFloat(t.endValue)&&"%"===t.unitType&&(t.endValue=0,t.startValue=100)}),C(h,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&g.dequeue(h,o.queue)}C.State.calls[e]=!1;for(var _=0,f=C.State.calls.length;_<f;_++)if(C.State.calls[_]!==!1){l=!0;break}l===!1&&(C.State.isTicking=!1,delete C.State.calls,C.State.calls=[])}var g,_=function(){if(i.documentMode)return i.documentMode;for(var e=7;e>4;e--){var t=i.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return t=null,e}return s}(),f=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var i,s=(new Date).getTime();return i=Math.max(0,16-(s-e)),e=s+i,setTimeout(function(){t(s+i)},i)}}(),m=function(){var e=t.performance||{};if(!Object.prototype.hasOwnProperty.call(e,"now")){var i=e.timing&&e.timing.domComplete?e.timing.domComplete:(new Date).getTime();e.now=function(){return(new Date).getTime()-i}}return e}(),v=function(){var e=Array.prototype.slice;try{e.call(i.documentElement)}catch(t){e=function(){for(var e=this.length,t=[];--e>0;)t[e]=this[e];return t}}return e}(),b={isNumber:function(e){return"number"==typeof e},isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isWrapped:function(e){return e&&b.isNumber(e.length)&&!b.isString(e)&&!b.isFunction(e)&&!b.isNode(e)&&(0===e.length||b.isNode(e[0]))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},y=!1;if(e.fn&&e.fn.jquery?(g=e,y=!0):g=t.Velocity.Utilities,_<=8&&!y)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(_<=7)return void(jQuery.fn.velocity=jQuery.fn.animate);var w=400,k="swing",C={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:i.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[],delayedElements:{count:0}},CSS:{},Utilities:g,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:w,easing:k,begin:s,complete:s,progress:s,display:s,visibility:s,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0,promiseRejectEmpty:!0},init:function(e){g.data(e,"velocity",{isSVG:b.isSVG(e),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:4,patch:3},debug:!1,timestamp:!0,pauseAll:function(e){var t=(new Date).getTime();g.each(C.State.calls,function(t,i){if(i){if(e!==s&&(i[2].queue!==e||i[2].queue===!1))return!0;i[5]={resume:!1}}}),g.each(C.State.delayedElements,function(e,i){i&&a(i,t)})},resumeAll:function(e){var t=(new Date).getTime();g.each(C.State.calls,function(t,i){if(i){if(e!==s&&(i[2].queue!==e||i[2].queue===!1))return!0;i[5]&&(i[5].resume=!0)}}),g.each(C.State.delayedElements,function(e,i){i&&l(i,t)})}};t.pageYOffset!==s?(C.State.scrollAnchor=t,C.State.scrollPropertyLeft="pageXOffset",C.State.scrollPropertyTop="pageYOffset"):(C.State.scrollAnchor=i.documentElement||i.body.parentNode||i.body,C.State.scrollPropertyLeft="scrollLeft",C.State.scrollPropertyTop="scrollTop");var x=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,i,s){var n={x:t.x+s.dx*i,v:t.v+s.dv*i,tension:t.tension,friction:t.friction};return{dx:n.v,dv:e(n)}}function i(i,s){var n={dx:i.v,dv:e(i)},o=t(i,.5*s,n),r=t(i,.5*s,o),a=t(i,s,r),l=1/6*(n.dx+2*(o.dx+r.dx)+a.dx),c=1/6*(n.dv+2*(o.dv+r.dv)+a.dv);return i.x=i.x+l*s,i.v=i.v+c*s,i}return function e(t,s,n){var o,r,a,l={x:-1,v:0,tension:null,friction:null},c=[0],u=0,h=1e-4,d=.016;for(t=parseFloat(t)||500,s=parseFloat(s)||20,n=n||null,l.tension=t,l.friction=s,o=null!==n,o?(u=e(t,s),r=u/n*d):r=d;;)if(a=i(a||l,r),c.push(1+a.x),u+=16,!(Math.abs(a.x)>h&&Math.abs(a.v)>h))break;return o?function(e){return c[e*(c.length-1)|0]}:u}}();C.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},g.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){C.Easings[t[0]]=u.apply(null,t[1])});var S=C.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"],units:["%","em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","Q","in","pc","pt","px","deg","grad","rad","turn","s","ms"],colorNames:{aliceblue:"240,248,255",antiquewhite:"250,235,215",aquamarine:"127,255,212",aqua:"0,255,255",azure:"240,255,255",beige:"245,245,220",bisque:"255,228,196",black:"0,0,0",blanchedalmond:"255,235,205",blueviolet:"138,43,226",blue:"0,0,255",brown:"165,42,42",burlywood:"222,184,135",cadetblue:"95,158,160",chartreuse:"127,255,0",chocolate:"210,105,30",coral:"255,127,80",cornflowerblue:"100,149,237",cornsilk:"255,248,220",crimson:"220,20,60",cyan:"0,255,255",darkblue:"0,0,139",darkcyan:"0,139,139",darkgoldenrod:"184,134,11",darkgray:"169,169,169",darkgrey:"169,169,169",darkgreen:"0,100,0",darkkhaki:"189,183,107",darkmagenta:"139,0,139",darkolivegreen:"85,107,47",darkorange:"255,140,0",darkorchid:"153,50,204",darkred:"139,0,0",darksalmon:"233,150,122",darkseagreen:"143,188,143",darkslateblue:"72,61,139",darkslategray:"47,79,79",darkturquoise:"0,206,209",darkviolet:"148,0,211",deeppink:"255,20,147",deepskyblue:"0,191,255",dimgray:"105,105,105",dimgrey:"105,105,105",dodgerblue:"30,144,255",firebrick:"178,34,34",floralwhite:"255,250,240",forestgreen:"34,139,34",fuchsia:"255,0,255",gainsboro:"220,220,220",ghostwhite:"248,248,255",gold:"255,215,0",goldenrod:"218,165,32",gray:"128,128,128",grey:"128,128,128",greenyellow:"173,255,47",green:"0,128,0",honeydew:"240,255,240",hotpink:"255,105,180",indianred:"205,92,92",indigo:"75,0,130",ivory:"255,255,240",khaki:"240,230,140",lavenderblush:"255,240,245",lavender:"230,230,250",lawngreen:"124,252,0",lemonchiffon:"255,250,205",lightblue:"173,216,230",lightcoral:"240,128,128",lightcyan:"224,255,255",lightgoldenrodyellow:"250,250,210",lightgray:"211,211,211",lightgrey:"211,211,211",lightgreen:"144,238,144",lightpink:"255,182,193",lightsalmon:"255,160,122",lightseagreen:"32,178,170",lightskyblue:"135,206,250",lightslategray:"119,136,153",lightsteelblue:"176,196,222",lightyellow:"255,255,224",limegreen:"50,205,50",lime:"0,255,0",linen:"250,240,230",magenta:"255,0,255",maroon:"128,0,0",mediumaquamarine:"102,205,170",mediumblue:"0,0,205",mediumorchid:"186,85,211",mediumpurple:"147,112,219",mediumseagreen:"60,179,113",mediumslateblue:"123,104,238",mediumspringgreen:"0,250,154",mediumturquoise:"72,209,204",mediumvioletred:"199,21,133",midnightblue:"25,25,112",mintcream:"245,255,250",mistyrose:"255,228,225",moccasin:"255,228,181",navajowhite:"255,222,173",navy:"0,0,128",oldlace:"253,245,230",olivedrab:"107,142,35",olive:"128,128,0",orangered:"255,69,0",orange:"255,165,0",orchid:"218,112,214",palegoldenrod:"238,232,170",palegreen:"152,251,152",paleturquoise:"175,238,238",palevioletred:"219,112,147",papayawhip:"255,239,213",peachpuff:"255,218,185",peru:"205,133,63",pink:"255,192,203",plum:"221,160,221",powderblue:"176,224,230",purple:"128,0,128",red:"255,0,0",rosybrown:"188,143,143",royalblue:"65,105,225",saddlebrown:"139,69,19",salmon:"250,128,114",sandybrown:"244,164,96",seagreen:"46,139,87",seashell:"255,245,238",sienna:"160,82,45",silver:"192,192,192",skyblue:"135,206,235",slateblue:"106,90,205",slategray:"112,128,144",snow:"255,250,250",springgreen:"0,255,127",steelblue:"70,130,180",tan:"210,180,140",teal:"0,128,128",thistle:"216,191,216",tomato:"255,99,71",turquoise:"64,224,208",violet:"238,130,238",wheat:"245,222,179",whitesmoke:"245,245,245",white:"255,255,255",yellowgreen:"154,205,50",yellow:"255,255,0"}},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<S.Lists.colors.length;e++){var t="color"===S.Lists.colors[e]?"0 0 0 1":"255 255 255 1";S.Hooks.templates[S.Lists.colors[e]]=["Red Green Blue Alpha",t]}var i,s,n;if(_)for(i in S.Hooks.templates)if(S.Hooks.templates.hasOwnProperty(i)){s=S.Hooks.templates[i],n=s[0].split(" ");var o=s[1].match(S.RegEx.valueSplit);"Color"===n[0]&&(n.push(n.shift()),o.push(o.shift()),S.Hooks.templates[i]=[n.join(" "),o.join(" ")])}for(i in S.Hooks.templates)if(S.Hooks.templates.hasOwnProperty(i)){s=S.Hooks.templates[i],n=s[0].split(" ");for(var r in n)if(n.hasOwnProperty(r)){var a=i+n[r],l=r;S.Hooks.registered[a]=[i,l]}}},getRoot:function(e){var t=S.Hooks.registered[e];return t?t[0]:e},getUnit:function(e,t){var i=(e.substr(t||0,5).match(/^[a-z%]+/)||[])[0]||"";return i&&S.Lists.units.indexOf(i)>=0?i:""},fixColors:function(e){return e.replace(/(rgba?\(\s*)?(\b[a-z]+\b)/g,function(e,t,i){return S.Lists.colorNames.hasOwnProperty(i)?(t?t:"rgba(")+S.Lists.colorNames[i]+(t?"":",1)"):t+i})},cleanRootPropertyValue:function(e,t){return S.RegEx.valueUnwrap.test(t)&&(t=t.match(S.RegEx.valueUnwrap)[1]),S.Values.isCSSNullValue(t)&&(t=S.Hooks.templates[e][1]),t},extractValue:function(e,t){var i=S.Hooks.registered[e];if(i){var s=i[0],n=i[1];return t=S.Hooks.cleanRootPropertyValue(s,t),t.toString().match(S.RegEx.valueSplit)[n]}return t},injectValue:function(e,t,i){var s=S.Hooks.registered[e];if(s){var n,o,r=s[0],a=s[1];return i=S.Hooks.cleanRootPropertyValue(r,i),n=i.toString().match(S.RegEx.valueSplit),n[a]=t,o=n.join(" ")}return i}},Normalizations:{registered:{clip:function(e,t,i){switch(e){case"name":return"clip";case"extract":var s;return S.RegEx.wrappedValueAlreadyExtracted.test(i)?s=i:(s=i.toString().match(S.RegEx.valueUnwrap),s=s?s[1].replace(/,(\s+)?/g," "):i),s;case"inject":return"rect("+i+")"}},blur:function(e,t,i){switch(e){case"name":return C.State.isFirefox?"filter":"-webkit-filter";case"extract":var s=parseFloat(i);if(!s&&0!==s){var n=i.toString().match(/blur\(([0-9]+[A-z]+)\)/i);s=n?n[1]:0}return s;case"inject":return parseFloat(i)?"blur("+i+")":"none"}},opacity:function(e,t,i){if(_<=8)switch(e){case"name":return"filter";case"extract":var s=i.toString().match(/alpha\(opacity=(.*)\)/i);return i=s?s[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(i)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(i),10)+")"}else switch(e){case"name":return"opacity";case"extract":return i;case"inject":return i}}},register:function(){function e(e,t,i){var s="border-box"===S.getPropertyValue(t,"boxSizing").toString().toLowerCase();if(s===(i||!1)){var n,o,r=0,a="width"===e?["Left","Right"]:["Top","Bottom"],l=["padding"+a[0],"padding"+a[1],"border"+a[0]+"Width","border"+a[1]+"Width"];for(n=0;n<l.length;n++)o=parseFloat(S.getPropertyValue(t,l[n])),isNaN(o)||(r+=o);return i?-r:r}return 0}function t(t,i){return function(s,n,o){switch(s){case"name":return t;case"extract":return parseFloat(o)+e(t,n,i);case"inject":return parseFloat(o)-e(t,n,i)+"px"}}}_&&!(_>9)||C.State.isGingerbread||(S.Lists.transformsBase=S.Lists.transformsBase.concat(S.Lists.transforms3D));for(var i=0;i<S.Lists.transformsBase.length;i++)!function(){var e=S.Lists.transformsBase[i];S.Normalizations.registered[e]=function(t,i,n){switch(t){case"name":return"transform";case"extract":return r(i)===s||r(i).transformCache[e]===s?/^scale/i.test(e)?1:0:r(i).transformCache[e].replace(/[()]/g,"");case"inject":var o=!1;switch(e.substr(0,e.length-1)){case"translate":o=!/(%|px|em|rem|vw|vh|\d)$/i.test(n);break;case"scal":case"scale":C.State.isAndroid&&r(i).transformCache[e]===s&&n<1&&(n=1),o=!/(\d)$/i.test(n);break;case"skew":o=!/(deg|\d)$/i.test(n);break;case"rotate":o=!/(deg|\d)$/i.test(n)}return o||(r(i).transformCache[e]="("+n+")"),r(i).transformCache[e]}}}();for(var n=0;n<S.Lists.colors.length;n++)!function(){var e=S.Lists.colors[n];S.Normalizations.registered[e]=function(t,i,n){switch(t){case"name":return e;case"extract":var o;if(S.RegEx.wrappedValueAlreadyExtracted.test(n))o=n;else{var r,a={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(n)?r=a[n]!==s?a[n]:a.black:S.RegEx.isHex.test(n)?r="rgb("+S.Values.hexToRgb(n).join(" ")+")":/^rgba?\(/i.test(n)||(r=a.black),o=(r||n).toString().match(S.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return(!_||_>8)&&3===o.split(" ").length&&(o+=" 1"),o;case"inject":return/^rgb/.test(n)?n:(_<=8?4===n.split(" ").length&&(n=n.split(/\s+/).slice(0,3).join(" ")):3===n.split(" ").length&&(n+=" 1"),(_<=8?"rgb":"rgba")+"("+n.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")")}}}();S.Normalizations.registered.innerWidth=t("width",!0),S.Normalizations.registered.innerHeight=t("height",!0),S.Normalizations.registered.outerWidth=t("width"),S.Normalizations.registered.outerHeight=t("height")}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(_||C.State.isAndroid&&!C.State.isChrome)&&(t+="|transform"),new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(C.State.prefixMatches[e])return[C.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],i=0,s=t.length;i<s;i++){var n;if(n=0===i?e:t[i]+e.replace(/^\w/,function(e){return e.toUpperCase()}),b.isString(C.State.prefixElement.style[n]))return C.State.prefixMatches[e]=n,[n,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var t,i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return e=e.replace(i,function(e,t,i,s){return t+t+i+i+s+s}),t=s.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]},isCSSNullValue:function(e){return!e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":/^(table)$/i.test(t)?"table":/^(tbody)$/i.test(t)?"table-row-group":"block"},addClass:function(e,t){if(e)if(e.classList)e.classList.add(t);else if(b.isString(e.className))e.className+=(e.className.length?" ":"")+t;else{var i=e.getAttribute(_<=7?"className":"class")||"";e.setAttribute("class",i+(i?" ":"")+t)}},removeClass:function(e,t){if(e)if(e.classList)e.classList.remove(t);else if(b.isString(e.className))e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ");else{var i=e.getAttribute(_<=7?"className":"class")||"";e.setAttribute("class",i.replace(new RegExp("(^|s)"+t.split(" ").join("|")+"(s|$)","gi")," "))}}},getPropertyValue:function(e,i,n,o){function a(e,i){var n=0;if(_<=8)n=g.css(e,i);else{var l=!1;/^(width|height)$/.test(i)&&0===S.getPropertyValue(e,"display")&&(l=!0,S.setPropertyValue(e,"display",S.Values.getDisplayType(e)));var c=function(){l&&S.setPropertyValue(e,"display","none")};if(!o){if("height"===i&&"border-box"!==S.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var u=e.offsetHeight-(parseFloat(S.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(S.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(S.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(S.getPropertyValue(e,"paddingBottom"))||0);return c(),u}if("width"===i&&"border-box"!==S.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var h=e.offsetWidth-(parseFloat(S.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(S.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(S.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(S.getPropertyValue(e,"paddingRight"))||0);return c(),h}}var d;d=r(e)===s?t.getComputedStyle(e,null):r(e).computedStyle?r(e).computedStyle:r(e).computedStyle=t.getComputedStyle(e,null),"borderColor"===i&&(i="borderTopColor"),n=9===_&&"filter"===i?d.getPropertyValue(i):d[i],""!==n&&null!==n||(n=e.style[i]),c()}if("auto"===n&&/^(top|right|bottom|left)$/i.test(i)){var p=a(e,"position");("fixed"===p||"absolute"===p&&/top|left/i.test(i))&&(n=g(e).position()[i]+"px")}return n}var l;if(S.Hooks.registered[i]){var c=i,u=S.Hooks.getRoot(c);n===s&&(n=S.getPropertyValue(e,S.Names.prefixCheck(u)[0])),S.Normalizations.registered[u]&&(n=S.Normalizations.registered[u]("extract",e,n)),l=S.Hooks.extractValue(c,n)}else if(S.Normalizations.registered[i]){var h,d;h=S.Normalizations.registered[i]("name",e),"transform"!==h&&(d=a(e,S.Names.prefixCheck(h)[0]),S.Values.isCSSNullValue(d)&&S.Hooks.templates[i]&&(d=S.Hooks.templates[i][1])),l=S.Normalizations.registered[i]("extract",e,d)}if(!/^[\d-]/.test(l)){var p=r(e);if(p&&p.isSVG&&S.Names.SVGAttribute(i))if(/^(height|width)$/i.test(i))try{l=e.getBBox()[i]}catch(e){l=0}else l=e.getAttribute(i);else l=a(e,S.Names.prefixCheck(i)[0])}return S.Values.isCSSNullValue(l)&&(l=0),C.debug>=2&&console.log("Get "+i+": "+l),l},setPropertyValue:function(e,i,s,n,o){var a=i;if("scroll"===i)o.container?o.container["scroll"+o.direction]=s:"Left"===o.direction?t.scrollTo(s,o.alternateValue):t.scrollTo(o.alternateValue,s);else if(S.Normalizations.registered[i]&&"transform"===S.Normalizations.registered[i]("name",e))S.Normalizations.registered[i]("inject",e,s),a="transform",s=r(e).transformCache[i];else{if(S.Hooks.registered[i]){var l=i,c=S.Hooks.getRoot(i);n=n||S.getPropertyValue(e,c),s=S.Hooks.injectValue(l,s,n),i=c}if(S.Normalizations.registered[i]&&(s=S.Normalizations.registered[i]("inject",e,s),i=S.Normalizations.registered[i]("name",e)),a=S.Names.prefixCheck(i)[0],_<=8)try{e.style[a]=s}catch(e){C.debug&&console.log("Browser does not support ["+s+"] for ["+a+"]")}else{var u=r(e);u&&u.isSVG&&S.Names.SVGAttribute(i)?e.setAttribute(i,s):e.style[a]=s}C.debug>=2&&console.log("Set "+i+" ("+a+"): "+s)}return[a,s]},flushTransformCache:function(e){var t="",i=r(e);if((_||C.State.isAndroid&&!C.State.isChrome)&&i&&i.isSVG){var s=function(t){return parseFloat(S.getPropertyValue(e,t))},n={translate:[s("translateX"),s("translateY")],skewX:[s("skewX")],skewY:[s("skewY")],scale:1!==s("scale")?[s("scale"),s("scale")]:[s("scaleX"),s("scaleY")],rotate:[s("rotateZ"),0,0]};g.each(r(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),n[e]&&(t+=e+"("+n[e].join(" ")+") ",delete n[e])})}else{var o,a;g.each(r(e).transformCache,function(i){return o=r(e).transformCache[i],"transformPerspective"===i?(a=o,!0):(9===_&&"rotateZ"===i&&(i="rotate"),void(t+=i+o+" "))}),a&&(t="perspective"+a+" "+t)}S.setPropertyValue(e,"transform",t)}};S.Hooks.register(),S.Normalizations.register(),C.hook=function(e,t,i){var n;return e=o(e),g.each(e,function(e,o){if(r(o)===s&&C.init(o),i===s)n===s&&(n=S.getPropertyValue(o,t));else{var a=S.setPropertyValue(o,t,i);"transform"===a[0]&&C.CSS.flushTransformCache(o),n=a}}),n};var T=function(){function e(){return u?x.promise||null:_}function n(e,n){function o(o){var u,p;if(l.begin&&0===P)try{l.begin.call(m,m)}catch(e){setTimeout(function(){throw e},1)}if("scroll"===N){var _,f,w,k=/^x$/i.test(l.axis)?"Left":"Top",T=parseFloat(l.offset)||0;l.container?b.isWrapped(l.container)||b.isNode(l.container)?(l.container=l.container[0]||l.container,_=l.container["scroll"+k],w=_+g(e).position()[k.toLowerCase()]+T):l.container=null:(_=C.State.scrollAnchor[C.State["scrollProperty"+k]],f=C.State.scrollAnchor[C.State["scrollProperty"+("Left"===k?"Top":"Left")]],w=g(e).offset()[k.toLowerCase()]+T),c={scroll:{rootPropertyValue:!1,startValue:_,currentValue:_,endValue:w,unitType:"",easing:l.easing,scrollData:{container:l.container,direction:k,alternateValue:f}},element:e},C.debug&&console.log("tweensContainer (scroll): ",c.scroll,e)}else if("reverse"===N){if(u=r(e),!u)return;if(!u.tweensContainer)return void g.dequeue(e,l.queue);"none"===u.opts.display&&(u.opts.display="auto"),"hidden"===u.opts.visibility&&(u.opts.visibility="visible"),u.opts.loop=!1,u.opts.begin=null,u.opts.complete=null,y.easing||delete l.easing,y.duration||delete l.duration,l=g.extend({},u.opts,l),p=g.extend(!0,{},u?u.tweensContainer:null);for(var I in p)if(p.hasOwnProperty(I)&&"element"!==I){var F=p[I].startValue;p[I].startValue=p[I].currentValue=p[I].endValue,p[I].endValue=F,b.isEmptyObject(y)||(p[I].easing=l.easing),C.debug&&console.log("reverse tweensContainer ("+I+"): "+JSON.stringify(p[I]),e)}c=p}else if("start"===N){u=r(e),u&&u.tweensContainer&&u.isAnimating===!0&&(p=u.tweensContainer);var A=function(t,i){var s,o,r;return b.isFunction(t)&&(t=t.call(e,n,E)),b.isArray(t)?(s=t[0],!b.isArray(t[1])&&/^[\d-]/.test(t[1])||b.isFunction(t[1])||S.RegEx.isHex.test(t[1])?r=t[1]:b.isString(t[1])&&!S.RegEx.isHex.test(t[1])&&C.Easings[t[1]]||b.isArray(t[1])?(o=i?t[1]:h(t[1],l.duration),r=t[2]):r=t[1]||t[2]):s=t,i||(o=o||l.easing),b.isFunction(s)&&(s=s.call(e,n,E)),b.isFunction(r)&&(r=r.call(e,n,E)),[s||0,o,r]},M=function(n,o){var r,h=S.Hooks.getRoot(n),d=!1,_=o[0],f=o[1],m=o[2];if(!(u&&u.isSVG||"tween"===h||S.Names.prefixCheck(h)[1]!==!1||S.Normalizations.registered[h]!==s))return void(C.debug&&console.log("Skipping ["+h+"] due to a lack of browser support."));
(l.display!==s&&null!==l.display&&"none"!==l.display||l.visibility!==s&&"hidden"!==l.visibility)&&/opacity|filter/.test(n)&&!m&&0!==_&&(m=0),l._cacheValues&&p&&p[n]?(m===s&&(m=p[n].endValue+p[n].unitType),d=u.rootPropertyValueCache[h]):S.Hooks.registered[n]?m===s?(d=S.getPropertyValue(e,h),m=S.getPropertyValue(e,n,d)):d=S.Hooks.templates[h][1]:m===s&&(m=S.getPropertyValue(e,n));var v,y,w,k=!1,x=function(e,t){var i,s;return s=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return i=e,""}),i||(i=S.Values.getUnitType(e)),[s,i]};if(m!==_&&b.isString(m)&&b.isString(_)){r="";var T=0,E=0,P=[],I=[],F=0,N=0,A=0;for(m=S.Hooks.fixColors(m),_=S.Hooks.fixColors(_);T<m.length&&E<_.length;){var M=m[T],j=_[E];if(/[\d\.-]/.test(M)&&/[\d\.-]/.test(j)){for(var O=M,D=j,$=".",L=".";++T<m.length;){if(M=m[T],M===$)$="..";else if(!/\d/.test(M))break;O+=M}for(;++E<_.length;){if(j=_[E],j===L)L="..";else if(!/\d/.test(j))break;D+=j}var B=S.Hooks.getUnit(m,T),V=S.Hooks.getUnit(_,E);if(T+=B.length,E+=V.length,B===V)O===D?r+=O+B:(r+="{"+P.length+(N?"!":"")+"}"+B,P.push(parseFloat(O)),I.push(parseFloat(D)));else{var U=parseFloat(O),z=parseFloat(D);r+=(F<5?"calc":"")+"("+(U?"{"+P.length+(N?"!":"")+"}":"0")+B+" + "+(z?"{"+(P.length+(U?1:0))+(N?"!":"")+"}":"0")+V+")",U&&(P.push(U),I.push(0)),z&&(P.push(0),I.push(z))}}else{if(M!==j){F=0;break}r+=M,T++,E++,0===F&&"c"===M||1===F&&"a"===M||2===F&&"l"===M||3===F&&"c"===M||F>=4&&"("===M?F++:(F&&F<5||F>=4&&")"===M&&--F<5)&&(F=0),0===N&&"r"===M||1===N&&"g"===M||2===N&&"b"===M||3===N&&"a"===M||N>=3&&"("===M?(3===N&&"a"===M&&(A=1),N++):A&&","===M?++A>3&&(N=A=0):(A&&N<(A?5:4)||N>=(A?4:3)&&")"===M&&--N<(A?5:4))&&(N=A=0)}}T===m.length&&E===_.length||(C.debug&&console.error('Trying to pattern match mis-matched strings ["'+_+'", "'+m+'"]'),r=s),r&&(P.length?(C.debug&&console.log('Pattern found "'+r+'" -> ',P,I,"["+m+","+_+"]"),m=P,_=I,y=w=""):r=s)}r||(v=x(n,m),m=v[0],w=v[1],v=x(n,_),_=v[0].replace(/^([+-\/*])=/,function(e,t){return k=t,""}),y=v[1],m=parseFloat(m)||0,_=parseFloat(_)||0,"%"===y&&(/^(fontSize|lineHeight)$/.test(n)?(_/=100,y="em"):/^scale/.test(n)?(_/=100,y=""):/(Red|Green|Blue)$/i.test(n)&&(_=_/100*255,y="")));var H=function(){var s={myParent:e.parentNode||i.body,position:S.getPropertyValue(e,"position"),fontSize:S.getPropertyValue(e,"fontSize")},n=s.position===R.lastPosition&&s.myParent===R.lastParent,o=s.fontSize===R.lastFontSize;R.lastParent=s.myParent,R.lastPosition=s.position,R.lastFontSize=s.fontSize;var r=100,a={};if(o&&n)a.emToPx=R.lastEmToPx,a.percentToPxWidth=R.lastPercentToPxWidth,a.percentToPxHeight=R.lastPercentToPxHeight;else{var l=u&&u.isSVG?i.createElementNS("http://www.w3.org/2000/svg","rect"):i.createElement("div");C.init(l),s.myParent.appendChild(l),g.each(["overflow","overflowX","overflowY"],function(e,t){C.CSS.setPropertyValue(l,t,"hidden")}),C.CSS.setPropertyValue(l,"position",s.position),C.CSS.setPropertyValue(l,"fontSize",s.fontSize),C.CSS.setPropertyValue(l,"boxSizing","content-box"),g.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){C.CSS.setPropertyValue(l,t,r+"%")}),C.CSS.setPropertyValue(l,"paddingLeft",r+"em"),a.percentToPxWidth=R.lastPercentToPxWidth=(parseFloat(S.getPropertyValue(l,"width",null,!0))||1)/r,a.percentToPxHeight=R.lastPercentToPxHeight=(parseFloat(S.getPropertyValue(l,"height",null,!0))||1)/r,a.emToPx=R.lastEmToPx=(parseFloat(S.getPropertyValue(l,"paddingLeft"))||1)/r,s.myParent.removeChild(l)}return null===R.remToPx&&(R.remToPx=parseFloat(S.getPropertyValue(i.body,"fontSize"))||16),null===R.vwToPx&&(R.vwToPx=parseFloat(t.innerWidth)/100,R.vhToPx=parseFloat(t.innerHeight)/100),a.remToPx=R.remToPx,a.vwToPx=R.vwToPx,a.vhToPx=R.vhToPx,C.debug>=1&&console.log("Unit ratios: "+JSON.stringify(a),e),a};if(/[\/*]/.test(k))y=w;else if(w!==y&&0!==m)if(0===_)y=w;else{a=a||H();var q=/margin|padding|left|right|width|text|word|letter/i.test(n)||/X$/.test(n)||"x"===n?"x":"y";switch(w){case"%":m*="x"===q?a.percentToPxWidth:a.percentToPxHeight;break;case"px":break;default:m*=a[w+"ToPx"]}switch(y){case"%":m*=1/("x"===q?a.percentToPxWidth:a.percentToPxHeight);break;case"px":break;default:m*=1/a[y+"ToPx"]}}switch(k){case"+":_=m+_;break;case"-":_=m-_;break;case"*":_*=m;break;case"/":_=m/_}c[n]={rootPropertyValue:d,startValue:m,currentValue:m,endValue:_,unitType:y,easing:f},r&&(c[n].pattern=r),C.debug&&console.log("tweensContainer ("+n+"): "+JSON.stringify(c[n]),e)};for(var j in v)if(v.hasOwnProperty(j)){var O=S.Names.camelCase(j),D=A(v[j]);if(S.Lists.colors.indexOf(O)>=0){var L=D[0],B=D[1],V=D[2];if(S.RegEx.isHex.test(L)){for(var U=["Red","Green","Blue"],z=S.Values.hexToRgb(L),H=V?S.Values.hexToRgb(V):s,q=0;q<U.length;q++){var W=[z[q]];B&&W.push(B),H!==s&&W.push(H[q]),M(O+U[q],W)}continue}}M(O,D)}c.element=e}c.element&&(S.Values.addClass(e,"velocity-animating"),$.push(c),u=r(e),u&&(""===l.queue&&(u.tweensContainer=c,u.opts=l),u.isAnimating=!0),P===E-1?(C.State.calls.push([$,m,l,null,x.resolver,null,0]),C.State.isTicking===!1&&(C.State.isTicking=!0,d())):P++)}var a,l=g.extend({},C.defaults,y),c={};switch(r(e)===s&&C.init(e),parseFloat(l.delay)&&l.queue!==!1&&g.queue(e,l.queue,function(t){C.velocityQueueEntryFlag=!0;var i=C.State.delayedElements.count++;C.State.delayedElements[i]=e;var s=function(e){return function(){C.State.delayedElements[e]=!1,t()}}(i);r(e).delayBegin=(new Date).getTime(),r(e).delay=parseFloat(l.delay),r(e).delayTimer={setTimeout:setTimeout(t,parseFloat(l.delay)),next:s}}),l.duration.toString().toLowerCase()){case"fast":l.duration=200;break;case"normal":l.duration=w;break;case"slow":l.duration=600;break;default:l.duration=parseFloat(l.duration)||1}if(C.mock!==!1&&(C.mock===!0?l.duration=l.delay=1:(l.duration*=parseFloat(C.mock)||1,l.delay*=parseFloat(C.mock)||1)),l.easing=h(l.easing,l.duration),l.begin&&!b.isFunction(l.begin)&&(l.begin=null),l.progress&&!b.isFunction(l.progress)&&(l.progress=null),l.complete&&!b.isFunction(l.complete)&&(l.complete=null),l.display!==s&&null!==l.display&&(l.display=l.display.toString().toLowerCase(),"auto"===l.display&&(l.display=C.CSS.Values.getDisplayType(e))),l.visibility!==s&&null!==l.visibility&&(l.visibility=l.visibility.toString().toLowerCase()),l.mobileHA=l.mobileHA&&C.State.isMobile&&!C.State.isGingerbread,l.queue===!1)if(l.delay){var u=C.State.delayedElements.count++;C.State.delayedElements[u]=e;var p=function(e){return function(){C.State.delayedElements[e]=!1,o()}}(u);r(e).delayBegin=(new Date).getTime(),r(e).delay=parseFloat(l.delay),r(e).delayTimer={setTimeout:setTimeout(o,parseFloat(l.delay)),next:p}}else o();else g.queue(e,l.queue,function(e,t){return t===!0?(x.promise&&x.resolver(m),!0):(C.velocityQueueEntryFlag=!0,void o(e))});""!==l.queue&&"fx"!==l.queue||"inprogress"===g.queue(e)[0]||g.dequeue(e)}var c,u,_,f,m,v,y,k=arguments[0]&&(arguments[0].p||g.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||b.isString(arguments[0].properties));b.isWrapped(this)?(u=!1,f=0,m=this,_=this):(u=!0,f=1,m=k?arguments[0].elements||arguments[0].e:arguments[0]);var x={promise:null,resolver:null,rejecter:null};if(u&&C.Promise&&(x.promise=new C.Promise(function(e,t){x.resolver=e,x.rejecter=t})),k?(v=arguments[0].properties||arguments[0].p,y=arguments[0].options||arguments[0].o):(v=arguments[f],y=arguments[f+1]),m=o(m),!m)return void(x.promise&&(v&&y&&y.promiseRejectEmpty===!1?x.resolver():x.rejecter()));var E=m.length,P=0;if(!/^(stop|finish|finishAll|pause|resume)$/i.test(v)&&!g.isPlainObject(y)){var I=f+1;y={};for(var F=I;F<arguments.length;F++)b.isArray(arguments[F])||!/^(fast|normal|slow)$/i.test(arguments[F])&&!/^\d/.test(arguments[F])?b.isString(arguments[F])||b.isArray(arguments[F])?y.easing=arguments[F]:b.isFunction(arguments[F])&&(y.complete=arguments[F]):y.duration=arguments[F]}var N;switch(v){case"scroll":N="scroll";break;case"reverse":N="reverse";break;case"pause":var A=(new Date).getTime();return g.each(m,function(e,t){a(t,A)}),g.each(C.State.calls,function(e,t){var i=!1;t&&g.each(t[1],function(e,n){var o=y===s?"":y;return o!==!0&&t[2].queue!==o&&(y!==s||t[2].queue!==!1)||(g.each(m,function(e,s){if(s===n)return t[5]={resume:!1},i=!0,!1}),!i&&void 0)})}),e();case"resume":return g.each(m,function(e,t){l(t,A)}),g.each(C.State.calls,function(e,t){var i=!1;t&&g.each(t[1],function(e,n){var o=y===s?"":y;return o!==!0&&t[2].queue!==o&&(y!==s||t[2].queue!==!1)||(!t[5]||(g.each(m,function(e,s){if(s===n)return t[5].resume=!0,i=!0,!1}),!i&&void 0))})}),e();case"finish":case"finishAll":case"stop":g.each(m,function(e,t){r(t)&&r(t).delayTimer&&(clearTimeout(r(t).delayTimer.setTimeout),r(t).delayTimer.next&&r(t).delayTimer.next(),delete r(t).delayTimer),"finishAll"!==v||y!==!0&&!b.isString(y)||(g.each(g.queue(t,b.isString(y)?y:""),function(e,t){b.isFunction(t)&&t()}),g.queue(t,b.isString(y)?y:"",[]))});var M=[];return g.each(C.State.calls,function(e,t){t&&g.each(t[1],function(i,n){var o=y===s?"":y;return o!==!0&&t[2].queue!==o&&(y!==s||t[2].queue!==!1)||void g.each(m,function(i,s){if(s===n)if((y===!0||b.isString(y))&&(g.each(g.queue(s,b.isString(y)?y:""),function(e,t){b.isFunction(t)&&t(null,!0)}),g.queue(s,b.isString(y)?y:"",[])),"stop"===v){var a=r(s);a&&a.tweensContainer&&o!==!1&&g.each(a.tweensContainer,function(e,t){t.endValue=t.currentValue}),M.push(e)}else"finish"!==v&&"finishAll"!==v||(t[2].duration=1)})})}),"stop"===v&&(g.each(M,function(e,t){p(t,!0)}),x.promise&&x.resolver(m)),e();default:if(!g.isPlainObject(v)||b.isEmptyObject(v)){if(b.isString(v)&&C.Redirects[v]){c=g.extend({},y);var j=c.duration,O=c.delay||0;return c.backwards===!0&&(m=g.extend(!0,[],m).reverse()),g.each(m,function(e,t){parseFloat(c.stagger)?c.delay=O+parseFloat(c.stagger)*e:b.isFunction(c.stagger)&&(c.delay=O+c.stagger.call(t,e,E)),c.drag&&(c.duration=parseFloat(j)||(/^(callout|transition)/.test(v)?1e3:w),c.duration=Math.max(c.duration*(c.backwards?1-e/E:(e+1)/E),.75*c.duration,200)),C.Redirects[v].call(t,t,c||{},e,E,m,x.promise?x:s)}),e()}var D="Velocity: First argument ("+v+") was not a property map, a known action, or a registered redirect. Aborting.";return x.promise?x.rejecter(new Error(D)):console.log(D),e()}N="start"}var R={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},$=[];g.each(m,function(e,t){b.isNode(t)&&n(t,e)}),c=g.extend({},C.defaults,y),c.loop=parseInt(c.loop,10);var L=2*c.loop-1;if(c.loop)for(var B=0;B<L;B++){var V={delay:c.delay,progress:c.progress};B===L-1&&(V.display=c.display,V.visibility=c.visibility,V.complete=c.complete),T(m,"reverse",V)}return e()};C=g.extend(T,C),C.animate=T;var E=t.requestAnimationFrame||f;if(!C.State.isMobile&&i.hidden!==s){var P=function(){i.hidden?(E=function(e){return setTimeout(function(){e(!0)},16)},d()):E=t.requestAnimationFrame||f};P(),i.addEventListener("visibilitychange",P)}return e.Velocity=C,e!==t&&(e.fn.velocity=T,e.fn.velocity.defaults=C.defaults),g.each(["Down","Up"],function(e,t){C.Redirects["slide"+t]=function(e,i,n,o,r,a){var l=g.extend({},i),c=l.begin,u=l.complete,h={},d={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""};l.display===s&&(l.display="Down"===t?"inline"===C.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),l.begin=function(){0===n&&c&&c.call(r,r);for(var i in d)if(d.hasOwnProperty(i)){h[i]=e.style[i];var s=S.getPropertyValue(e,i);d[i]="Down"===t?[s,0]:[0,s]}h.overflow=e.style.overflow,e.style.overflow="hidden"},l.complete=function(){for(var t in h)h.hasOwnProperty(t)&&(e.style[t]=h[t]);n===o-1&&(u&&u.call(r,r),a&&a.resolver(r))},C(e,d,l)}}),g.each(["In","Out"],function(e,t){C.Redirects["fade"+t]=function(e,i,n,o,r,a){var l=g.extend({},i),c=l.complete,u={opacity:"In"===t?1:0};0!==n&&(l.begin=null),n!==o-1?l.complete=null:l.complete=function(){c&&c.call(r,r),a&&a.resolver(r)},l.display===s&&(l.display="In"===t?"auto":"none"),C(this,u,l)}}),C}(window.jQuery||window.Zepto||window,window,window?window.document:void 0)})},function(e,t,i){var s=i(3),n=i(8),o=i(255),r=i(257),a=i(258),l=i(259),c=i(260),u=function(){function e(){this.element=n("<div />",{class:"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=n("<div />",{class:"url"}),this.linkEditInput=n("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=n("<div />",{class:"done"}).text(this.actionNames.done),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),t.call(this),this.element.append(this.linkUrl),this.hide()}function t(){var e=this,t=n("<div />",{class:"options"}),s={edit:function(){i.call(this)},remove:function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(this.linkElement),e.removeAllRanges(),e.addRange(t),window.document.execCommand("unlink",!1,null),e.removeAllRanges(),this.onChange(),this.hide()},open:function(){var e=n(this.linkElement).attr("href");e.indexOf("://")===-1&&(e="http://"+e),window.open(e,"_blank")}};for(var o in s){var r=n("<div />",{class:o}).text(this.actionNames[o]);n(r).on("click",function(t){return function(){t.call(e)}}(s[o])),t.append(r)}t.hide(),n(this.element).append(t)}function i(){this.linkElement||c.error("Cannot edit link without a valid linkElement");var e=this.linkElement;u.call(this,function(t){n(e).attr("href",t)},n(e).attr("href"))}function u(e,t){t&&(this.linkEditInput.val(t),this.linkUrl.addClass("modified"));var i=this,s=function(){var t=n(i.linkEditInput).val().trim();e(t),i.onChange(),i.close()};n(this.linkEditInput).on("keydown",function(e){i.linkUrl.addClass("modified"),e.keyCode===d.enter?(e.preventDefault(),s()):e.keyCode===d.esc&&(i.close(),i.onDismiss(),e.stopPropagation())}),n(this.linkEditInput).on("keyup",function(e){e.keyCode!==d.esc&&e.keyCode!==d.enter&&h.call(i)}),n(this.linkEditInput).on("paste",function(e){i.linkUrl.addClass("modified"),h.call(i)}),this.linkEditDone.on("click",function(e){e.preventDefault(),s()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),h.call(this),n(this.linkEditInput).focus()}function h(){var e=n(this.linkEditInput).val(),t=n(this.linkEditDone).outerWidth(),i=n(this.linkUrl).outerWidth()-n(this.linkUrl).width(),s=r.calcTextWidth(n(this.linkEditInput).get(0),e),a=r.calcTextWidth(n(this.linkEditInput).get(0),"A"),l=s+t+i+a,c=l<this.minWidth?this.minWidth:l;c=c>this.maxWidth?this.maxWidth:c;var u=n(this.element),h=c-u.width();if(0!==h){var d=Math.floor(h/2);o(u,{width:c,left:"-="+d},{duration:40,easing:"ease"})}}var d={shift:16,enter:13,esc:27,delete:8,tab:9},p=function(t){this.onChange="onChange"in t&&s.isFunction(t.onChange)?t.onChange:s.noop,this.onDismiss=t.onDismiss||s.noop,this.bypassClasses="bypassClasses"in t&&s.isArray(t.bypassClasses)?t.bypassClasses:[],this.maxWidth="maxWidth"in t&&s.isNumber(t.maxWidth)?t.maxWidth:600,this.minWidth="minWidth"in t&&s.isNumber(t.minWidth)?t.minWidth:200,this.linkElement=null,this.labels=s.extend({},{Edit:"Edit",Remove:"Remove",Open:"Open",Done:"Done"},t.labels),this.actionNames={edit:this.labels.Edit,remove:this.labels.Remove,open:this.labels.Open,done:this.labels.Done},e.call(this),l.call(this)};return s.assign(p.prototype,l.prototype),p.prototype.createLink=function(e){u.call(this,function(t){a.restoreSelection(e),window.document.execCommand("createLink",!1,t);var i=window.getSelection(),s=i.getRangeAt(0);s.collapse(!1),i.removeAllRanges(),i.addRange(s)})},p.prototype.showOptions=function(e){this.linkElement=e,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},p.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},p.prototype.isValidLink=function(e){return!!e&&!s.some(this.bypassClasses,function(t){return n(e).hasClass(t)})},p}();e.exports=u},function(e,t,i){var s=i(3),n=i(8),o=function(){var e=function(){};return e.calcTextWidth=function(e,t){var i=["font-style","font-weight","font-size","font-family"],o=s.reduce(i,function(t,i){return t+" "+n(e).css(i)},"").trim(),r=document.createElement("canvas"),a=r.getContext("2d");a.font=o;var l=a.measureText(t);return Math.round(l.width)},e.browser=function(){var e=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(trident)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},t=e(navigator.userAgent),i={};return t.browser&&(i[t.browser]=!0,i.version=t.version),i.trident&&(i.msie=!0),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0),i}(),e}();e.exports=o},function(e,t){var i=function(){return{saveSelection:function(e,t){if(t=t||window.getSelection(),!t||!t.rangeCount)return null;for(var i,s,n,o=t.getRangeAt(0),r=0,a=[e];!n&&(i=a.pop());){if(i.nodeType===i.TEXT_NODE)i===o.startContainer?(r+=o.startOffset,n=!0):r+=i.length;else{var l=i.childNodes.length;if("false"!==i.getAttribute("contenteditable"))for(;l--;)a.push(i.childNodes[l])}s=i}return{container:e,endContainer:o.endContainer,start:r,end:r+o.toString().length,selection:t,anchorNode:t.anchorNode}},restoreSelection:function(e){if(e){var t=0,i=document.createRange();i.setStart(e.container,0),i.collapse(!0);for(var s,n,o=[e.container],r=!1,a=!1;!a&&(s=o.pop());){if(s.nodeType===s.TEXT_NODE){var l=t+s.length;!r&&e.start>=t&&e.start<l&&(i.setStart(s,e.start-t),r=!0),r||l!==e.end||(i.setStart(s,e.end-t),r=!0),r&&e.end>=t&&e.end<=l&&(i.setEnd(s,e.end-t),a=!0),t=l}else{var c=s.childNodes.length;if("false"!==s.getAttribute("contenteditable"))for(;c--;)o.push(s.childNodes[c])}n=s}if(!a){var u=e.end-t;try{i.setEnd(e.endContainer,u)}catch(e){}}var h=window.getSelection();h.removeAllRanges();try{h.addRange(i)}catch(e){}}},setToStart:function(e){if(e){var t=document.createRange();t.setStart(e,0),t.setEnd(e,0),t.collapse(!0);var i=window.getSelection();i.removeAllRanges();try{i.addRange(t)}catch(e){}}},setToEnd:function(e){for(var t=[e],i=null,s=e,n=0;i=t.pop();)if(3===i.nodeType)s=i,n=i.length;else for(var o=i.childNodes.length;o--;)t.push(i.childNodes[o]);var r=document.createRange();r.setStart(s,n),r.setEnd(s,n),r.collapse(!0);var a=window.getSelection();a.removeAllRanges();try{a.addRange(r)}catch(e){}}}}();e.exports=i},function(e,t,i){var s=i(260),n=function(){function e(e,t){"number"==typeof e&&"number"==typeof t&&this.element.css({left:e+"px",top:t+"px"})}function t(){var e=this.element.get(0).getBoundingClientRect().left;e<0&&this.element.css("left","+="+-1*e+"px");var t=this.element.get(0).getBoundingClientRect().top;t<0&&this.element.css("top","+="+-1*t+"px")}var i=function(e){return this.element?(e=e||{},this.onShow=e.onShow||function(e){e.element.show()},this.onHide=e.onHide||function(e){e.element.hide()},this.isShown=!1,void this.element.hide()):(s.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.isShown&&(this.isShown=!1,this.onHide(this))},i.prototype.showOverTarget=function(e,i){var s=e-this.element.width()/2,n=i-this.element.height()-10;this.show(s,n),t.call(this)},i.prototype.show=function(t,i){e.call(this,t,i),this.isShown||(this.isShown=!0,this.onShow(this))},i.prototype.size=function(e,t){e&&"number"==typeof e&&this.element.width(e),t&&"number"==typeof t&&this.element.width(t)},i}();e.exports=n},function(e,t,i){var s=i(3),n=i(253),o=["assert","clear","constructor","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","timeline","timelineEnd","trace","warn"],r=function(e){return function(){return n.debugMode?window.console[e].bind(window.console).apply(this,arguments):s.noop}},a={};s.each(o,function(e){a[e]=r(e)}),e.exports=a},function(e,t,i){var s=i(3),n=i(8),o=i(255),r=o.animate,a=i(259),l=function(){function e(){var e=this,t=s.reduce(this.controlsOrder,function(e,t){return s.has(this.controls,t)&&e.push(this.template(s.extend({name:t},this.controls[t]))),e},[],this);this.element=n("<div />",{class:"bubbles"}).css({position:"absolute",top:0,left:0}).html(t),this.buttons=n(this.element).find("[data-command]"),this.hide(),this.buttons.on("mousedown",function(e){e.preventDefault()}),this.buttons.on("mouseup",function(t){t.preventDefault(),l.call(e,this)})}function t(){s.each(this.controls,function(e,t){s.has(e,"keyboard")&&this.keyboardEvents.on(e.keyboard,s.partial(o.bind(this),t)),s.has(e,"keyboardInverse")&&this.keyboardEvents.on(e.keyboardInverse,s.partial(i.bind(this),t))},this)}function i(e){s.has(this.controls,e)&&d[e]&&o.call(this,e)}function o(e){var t,i,n,o;s.has(this.controls,e)&&(t=d[e],i=this.controls[e],n=i.command,o=i.el,t&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(n,o,this):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(n,o,this),this.onAction(this))}function l(e){o.call(this,n(e).attr("data-name"))}function c(){this.buttons.removeClass("active"),this.buttons.filter(function(){return d[n(this).attr("data-name")]}).addClass("active")}function u(e,t){var i=!1;return n.each(e,function(e,s){if(s===t||"undefined"!=typeof s.nodeName&&s.nodeName===t)return i=!0,!1}),i}var h='<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>',d={},p=function(i,n,o){o=o||{},this.applyCommand=i,this.inverseCommand=n,this.template=s.template(o.template||h),this.controls=o.controls||{},this.controlsOrder=o.controlsOrder||s.keys(this.controls),this.onAction=o.onAction||s.noop,this.keyboardEvents=o.keyboardEvents,e.call(this),this.keyboardEvents&&t.call(this),a.call(this,o)};return s.assign(p.prototype,a.prototype),p.prototype.setActives=function(e){d=s.reduce(this.controls,function(t,i,s){var n=i.command,o=(i.el||"").toUpperCase(),r=u(e,o),a=!1;try{a=document.queryCommandEnabled(n)&&document.queryCommandState(n)}catch(e){a=!1}return t[s]=a||r,t},{},this),c.call(this)},p.prototype.open=function(e,t){if(!this.isShown){var i=n(this.element).children("[data-command]"),s=n(this.element).find(".shim");n(this.element).css({width:"auto"}),s.remove(),i.removeAttr("style")}this.showOverTarget(e,t)},p.prototype.closeWithShim=function(e,t,i,o){var a=n(this.element),l=n(e),c=n('<div class="shim">&nbsp;</div>').get(0),u=s.has(r,"Promise");i=u?i:200;var h=a.width();a.css("width",h+t);var d=l.position().left,p=h/2-(d+t/2);l.before(c).hide();var g=n(c).offset().left+p,_=n(c).offset().top;this.isAnimating=!0,s.forEach(this.buttons,function(e,t){r(e,"stop"),r(e,{opacity:0},{duration:.5*i})}),r(a,{left:"+="+p},{easing:"ease",duration:i});var f=r(c,{width:t},{easing:"ease",duration:i}),m=s.bind(function(){s.isFunction(o)&&o.call(this,g,_),this.isAnimating=!1,this.hide()},this);u?f.then(m):s.delay(m,i)},p.prototype.getActiveStates=function(){return d},p}();e.exports=l},function(e,t,i){var s=i(3),n=i(8),o=i(263),r=function(){function e(e){e.normalize();for(var t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);t.nextNode();){var i=t.currentNode,s=n(i).parent().is(e);s&&""!==i.nodeValue.trim()&&n(i).wrap("<p>")}}function t(t){e(t),n(t).children().each(function(){var e=n(this).get(0),t=e.nodeName===f,i=e.nodeName===m;v(e)||b(e)||t||i||n(this).wrap("<p>")})}function i(e){return s.filter(n(e).find("*").toArray(),function(e){return v(e)||w(e)})}function r(e,o){e.normalize(),o||t(e);var r=i(e);!r.length&&o||(o&&(t(e),r=i(e)),n(e).empty(),s.each(r,function(t){var i=s.some(n(t).children().toArray(),function(e){return v(e)});(w(t)||!h(t)&&!i)&&n(e).append(t)}))}function a(e){if(!w(e)){var t=n(e).children(g.join()).toArray(),i=!1;s.each(t,function(e){i||(n(e).unwrap(),i=!0),a(e)})}}function l(e,t){var o=i(e);s.each(o,function(e){n(e).find("li").contents().unwrap(),t&&(n(e).find("br:last-child").remove(),n(e).append("<br>")),n(e).contents().unwrap()})}function c(e){var i=k(e);i.shift();for(var s=i.shift();s&&!n(s).is("[contentEditable]");){var o=s.parentNode;n(s).contents().unwrap(),t(o),s=i.shift()}}function u(e){if(e&&e.length){for(var t=e.shift(),i=!1,o=["style","dir"];t;){var r=n(t).find("span").toArray();"SPAN"===t.nodeName&&r.push(t),r.length&&(i=!0),n(r).contents().unwrap(),s.each(o,function(e){n(t).removeAttr(e),n(t).find("["+e+"]").removeAttr(e)}),t=e.shift()}return i}}function h(e,t){var i=n(e).text();t&&(i=i.replace(/\n|\r/gm,"").trim());var s=e&&e.nodeName===m;return""===i&&!b(e)&&!y(e)&&!s}function d(e){var t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body}function p(e){var t=document.implementation.createHTMLDocument("");return t.body.appendChild(e.cloneNode(!0)),t.body}var g=["P","FIGURE","H2","BLOCKQUOTE","UL","OL","PRE"],_=["FIGURE","IFRAME","IMG","HR"],f="DIV",m="HR",v=function(e){return s.contains(g,e.nodeName)},b=function(e){return e&&s.contains(_,e.nodeName)},y=function(e){return n(e).find(_.join()).length},w=function(e){return"false"===n(e).attr("contenteditable")},k=function(e){return s.filter(e,function(e){return s.contains(g,e.nodeName)})},C=function(e){this.sanitizeConfig=e};return C.prototype.flattenBlocksDown=function(e,t){r(e,t)},C.prototype.unBlock=function(e){a(e)},C.prototype.unwrapParentBlocks=function(e){c(e)},C.prototype.scrubSpansAndBadAttrs=function(e,t){return u(e,t)},C.prototype.blockifyInlineNodes=function(e){t(e)},C.prototype.inlinify=function(e,t){l(e,t)},C.prototype.getBlockNodes=function(e){return i(e)},C.prototype.isEmptyElement=function(e,t){return h(e,t)},C.prototype.filterHTML=function(e){var t=d(e),i=new o(this.sanitizeConfig),s=i.clean_node(t),n=p(s),r=n.innerHTML,a=r.replace(/[<]p[>][ ]*[<]\/p[>]/g,"");return a},C.prototype.filterPlaintext=function(e,t){var i=s.escape(e);return i=i.replace(/\r\n/g,"\n"),i=i.replace(/\r/g,"\n"),t&&(i=i.replace(/\n([ ]*\n)+/g,"</p><p>")),i=i.replace(/\n/g,"<br>"),t&&(i="<p>"+i+"</p>"),i},C.prototype.convertToBrowserSpaces=function(e){return e.replace(/[ ]{2}/g,"  ").replace(/[ ]$/," ")},C.prototype.sanitizeIFrames=function(e){var t=d(e);return n(t).find("iframe").each(function(){n(this).attr("data-original-src",n(this).attr("src")),n(this).attr("src","javascript:''")}),t.innerHTML},C.prototype.unSanitizeIFrames=function(e){var t=d(e);return n(t).find("iframe[data-original-src]").each(function(){n(this).attr("src",n(this).attr("data-original-src")),n(this).removeAttr("data-original-src")}),t.innerHTML},C}();e.exports=r},function(e,t){function i(){var e,t;for(t=arguments[0]||{},this.config={},this.config.elements=t.elements?t.elements:[],this.config.attributes=t.attributes?t.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=!!t.allow_comments&&t.allow_comments,this.allowed_elements={},this.config.protocols=t.protocols?t.protocols:{},this.config.classnames=t.classnames?t.classnames:{},this.config.add_attributes=t.add_attributes?t.add_attributes:{},this.dom=t.dom?t.dom:document,e=0;e<this.config.elements.length;e++)this.allowed_elements[this.config.elements[e]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,t.remove_contents)if(t.remove_contents instanceof Array)for(e=0;e<t.remove_contents.length;e++)this.config.remove_element_contents[t.remove_contents[e]]=!0;else this.config.remove_all_contents=!0;this.transformers=t.transformers?t.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(e){function t(e,t){var i;for(i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function s(){var e,t,i=[],s={};for(e=0;e<arguments.length;e++)if(arguments[e]&&arguments[e].length)for(t=0;t<arguments[e].length;t++)s[arguments[e][t]]||(s[arguments[e][t]]=!0,i.push(arguments[e][t]));return i}function n(e){var t;switch(e.nodeType){case 1:r.call(this,e);break;case 3:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 5:t=e.cloneNode(!1),this.current_element.appendChild(t);break;case 8:this.config.allow_comments&&(t=e.cloneNode(!1),this.current_element.appendChild(t));break;default:console&&console.log&&console.log("unknown node type",e.nodeType)}}function o(e,i){for(var s=[],n=0;n<e.length;n++)t(e[n],i)!==-1&&s.push(e[n]);return s}function r(e){var r,l,c,u,h,d,p,g,_,f,m=a.call(this,e);if(e=m.node,c=e.nodeName.toLowerCase(),l=this.current_element,this.allowed_elements[c]||m.whitelist){this.current_element=this.dom.createElement(e.nodeName),l.appendChild(this.current_element);var v=this.config.attributes;for(u=s(v[c],v[i.ALL],m.attr_whitelist),this.config.classnames[c]&&this.config.classnames[c].length&&u.push("class"),r=0;r<u.length;r++){d=u[r];var b="object"==typeof u[r]||u[r]instanceof Object;if(d=b?u[r].name:u[r],h=e.attributes[d]){g=h.value;var y=g.toLowerCase();if(f=!0,this.config.protocols[c]&&this.config.protocols[c][d]){f=!1,_=this.config.protocols[c][d],_.push(i.RELATIVE);for(var r in _)if(0===y.indexOf(_[r].toLowerCase())){f=!0;break}}"class"===d&&this.config.classnames[c]&&(g=o(g.split(" "),this.config.classnames[c]).join(" "),f=!!g),b&&(f=y.match(u[r].value)),f&&(p=document.createAttribute(d),p.value=g,this.current_element.setAttributeNode(p))}}if(this.config.add_attributes[c])for(d in this.config.add_attributes[c])p=document.createAttribute(d),p.value=this.config.add_attributes[c][d],this.current_element.setAttributeNode(p)}else if(t(e,this.whitelist_nodes)!==-1){for(this.current_element=e.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);l.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[c])for(r=0;r<e.childNodes.length;r++)n.call(this,e.childNodes[r]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=l}function a(e){var i,n,o,r={attr_whitelist:[],node:e,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(o=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:e,node_name:e.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==o){if("object"!=typeof o)throw new Error("transformer output must be an object or null");if(o.whitelist_nodes&&o.whitelist_nodes instanceof Array)for(n=0;n<o.whitelist_nodes.length;n++)t(o.whitelist_nodes[n],this.whitelist_nodes)===-1&&this.whitelist_nodes.push(o.whitelist_nodes[n]);r.whitelist=!!o.whitelist,o.attr_whitelist&&(r.attr_whitelist=s(r.attr_whitelist,o.attr_whitelist)),r.node=o.node?o.node:r.node}return r}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var c=0;c<e.childNodes.length;c++)n.call(this,e.childNodes[c]);return l.normalize&&l.normalize(),l},e.exports=i},function(e,t,i){var s=i(3),n=i(8),o=function(){var e=function(e){return Array.prototype.indexOf.call(e.parentNode.childNodes,e)},t=function(e){return e instanceof HTMLElement},i={getParentNodes:function(e,t){if(t=t||[],!e||i.isEditorNode(e))return t;var s=e.parentNode;return i.isEditorNode(s)?t:s?(t.push(s),i.getParentNodes(s,t)):t},getRootElements:function(s){s=s||i.getSelection();var n=s&&s.anchorNode?s.anchorNode:null;if(!n||i.isEditorNode(n))return[];var o=i.getParentNodes(n),r=s.focusNode,a=i.getParentNodes(r),l=o.length?o.pop():n,c=a.length?a.pop():r,u=e(l),h=e(c);if(h<u){var d=u;u=h,h=d}for(var p=[],g=l.parentNode,_=u;_<=h;_++){var f=g.childNodes[_];t(f)&&p.push(f)}return p},getNodeList:function(e,t){e=e||i.getSelection();var n=e&&e.anchorNode?e.anchorNode:null;if(!n||i.isEditorNode(n))return[];var o=e.focusNode,r=[n];o&&!i.isEditorNode(o)&&(r=r.concat([o]));var a=i.getParentNodes(n);if(r=r.concat(a),!t){var l=i.getParentNodes(o);r=r.concat(l)}var c=s.union(r);return c},getNodeByNames:function(e,t,s){var n=i.getNodeList(s);
return n=t?n.reverse():n,this.getNodesByNames(n,e)[0]},getNodesByNames:function(e,t){return s.filter(e,function(e){return s.indexOf(t,e.nodeName)!==-1})},getNearestElement:function(e){e=e||i.getSelection();var t=i.getNodeList();return s.find(t,function(e){return 1===e.nodeType})},getContextCoordinates:function(e,t){var s=i.getSelection(),o=s.getRangeAt(0).cloneRange(),r=n(e).offset();if(t||!s.isCollapsed){var a=(t||o).getBoundingClientRect();return{x:a.left+a.width/2-r.left,y:a.top-r.top+n(window).scrollTop()}}if(o.getClientRects){o.collapse(!0);var l=o.getClientRects()[0];if(l)return{x:l.left-r.left,y:l.top-r.top+n(window).scrollTop()}}},getSelection:function(){var e=window.getSelection();if(e.anchorNode){var t=n(e.anchorNode).closest("[contenteditable]").length;return t?e:null}return null},collapseToEnd:function(){var e=i.getSelection();e&&e.collapseToEnd()},collapseToStart:function(){var e=i.getSelection();e&&e.collapseToStart()},isInContext:function(e,t){return n(e.anchorNode).closest(t).length>0},isEditorNode:function(e){return n(e).is('[contentEditable="true"]')},hasSelection:function(){var e=i.getSelection();return e&&!e.isCollapsed},rangeFromElement:function(e){var t,s,n=i.getSelection();return!(!n||!n.isCollapsed)&&(s=n.getRangeAt(0),t=s.cloneRange(),t.selectNodeContents(e),t.setEnd(s.startContainer,s.startOffset),t)},isCursorAtEnd:function(e,t){var i=this.rangeFromElement(e);if(!i)return!1;var s=i.toString(),n=e.textContent;return t&&(s=s.trim(),n=n.trim()),s.length===n.length},isCursorAtStart:function(e){var t=this.rangeFromElement(e);return!!t&&(0===t.startOffset&&0===t.endOffset)}};return i}();e.exports=o},function(e,t,i){var s=i(3),n=i(8),o=i(259),r=function(){function e(){this.element=n("<div />",{class:"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=n("<div />",{class:"opener"}),this.isTrayOpen=!1;var e=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),t.call(e,null,!0),!1}),this.tray=n("<div />",{class:"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function t(e,t){"boolean"!=typeof e&&(e=!this.isTrayOpen),e?(this.openTray.call(this,this.tray),this.isTrayOpen=!0,this.onTrayOpened.call(this,t)):(this.closeTray.call(this,this.tray),this.isTrayOpen=!1,this.onTrayClosed.call(this,t)),n(this.opener).toggleClass("open",this.isTrayOpen),t?n(this.opener).toggleClass("closed",!this.isTrayOpen):n(this.opener).removeClass("closed")}var i=function(t){t=t||{},this.openTray=t.openTray||this.openTray,this.closeTray=t.closeTray||this.closeTray,this.onTrayOpened=t.onTrayOpened||function(e){},this.onTrayClosed=t.onTrayClosed||function(e){},this.customOffset=t.customOffset||s.noop,this.keyboardEvents=t.keyboardEvents,e.call(this),o.call(this,t)};s.assign(i.prototype,o.prototype);var r=s.memoize(function(e,t){var i;return s.isFunction(t)?i=t.call():s.isObject(t)&&(i=t),s.pick(s.defaults(s.isObject(i)?i:{},{x:e.x||e,y:e.y||0}),["x","y"])});return i.prototype.addToTray=function(e,t){var i;t=t||{},this.tray.append(e),i=t.keyboard,this.keyboardEvents&&i&&this.keyboardEvents.on(i.shortcut,i.callback,i.context)},i.prototype.openTray=function(e){e.show()},i.prototype.closeTray=function(e){e.hide()},i.prototype.open=function(e,i){if(e){i=r(i||0,this.customOffset||0);var s=n(e).position(),o=parseInt(n(e).css("margin-top"),10)||0;t.call(this,!1),this.show(s.left+i.x,s.top+i.y+o)}},i.prototype.close=function(){t.call(this,!1),this.hide()},i.prototype.toggleTrayWithIntent=function(e){t.call(this,e,!0)},i}();e.exports=r},function(e,t,i){var s=i(3),n=i(8),o=i(258),r=function(){function e(){var e=this,s=function(e){return/Mac/.test(navigator.platform)?e.metaKey:e.ctrlKey};n(this.editor.element).on("keydown.undoManager",function(n){if(n.keyCode===u.z&&s(n)&&!n.altKey)return n.shiftKey?i.call(e):t.call(e),n.preventDefault(),!1})}function t(){if(l.call(this),this.undoStates.length){var e=this.undoStates.pop();c.call(this,e),this.redoStates.push(this.currState),r.call(this)}}function i(){if(this.redoStates.length){var e=this.redoStates.pop();c.call(this,e),this.undoStates.push(this.currState),r.call(this)}}function r(){this.currState=a.call(this)}function a(){var e={data:this.editor.getData(!0,!0),selection:o.saveSelection(this.editor.element)};return e}function l(){var e=a.call(this);return this.currState?void(e.data!==this.currState.data&&(this.undoStates.push(this.currState),this.currState=e)):void(this.currState=e)}function c(e){if(this.isRestoring=!0,this.editor.setData(e.data,!0),e.selection)o.restoreSelection(e.selection);else{var t=window.getSelection();t.removeAllRanges()}this.afterRestore()}var u={command:91,control:17,shift:16,z:90},h=500,d=function(t,i){this.editor=t,this.modifierKeyCode=!1,this.isShift=!1,this.currState=null,this.undoStates=[],this.redoStates=[],this.afterRestore=i||function(){},this.isRestoring=!1;var n=this,o=s.debounce(function(){n.isTorndown||l.call(n)},h);this.defaultOnChange=t.onChange,t.onChange=function(e){if(n.isRestoring)n.isRestoring=!1;else{if("updateAsyncImage"===e)return;n.currState?o():l.call(n)}n.defaultOnChange.call(this)},e.call(this)};return d.prototype.undo=function(){t.call(this)},d.prototype.redo=function(){i.call(this)},d.prototype.teardown=function(){this.isTorndown=!0,this.editor.onChange=this.defaultOnChange,this.undoStates.length=0,this.redoStates.length=0,this.currState=null,n(this.editor.element).off(".undoManager")},d}();e.exports=r},function(e,t,i){var s=i(3),n=i(8),o=i(264),r=i(258),a=i(257),l=function(){function e(){var e=this;n(this.editor.element).on("keypress",function(s){var n=!1;if(34===s.charCode)n=i.call(e);else{if(39!==s.charCode)return;n=t.call(e)}n&&s.preventDefault()})}function t(){var e=this.config.singleQuotes;return l.call(this,e.open,e.close,e.prime)}function i(){var e=this.config.doubleQuotes;return l.call(this,e.open,e.close,e.prime)}function l(e,t,i){var a=o.getSelection();if(!a.isCollapsed)return!1;var l=a.anchorNode;l.normalize();var c=r.saveSelection(l),u=l.textContent,h=u.slice(0,c.start),d=h.charAt(h.length-1),p=l.lastChild&&"BR"===l.lastChild.nodeName?l.lastChild:null,g=s.any(this.config.openingMatches,function(e){return e.test(d)})||p,_="";_=!d||g?e:/\d/.test(d)?i:t;var f=document.createTextNode(_),m=a.getRangeAt(0);return m.deleteContents(),m.insertNode(f),p&&p.previousSibling&&"BR"===p.previousSibling.nodeName&&n(p).remove(),m.setEndAfter(f),m.collapse(!1),a.removeAllRanges(),a.addRange(m),!0}var c=function(t,i){return a.browser.msie?null:(this.editor=t,this.config={openingMatches:[/\s/,/\u200B/,/[=]/],singleQuotes:{open:"‘",close:"’",prime:"′"},doubleQuotes:{open:"“",close:"”",prime:"″"}},s.extend(this.config,i||{}),void e.call(this))};return c}();e.exports=l},function(e,t,i){var s=i(3),n=i(8),o=i(269),r=function(){function e(){n(this.element).on("keydown.keycombos",i.bind(this)),this.listening=!0}function t(){n(this.element).off("keydown.keycombos"),this.listening=!1}function i(e){var t=this.humanKeys.translate(e);t&&a.call(this,t)&&(r.call(this,t,e),e.preventDefault(),e.stopImmediatePropagation())}function r(e,t){s.each(c.call(this,e),function(i){s.has(i,"callback")&&s.has(i,"context")&&i.callback.call(i.context,t,e)})}function a(e){return c.call(this,e).length>0}function l(e,t){var i=c.call(this,e);return s.filter(i,{callback:t}).length>0}function c(e){return s.has(this.subscribers,e)?this.subscribers[e]:[]}function u(t,i,n){if(!l.call(this,t,i))return s.has(this.subscribers,t)||(this.subscribers[t]=[]),this.subscribers[t].push({callback:i,context:n}),this.listening||e.call(this),this}function h(){this.subscribers={},t.call(this)}function d(e,i){return e?s.has(this.subscribers,e)?(i&&(this.subscribers[e]=s.reject(this.subscribers[e],{callback:i})),i&&0!==this.subscribers[e].length||delete this.subscribers[e],0===s.values(this.subscribers).length&&t.call(this),this):this:(h.call(this),this)}var p=function(e){e=e||{},this.debounceRate=e.debounceRate||100,this.element=e.element||document,this.humanKeys=e.humanKeys||new o,this.subscribers={},this.listening=!1};return p.prototype.on=function(e,t,i){s.each((e||"").split(" "),function(e){u.call(this,this.humanKeys.normalize(e),t,i)},this)},p.prototype.off=function(e,t){e?s.each(e.split(" "),function(e){d.call(this,this.humanKeys.normalize(e),t)},this):d.call(this,null,t)},p}();e.exports=r},function(e,t,i){var s=i(3),n=function(){function e(){return navigator.platform.match(/^Win/i)?"Win":navigator.platform.match(/^Mac/i)?"Mac":navigator.platform.match(/^Linux/i)?"Linux":navigator.platform}function t(){return s.extend({},this.prettyMapping,this.platformPrettyMapping[e.call(this)])}function i(){return this.platformModifiers[e.call(this)]||{}}function n(){var t=e.call(this);return s.has(this.platformPrettySeperators,t)?this.platformPrettySeperators[t]:this.seperator}function o(e){return this.specialKeys[e.keyCode]||String.fromCharCode(e.keyCode)}function r(e){return s.filter(this.modifiers,function(t){return e[t+"Key"]})}function a(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}var l=["ctrl","meta","alt","shift"],c="+",u={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",187:"PLUS",61:"PLUS",188:"COMMA",189:"MINUS",173:"MINUS",190:"DOT",32:"SPACE"},h={LEFT:"←",RIGHT:"→",DOWN:"↓",UP:"↑",PLUS:"+",COMMA:",",MINUS:"-",DOT:".",SPACE:"Space"},d={Win:{meta:"ctrl"},Linux:{meta:"ctrl"}},p={Mac:{meta:"⌘",shift:"⇧",alt:"⌥"}},g={Win:"-",Linux:"-",Mac:""},_=function(e){e=e||{},this.modifiers=e.modifiers||l,this.separator=e.separator||c,this.specialKeys=e.specialKeys||u,this.prettyMapping=e.prettyMapping||h,this.platformModifiers=e.platformsModififiers||d,this.platformPrettyMapping=e.platformPrettyModifiers||p,this.platformPrettySeperators=e.platformPrettySeperators||g};return _.prototype.translate=function(e){var t=r.call(this,e);return 0===t.length?null:t.concat(o.call(this,e)).join(this.separator)},_.prototype.normalize=function(e){var t=e.split(this.separator),n=i.call(this),o="";return s.each(this.modifiers,function(e){var i=s.indexOf(t,e.toLowerCase()),r=n[e]||e;i>=0&&(o+=r+this.separator,t.splice(i,1))},this),o+t.join(this.separator).toUpperCase()},_.prototype.pretty=function(e){var i=this.normalize(e),o=t.call(this),r=n.call(this);return s.map(i.split(this.separator),function(e){return o[e]||a(e)},this).join(r)},_}();e.exports=n},function(e,t,i){var s=i(3),n=i(8),o=i(262),r=i(258),a=i(264),l=i(266),c=i(267),u=i(268),h=i(260),d=function(){function e(){_.call(this,x);var e=n("<div />",{"data-js":"editor-wrapper",class:"editor-wrapper"}).css("position","relative"),i=n("<div />",{"data-js":"editor-slot",class:"editor-slot"}).css("position","relative");n(this.element).wrap(e).wrap(i),this.placeholderElement=n("<div />",{"data-js":"editor-placeholder",class:"editor-placeholder"}).css("position","absolute"),i=n(this.element).parent(),i.append(this.placeholderElement),d.call(this),t.call(this)}function t(){var e=this,t=function(){y.call(this),i.call(this),this.onChange()};n(this.element).on("input keydown keyup keypress mousedown mouseup",function(t){e.config.onClientEvent.call(e,t)}),n(this.element).on("keydown",function(t){if(t.keyCode===E.shift)e.keyModifiers.shift=!0;else if(t.keyCode===E.backspace)C.call(e);else if(t.keyCode===E.enter)return e.config.forceSingleLine||t.metaKey||v.call(e,this,!1),void t.preventDefault();s.defer(function(){e.onChange(t)})}),n(this.element).on("keyup",function(i){i.keyCode===E.shift?e.keyModifiers.shift=!1:i.keyCode===E.enter?C.call(e):i.keyCode!==E.backspace&&i.keyCode!==E.delete||s.defer(function(){C.call(e)}),t.call(e)}),n(this.element).on("input",function(i){t.call(e)}),n(this.element).on("blur",function(t){e.onChange()});var o=!1;n(this.element).on("mouseup",function(){o=!1,i.call(e)}),n(this.element).on("mousedown",function(e){o=!0}),n(this.element).on("mouseleave",function(){o&&i.call(e)}),n(this.element).on("paste",function(t){var i=(t.originalEvent||t).clipboardData;e.config.pasteHook(i,e.keyModifiers.shift)||p.call(e,i,t),t.preventDefault()}),n(this.element).on("drop",function(e){e.stopPropagation(),e.preventDefault()}),this.placeholderElement.on("click",function(){e.isEmpty()&&n(e.element).focus()}),n(this.element).on("focus",function(){s.defer(function(){e.onChange()})})}function i(){var e=this;setTimeout(function(){var t=a.getSelection();e.config.onSelection.call(e,t)},200)}function d(){var e=this.isEmpty()?this.config.placeholder:"",t=n(this.placeholderElement);t.html(e);var i=t.outerHeight();i&&n(this.element).css("min-height",Math.max(parseInt(t.css("min-height"),10)||0,i))}function p(e,t){var i="";if(s.contains(e.types,"text/plain"))i=e.getData("text/plain"),i=this.dataFilter.filterPlaintext(i),m.call(this,i);else{if(!s.contains(e.types,"text/html"))return;i=e.getData("text/html"),i=this.dataFilter.filterHTML(i);var n=i.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),o=document.implementation.createHTMLDocument("");o.body.innerHTML=n;var r=o.body,a=r.textContent||r.innerText||"",l=a.split("\n").join("<br>");m.call(this,l)}if(this.config.forceSingleLine){var c=f.call(this).replace(/<br\s*\/*>/g," ");_.call(this,c)}this.onChange(t)}function g(){n(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function _(e){n(this.element).html(e)}function f(){return n(this.element).html().trim()}function m(e){if(e=e.replace(/[<]br\s?\/?[>]$/,""),e=this.dataFilter.convertToBrowserSpaces(e),!e)return void h.warn("Cannot insert empty data");var t=a.getSelection();if(!t||!t.focusNode)return void h.warn("Cannot insert without the editor having a cursor or selection");var i=t.getRangeAt(0);i.deleteContents();var s=i.createContextualFragment(e);i.insertNode(s),t.removeAllRanges(),i.collapse(!1),t.addRange(i)}function v(e,t){t||e.lastChild&&"br"===e.lastChild.nodeName.toLowerCase()||e.appendChild(document.createElement("br"));var i=a.getSelection();if(i){var s=i.getRangeAt(0),n=document.createElement("br");s.deleteContents(),s.insertNode(n),s.setStartAfter(n),s.setEndAfter(n),s.collapse(!1),i.removeAllRanges(),i.addRange(s)}}function b(e){n(e).contents().each(function(e,t){t.nodeType===Node.TEXT_NODE?t.textContent=t.textContent.replace(T,""):t.nodeType===Node.ELEMENT_NODE&&b(t)})}function y(){if(!this.isEmpty()){var e=w.call(this);if(e&&e.nodeType===Node.ELEMENT_NODE){var t=e.textContent||e.innerText||"",i=t.match(T);if(i){var s=r.saveSelection(e);s.start-=(t.substr(0,s.start).match(T)||"").length||0,s.end-=(t.substr(0,s.end).match(T)||"").length||0,b(e),r.restoreSelection(s)}}}}function w(){var e=k.call(this);if(!e){var t=n(this.element).children();if(!t.length)return null;e=t.last().get(0)}return e}function k(e){return e||(e=!a.getSelection()&&this.lastSelection?a.getParentNodes(this.lastSelection.anchorNode):a.getNodeList()),s.find(e.reverse(),function(e){return e.nodeType===Node.ELEMENT_NODE})}function C(){this.isEmpty()&&(_.call(this,x),this.setCursorToEnd())}var x="<span>&#8203;</span>",S="<span>​</span>",T=/\u200B/g,E={shift:16,enter:13,esc:27,backspace:8,delete:46,tab:9,right:39},P=function(t,i){if(!t)throw new Error("A valid element parameter is required to initalize the editor");this.element=t,this.keyComboEvents=i.keyComboEvents||new u({element:this.element}),this.keyComboEvents.on("meta+b meta+i meta+k meta+u",s.noop),this.config={placeholder:!1,onChange:function(){},onSelection:function(e){},onClientEvent:function(e){},pasteHook:function(e,t){return!1},filterForSetData:function(e){return e},filterForGetData:function(e){return e},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1,smartQuotes:{enabled:!1,config:{}}},s.extend(this.config,i||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){this.previousRawData!==f.call(this)&&(g.call(this),d.call(this),this.config.onChange.apply(this,arguments),this.previousRawData=f.call(this))},this.keyModifiers={shift:!1},this.undoManager=new l(this),this.config.smartQuotes.enabled&&(this.smartQuoter=new c(this)),e.call(this)};return P.prototype.getData=function(e){var t=f.call(this);t=this.config.filterForGetData.call(this,t);var i=t.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(T,""),s=document.createElement("div");s.innerHTML=i;var n=s.textContent||s.innerText||"",o=e?n.trim():n;return o},P.prototype.setData=function(e){e=this.config.filterForSetData.call(this,e),e=this.dataFilter.filterPlaintext(e),_.call(this,e),C.call(this),this.onChange()},P.prototype.setHTML=function(e){_.call(this,e),this.onChange()},P.prototype.getHTML=function(){return f.call(this)},P.prototype.insertData=function(e,t){t&&(e=this.dataFilter.filterHTML(e)),m.call(this,e),this.onChange()},P.prototype.blur=function(){return n(this.element).blur()},P.prototype.focus=function(e){var t=n(this.element).focus();return e||this.setCursorToEnd(),t},P.prototype.hasFocus=function(){return n(this.element).is(":focus")},P.prototype.setPlaceholder=function(e){this.config.placeholder=e,d.call(this)},P.prototype.isEmpty=function(){var e=this.getData(!1);if(""===e||"\n"===e||"\r\n"===e)return!0;var t=f.call(this);return t===x||t===S||""===t},P.prototype.getCurrentElement=function(){return a.getNearestElement()},P.prototype.setCursorToStart=function(e){var t=n(this.element);e=e&&t.find(e).first().get(0)||t.children().first().get(0),e&&r.setToStart(e)},P.prototype.setCursorToEnd=function(e){var t=n(this.element);e=e&&t.find(e).last().get(0)||t.children().last().get(0),e&&r.setToEnd(e)},P.prototype.teardown=function(){this.undoManager.teardown(),this.keyComboEvents.off()},P}();e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="editor editor-plaintext" aria-label="'+__e(ariaLabel)+'" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_values(_imports))},,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(178),r=i(194),a=o.extend({initialize:function(e){this.el=e.el||null,this.itemSelector=e.itemSelector||".item",this.dropInParent=e.dropInParent||!1,this.transparentPlaceholder=e.transparentPlaceholder,this.beforeDragStart=e.beforeDragStart||s.noop,this.afterDragEnd=e.afterDragEnd||s.noop,this.scrollable=e.scrollable||!1,this.$items=this.$(this.itemSelector),this.isAnimating=!1,this.disableAnimation=e.disableAnimation||!1,this.disableAnimation&&(this.calculateDropTarget=s.throttle(this.calculateDropTarget,500)),this.$currentlyDraggedItem=null,this.$placeholder=null,this.placeholderElement=null,this.renderedPlaceholder=!1,this.reloadItems()},itemEvents:function(e){e||(e=this.itemSelector);var t={};return t["dragstart "+e]="setPlaceholder",t["dragenter "+e]="calculateDropTarget",t["dragend "+e]="resetPlaceholder",this.dropInParent?(t.dragover="cancelEvent",t.drop="dropItemAndResetPlaceholder"):(t["dragover "+e]="cancelEvent",t["drop "+e]="dropItem"),t},setPlaceholder:function(e){this.renderedPlaceholder=!1,e.originalEvent.dataTransfer.effectAllowed="move";try{e.originalEvent.dataTransfer.setData("text/html","")}catch(e){}if(this.$currentlyDraggedItem=n(e.currentTarget),this.$currentlyDraggedItem){if(this.$placeholder=this.$currentlyDraggedItem.clone().addClass("sortable-placeholder"),this.transparentPlaceholder&&this.$placeholder.addClass("transparent-placeholder"),!this.disableAnimation){var t=this.$currentlyDraggedItem.outerWidth();this.$placeholder.data("item-width",t).data("need-animation",!1)}this.placeholderElement=this.$placeholder.get(0),this.$currentlyDraggedItem.addClass("sortable-dragging"),this.beforeDragStart(),this.trigger("dragstart",this),this.scrollable&&(this.$el.on("dragover."+this.cid,s.throttle(function(e){var t=.2,i=window.innerHeight,s=e.originalEvent.clientY/i,n=this.getBoundingClientRect();s<t&&n.top<0?window.scrollBy(0,-(200*(t-s))):s>1-t&&window.scrollBy(0,200*(t+s-1)),e.preventDefault()},50)),this.$currentlyDraggedItem.one("dragend",s.bind(function(){this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" "))},this)))}},calculateDropTarget:function(e){if(this.$currentlyDraggedItem&&!this.isAnimating){e.preventDefault(),this.renderedPlaceholder=!0;var t=e.currentTarget,i=n(t);if(t===this.placeholderElement)return!1;this.$currentlyDraggedItem.hide();var s,o=i.index(this.itemSelector),r=this.$placeholder.index(this.itemSelector),a=this.$placeholder.data("need-animation")||!1,l=this.$placeholder.data("item-width");return this.disableAnimation||(s=n("<span>").css({width:l,display:"inline-block"}),this.$placeholder.after(s),a&&this.$placeholder.css({width:0,padding:0})),r<o?i.after(this.placeholderElement):i.before(this.placeholderElement),this.disableAnimation||(a?this.animatePlaceholderWidth(s,this.$placeholder,l,200):this.$placeholder.data("need-animation",!0)),this.lastDroppable=t,!1}},animatePlaceholderWidth:function(e,t,i,n){this.isAnimating=!0,r.animate(e,"stop"),r.animate(t,"stop"),r.animate(e,{width:0},n,"easeInOutQuart",s.bind(function(){e.remove(),this.isAnimating=!1},this)),r.animate(t,{width:i},n,"easeInOutQuart")},cancelEvent:function(e){this.$currentlyDraggedItem&&e.preventDefault()},dropItem:function(e){return this.$currentlyDraggedItem&&this.renderedPlaceholder&&this.placeholderElement&&(e.stopPropagation(),this.$currentlyDraggedItem.insertAfter(this.placeholderElement)),!1},resetPlaceholder:function(e){this.renderedPlaceholder=!1,this.placeholderElement=null,this.$currentlyDraggedItem&&(this.$currentlyDraggedItem.removeClass("sortable-dragging").show(),this.$currentlyDraggedItem=null,this.$placeholder.detach(),e.stopPropagation(),this.afterDragEnd(),this.trigger("dragend",this),this.lastDroppable=null)},dropItemAndResetPlaceholder:function(e){return this.dropItem(e),this.resetPlaceholder(e)},sequence:function(){var e=this.$(this.itemSelector).toArray();return s.uniq(s.pluck(e,"id"))},reloadItems:function(){return this.$items=this.$(this.itemSelector),s.each(this.$items,function(e){e.draggable=!0,n(e).find("a").attr("draggable",!1),n(e).find("img").attr("draggable",!1)}),this.delegateEvents(this.itemEvents(this.itemSelector)),this},disableItems:function(){return s.each(this.$items,function(e){e.draggable=!1}),this.undelegateEvents(),this},teardown:function(){return this.undelegateEvents(),this.scrollable&&this.$el.off(["dragenter."+this.cid,"dragover."+this.cid].join(" ")),s.each(this.$items,function(e){n(e).add("a, img",e).removeAttr("draggable")}),this.$items=null,this.$placeholder=null,this.beforeDragStart=null,this.afterDragEnd=null,this.calculateDropTarget=null,this}});e.exports=a},,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(291);e.exports=s},function(e,t,i){"use strict";var s=i(185),n=i(292),o=s.extend({className:"knight-rider-container",template:n,defaults:{variation:"",loading:!1},_onChangeLoading:function(e,t){this.$el.toggleClass("loading",t),this.$el.find("[data-js-knightRider]").toggleClass("animate",t),this.$el.toggle(t)},afterRender:function(){this._onChangeLoading(this,this.get("loading")),this.listenTo(this,"change:loading",this._onChangeLoading)}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="knight-rider-loader '+__e(variation)+'" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(178),r=i(139),a=i(303),l=i(235),c=i(242),u=i(304),h=i(305),d=i(308),p=i(309),g=o.extend({className:"popover--post-share-popover",mixins:[l,c,p],template:u,defaults:{popoverData:{},forceSocialFallback:!1,forceEmailFallback:!1,tumblelogShare:!1},events:{"click .embed_post":"__embedPostClick","click .share_email":"__emailTriggerClick","click .share_facebook":"__shareFacebookClick","click .share_pinterest":"__sharePinterestClick","click .share_twitter":"__shareTwitterClick","click .share_reddit":"__shareRedditClick","click .share_permalink":"__sharePermalinkClick","click .flag_post":"__flagPostClick","click .cancel":"__cancelClick","click .popover_menu_item_anchor":"__checkIfPremiumPost","input .email_address":"__emailFormInput","input .twitter .share_message":"__shareTwitterInput","change .reply_to_input":"__replyToChange","keydown .share_form":"__submitKeydown","submit .share_form":"__submit","focus input":"__suspendKeyCommands","focus textarea":"__suspendKeyCommands","blur textarea":"__resumeKeyCommands","blur input":"__resumeKeyCommands"},__embedPostClick:function(e){e.preventDefault(),r.trigger("dashboard-share:embed"),this._showEmbedCode()},__emailTriggerClick:function(e){e.preventDefault(),r.trigger("dashboard-share:email"),this._toggleEmailForm()},__shareFacebookClick:function(e){e.preventDefault(),r.trigger("dashboard-share:facebook"),this._shareFacebook()},__sharePinterestClick:function(e){e.preventDefault(),r.trigger("dashboard-share:pinterest"),this._sharePinterest()},__shareRedditClick:function(e){e.preventDefault(),r.trigger("dashboard-share:reddit"),this._shareReddit()},__shareTwitterClick:function(e){e.preventDefault(),r.trigger("dashboard-share:twitter"),this._shareTwitter()},__sharePermalinkClick:function(){this.resetAndHide()},__flagPostClick:function(e){e.preventDefault(),this.onClickOutside(),r.trigger("abuseform:open",{mode:"post",post:this.model})},__cancelClick:function(e){e.preventDefault(),this._cancelOrClose()},__emailFormInput:function(){var e=g.validateEmail(this.$emailAddress.val());this.$submitButton.attr("disabled",!e)},__shareTwitterInput:function(e){e.preventDefault();var t=g.validateTwitter(this.$shareMessage.val(),this.$characterCount);this.$submitButton.attr("disabled",!t)},__replyToChange:function(e){var t=s(e.currentTarget).is(":checked");a.set("share_popover_reply_to",t,31536e3)},__submitKeydown:function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.preventDefault(),e.stopPropagation(),this.submitForm())},__submit:function(){return this.submitForm(),!1},__submitSuccess:function(){this.$status.show(),this._fadeoutPopover()},__submitError:function(){this.$errorStatus.html(this.errorText),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!1),this.$errorStatus.addClass("active")},__suspendKeyCommands:function(){r.trigger("keycommands:suspend indashblog:keycommands:suspend")},__resumeKeyCommands:function(){r.trigger("keycommands:resume indashblog:keycommands:resume")},__checkIfPremiumPost:function(){var e=s("[data-id="+this.options.popoverData.post_id+"]").data("json");if(e&&e.pt){var t=new d(e),i=this.loggingData({userAction:"share"});i&&i.modelData&&(i.modelData=t.toJSON()),r.trigger("useraction:explore_click:share",{model:t,loggingData:i})}},_shareTwitter:function(){!this.options.forceSocialFallback&&this.twitterUsername?(this.$serviceCancel.show(),this.$submitButton.html("Tweet"),this.$shareForm.data("type","twitter"),this.$shareLabel.text("@"+this.twitterUsername),this.$shareMessage.val(" [URL]"),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.get(0).setSelectionRange(0,0),this.$shareMessage.attr("placeholder",""),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("twitter"),g.validateTwitter(this.$shareMessage.val(),this.$characterCount),this.$shareForm.hasClass("active")&&(this.$shareMessage.focus(),this.$shareMessage.get(0).setSelectionRange(0,0))):this._shareTwitterFallback()},_shareTwitterFallback:function(){var e=this.tinyUrl||this.url||this.model.get("url");window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(e),"twitter-share-dialog","width=626,height=258");var t=this._getGenericShareData();this.model.shareTwitter(t),this.resetAndHide()},_shareFacebook:function(){!this.options.forceSocialFallback&&this.hasFacebook?this.model.facebookStatus().done(n.bind(this._shareFacebookSuccess,this)).fail(n.bind(this._shareFacebookFallback,this)):this._shareFacebookFallback()},_shareFacebookSuccess:function(e){e?(this.$serviceCancel.show(),this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","facebook"),this.$shareLabel.text(e),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("facebook"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$shareForm.hasClass("active")&&this.$shareMessage.focus()):this._shareFacebookFallback()},_shareFacebookFallback:function(){var e=this.url||this.model.get("url");window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436");var t=this._getGenericShareData();this.model.shareFacebook(t),this.resetAndHide()},_sharePinterest:function(){var e=this.model.get("pinterest_share_window");window.open(e.url,e.name,e.dimensions);var t=this._getGenericShareData();this.model.sharePinterest(t),this.resetAndHide()},_shareReddit:function(){window.open("https://reddit.com/submit?url="+this.model.get("post_url"),"reddit-share-dialog","scrollbars=1,width=860,height=600");var e=this._getGenericShareData();this.model.shareReddit(e),this.resetAndHide()},_toggleEmailForm:function(){return this.options.forceEmailFallback||!this.model.get("tumblelog_share")&&!this.model.get("has_user")?void this._emailFormFallback():(this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","email"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$replyTo.addClass("active"),void(this.$shareForm.hasClass("active")&&this.$emailAddress.length&&this.$emailAddress.focus()))},_emailFormFallback:function(){var e=this._getGenericShareData();this.model.shareEmail(e);var t="mailto:?body="+this.url;if(this.model.get("embed_key")){var i=window.open();i.document.write('<html><script>location.href = "'+t+'";setTimeout(function(){window.close();},500);</script></html>'),i.document.close()}else window.location.href=t;this.resetAndHide()},_showEmbedCode:function(){this.$serviceCancel.show(),this.$shareForm.data("type","embed"),this.$shareLabel.text(this.$shareLabel.data("embed-label")),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.attr("placeholder",""),this.$shareForm.addClass("embed");var e=this.$shareForm.find(".embed_code_text");e.length&&(e.click(function(){e.select()}),setTimeout(function(){e.trigger("click")},100))},_fadeoutPopover:function(){setTimeout(n.bind(function(){this.$el.fadeOut(150,n.bind(this.resetAndHide,this))},this),1250)},_cancelOrClose:function(){var e=this.$emailAddress.val()||"";"email"===this.$shareForm.data("type")&&e.length?(this.$emailAddress.val(""),this.$submitButton.attr("disabled",!0)):this.resetForm()},_getGenericShareData:function(){return[{name:"post_id",value:this.model.get("post_id")},{name:"tumblelog_name",value:this.model.get("tumblelog_name")},{name:"share_fallback",value:!0}]},initialize:function(e){this.options=n.extend({},this.defaults,e),this.model=new h(this.options.popoverData),this.listenTo(this.model,"error",this.__submitError),this.listenTo(this.model,"success",this.__submitSuccess)},cacheSelectors:function(){this.$shareForm=this.$(".share_form"),this.$shareLabel=this.$(".share_label"),this.$replyTo=this.$(".reply_to"),this.$shareOptions=this.$(".share_options"),this.$submitButton=this.$("button.email_submit"),this.$emailAddress=this.$(".email_address"),this.$shareMessage=this.$(".share_message"),this.$embedCode=this.$(".embed_code_text"),this.$characterCount=this.$(".character_count"),this.$serviceCancel=this.$(".cancel.service"),
this.$status=this.$(".status"),this.$errorStatus=this.$(".error_status"),this.$statusMessage=this.$(".status_message"),this.$replyToInput=this.$(".reply_to_input"),this.sentText=this.$status.data("sent")||"",this.errorText=this.$status.data("error")||"",this.$(".share_twitter").length&&(this.twitterUsername=this.$(".share_twitter").data("twitter-username")),this.$(".share_facebook").length&&(this.hasFacebook=this.$(".share_facebook").data("has-facebook")),this.url=this.$shareOptions.data("post-url"),this.tinyUrl=this.$shareOptions.data("post-tiny-url"),this.tumblelogName=this.$shareOptions.data("tumblelog-name"),this.embedKey=this.$shareOptions.data("embed-key"),this.postId=this.$shareOptions.data("post-id"),this.rootId=this.$shareOptions.data("root-id")},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.model.toJSON())),this.cacheSelectors(),this.$replyToInput.prop("checked","true"===a.get("share_popover_reply_to")),this},resetForm:function(){this.$serviceCancel.hide(),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!0),this.$emailAddress.val(""),this.$shareMessage.val(""),this.$shareMessage.attr("placeholder",this.$shareMessage.attr("title")),this.$shareOptions.addClass("active"),this.$shareForm.removeClass("active"),this.$shareForm.removeClass("facebook"),this.$shareForm.removeClass("twitter"),this.$shareForm.removeClass("embed"),this.$status.hide(),this.$statusMessage.html(this.sentText),this.$replyTo.removeClass("active"),this.$errorStatus.removeClass("active"),this.$el.show()},resetAndHide:function(){this.resetForm(),this.teardown()},submitForm:function(){var e=this.$shareForm.serializeArray();switch(this.$shareForm.data("type")){case"facebook":this.model.shareFacebook(e);break;case"twitter":this.model.shareTwitter(e);break;default:this.model.shareEmail(e)}this.$submitButton.attr("disabled",!0),this.$submitButton.html(this.$submitButton.data("label-sending"))},teardown:function(){return this.__resumeKeyCommands(),this.$el.remove(),this}},{placeholderSupport:function(){var e=document.createElement("input");return"placeholder"in e},validateEmail:function(e){var t=/\S+@\S+\.\S+/;return t.test(e)},validateTwitter:function(e,t){var i=e.match(/\[URL\]/gi),s=i?24*i.length:0,n=140-e.length-s,o=!(!t||!t.length)&&t;return o&&(o.removeClass("character-limit").html(n),n<10&&o.addClass("character-limit")),!(n<0||140===n)}});e.exports=g},function(e,t,i){"use strict";function s(e){return new RegExp(e+"=([^;]+)").test(decodeURIComponent(document.cookie))}function n(e){var t=decodeURIComponent(document.cookie).match(new RegExp(e+"=([^;]+)"));return t&&t.length>1?t[1]:null}function o(e,t,i,s){"object"===("undefined"==typeof t?"undefined":c(t))&&(t=JSON.stringify(t));var n=encodeURIComponent(e)+"="+encodeURIComponent(t);if(u.isPlainObject(i)&&(s=i,i=!!s&&s.expires),s=u.extend({expires:i},h,s),s.expires instanceof Date)n+=";expires="+s.expires.toGMTString();else if("number"==typeof s.expires){var o=new Date;o.setTime(o.getTime()+1e3*s.expires),n+=";expires="+o.toGMTString()}s.path&&(n+=";path="+encodeURI(s.path)),s.secure&&(n+=";secure"),s.domain&&(n+=";domain="+encodeURI(s.domain)),document.cookie=n}function r(e){o(e,"",-1)}function a(e,t){var i=n(e);try{i=JSON.parse(i)}catch(e){return i}return t?u.get(i,t):i}function l(e,t,i,s){var n;u.isPlainObject(t)?(s=i,n=t):(n=a(e)||{},u.isPlainObject(n)||(n={}),u.set(n,t,i)),o(e,JSON.stringify(n),s)}var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=i(3),h={path:"/",secure:!1,domain:""},d={has:s,get:n,set:o,unset:r,getHash:a,setHash:l};e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="'+__e(tumblelog_name)+'" data-post-id="'+__e(post_id)+'" data-root-id="'+__e(root_id)+'" data-post-url="'+__e(post_url)+'" data-post-tiny-url="'+__e(post_tiny_url)+'" data-embed-key="'+__e(embed_key)+'" data-embed-did="'+__e(embed_did)+'"> ',is_private||(__p+=" ",show_permalink&&(__p+=' <li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="permalink" href="'+__e(post_url)+'" target="_blank" class="external" title="'+__e(permalink_label)+'" rel="noopener"> '+__e(permalink_label)+' <i class="icon icon_arrow_carrot_right"></i></a></li> '),__p+=" ",show_embed&&(__p+=' <li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="embed" href="#">'+__e(__("Embed"))+"</a></li> "),__p+=" ",show_email&&(__p+=' <li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="email" href="#">'+__e(__("Email"))+"</a></li> "),__p+=" ",show_twitter&&(__p+=' <li class="share_twitter popover_menu_item" data-twitter-username="'+__e(twitter_username)+'"><a class="popover_menu_item_anchor" data-share-type="twitter" href="#">'+__e(__("Twitter"))+"</a></li> "),__p+=" ",show_facebook&&(__p+=' <li class="share_facebook popover_menu_item" data-has-facebook="'+(null==(__t=has_facebook?"1":"")?"":__t)+'"><a class="popover_menu_item_anchor" data-share-type="facebook" href="#">'+__e(__("Facebook"))+"</a></li> "),__p+=" ",show_pinterest&&(__p+=' <li class="share_pinterest popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="pinterest" href="#">'+__e(__("Pinterest"))+"</a></li> "),__p+=" ",show_reddit&&(__p+=' <li class="share_reddit popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="reddit" href="#">'+__e(__("Reddit"))+"</a></li> "),__p+=" ",show_flagging&&(__p+=' <li class="flag_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+__e(__("Report this post"))+"</a></li> "),__p+=" ",show_reporting_links&&(__p+=' <li class="popover_menu_item"><a class="popover_menu_item_anchor" target="_blank" href="'+__e(abuse_url)+'">'+__e(__("Report Abuse"))+"</a></li> "),__p+=" "),__p+=" </ul> ",is_private||(__p+=' <form method="post" class="share_form email_form" id="share_email_'+__e(post_id)+'" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="'+__e(__("Embed"))+'"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="'+__e(__("Email"))+'" title="'+__e(__("Email"))+'"> <input type="hidden" name="post_id" value="'+__e(post_id)+'"> <input type="hidden" name="tumblelog_name" value="'+__e(tumblelog_name)+'"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="'+__e(__("Message (Optional)"))+'" title="'+__e(__("Message (Optional)"))+'"></textarea><div class="character_count">140</div></li></ul></div> ',show_embed&&(__p+=' <div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">'+__e(embed_code)+"</textarea></div> "),__p+=" ",has_user&&(__p+=' <div class="reply_to" title="'+__e(__("Let them reply to"))+'"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_'+__e(post_id)+'" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_'+__e(post_id)+'"> '+(null==(__t=__("Let them reply to <span>"))?"":__t)+" </label></div> "),__p+=' <div class="error_status"></div><button type="submit" class="tx-button blue email_submit" data-label-sending="'+__e(__("Sending..."))+'" data-label="'+__e(__("Send"))+'" disabled="disabled">'+__e(__("Send"))+'</button></div></form><div class="status" data-sent="'+__e(__("Sent!"))+'" data-error="'+__e(__("Error!"))+'"><span class="status_message">'+__e(__("Sent!"))+"</span></div> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(143),r=i(129),a=i(137),l=i(306),c=o.extend({url:function(){return"/svc/post/share/"+this.get("tumblelog_name")+"/"+this.get("post_id")},parse:function(e){return!n.isUndefined(e)&&n.has(e,"response")?n.result(e.response,"share_popover_data")||{}:{}},hostname:function(){var e=r.get("Context/hosts");return n.isEmpty(e)?"http://www.tumblr.com":e.www_host},defaults:{abuse_url:"",embed_code:"",embed_did:"",form_key:s("#tumblr_form_key").attr("content"),has_facebook:!1,has_user:!1,is_private:!1,permalink_label:"",post_id:"",post_tiny_url:"",post_url:"",root_id:"",show_email:!0,show_embed:!0,show_facebook:!0,show_permalink:!0,show_pinterest:!0,show_reporting_links:!0,show_twitter:!0,show_reddit:!0,show_flagging:!0,tumblelog_name:"",twitter_username:"",embed_key:"",pinterest_share_window:{},tumblelog_share:!1},initialize:function(e){this.get("embed_code")||this.set("embed_code",new l(this.toJSON()).getCode()),a.bool("enable_share_embed_code")||this.set("show_embed",!1),a.bool("reddit_sharing")||this.set("show_reddit",!1)},shareEmail:function(e){return this.get("tumblelog_share")?this.share("/svc/email_tumblelog",e):this.share("/svc/share/email",e)},shareTwitter:function(e){if(!this.get("tumblelog_share"))return this.share("/svc/share/twitter",e)},shareFacebook:function(e){if(!this.get("tumblelog_share"))return this.share("/svc/share/facebook",e)},sharePinterest:function(e){return this.share("/svc/share/pinterest",e)},shareReddit:function(e){return this.share("/svc/share/reddit",e)},facebookStatus:function(){return s.ajax({url:this.hostname()+"/svc/facebook_status",type:"post",data:{form_key:this.get("form_key")}})},share:function(e,t){return t=t||[],t.push({name:"form_key",value:this.get("form_key")}),s.ajax({url:this.hostname()+e,type:"post",data:t,success:n.bind(function(){this.trigger("success")},this),error:n.bind(function(){this.trigger("error")},this)}),this}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(307),r=i(129),a=n.extend({name:"PostEmbedCodeGenerator",defaults:{embed_host:"//embed.tumblr.com",secure_assets_host:"https://assets.tumblr.com",tumblelog_mention_key:"",post_id:"",post_url:"",embed_key:"",embed_did:""},initialize:function(e){this.options=s.extend({},this.defaults,e);var t=r.get("Context/hosts");t&&(t.embed_host&&(this.options.embed_host=t.embed_host),t.secure_assets_host&&(this.options.secure_assets_host=t.secure_assets_host)),this.template=o},getCode:function(){return this.template(this.options)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="undefined"!=typeof language&&"undefined"!=typeof width?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-language="'+__e(language)+'" data-width="'+__e(width)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":"undefined"!=typeof language?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-language="'+__e(language)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":"undefined"!=typeof width?' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'" data-width="'+__e(width)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ":' <div class="tumblr-post" data-href="'+__e(embed_host)+"/embed/post/"+__e(embed_key)+"/"+__e(post_id)+'" data-did="'+__e(embed_did)+'"><a href="'+__e(post_url)+'">'+__e(post_url)+"</a></div> ",__p+=' <script async src="'+__e(secure_assets_host)+'/post.js"></script>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(143),r=i(139),a=i(149),l=i(172),c=i(306),u=i(130),h=i(140),d=o.extend({defaults:{},endpoints:{like:"/svc/like",unlike:"/svc/unlike",reblog:"/fast_reblog",reply:"/svc/reply",publish:"/publish",queue:"/publish",destroy:"/svc/post/delete",promote:"/svc/promote",unpromote:"/svc/unpromote",answer:"/answer",deny:"/deny_submission",approve:"/approve_submission",remove_source:"remove_app_attribution"},initialize:function(e){this._createPostTumblelogModel("tumblelog",this.get("tumblelog-data")),this._createPostTumblelogModel("parentTumblelog",this.get("tumblelog-parent-data")),this._createPostTumblelogModel("rootTumblelog",this.get("tumblelog-root-data")),this.listenTo(this,"like:success",this.logClientLike)},logClientLike:function(){r.trigger("ads:client_like",{loggingData:{userAction:"client_like",postData:this.attributes}})},_createPostTumblelogModel:function(e,t){e=e||"tumblelog",t=t||!1;var i=!1;t&&t.name&&(i=new a(s(t).omit(s.isUndefined).omit(s.isNull).value())),this[e]=i},_setTumblelog:function(){this.tumblelog=new a(s({name:this.get("tumblelog"),ignoring:!1,sponsor:this.get("sponsored"),following:this.get("following"),mention_key:this.get("tumblelog_mention_key")}).omit(s.isUndefined).omit(s.isNull).value())},_setReblogTumblelog:function(){var e=this.get("reblog_source");e&&e.name&&(this.reblogTumblelog=new a(s({name:e.name,ignoring:!1,following:e.following}).omit(s.isUndefined).omit(s.isNull).value()))},getRootTumblelogUuid:function(){return this.get("tumblelog-root-data")?this.get("tumblelog-root-data").uuid:this.get("tumblelog-data")?this.get("tumblelog-data").uuid:this.get("reblogged_root_uuid")||this.get("tumblelog_uuid")},_xhrRequest:function(e,t,i){i.init&&i.init();var o=n.ajax({data:t,type:"POST",url:e,withFormKey:!0});return o.done(s.bind(function(e){i[200]&&i[200].call(this,e)},this)),o.fail(s.bind(function(e){i[e.status]&&i[e.status].call(this,e.status)},this)),o.always(s.bind(function(){i.always&&i.always()},this)),o},_xhrSuccess:function(e){this.trigger(e+":success")},_xhrFailure:function(e){l.alert(u("Sorry, we seem to be having technical trouble.  Please try again later.")),this.trigger(e+":failure")},_xhrForbidden:function(e){this.trigger(e+":forbidden")},_setCarouselIndex:function(e){return this.get("is_carousel")?s.extend(e,{offset:this.get("carousel_index")}):e},save:function(e,t,i){if(i||(i={}),this.endpoints[e]){var n={200:s.bind(this._xhrSuccess,this,e),401:s.bind(this._xhrFailure,this,e),404:s.bind(this._xhrFailure,this,e),403:s.bind(this._xhrForbidden,this,e),500:s.bind(this._xhrFailure,this,e)};return this._xhrRequest(this.endpoints[e],t,s.defaults(i,n))}throw new Error("Missing endpoint url for "+e)},like:function(e){if(!this.get("is_mine")){if(this.get("liked")===!1){this.set("liked",!0);var t=this.likePayload(e,this.getLikeSource("like"));this.save("like",{data:t})}this.trigger("like:set",this),r.trigger("post:like:set",this.get("id"),this,e)}},unlike:function(){if(this.get("liked")===!0){this.set("liked",!1);var e=this.likePayload("mouse",this.getLikeSource("unlike"));this.save("unlike",{data:e})}this.trigger("unlike:set",this),r.trigger("post:unlike:set",this.get("id"))},toggleLike:function(){this.get("liked")?this.unlike():this.like()},getLikeSource:function(e){e=e||"like";var t="LIKE_";switch(e){case"unlike":t="UNLIKE_";break;case"reply":t="REPLY_";break;case"ignore":t="IGNORE_"}var i=location.pathname;return i.match(/^\/dashboard/)?t+"SOURCE_DASHBOARD":i.match(/^\/tagged/)?t+"SOURCE_TAG_PAGE":i.match(/^\/likes/)?t+"SOURCE_LIKES_PAGE":i.match(/^\/inbox/)?t+"SOURCE_INBOX":i.match(/^\/search/)?t+"SOURCE_SEARCH_RESULTS_PAGE":i.match(/^\/explore/)?t+"SOURCE_DISCOVER":i.match(/^\/tv/)?t+"SOURCE_TV":i.match(/^\/indash_blog\/peepr/)?t+this.getPeeprSource():t+"SOURCE_UNKNOWN"},getPeeprSource:function(){if(window.parent&&window.parent.location){var e=window.parent.location.pathname;if(e.match(/search/))return"SOURCE_SEARCH_PEEPR"}return"SOURCE_PEEPR"},getEmbedCode:function(e,t){var i={embed_key:this.get("embed_key"),embed_did:this.get("embed_did"),post_id:this.get("id"),post_url:this.get("post_url")};e&&(i.language=e),t&&(i.width=t);var s=new c(i);return s.getCode()},likePayload:function(e,t){e=e||"mouse",t=t||"LIKE_SOURCE_UNKNOWN";var i={id:this.get("id"),root_id:this.get("root_id"),key:this.get("reblog_key"),placement_id:this.get("placement_id")||!1,is_recommended:this.get("is_recommended")||"",pt:this.get("pt"),method:e,source:t};return this._setCarouselIndex(i)},reblog:function(e){e=s.extend({},e,{reblogId:this.get("id"),reblogKey:this.get("reblog_key"),pt:this.get("pt")}),r.trigger("postForms:reblog",e)},fastReblog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h().attributes.fastqueue_web_lab;this.trigger("fastreblog:success",e),r.trigger("post:fastreblog:set",{model:this});var t={reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),queue:e,pt:this.get("pt")};t=this._setCarouselIndex(t);var i={200:s.bind(function(t){this.set("reblogged",!0),this.trigger("fastreblog:ajax:success",t.response);var i={model:this.clone(),toastOptions:{type:e?"queue":"selfReblog",avatar:t.response.post_tumblelog.avatar,fromTumblelogName:t.response.post_tumblelog.name_or_id}};r.trigger("post:fastReblog:showtoast",i)},this)};this.save("reblog",t,i)},reply:function(e){var t={reply_text:e,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog-key")||this.get("tumblelog_key"),source:this.getLikeSource("reply")},i={200:s.bind(function(){this.trigger("replied")},this)};return this.save("reply",{data:t},i)},destroy:function(){var e={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.save("destroy",e)},publish:function(){var e=this.save("publish",{id:this.get("id")});e.fail(s.bind(function(e){this.trigger("publish:failure",n.parseJSON(e.responseText))},this))},promote:function(e){var t={tag:e,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("promote",t)},unpromote:function(e){var t={tag_id:e,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("unpromote",t)},queue:function(){var e={id:this.get("id"),queue:"queue"};this.save("queue",e)},removeSource:function(){var e={post_id:this.get("id"),tumblelog_id:this.get("tumblelog")};return this.save("remove_source",e)},approve:function(e){var t={id:this.get("id"),queue:e};return this.save("approve",t)},deny:function(){return this.save("deny",{pid:this.get("id")})},answer:function(e){var t={post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog-key"),answer_text:e};return this.save("answer",t)},embedFocus:function(){this.trigger("embed:focus",this)},updateReblogControl:function(e){this.trigger("reblog:success",e)},dismiss:function(){this.trigger("dismiss",this)}});e.exports=d},function(e,t,i){"use strict";var s=i(3),n=i(145),o=new n({loggingData:function e(t){var e={};return!s.isEmpty(this.model)&&s.isFunction(this.model.toJSON)&&(e.modelData=this.model.toJSON()),s.isObject(t)&&(e=s.extend(e,t)),e}});e.exports=o},,,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(150),r=i(315),a=2e3,l=i(174),a=2e3,c=function(e,t,i){this.name="EmbedError",this.message=e,this.input=t,this.data=i,this.stack=(new Error).stack};c.prototype=new Error;var u=l.extend({constructor:function(e){this.setEmbedRegexes(e||[])},setEmbedRegexes:function(e){this.regexes=e,this.services=s.unique(s.values(e))},isValidEmbedService:function(e){return s.any(this.regexes,function(t,i){return new RegExp(i,"mi").test(e)})},isValidEmbedServiceName:function(e){return s.contains(this.services,e)},getUrlFromEmbedCode:function(e){var t=n(r.nodeFromString(e)),i=t.find("iframe[src], embed[src], script[src]").first(),s=t.find("object[data]").first();return i.attr("src")||s.attr("data")||!1},fetchEmbedData:function(e,t,i){var r=n.ajax({url:"/svc/post/get_video_data",type:"POST",withFormKey:!0,data:JSON.stringify({embed_url:e,embed_width:t})});return o(r).then(s.bind(function(n){if(s.isEmpty(n)||"false"===n||!s.isPlainObject(n))throw new c("Invalid embed response",e,n);if(n.thumbnail||i)return n;var r=s.bind(this.fetchEmbedData,this,e,t,!0);return o.promise(function(e,t){s.delay(function(){r().then(function(e){return e},function(){return n})},a)})},this)).catch(function(e){return o.reject(e)})},parseEmbedData:function(e,t){if(!s.isString(e))throw"The input is invalid. Expected a string";var i=s.trim(e);if(this.isValidEmbedService(i))return this.fetchEmbedData(i,t);var n=this.getUrlFromEmbedCode(i);return s.isEmpty(n)?o.reject(new c("Invalid embed code",e)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:n,preview_iframe:"",embed_code:e})}});e.exports=new u},function(e,t,i){"use strict";function s(e){var t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body}function n(e){var t=document.implementation.createHTMLDocument("");return t.body.appendChild(e.cloneNode(!0)),t.body}function o(e){return n(e).innerHTML}function r(e){var t,i=document.implementation.createHTMLDocument("");return i.body.innerHTML=e,t=i.body.textContent||i.body.innerText||"",t=t.trim()}e.exports={nodeFromString:s,wrapNode:n,outerHTML:o,stripTags:r}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(242),r=i(404),a=n.extend({className:"popover--gif-search",mixins:[o],defaults:{query:null},initialize:function(e){this.gifSearch=new r(s.pick(e,"collection","query","imageWidth","loadFullImageBeforeSelect","selectedImageUrl","resultLimit","loggingContext")),this.listenTo(this,"change:query",function(e,t){this.gifSearch.setQuery(t)}),this.listenTo(this.gifSearch,"all",this.trigger)},render:function(){this.gifSearch.render().$el.appendTo(this.$el)},teardown:function(){return s.result(this.gifSearch,"remove"),this.$el.remove(),this}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(139),r=i(173),a=i(405),l=i(438),c=function(){};c.extend=n.Model.extend,s.extend(c.prototype,n.Events);var u=new c,h=r.extend({name:"ImageSearch",selector:"body",defaults:{resultLimit:200,imageWidth:250,loadFullImageBeforeSelect:!1,query:null,selectedImageUrl:null,loggingContext:null},initialize:function(e){e=e||{},s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"collection")),s.isEmpty(this.collection)&&(this.collection=new l),this.view=new a(s.extend({eventBus:u,collection:this.collection,query:this.get("query"),imageWidth:this.get("imageWidth"),loadFullImageBeforeSelect:this.get("loadFullImageBeforeSelect"),resultLimit:this.get("resultLimit"),selectedImageUrl:this.get("selectedImageUrl"),loggingContext:this.get("loggingContext")},this.viewOptions)),this.listenTo(u,"image:select",function(e,t){this.logGifSearchEvent("select",t),this.trigger("selectImage",e.toJSON(),this.getQuery())}),this.listenTo(u,"image:impression",function(e){this.logGifSearchEvent("impression",e)}),this.listenTo(u,"gifsearch:resultChange",function(e){this.logGifSearchResultChange("search",e)}),this.listenTo(this.view,"dismiss",function(){this.trigger("dismiss")})},render:function(){return this.view.render(),this.trigger("append"),this.view},setQuery:function(e){this.view.setQuery(e)},getQuery:function(){return this.view.getQuery()},getCurrentResults:function(){return this.view.get("currentResults")},logGifSearchEvent:function(e,t){var i={popularSearch:t.model.get("popularSearchTag")?t.model.get("popularSearchTag"):null,query:this.getQuery()?this.getQuery():null,resultsIndex:this.getCurrentResults().indexOf(t.model),top:Math.round(t.$el.position().top),left:Math.round(t.$el.position().left),postBlog:t.model.get("postBlog"),postId:t.model.get("postId"),context:this.get("loggingContext")};o.trigger("gifsearch:"+e,{loggingData:i})},logGifSearchResultChange:function(e,t){var i=this.getQuery();if(i){var s={query:i,context:this.get("loggingContext")};o.trigger("gifsearch:"+e,{loggingData:s})}}});e.exports=h},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(406),a=i(191),l=i(410),c=i(412),u=i(429),h=i(432),d=i(437),p=o.extend({className:"gif-search-container",template:d,mixins:[a],keycommands:{"keydown:tab":"_onKeyPressTab","keydown:shift+tab":"_onKeyPressShiftTab"},subviews:{searchInput:{constructor:l,options:function(e){return{eventBus:e.eventBus,keyboardManager:e.keyboardManager,keyboardNamespace:"gifsearch:input"}}},searchResults:{constructor:c,options:function(e){return{imageWidth:e.get("imageWidth"),selectedImageUrl:e.get("selectedImageUrl"),loadFullImageBeforeSelect:e.get("loadFullImageBeforeSelect"),eventBus:e.eventBus,keyboardManager:e.keyboardManager,keyboardNamespace:"gifsearch:results"}}},searchMessage:{constructor:u,options:function(e){return{eventBus:e.eventBus}}}},defaults:{imageWidth:null,loadFullImageBeforeSelect:!0,resultLimit:200,selectedImageUrl:"",query:null,loggingContext:null,focusIndex:0,tabbingView:null},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection")),this.keyboardManager=new r({allowMultipleActiveViews:!0}),this.noResults=[n("Nothing turned up. Bummer."),n("Looked around but didn't see anything about that."),n("Sadly, nothing."),n("Tragically, nothing."),n("Welcome to the void. There is nothing here."),n("We found nothing. Here it isn't."),n("Couldn't find that. Please, don't be upset. Please."),n("Sincerely, we found nothing."),n("Maybe try a similar search but use different words? Dunno.")],this.listenTo(this,"change:query",this._onChangeQuery),this.listenTo(this.eventBus,"image:tag",function(e,t){this.set("query",e),this.searchInput.setValue(this.get("query"))}),this.listenTo(this.eventBus,"showHiddenResults",function(){this.searchResults.setCollection(this.get("currentResults")),this.hasResults()&&this.searchMessage.hide()})},afterRenderSubviews:function(){this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.searchInput,"focus",this._onChangeFocusView),this.listenTo(this.searchResults,"focus",this._onChangeFocusView),this.listenTo(this.searchInput,"userQueryChanged",function(e){this.setQuery(e)}),this.loader=new h({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),s.isString(this.get("query"))&&(this._onChangeQuery(this,this.get("query")),this.searchInput.setValue(this.get("query"))),s.defer(s.bind(function(){this.rendered&&this.searchInput.focus()},this)),this._focusViews=[this.searchInput,this.searchResults],this._tabbableViews=[this.searchResults],this.keyboardManager.add("gifsearch:main",this),this.focusKeys()},beforeRemove:function(){this.keyboardManager.remove("gifsearch"),this.currentQuery&&this.currentQuery.reject()},hasResults:function(){return!(s.isEmpty(this.get("currentResults"))||s.isEmpty(this.get("currentResults").models))},dismiss:function(){this.trigger("dismiss")},_onKeyPressTab:function(e){e.preventDefault(),this._moveFocusDown()},_onKeyPressShiftTab:function(e){e.preventDefault(),this._moveFocusUp()},_moveFocusUp:function(){var e=this.get("tabbingView");e&&e.set("isFocused",!1),this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var e=this._focusViews||[];this.set("focusIndex",Math.min(e.length-1,this.get("focusIndex")+1))},_onChangeFocusView:function(e){var t=this._focusViews,i=s.indexOf(t,e);this.set("tabbingView",s.contains(this._tabbableViews,e)?e:null),this.set("focusIndex",i)},_onChangeFocusIndex:function(e,t){var i=s.get(this._focusViews,t);this.set("tabbingView",s.contains(this._tabbableViews,i)?i:null),s.result(i,"focus")},_onChangeQuery:function(e,t){s.isString(t)&&(this.rendered&&this.loader.set("loading",!0),this.currentQuery&&this.currentQuery.reject(),this.searchResults.cancelPreloads(),this.searchResults.cancelFullImageLoads(),this.currentQuery=this.collection.fetchGifs(t,this.get("resultLimit"),this.get("loggingContext")),this.currentQuery.promise.then(s.bind(function(e){if(this.set("currentResults",e.media),this.rendered){this.loader.set("loading",!1);var t=e.get("message");t&&(t.header||t.body)?this.searchMessage.setMessage(t.header,t.body,this.hasResults()):(this.searchResults.setCollection(this.get("currentResults")),this.hasResults()?this.searchMessage.hide():this.searchMessage.setMessage("",s.sample(this.noResults),!1))}this.currentQuery=null},this)))},setQuery:function(e){this.set("query",e)},getQuery:function(){return this.get("query")}});e.exports=p},function(e,t,i){"use strict";var s=i(3),n=i(407),o=n.extend({name:"MessagingKeyboardManager",addKeyboardAccess:function(e){return!!s.isFunction(s.get(e,"soloKeys"))&&(e.enableKeys(),e.soloKeys(!0),!0)},removeKeyboardAccess:function(e){return!!s.isFunction(s.get(e,"unSoloKeys"))&&(e.disableKeys(),e.unSoloKeys(),!0)}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(408),r=n.extend({name:"BaseKeyboardManager",defaults:{isDebugEnabled:!1,keepInactiveItems:!0,allowMultipleActiveViews:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),this.collection=new o,this.listenTo(this.collection,"add",this._onAddItem),this.listenTo(this.collection,"remove",this._onRemoveItem),this.listenTo(this.collection,"change:isActive",this._onItemActiveChange)},addKeyboardAccess:s.noop,removeKeyboardAccess:s.noop,add:function(e,t){return!(!e||!t)&&(!this.collection.get(e)&&(this.get("keepInactiveItems")||this.get("allowMultipleActiveViews")||this.collection.remove(this.collection.models),this.collection.unshift({namespace:e,view:t}),this._adjustActiveStates(),!0))},remove:function(e){var t=this.collection.getByNamespace(e);return!s.isEmpty(t)&&(this.collection.remove(t),this._adjustActiveStates(),!0)},toggle:function(e,t,i){return i?this.add(e,t):this.remove(e)},_onAddItem:function(e){return this.addKeyboardAccess(e.get("view"))},_onRemoveItem:function(e){return this.removeKeyboardAccess(e.get("view"))},_adjustActiveStates:function(){var e,t;0!==this.collection.length&&(e=this.collection.first(),t=this.collection.rest(),e&&e.set("isActive",!0),this.get("allowMultipleActiveViews")||s.each(t,function(e){e.set("isActive",!1)},this))},_onItemActiveChange:function(e,t){return t?this.addKeyboardAccess(e.get("view")):this.removeKeyboardAccess(e.get("view"))}});e.exports=r},function(e,t,i){"use strict";var s=i(148),n=i(409),o=s.extend({model:n,getByNamespace:function(e){return this.filter(function(t){return this._isNamespaceMatch(e,t.get("namespace"))},this)},_isNamespaceMatch:function(e,t){return e===t||0===t.indexOf(e+":")}});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({idAttribute:"namespace",defaults:{namespace:null,view:null,isActive:!0}});e.exports=n},function(e,t,i){"use strict";var s=i(185),n=i(191),o=i(236),r=i(411),a=i(130),l=i(3),c=i(251),u=s.extend({className:"gif-search-input",template:r,mixins:[n,o],defaults:{isFocused:!1},events:{"focus [data-js-plainTextEditor]":"_onFocus","blur [data-js-plainTextEditor]":"_onBlur"},subviews:{textEditor:{constructor:c,options:function(e){return{forceSingleLine:!0,placeholder:a("Find a GIF"),syncWithModel:!1,onChange:l.debounce(l.bind(e._onUserChangeInput,e),250)}}}},initialize:function(e){e=l.extend({},e),l.extend(this,l.pick(e,"eventBus","keyboardManager","keyboardNamespace"))},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused)},_onChangeIsFocused:function(e,t){
t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onUserChangeInput:function(){this.trigger("userQueryChanged",this.textEditor.getEditorValue())},focus:function(){this.textEditor.focus()},_onFocus:function(){this.set("isFocused",!0)},_onBlur:function(){this.set("isFocused",!1)},setValue:function(e){this.textEditor.setEditorValue(e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="textEditor"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.prototype,r=i(413),a=i(191),l=i(414),c=i(415),u=i(417),h=i(194),d=h.animate,p=h.hook,g=i(150),_=i(427),f=function(e){var t=Math.round(e.position().top),i=Math.round(t+e.height());return{top:t,bottom:i}},m=function(e,t){return!(t.bottom<e.top||t.top>e.bottom)},v=function(e,t){return t.bottom>=e.bottom&&t.top<=e.top},b=function(e){return{top:Math.round(e.scrollTop()),bottom:Math.round(e.scrollTop()+e.height())}},y=function(e,t){return Math.floor(t.position().top/e.height())},w=function(e){return Math.floor(e.scrollTop()/e.outerHeight(!0))},k=function(e){return Math.ceil(e.get(0).scrollHeight/e.height())},C=n.extend({className:"gif-search-results",template:l,mixins:[a,r],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},subviews:{searchResults:{constructor:c,options:function(e){return{eventBus:e.eventBus,imageWidth:e.get("imageWidth"),onSelect:s.bind(e._onSubviewSelect,e),onClear:s.bind(e._onSubviewClear,e),loadFullImageBeforeSelect:e.get("loadFullImageBeforeSelect")}},collection:function(e){return e.collection}}},defaults:{renderBatchSize:50,renderBatchDelay:5,selectedImageUrl:"",imageWidth:null,loadFullImageBeforeSelect:!0,enablePreloading:!0,isPreloading:!1,preloadPollInterval:1e3,selectedView:null,isFocused:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection","keyboardManager","keyboardNamespace")),this.keyboardViewName="searchResults"},setCollection:function(e){this.collection&&this.stopListening(this.collection),this.collection=e,this.eventBus.trigger("gifsearch:resultChange",this.collection),this.rendered&&this.render()},populatePreloadQueue:function(){this._preloadQueue=s.range(k(this.$el)),this.sortPreloadQueue()},sortPreloadQueue:function(){var e;s.isEmpty(this._preloadQueue)||(e=w(this.$el),this._preloadQueue=s.sortBy(this._preloadQueue,function(t){return Math.abs(e-t)+(t<e?.1:0)}))},clearPreloadQueue:function(){this._preloadQueue&&(this._preloadQueue.length=0)},processPreloadQueue:function(){var e,t;if(!this.get("isPreloading")){if(!this.rendered||s.isEmpty(this._preloadQueue))return void this.stopPreloadPoller();e=this._preloadQueue.shift(),t=this.getViewsAtPageIndex(e),this.set("isPreloading",!0),this.preloadSubviews(t).finally(s.bind(function(){this.set("isPreloading",!1)},this)).catch(s.noop)}},startPreloadPoller:function(){this.stopPreloadPoller(),this._preloadTimer=setInterval(s.bind(this.processPreloadQueue,this),this.get("preloadPollInterval"))},stopPreloadPoller:function(){this._preloadTimer&&(clearInterval(this._preloadTimer),this._preloadTimer=null)},renderCollectionSubviews:function(e){if("searchResults"!==e)return o.renderCollectionSubviews.apply(this,arguments);var t=this.subviews[e],i=t.container||s.bind(function(){return this.$('[data-subview="'+e+'[]"]')},this),n=t.prepareView||function(i,s){var n=new t.constructor(s);return n.$el.attr("data-subview",e),i.append(n.$el),n},r=t.options||{},a=t.collection;if(s.isFunction(a)&&(a=a(this)),!a)return null;var l=this.get("renderBatchSize"),c=this.get("renderBatchDelay");this._deferredRenders=s(a.models).groupBy(function(e,t){return Math.floor(t/l)}).toArray().map(function(t,o){return s.delay(this.createCollectionSubviewRenderer(t,i,n,r,e,!!o),o*c)},this).value()},hideViews:function(e){s.each(e,function(e){e.rendered&&(e.set("isSelectable",!1),e.$el.css("opacity",0))})},animateShowViews:function(e){var t=0;s.each(e,function(e){this.animateShowView(e,100*t++)},this)},animateShowView:function(e,t,i,n){var o,r=!1;n=s.isNumber(n)?n:250,t=s.isNumber(t)?t:0,i=s.isNumber(i)?i:1e3,p(e.$el,"translateY","40px");var a=function(){r=!0,d(e.$el,"stop"),d(e.$el,{translateY:0,opacity:1},{duration:n,delay:t,complete:s.bind(function(){e.rendered&&(e.set("isSelectable",!0),e.$el.css({transform:"",opacity:""}))},this)})};i>0&&(o=setTimeout(a,i)),e.getLoadPromise().then(function(){o&&clearTimeout(o),r||a()})},beforeRender:function(){this.$el.css("visibility","hidden"),this.removeSubviews()},afterRender:function(){this.collection&&0!==this.collection.length&&(this.listenTo(this.eventBus,"image:full:loading",this.cancelPreloads),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this._setIsFocusedDebounced=s.debounce(s.bind(this._setIsFocused,this),0),s.defer(s.bind(function(){if(this.rendered){this._deferredRenders||(this._deferredRenders=[]);var e=s.delay(s.bind(this.resetMasonry,this),this.get("renderBatchDelay")*this._deferredRenders.length);this._deferredRenders.push(e),this.scrollbar?this.scrollbar.update():this.scrollbar=new _(this.$el)}},this)))},removeSubviews:function(){return s.forEach(this._deferredRenders,clearTimeout),this._deferredRenders=[],delete this.masonry,o.removeSubviews.apply(this,arguments)},resetMasonry:function(){this.setupMasonary(),this.setupElementCaches(),this.get("enablePreloading")&&(this.populatePreloadQueue(),this.startPreloadPoller()),this.setSelectedImage(),this.setupVirtualization();var e=this.getSubviewsInBounds();this.hideViews(e),this.$el.css("visibility",""),this.animateShowViews(e)},getViewBounds:function(e){return s.result(this._elementPositionCache,e.cid)?this._elementPositionCache[e.cid]:f(e.$el)},getSubviewsInBounds:function(e){return e=e||b(this.$el),s.filter(this.searchResults,function(t){return m(this.getViewBounds(t),e)},this)},setupMasonary:function(){this.masonry?this.masonry.reload():this.masonry=new u(this.$(".results-scroller").get(0),{transitionDuration:0,isFitWidth:!0,gutter:10},this)},setupElementCaches:function(){var e=this.$el;this._pageIndexCache={},this._elementPositionCache={},s.each(this.searchResults,function(t){var i=y(e,t.$el);s.isArray(this._pageIndexCache[i])||(this._pageIndexCache[i]=[]),this._pageIndexCache[i].push(t),this._elementPositionCache[t.cid]=f(t.$el)},this)},getViewsAtPageIndex:function(e){return this._pageIndexCache[e]||[]},setupVirtualization:function(){var e=s.bind(function(){this.rendered&&(this.sortPreloadQueue(),this.virtualizeSubviews())},this),t=s.debounce(e,250);this.$el.off(".image-search-virtualization").on("scroll.image-search-virtualization",t),this.virtualizeSubviews()},setSelectedImage:function(){var e,t;if(this.get("selectedImageUrl")&&(t=s.find(this.searchResults,function(e,t){return e.model.get("mediaUrl")===this.get("selectedImageUrl")},this))){if(t.set("isPreselected",!0),e=t.$el.offset().top-this.$el.offset().top,0===e)return;e-=(this.$el.height()-t.$el.height())/2,this.$el.scrollTop(e)}},cancelPreloads:function(){this.stopPreloadPoller(),this.clearPreloadQueue()},cancelFullImageLoads:function(){this.eventBus.trigger("image:full:cancelLoad")},preloadSubviews:function(e,t){return g.all(s.map(e,function(e){return e.loadImage()}))},_virtualizeSubviews:function(e,t,i){s.forEach(this.searchResults,function(n,o){if(n&&n.$el){var r=this.getViewBounds(n);m(r,e)?s.isFunction(t)&&t.call(this,n,v(r,e)):s.isFunction(i)&&i.call(this,n)}},this)},virtualizeSubviews:function(){var e=this.$el,t={top:e.scrollTop(),bottom:e.scrollTop()+e.height()};this._virtualizeSubviews(t,function(e,t){e.set({isVirtualized:!1}),t&&e.get("isImpressionLogged")===!1&&(this.eventBus.trigger("image:impression",e),e.set("isImpressionLogged",!0))},function(e){e.set({isVirtualized:!0})})},beforeRemove:function(){this.$el.off(),this.cancelPreloads(),this.cancelFullImageLoads(),this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("selectedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onSubviewSelect:function(e){this.get("isFocused")||this._setIsFocused(!0),this.setSelectedIndex(this.keyboardViewName,s.indexOf(this.searchResults,e)),this.set("selectedView",this.getSelectedView(this.keyboardViewName))},_onSubviewClear:function(){this.set("selectedView",null),this.deselect(this.keyboardViewName)},focus:function(){var e=this.get("selectedView"),t=!s.isEmpty(e);this._setIsFocused(!0),t?this.setSelectedIndex(this.keyboardViewName,s.indexOf(this.searchResults,e)):this.set("selectedView",this.selectFirst(this.keyboardViewName))},isLastViewSelected:function(){return this.isLastSelected(this.keyboardViewName)},isFirstViewSelected:function(){return this.isFirstSelected(this.keyboardViewName)},_onKeyPressDown:function(e){var t;e.preventDefault(),t=this.isLastViewSelected()?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressUp:function(e){var t;e.preventDefault(),t=this.isFirstViewSelected()?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressEnter:function(e){var t=this.get("selectedView");e.preventDefault(),t&&t.select(e)}});e.exports=C},function(e,t,i){"use strict";var s=i(3),n=i(145),o=new n({defaults:{hasSelection:function(e){return this._validateParams(e)?s.has(this._selectedIndexes,e):null},getSelectedIndex:function(e){return this._validateParams(e)?s.get(this._selectedIndexes,e,0):null},deselect:function(e){this._validateParams(e)&&this.hasSelection(e)&&delete this._selectedIndexes[e]},resetSelected:function(e){this._validateParams(e)&&this.setSelectedIndex(e,0)},setSelectedIndex:function(e,t){var i;return this._validateParams(e)?(i=s.get(this,e,[]),t=Math.max(0,Math.min(t,i.length-1)),s.set(this._selectedIndexes,e,t),t):null},getSelectedView:function(e){var t;return this._validateParams(e)?(t=s.get(this,e,[]),s.get(t,this.getSelectedIndex(e))):null},isFirstSelected:function(e){return this._validateParams(e)?0===this.getSelectedIndex(e):null},isLastSelected:function(e){var t;return this._validateParams(e)?(t=s.get(this,e,[]),this.getSelectedIndex(e)===t.length-1):null},selectFirst:function(e){var t;if(!this._validateParams(e))return null;t=s.get(this,e,[]);var i=this.setSelectedIndex(e,0);return s.get(t,i)},selectLast:function(e){var t;if(!this._validateParams(e))return null;t=s.get(this,e,[]);var i=this.setSelectedIndex(e,t.length-1);return s.get(t,i)},selectNext:function(e){var t,i;return this._validateParams(e)?this.hasSelection(e)?(t=s.get(this,e,[]),i=this._increaseSelectedIndex(e),s.get(t,i)):this.selectFirst(e):null},selectPrevious:function(e){var t,i;return this._validateParams(e)?(t=s.get(this,e,[]),i=this._decreaseSelectedIndex(e),s.get(t,i)):null},_validateParams:function(e){return!!e},_increaseSelectedIndex:function(e){return this._validateParams(e)?this.setSelectedIndex(e,this.getSelectedIndex(e)+1):null},_decreaseSelectedIndex:function(e){return this._validateParams(e)?this.setSelectedIndex(e,this.getSelectedIndex(e)-1):null}},before:{initialize:function(){this._selectedIndexes={}}}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="results-scroller" data-subview="searchResults[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(416),a=i(218),l=i(236),c=i(290),u=i(150),h=o.extend({className:"gif-search-result",tagName:"a",attributes:{href:"#",tabIndex:1},template:r,events:{"click [data-js-select]":"_onClickSelect","click [data-js-tag]":"_onClickTag",mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[l],defaults:{skipTags:["gif","gifs"],imageWidth:null,isVirtualized:!0,hasStillImage:!0,isPreselected:!1,unloadImageOnVirtualize:!1,isLoaded:!1,isSelectable:!0,loadFullImageBeforeSelect:!0,loadingFullImage:!1,containerWidth:150,isImpressionLogged:!1,isSelected:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","onSelect","onClear")),this._loadDefer=u.defer()},afterRender:function(){this.listenTo(this,"change:isPreselected",this._onChangeIsPreselected),this.listenTo(this,"change:isVirtualized",this._onChangeIsVirtualized),this.listenTo(this,"change:hasStillImage",this._onChangeHasStillImage),this.listenTo(this,"change:isSelectable",this._onChangeIsSelectable),this.listenTo(this,"change:isLoaded",this._onChangeIsLoaded),this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this.eventBus,"image:full:cancelLoad",this._onCancelAllFullImageLoads),this._onChangeIsVirtualized(this,this.get("isVirtualized")),this._onChangeHasStillImage(this,this.get("hasStillImage")),this._onChangeIsPreselected(this,this.get("isPreselected")),this._onChangeIsSelectable(this,this.get("isSelectable")),this._onChangeIsLoaded(this,this.get("isLoaded"))},getTemplateData:function(){var e=this.model.toJSON(),t=e.popularSearchTag?[e.popularSearchTag]:e.postTags,i=this.get("skipTags"),n=this.get("containerWidth"),o=Math.round(this.model.get("height")*(n/this.model.get("width")));return t=s.reject(t,function(e){return s.contains(i,e.toLowerCase())}),s.extend(e,{tags:t.slice(0,3),width:n,height:o}),this.get("imageWidth")&&s.extend(e,{mediaUrl:e.mediaUrl.replace(/_\d+\./,"_"+this.get("imageWidth")+".")}),e},loadImage:function(){var e=this.js$("img"),t=e.attr("data-img-src");return this.get("isLoaded")||(e.attr("src",t),a.load(t,100).then(s.bind(function(){this.rendered&&this.set("isLoaded",!0),this._loadDefer.resolve()},this))),this._loadDefer.promise},unloadImage:function(){this.js$("img").removeAttr("src")},refreshStillImage:function(){this._onChangeHasStillImage(this,this.get("hasStillImage"))},getLoadPromise:function(){return this._loadDefer.promise},_onCancelAllFullImageLoads:function(){this._cancelLoadFullImage()},_onClickSelect:function(e){e.preventDefault(),s.isFunction(this.onSelect)&&this.onSelect(this,this.model);var t=this.model.get("mediaUrl"),i=this.js$("img").attr("src"),n=function(){this.$el.addClass("gif-search-result--selected"),this.eventBus.trigger("image:select",this.model,this)};this.get("loadFullImageBeforeSelect")&&t!==i?this._loadFullImage(t,n):n.call(this)},select:function(e){this._onClickSelect(e)},_loadFullImage:function(e,t){this.eventBus.trigger("image:full:cancelLoad"),this.set("loadingFullImage",!0),this.eventBus.trigger("image:full:loading"),this.loader=new c({variation:"centered small",loading:!0}),this.$el.addClass("loading-full").append(this.loader.render().$el),a.load(e).then(s.bind(function(){this.get("loadingFullImage")&&s.isFunction(t)&&t.call(this)},this)).finally(s.bind(this._cancelLoadFullImage,this))},_cancelLoadFullImage:function(){this.rendered&&this.get("loadingFullImage")&&(this.loader&&(this.loader.remove(),this.loader=null),this.$el.removeClass("loading-full"),this.set("loadingFullImage",!1))},_onClickTag:function(e){var t=n(e.target).attr("data-js-tag");this.eventBus.trigger("image:tag",t,this.model),e.preventDefault(),e.stopPropagation()},_onChangeIsPreselected:function(e,t){this.$el.toggleClass("gif-search-result--preselected",t)},_onChangeIsVirtualized:function(e,t){this.$el.toggleClass("off",t),t&&this.get("unloadImageOnVirtualize")?this.unloadImage():t||this.loadImage()},_onChangeHasStillImage:function(e,t){this._removeStillCanvas(),t&&this._prepareCreateStillCanvas()},_onChangeIsSelectable:function(e,t){this.$el.toggleClass("gif-search-result--selectable",t)},_onChangeIsLoaded:function(e,t){this.$el.toggleClass("loaded",t)},_createStillCanvas:function(){if(this.rendered){var e,t=this.js$("img"),i=t.parent(),s=parseInt(t.width(),10),o=parseInt(t.height(),10),r=n("<canvas />").attr({width:s,height:o});this.$("canvas").remove(),i.append(r),e=r.get(0).getContext("2d"),e.drawImage(t.get(0),0,0,s,o),this.$el.addClass("show-still")}},_prepareCreateStillCanvas:function(){this.getLoadPromise().then(s.bind(this._createStillCanvas,this)).catch(s.noop)},_removeStillCanvas:function(){this.$("canvas").remove(),this.$el.removeClass("show-still")},setSelected:function(e){this.rendered&&this.set("isSelected",e)},_onChangeIsSelected:function(e,t){this.$el.toggleClass("selected",t),this.$el.focus()},_onMouseEnter:function(e){s.isFunction(this.onSelect)&&this.onSelect(this)},_onMouseLeave:function(e){s.isFunction(this.onClear)&&this.onClear(this)}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<figure data-js-select style="width: '+__e(width)+"px; height: "+__e(height)+'px"><img data-js-img data-img-src="'+__e(mediaUrl)+'" width="'+__e(width)+'" height="'+__e(height)+'"></figure><footer><nav class="tags"> ',_.each(tags,function(e){__p+=" ",_.isEmpty(e)||(__p+=' <a href="#" data-js-tag="'+__e(e)+'">#'+__e(e)+"</a> "),__p+=" "}),__p+=' </nav><a class="attribution" href="http://tmblr.co/'+__e(rootPostUrlHash)+'" target="_blank">'+__e(__("Originally posted by %1$s",rootBlog))+"</a></footer>";return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(428),r=i(139),a=i(178),l=i(189),c=a.extend({mixins:[l],tplScrollbarWrapper:'<div class="tx-scroll"></div>',tplScrollbarTrackVertical:'<div data-js-track-vertical class="tx-scrollbar-track tx-scrollbar-track--vertical"><div data-js-thumb-vertical class="tx-scrollbar-thumb"></div></div>',tplScrollbarTrackHorizontal:'<div data-js-track-horizontal class="tx-scrollbar-track tx-scrollbar-track--horizontal"><div data-js-thumb-horizontal class="tx-scrollbar-thumb"></div></div>',defaults:{trackActiveClass:"tx-scrollbar-track--active",scrollingClass:"tx-scroll--scrolling",containerClass:"tx-scroll-container",containerClassVertical:"tx-scroll-container--vertical",containerClassHorizontal:"tx-scroll-container--horizontal",infiniteScrollPercent:.9,isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1,isScrolling:!1,nativeScrollbarSize:20},events:{"mousedown [data-js-thumb-vertical]":"_onVerticalThumbMousedown","mousedown [data-js-thumb-horizontal]":"_onHorizontalThumbMousedown"},destroyed:!1,constructor:function(e){var t=this._getElementFromOptions(e);return null===t?null:(this.container=t,this.$container=n(t),s.extend(e,{el:this._getWrappedElement(t)}),a.prototype.constructor.call(this,e))},initialize:function(e){this.$window=n(window),this._onScrollStopDebounced=s.debounce(s.bind(this._onScrollStop,this),150),this._onResizeDebounced=s.debounce(s.bind(this._onResize,this),150),this.render()},render:function(){return this.rendered&&!this.destroyed?this:(this.listenTo(r,"DOMEventor:flatresize",this._onResizeDebounced),this.listenTo(this,"change:isScrollableVertical",this._onChangeIsScrollableVertical),this.listenTo(this,"change:isScrollableHorizontal",this._onChangeIsScrollableHorizontal),this.listenTo(this,"change:isScrollable",this._onChangeIsScrollable),this.update(),this.destroyed=!1,a.prototype.render.apply(this,arguments))},getVerticalTrack:function(){return this.$verticalTrack},getHorizontalTrack:function(){return this.$horizontalTrack},getVerticalThumb:function(){return this.$verticalThumb},getHorizontalThumb:function(){return this.$horizontalThumb},getScrollContainer:function(){return this.container},isScrollable:function(){return this.get("isScrollable")},isScrollableVertical:function(){return this.get("isScrollableVertical")},isScrollableHorizontal:function(){return this.get("isScrollableHorizontal")},update:function(){var e,t,i;this.destroyed||(e=this._isScrollableVertical(),t=this._isScrollableHorizontal(),i=e||t,this.set({isScrollableVertical:e,isScrollableHorizontal:t,isScrollable:i}),this._updateScrollConstants(),e&&(this._updateVerticalThumbHeight(),this._positionVerticalThumb()),t&&(this._updateHorizontalThumbWidth(),this._positionHorizontalThumb()))},remove:function(){return this.destroy()},destroy:function(){this.$container.off(".txScroll"),this.$window.off(".txScroll"),this.set({isScrollable:!1,isScrollableHorizontal:!1,isScrollableVertical:!1}),this.undelegateEvents(),this.stopListening(),this._unwrapContainer(),this.destroyed=!0},_getElementFromOptions:function(e){var t;return t=e instanceof n?e.get(0):e instanceof window.Element?e:s.get(e,"el",null)},_getWrappedElement:function(e){var t=e instanceof n?e:n(e),i=n(this.tplScrollbarWrapper);return t.wrap(i),i=t.parent(),i.get(0)},_unwrapContainer:function(){this.$container.unwrap()},_appendVerticalTrack:function(){var e=n(this.tplScrollbarTrackVertical);this.$verticalTrack=e,this.$verticalThumb=e.find("[data-js-thumb-vertical]"),this.$el.append(e)},_removeVerticalTrack:function(){var e=this.getVerticalTrack();e&&(e.remove(),delete this.$verticalTrack,delete this.$verticalThumb)},_appendHorizontalTrack:function(){var e=n(this.tplScrollbarTrackHorizontal);this.$horizontalTrack=e,this.$horizontalThumb=e.find("[data-js-thumb-horizontal]"),this.$el.append(e)},_removeHorizontalTrack:function(){var e=this.getHorizontalTrack(!0);e&&(e.remove(),delete this.$horizontalTrack,delete this.$horizontalThumb)},_onChangeIsScrollable:function(e,t){var i;this.destroyed||(i="ontouchstart"in document.documentElement,i||this.$container.off("wheel.txScroll"),this.$container.off("scroll.txScroll"),this.$container.toggleClass(this.get("containerClass"),t),t&&(this.$container.on("scroll",s.bind(this._onScroll,this)),i||this.$container.on("wheel.txScroll",s.bind(this._stealScroll,this))))},_onChangeIsScrollableVertical:function(e,t){this.destroyed||(this.$container.toggleClass(this.get("containerClassVertical"),t),t?this._appendVerticalTrack():this._removeVerticalTrack())},_onChangeIsScrollableHorizontal:function(e,t){this.destroyed||(this.$container.toggleClass(this.get("containerClassHorizontal"),t),t?this._appendHorizontalTrack():this._removeHorizontalTrack())},_updateScrollConstants:function(){var e=this.getVerticalTrack(),t=this.getHorizontalTrack(),i=this.getVerticalThumb(),s=this.getHorizontalThumb();this.currentScrollTop=this.$container.scrollTop(),this.currentScrollLeft=this.$container.scrollLeft(),this.get("isScrollableVertical")&&e&&i&&(this.percentageDifferenceVertical=(this.container.scrollHeight-this.$container.height())/(e.height()-i.height())),this.get("isScrollableHorizontal")&&t&&s&&(this.percentageDifferenceHorizontal=(this.container.scrollWidth-this.$container.width())/(t.width()-s.width()))},_onResize:function(){this.trigger("resize"),this.update()},_getAddedScrollbarHeight:function(){return this.get("isScrollableHorizontal")?this.get("nativeScrollbarSize"):0},_getAddedScrollbarWidth:function(){return this.get("isScrollableVertical")?this.get("nativeScrollbarSize"):0},_isScrollableVertical:function(){return this.container&&this.container.scrollHeight>this.$container.height()+this._getAddedScrollbarHeight()},_isScrollableHorizontal:function(){return this.container&&this.container.scrollWidth>this.$container.width()+this._getAddedScrollbarWidth()},_getScrollTop:function(e,t){return e.pageY-t.offset().top},_getScrollLeft:function(e,t){return e.pageX-t.offset().left},_onVerticalThumbMousedown:function(e){var t=this.getVerticalTrack();e.preventDefault(),t&&(t.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",s.bind(this._onVerticalThumbMousemove,this)),this.$window.on("mouseup.txScroll",s.bind(this._onVerticalThumbMouseup,this)),this.mouseDownOriginalOffsetY=this._getScrollTop(e,t),this._updateScrollConstants())},_onHorizontalThumbMousedown:function(e){var t=this.getHorizontalTrack();e.preventDefault(),t&&(t.addClass(this.get("trackActiveClass")),this.$window.on("mousemove.txScroll",s.bind(this._onHorizontalThumbMousemove,this)),this.$window.on("mouseup.txScroll",s.bind(this._onHorizontalThumbMouseup,this)),this.mouseDownOriginalOffsetX=this._getScrollLeft(e,t),this._updateScrollConstants())},_onVerticalThumbMousemove:function(e){var t,i=this.getVerticalTrack();i&&o.read(function(){this.destroyed||(t=this._getScrollTop(e,i)-this.mouseDownOriginalOffsetY,o.write(function(){this.destroyed||this.$container.scrollTop(this.currentScrollTop+t*this.percentageDifferenceVertical)},this))},this)},_onVerticalThumbMouseup:function(e){var t=this.getVerticalTrack();e.preventDefault(),t&&t.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_onHorizontalThumbMousemove:function(e){var t,i=this.getHorizontalTrack();i&&o.read(function(){this.destroyed||(t=this._getScrollLeft(e,i)-this.mouseDownOriginalOffsetX,o.write(function(){this.destroyed||this.$container.scrollLeft(this.currentScrollLeft+t*this.percentageDifferenceHorizontal)},this))},this)},_onHorizontalThumbMouseup:function(e){var t=this.getHorizontalTrack();e.preventDefault(),t&&t.removeClass(this.get("trackActiveClass")),this.$window.off(".txScroll")},_updateVerticalThumbHeight:function(){var e,t=this.getVerticalThumb(),i=this.getVerticalTrack();i&&t&&(e=this.$container.height()/this.container.scrollHeight,t.height(i.height()*e))},_updateHorizontalThumbWidth:function(){var e,t=this.getHorizontalThumb(),i=this.getHorizontalTrack();i&&t&&(e=this.$container.width()/this.container.scrollWidth,t.width(i.width()*e))},_positionVerticalThumb:function(){var e,t,i,s=this.getVerticalTrack(),n=this.getVerticalThumb();!this.destroyed&&s&&n&&(i=this.container.scrollTop,e=i/(this.container.scrollHeight-this.$container.height()),t=s.height()-n.height(),o.write(function(){this.destroyed||(n.css("transform","translate3d(0, "+t*e+"px, 0)"),this.trigger("scroll:vertical",i,e),this.trigger("scroll",i,e),e>this.get("infiniteScrollPercent")&&this.trigger("infinitescroll",i,e))},this))},_positionHorizontalThumb:function(){var e,t,i,s=this.getHorizontalTrack(),n=this.getHorizontalThumb();!this.destroyed&&s&&n&&(i=this.container.scrollLeft,e=i/(this.container.scrollWidth-this.$container.width()),t=s.width()-n.width(),o.write(function(){this.destroyed||(n.css("transform","translate3d("+t*e+"px, 0, 0)"),this.trigger("scroll:horizontal",i,e))},this))},_onScroll:function(){this.get("isScrolling")||(this.trigger("scrollstart"),this.$el.addClass(this.get("scrollingClass"))),this.set("isScrolling",!0),this._onScrollStopDebounced(),this.get("isScrollableVertical")&&o.read(s.bind(this._positionVerticalThumb,this)),this.get("isScrollableHorizontal")&&o.read(s.bind(this._positionHorizontalThumb,this))},_onScrollStop:function(){this.destroyed||(this.trigger("scrollstop"),this.set("isScrolling",!1),this.$el.removeClass(this.get("scrollingClass")))},_stealScroll:function(e){var t=e.currentTarget,i=e.originalEvent.deltaX,s=e.originalEvent.deltaY,o=Math.abs(i)>0,r=Math.abs(s)>0;this.get("isScrollableHorizontal")&&o&&(i<0&&t.scrollLeft<=0&&e.preventDefault(),i>0&&t.scrollLeft>=t.scrollWidth-n(t).width()-this._getAddedScrollbarWidth()&&e.preventDefault()),this.get("isScrollableVertical")&&r&&(s<0&&t.scrollTop<=0&&e.preventDefault(),s>0&&t.scrollTop>=t.scrollHeight-n(t).height()-this._getAddedScrollbarHeight()&&e.preventDefault())}});e.exports=c},function(e,t){!function(t){"use strict";function i(){this.frames=[],this.lastId=0,this.raf=s,this.batch={hash:{},read:[],write:[],mode:null}}var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)};i.prototype.read=function(e,t){var i=this.add("read",e,t),s=i.id;this.batch.read.push(i.id);var n="reading"===this.batch.mode||this.batch.scheduled;return n?s:(this.scheduleBatch(),s)},i.prototype.write=function(e,t){var i=this.add("write",e,t),s=this.batch.mode,n=i.id;this.batch.write.push(i.id);var o="writing"===s||"reading"===s||this.batch.scheduled;return o?n:(this.scheduleBatch(),n)},i.prototype.defer=function(e,t,i){"function"==typeof e&&(i=t,t=e,e=1);var s=this,n=e-1;return this.schedule(n,function(){s.run({fn:t,ctx:i})})},i.prototype.clear=function(e){if("function"==typeof e)return this.clearFrame(e);e=Number(e);var t=this.batch.hash[e];if(t){var i=this.batch[t.type],s=i.indexOf(e);delete this.batch.hash[e],~s&&i.splice(s,1)}},i.prototype.clearFrame=function(e){var t=this.frames.indexOf(e);~t&&this.frames.splice(t,1)},i.prototype.scheduleBatch=function(){var e=this;this.schedule(0,function(){e.batch.scheduled=!1,e.runBatch()}),this.batch.scheduled=!0},i.prototype.uniqueId=function(){return++this.lastId},i.prototype.flush=function(e){for(var t;t=e.shift();)this.run(this.batch.hash[t])},i.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(e){throw this.runBatch(),e}},i.prototype.add=function(e,t,i){var s=this.uniqueId();return this.batch.hash[s]={id:s,fn:t,ctx:i,type:e}},i.prototype.run=function(e){var t=e.ctx||this,i=e.fn;if(delete this.batch.hash[e.id],!this.onError)return i.call(t);try{i.call(t)}catch(e){this.onError(e)}},i.prototype.loop=function(){var e=this,t=this.raf;this.looping||(t(function i(){var s=e.frames.shift();e.frames.length?t(i):e.looping=!1,s&&s()}),this.looping=!0)},i.prototype.schedule=function(e,t){return this.frames[e]?this.schedule(e+1,t):(this.loop(),this.frames[e]=t)},t=t||new i,"undefined"!=typeof e&&e.exports?e.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom)},function(e,t,i){"use strict";var s=i(3),n=i(430),o=i(185),r=i(431),a=o.extend({className:"gif-search-message",template:r,defaults:{header:"",body:"",hasResults:!1},events:{"click [data-js-showResults]":"_onClickShowResults"},initialize:function(e){s.extend(this,s.pick(e,"eventBus"))},_onClickShowResults:function(){this.eventBus.trigger("showHiddenResults")},_filterMessageHtml:function(e,t){t.find("script, link").remove(),t.find("a[onerror]").removeAttr("onerror")},getTemplateData:function(){var e=o.prototype.getTemplateData.apply(this,arguments);return e.body=n(e.body||"",this._filterMessageHtml),e},afterRender:function(){this.rendered||this.listenTo(this,"change",this.render),this.$el.toggleClass("gif-search-message--hidden",!(this.get("header")||this.get("message")))},setMessage:function(e,t,i){s.isString(t)||(t=e,e=""),s.isBoolean(i)||(i=this.get("hasResults")),this.set({header:e,body:t,hasResults:i}),t||e?this.show():this.hide()},show:function(){this.$el.removeClass("gif-search-message--hidden")},hide:function(){this.$el.addClass("gif-search-message--hidden")}});e.exports=a},function(e,t,i){"use strict";function s(e,t){var i=r.nodeFromString(e),s=o(i);return n.isFunction(t)&&(t=n.rest(arguments)),n.each(t,function(e){e(i,s)}),s.html()}var n=i(3),o=i(8),r=i(315);e.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;
module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="gif-search-message-container"> ',header&&(__p+=' <h2 class="gif-search-message-header">'+(null==(__t=header)?"":__t)+"</h2> "),__p+=' <div class="gif-search-message-body">'+(null==(__t=body)?"":__t)+"</div> ",hasResults&&(__p+=' <p><span class="gif-search-show-results" data-js-showresults>'+__e(__("View results anyway"))+"</span></p> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(433);e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(434),r=i(436),a=n.extend({className:"loader-container",template:r,defaults:{type:"",classModifiers:"",loading:!1},initialize:function(e){this.options=s.extend({},this.defaults,e),this.$container=e.$container,"bar"===this.get("type")&&this.createBarLoader(),this.listenTo(this,"change:loading",this._onChangeLoading),this.attach()},createBarLoader:function(){this.subviews.loaderType=new o(this.options)},_onChangeLoading:function(e,t){this.subviews.loaderType.toggleLoading(t)},attach:function(){this.render(),this.$el.attr("data-subview=loader"),this.$container.find("[data-subview=loader]").replaceWith(this.$el)}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(435),r=n.extend({className:"loader-bar",template:o,defaults:{classModifiers:"",loading:!1},initialize:function(e){this.options=s.extend({},this.defaults,e),this.$el.addClass(this.get("classModifiers")),this.interval=null,this.timeout=null},afterRender:function(){this.$bars=this.$el.find(".bar"),this.get("loading")===!0&&this.toggleLoading(this.get("loading"))},toggleLoading:function(e){this.currentBar=0,this.counter=0,e===!0?(clearTimeout(this.timeout),this.$el.addClass("loading"),this.$bars.addClass("animating"),this.startAnimating()):(this.$el.removeClass("loading"),this.stopAnimating(),this.timeout=setTimeout(s.bind(function(){this.$bars.removeClass("animating")},this),300))},showBar:function(e){this.$bars.eq(e).addClass("active")},hideBar:function(e){this.$bars.eq(e).removeClass("active")},loop:function(){var e=this.$bars.eq(this.currentBar);e.remove(),this.$el.append(e),this.currentBar+=1,this.currentBar>=this.$bars.length&&(this.currentBar=0),this.counter++},startAnimating:function(){this.stopAnimating(),this.loop(),this.interval=setInterval(s.bind(function(){this.loop()},this),300)},stopAnimating:function(){clearInterval(this.interval)},beforeRemove:function(){clearInterval(this.interval),clearTimeout(this.timeout)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="bar white"></div><div class="bar red"></div><div class="bar orange"></div><div class="bar green"></div><div class="bar purple"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="loader-type" data-subview="loaderType"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchInput"></div><div data-subview="loader"></div><div data-subview="searchResults"></div><div data-subview="searchMessage"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(148),r=i(439),a=3e5,l=o.extend({model:r,resultCountForQuery:function(e){e=(e||"").toLowerCase().trim();var t=this.get(e);return t?t.media.length:0},fetchGifs:function(e,t,i,o){var l,c=n.defer();e=(e||"").toLowerCase().trim();var u=this.get(e);return u||(u=new r({query:e,limit:t,loggingContext:i}),this.add(u)),!o&&s.now()-u.get("ts")<a?(this.trigger("search",e,!0),c.resolve(u)):(this.trigger("search",e,!1),l=u.fetch({success:function(){l=null,c.resolve(u)},error:function(e){l=null,c.reject(e)}})),c.promise.catch(function(){l&&l.abort()}),c},clearCache:function(e){this.remove(e)}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(143),o=n.prototype,r=i(440),a=function(e,t,i){this.name="EmbedError",this.message=e,this.input=t,this.data=i,this.stack=(new Error).stack},l=n.extend({idAttribute:"query",url:"/svc/search/inline_gif",defaults:{query:"",limit:200,loggingContext:null},initialize:function(e,t){this.media=new r},fetch:function(e){var t=this.get("loggingContext"),i={q:this.get("query"),limit:this.get("limit")};return s.isEmpty(t)||s.extend(i,{context:t}),e=s.extend({type:"POST",withFormKey:!0,data:i},e),o.fetch.call(this,e)},parse:function(e,t){if(t&&t.xhr&&(e=(e||{}).response),s.isEmpty(e))throw new a("Invalid GIF search response",this.get("query"),e);return this.media.reset(e.media),delete e.media,e.ts=s.now(),e},toJSON:function(){var e=o.toJSON.apply(this,arguments);return e.media=this.media?this.media.toJSON():[],e}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(441),r=n.extend({model:o,previousFrom:function(e){return this.rotateFrom(e,-1)},nextFrom:function(e){return this.rotateFrom(e,1)},rotateFrom:function(e,t){for(var i=(s.isNumber(e)?this.at(e):this.findWhere({mediaUrl:e}))||this.sample(),n=this.indexOf(i)+t;n<0;)n+=this.length;return this.at(n%this.length)}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(143),o=i(217),r=n.extend({defaults:{mediaUrl:"",postUrl:"",rootPostUrl:"",rootPostUrlHash:"",rootBlog:"",rootBlogUrl:"",rootBlogKey:"",postTags:[],popularSearchTag:"",width:0,height:0},initialize:function(e,t){this.attributes={},this.set(s.defaults(o(e||{}),this.defaults))}});e.exports=r},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(467),r=i(232),a=(i(233),n.extend({name:"Upload",initialize:function(e){e=s.extend({},e),this.collection=e.collection||(e.collection=new r),this.indexView=new o(e),this.listenTo(this.collection,"all",this._relayCollectionEvent)},_relayCollectionEvent:function(){this.trigger.apply(this,arguments)},addFiles:function(e){return this.indexView.add({files:e})},promise:function(){return this.indexView.promise()},teardown:function(){return this.remove()},remove:function(){return this.indexView.remove(),this.stopListening(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el},getCurrentRequest:function(){return this.indexView.jqXHR}}));e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(6).sprintf,o=i(178),r=i(145),a=i(150),l=i(139),c=i(130),u=i(232),h=i(233),d=i(468),p=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],g=["add","send","progress","active","enable","disable"],_=o.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",message:{cancel:"Canceled upload",error:"Upload error",filesize:"The file is too big. Squish it down, and try again!",filetype:"This is not valid %1$s file."},fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(e,t){var i=new h(e);return this.collection.add(i,t||{}),i},_createUploadModelForFile:function(e,t,i){t=s.extend({file:e},t);var n=this._createUploadModel(t,i);return e._uploadModel=n,n},initialize:function(e){if(this.options=s.merge({},this.defaults,e),this.options.url&&(this.options.fileUpload.url=this.options.url),this.options.collection?this.collection=this.options.collection:this.collection=new u,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var t=s.merge({},this._fileUploadWrap);s.forEach(p,function(e){s.isFunction(t.defaults[e])||(t.defaults[e]=s.noop)},this);var i=new r(t);i.applyTo(this.options.fileUpload),s.forEach(p,function(e){this.options.fileUpload[e]=d(this.options.fileUpload[e],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),s.forEach(g,function(e){this[e]=function(){var t=s.toArray(arguments);t.unshift(e),this._fileUploadInvoke.apply(this,t)}},this)},_fileUploadInvoke:function(e){return this._fileUpload[e].apply(this._fileUpload,s.rest(arguments))},validateFile:function(e,t){t||(t=this.options);var i=[];return t.maxUploadSize&&e.size>t.maxUploadSize&&(l.trigger("postform-interaction:upload-limit-hit",{loggingData:{fileSize:e.size,fileType:e.type,maxSize:t.maxUploadSize}}),i.push({type:"filesize",message:n(t.message.filesize,t.maxUploadSize)})),t.uploadPattern&&e.type&&!t.uploadPattern.test(e.type)&&i.push({type:"filetype",message:n(t.message.filetype,t.mediaType)}),i},upload:function(e){this.add({files:[e]})},cancel:function(){var e;return this.jqXHR?(e=this.jqXHR.abort(),this.jqXHR=null):e=a.reject(this.options.message.cancel),e},_forMatchingFiles:function(e,t){var i=s.rest(arguments);this.collection.forEach(function(n){if(s.contains(e,n.get("file"))){var o=s.clone(i);o[0]=n,t.apply(this,o)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(e,t,i){this._fileUpload.options.replaceFileInput&&this.setElement(e)},add:function(e,t,i){var n=i.files[0],o=this.validateFile(n),r={},a={};if(!s.isEmpty(o)){r.error=s.pluck(o,"message"),r.file=n;var l={errorType:"validation",messages:o,file:n};this.collection.trigger("invalid",this.collection,new this.collection.model(r)),this.trigger("error",l),a.silent=!0}return this._createUploadModelForFile(n,r,a),s.isEmpty(o)},send:function(e,t,i){return!0}},before:{},after:{done:function(e,t,i){var n,o=s.get(i,"result.meta.status"),r=s.get(i,"result.response"),a=s.get(i,"result.errors");if(200!==o||s.isEmpty(r)){var l=function(){return r&&r.msg?r.msg:s.isArray(a)?s.isEmpty(a)?c("Woops :("):a:a.join(" ")}();n={error:l,uploading:!1}}else s.isArray(r)&&(r=r[0]),n=s.extend({complete:!0,uploading:!1},r);this._forMatchingFiles(i.files,function(e,t){e.set(t)},n)},fail:function(e,t,i){var n;n="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},n.responseJSON=s.get(i,"jqXHR.responseJSON"),this._forMatchingFiles(i.files,function(e,t){e.set(t)},n)},progress:function(e,t,i){this._forMatchingFiles(i.files,function(e,t){e.set(t)},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(e,t,i,n){var o=e.apply(this,s.rest(arguments));return o!==!1&&!i.isDefaultPrevented()&&((n.autoUpload||n.autoUpload!==!1&&this._fileUpload.options.autoUpload)&&n.process().done(s.bind(function(){this.jqXHR=n.submit()},this)),o)},send:function(e,t,i,n){n.withFormKey=!0;var o=e.apply(this,s.rest(arguments));if(o){this._forMatchingFiles(n.files,function(e,t){e.set(t)},{uploading:!0});var r={files:n.files};this.collection.trigger("send",this.collection,r),this.trigger("send",r)}return o}}}});e.exports=_},function(e,t,i){"use strict";var s=function(e,t){return t||(t=this),function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),e.apply(t,i)}};e.exports=s},,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";function s(){return o||(o=new r),o}function n(){return!!o}var o,r=i(488);e.exports={getInstance:s,hasInstance:n}},function(e,t,i){"use strict";function s(e,t){e instanceof o&&(e=e.get(0)),t instanceof o&&(t=t.get(0)),e&&t&&n.forEach(u,function(i){e.hasAttribute(i)&&t.setAttribute(i,e.getAttribute(i))})}var n=i(3),o=i(8),r=i(173),a=r.prototype,l=i(489),c=i(489).LivePhoto,u=["width","height","data-pin-url","data-pin-description"],h=r.extend({name:"LivePhotos",autoAppend:!0,initialize:function(){this.instances=[]},create:function(e){var t=e instanceof o?e:o(e);if(t.length){var i=t.closest("a, [data-lightbox]");if(i.length){var n,r;i.on("mousedown.livephoto touchstart.livephoto",function(){n=!1,i.prop("livePhotoSneezeguard",!0),r=setTimeout(function(){i.prop("livePhotoSneezeguard",!1),n=!0},750)}),i.on("click.livephoto",function(e){clearTimeout(r),n&&e.preventDefault()})}var a=new c(t.get(0));return this.instances.push(a),s(t,a.img),a}return null},remove:function(){return l.cleanup(),a.remove.call(this)},append:function(){return l.addStyles(),a.append.call(this)}});e.exports=h},function(e,t,i){!function(t,i){e.exports=i()}(this,function(){return function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function s(e,t){if(u){d&&n(),"object"==typeof e&&"[object Object]"===e.toString()&&(t=e,e=t.elements,delete t.elements),e||(e="img[data-live-photo]"),"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]);var i=[];return Array.prototype.forEach.call(e,function(e){if("string"==typeof e&&(e=document.querySelector(e)),e){var s=new l(e,t);i.push(s)}}),i}}function n(){c.use(),h++}function o(){d=!1}function r(){for(;h>0;)c.unuse(),h--}function a(e,t){return s(e,t)}var l=i(1),c=i(4),u=!0,h=0,d=!0;a.initialize=s,a.addStyles=n,a.noStyles=o,a.cleanup=r,a.LivePhoto=l,e.exports=a},function(e,t,i){function s(e,t,i,s){var n=document.createElement("video");return n.src=e+(i?"#"+i:""),n.controls=!1,n.muted=s||!1,n.preload="auto",t&&(n.className=t),c(n,!s),n}function n(e,t){if(e.paused){var i=e.muted,s=e.currentTime,n=function(){e.removeEventListener("loadedmetadata",n),e.currentTime=s,t&&t(e)};e.muted=!0,e.play(),e.pause(),e.muted=i,e.duration>=0?n():e.addEventListener("loadedmetadata",n)}}function o(e,t,i){var n=document.createElement("div");n.className="live-photo",n.setAttribute("data-live-photo","");var o=document.createElement("img");o.className="live-photo-keyframe",o.src=e;var r=s(t,"live-photo-postroll",i,!0),a=s(t,"live-photo-video"),l=document.createElement("i");return l.className="live-photo-icon",n.appendChild(o),n.appendChild(r),n.appendChild(a),n.appendChild(l),{container:n,img:o,postroll:r,video:a,icon:l}}function r(){var e=["mousedown"];return u&&e.push("touchstart"),e}function a(){var e=["mouseup","mouseout"];return u&&e.push("touchend"),e}function l(e,t,i,s){if(!(this instanceof l))return new l(e,t,i,s);var n,r;if(e instanceof HTMLElement&&(s=t,r=e,t=r.getAttribute("data-live-photo"),i=parseFloat(r.getAttribute("data-live-photo-still-image-time")),e=r.src),s||(s={}),this.postrollMs=s.postrollMs||375,this.deactivateMs=s.deactivateMs||500,this.previewMs=s.previewMs||500,this.stillImageTime=i||NaN,!e&&!s.noErrors)throw new Error("LivePhoto Error: Missing keyframeUrl");if(!t&&!s.noErrors)throw new Error("LivePhoto Error: Missing videoUrl");n=o(e,t,i),r&&(r.parentNode.insertBefore(n.container,r),r.parentNode.removeChild(r)),this.container=n.container,this.img=n.img,this.video=n.video,this.postroll=n.postroll,this.icon=n.icon,this.__onVideoCanPlayThrough=this._onVideoCanPlayThrough.bind(this),this.__onVideoLoadededMetadata=this._onVideoLoadededMetadata.bind(this),this.__onPostrollTimeUpdate=this._onPostrollTimeUpdate.bind(this),this.__startVideoPlayback=this._startVideoPlayback.bind(this),this.__startPostrollPlayback=this._startPostrollPlayback.bind(this),this.__resetPlayback=this._resetPlayback.bind(this),this.__resetPreview=this._resetPreview.bind(this),this.video.addEventListener("canplaythrough",this.__onVideoCanPlayThrough),this.video.duration?(this._setDuration(this.video.duration),this._resetPostroll()):(this._setDuration(0),this.video.addEventListener("loadedmetadata",this.__onVideoLoadededMetadata)),this._playing=!1,this._canPlayThrough=!1,this._playWhenReady=!1,s.useEventHandlers!==!1&&this._addEventHandlers(s.playEvents,s.stopEvents)}var c=i(2),u="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints;l.prototype={_addEventHandlers:function(e,t){var i=this.container,s=!1,o=this.play.bind(this),l=this.video,c=this.postroll,u=function(e){if(e.preventDefault(),s)o();else{var t=!1,i=!1;n(l,function(){t=!0,i&&o()}),n(c,function(){i=!0,t&&o()}),s=!0}};e&&e!==!1||(e=r),"function"==typeof e&&(e=e(this)),"string"==typeof e&&(e=e.split(/[,\s]+/)),e.forEach(function(e){e&&i.addEventListener(e,u)});var h=this.stop.bind(this),d=function(e){e.preventDefault(),h()};t&&t!==!1||(t=a),"function"==typeof t&&(t=t(this)),"string"==typeof t&&(t=t.split(/[,\s]+/)),t.forEach(function(e){e&&i.addEventListener(e,d)})},_onVideoCanPlayThrough:function(){this._canPlayThrough=!0,this._playWhenReady&&(this._playWhenReady=!1,this.play()),this.container.classList.remove("loading"),this.video.removeEventListener("canplaythrough",this.__onVideoCanPlayThrough)},_onVideoLoadededMetadata:function(){this._setDuration(this.video.duration||0),this._resetPostroll(),this.video.removeEventListener("loadedmetadata",this.__onVideoLoadededMetadata)},_onPostrollTimeUpdate:function(e){this.postroll.currentTime>=this.stillImageTime-.1&&this._resetPreview()},_clearTimeouts:function(){clearTimeout(this._resetVideoTimeout),clearTimeout(this._resetPostrollTimeout),clearTimeout(this._resetPreviewTimeout),this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate)},_setDuration:function(e){this.duration=e,("number"!=typeof this.stillImageTime||isNaN(this.stillImageTime))&&(this.stillImageTime=.5*e),this.previewStart=Math.max(0,this.stillImageTime-this.previewMs/1e3)},_resetPostroll:function(){this.postroll.pause(),this.postroll.currentTime=this.stillImageTime},_resetVideo:function(){this.video.pause(),this.video.currentTime=0,this.video.muted=!1},_startVideoPlayback:function(){this.video.play(),this._resetPostroll()},_startPostrollPlayback:function(){this._resetPostroll(),this.postroll.play()},_resetPlayback:function(){this._playing=!1,this._resetVideo(),this._resetPostroll()},_resetPreview:function(){this.postroll.removeEventListener("timeupdate",this.__onPostrollTimeUpdate),this._resetPostroll(),this.container.classList.remove("preview")},load:function(){this.video.load(),this.postroll.load()},play:function(){if(!this._playing){if(!this._canPlayThrough)return this._playWhenReady=!0,this._clearTimeouts(),this.load(),void this.container.classList.add("loading");this._playing=!0,this._clearTimeouts(),this._startPostrollPlayback(),this.video.currentTime=0,this._resetPostrollTimeout=setTimeout(this.__startVideoPlayback,this.postrollMs),this.container.classList.add("active")}},stop:function(){this._playing&&(this.video.muted=!0,this._clearTimeouts(),this.container.classList.remove("active"),this._resetVideoTimeout=setTimeout(this.__resetPlayback,this.deactivateMs))},preview:function(){this._playing||(this._clearTimeouts(),this.postroll.currentTime=this.previewStart,this.postroll.play(),this.container.classList.add("preview"),this._previewCompleteTimeout=setTimeout(this.__resetPreview,1e3*(this.stillImageTime-this.previewStart)),this.postroll.addEventListener("timeupdate",this.__onPostrollTimeUpdate))}},e.exports=l},function(e,t,i){/*! npm.im/iphone-inline-video */
"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function n(e){function t(n){i=requestAnimationFrame(t),e(n-(s||n)),s=n}var i,s;this.start=function(){i||t(0)},this.stop=function(){cancelAnimationFrame(i),i=null,s=0}}function o(e,t,i,s){function n(t){Boolean(e[i])===Boolean(s)&&t.stopImmediatePropagation(),delete e[i]}return e.addEventListener(t,n,!1),n}function r(e,t,i,s){function n(){return i[t]}function o(e){i[t]=e}s&&o(e[t]),Object.defineProperty(e,t,{get:n,set:o})}function a(e,t,i){i.addEventListener(t,function(){return e.dispatchEvent(new Event(t))})}function l(e,t){Promise.resolve().then(function(){e.dispatchEvent(new Event(t))})}function c(e){var t=new Audio;return a(e,"play",t),a(e,"playing",t),a(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}function u(e,t,i){(v||0)+200<Date.now()&&(e[k]=!0,v=Date.now()),i||(e.currentTime=t),S[++T%3]=100*t|0}function h(e){return e.driver.currentTime>=e.video.duration}function d(e){var t=this;t.video.readyState>=t.video.HAVE_FUTURE_DATA?(t.hasAudio||(t.driver.currentTime=t.video.currentTime+e*t.video.playbackRate/1e3,t.video.loop&&h(t)&&(t.driver.currentTime=0)),u(t.video,t.driver.currentTime)):t.video.networkState!==t.video.NETWORK_IDLE||t.video.buffered.length||t.video.load(),t.video.ended&&(delete t.video[k],t.video.pause(!0))}function p(){var e=this,t=e[w];return e.webkitDisplayingFullscreen?void e[C]():("data:"!==t.driver.src&&t.driver.src!==e.src&&(u(e,0,!0),t.driver.src=e.src),void(e.paused&&(t.paused=!1,e.buffered.length||e.load(),t.driver.play(),t.updater.start(),t.hasAudio||(l(e,"play"),t.video.readyState>=t.video.HAVE_ENOUGH_DATA&&l(e,"playing")))))}function g(e){var t=this,i=t[w];i.driver.pause(),i.updater.stop(),t.webkitDisplayingFullscreen&&t[x](),i.paused&&!e||(i.paused=!0,i.hasAudio||l(t,"pause"),t.ended&&(t[k]=!0,l(t,"ended")))}function _(e,t){var i=e[w]={};i.paused=!0,i.hasAudio=t,i.video=e,i.updater=new n(d.bind(i)),t?i.driver=c(e):(e.addEventListener("canplay",function(){e.paused||l(e,"playing")}),i.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){i.driver.paused=!0},play:function(){i.driver.paused=!1,h(i)&&u(e,0)},get ended(){return h(i)}}),e.addEventListener("emptied",function(){var t=!i.driver.src||"data:"===i.driver.src;i.driver.src&&i.driver.src!==e.src&&(u(e,0,!0),i.driver.src=e.src,t?i.driver.play():i.updater.stop())},!1),e.addEventListener("webkitbeginfullscreen",function(){e.paused?t&&!i.driver.buffered.length&&i.driver.load():(e.pause(),e[C]())}),t&&(e.addEventListener("webkitendfullscreen",function(){i.driver.currentTime=e.currentTime}),e.addEventListener("seeking",function(){S.indexOf(100*e.currentTime|0)<0&&(i.driver.currentTime=e.currentTime)}))}function f(e){var t=e[w];e[C]=e.play,e[x]=e.pause,e.play=p,e.pause=g,r(e,"paused",t.driver),r(e,"muted",t.driver,!0),r(e,"playbackRate",t.driver,!0),r(e,"ended",t.driver),r(e,"loop",t.driver,!0),o(e,"seeking"),o(e,"seeked"),o(e,"timeupdate",k,!1),o(e,"ended",k,!1)}function m(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0),i&&!y||e[w]||(_(e,t),f(e),e.classList.add("IIV"),!t&&e.autoplay&&e.play(),"MacIntel"!==navigator.platform&&"Windows"!==navigator.platform||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}var v,b=s(i(3)),y=/iPhone|iPod/i.test(navigator.userAgent)&&void 0===document.head.style.grid,w=b(),k=b(),C=b("nativeplay"),x=b("nativepause"),S=[],T=0;m.isWhitelisted=y,e.exports=m},function(e,t){"use strict";var i="undefined"==typeof Symbol?function(e){return"@"+(e||"@")+Math.random()}:Symbol;e.exports=i},function(e,t,i){var s,n=0,o=i(5);"string"==typeof o&&(o=[[e.id,o,""]]),t.use=t.ref=function(){return n++||(t.locals=o.locals,s=i(7)(o,{})),t},t.unuse=t.unref=function(){--n||(s(),s=null)}},function(e,t,i){t=e.exports=i(6)(),t.push([e.id,".live-photo {\n  position: relative;\n  overflow: hidden;\n  cursor: pointer; }\n  .live-photo video,\n  .live-photo img {\n    display: block;\n    max-width: 100%;\n    pointer-events: none;\n    -ms-touch-action: none;\n        touch-action: none; }\n  .live-photo video {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 100%; }\n    .live-photo video::-webkit-media-controls-start-playback-button {\n      display: none; }\n  .live-photo .live-photo-icon {\n    display: block;\n    position: absolute;\n    top: 12px;\n    left: 12px;\n    width: 24px;\n    height: 24px;\n    background: url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='48' height='48' viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Ctitle%3ELive Photo%3C/title%3E%3Cg fill-rule='evenodd'%3E%3Cpath d='M24 36c6.627 0 12-5.373 12-12s-5.373-12-12-12-12 5.373-12 12 5.373 12 12 12zm0-2c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z'/%3E%3Cpath d='M24 29a5 5 0 1 0 0-10 5 5 0 0 0 0 10zm0-3a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.788.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462 1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.849 4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-.63 4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-1.85 4.461a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94 3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831 2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462 1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM24 44a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.788-.63a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-4.462-1.85a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm-2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM6.13 30.288a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 25.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm.63-4.788a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm1.85-4.462a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm2.94-3.831a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm3.831-2.94a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4.462-1.849a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z'/%3E%3C/g%3E%3C/svg%3E\") center center;\n    background-size: contain;\n    -webkit-filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.5));\n            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.5));\n    pointer-events: none; }\n  .live-photo .live-photo-postroll,\n  .live-photo .live-photo-video {\n    opacity: 0; }\n  .live-photo .live-photo-video {\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  .live-photo .live-photo-keyframe,\n  .live-photo .live-photo-postroll,\n  .live-photo .live-photo-video {\n    will-change: transform, filter, opacity;\n    transition: opacity 0.5s linear, -webkit-transform 0.5s ease-out, -webkit-filter 0.5s linear;\n    transition: transform 0.5s ease-out, filter 0.5s linear, opacity 0.5s linear;\n    transition: transform 0.5s ease-out, filter 0.5s linear, opacity 0.5s linear, -webkit-transform 0.5s ease-out, -webkit-filter 0.5s linear; }\n  .live-photo.loading .live-photo-icon {\n    -webkit-animation: live-photo-icon-loading 0.5s linear alternate infinite both;\n            animation: live-photo-icon-loading 0.5s linear alternate infinite both; }\n  .live-photo.preview .live-photo-postroll {\n    opacity: 1;\n    transition-duration: 0s; }\n  .live-photo.active video,\n  .live-photo.active img {\n    -webkit-transform: scale(1.075, 1.075);\n        -ms-transform: scale(1.075, 1.075);\n            transform: scale(1.075, 1.075); }\n  .live-photo.active .live-photo-postroll {\n    -webkit-animation: live-photo-post-roll 1s both;\n            animation: live-photo-post-roll 1s both; }\n  .live-photo.active .live-photo-video {\n    opacity: 1;\n    -webkit-filter: none;\n            filter: none;\n    transition-delay: 0.375s;\n    transition-duration: 0.625s; }\n\n@-webkit-keyframes live-photo-icon-loading {\n  0% {\n    opacity: 1; }\n  100% {\n    opacity: 0.75; } }\n\n@keyframes live-photo-icon-loading {\n  0% {\n    opacity: 1; }\n  100% {\n    opacity: 0.75; } }\n\n@-webkit-keyframes live-photo-post-roll {\n  0% {\n    opacity: 0;\n    -webkit-filter: blur(0);\n            filter: blur(0); }\n  2% {\n    opacity: 1; }\n  37.5% {\n    opacity: 1;\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  100% {\n    opacity: 0; } }\n\n@keyframes live-photo-post-roll {\n  0% {\n    opacity: 0;\n    -webkit-filter: blur(0);\n            filter: blur(0); }\n  2% {\n    opacity: 1; }\n  37.5% {\n    opacity: 1;\n    -webkit-filter: blur(7.5px);\n            filter: blur(7.5px); }\n  100% {\n    opacity: 0; } }\n",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t];i[2]?e.push("@media "+i[2]+"{"+i[1]+"}"):e.push(i[1])}return e.join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var s={},n=0;n<this.length;n++){var o=this[n][0];"number"==typeof o&&(s[o]=!0)}for(n=0;n<t.length;n++){var r=t[n];"number"==typeof r[0]&&s[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(e,t,i){function s(e,t){for(var i=0;i<e.length;i++){var s=e[i],n=p[s.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](s.parts[o]);for(;o<s.parts.length;o++)n.parts.push(c(s.parts[o],t))}else{for(var r=[],o=0;o<s.parts.length;o++)r.push(c(s.parts[o],t));p[s.id]={id:s.id,refs:1,parts:r}}}}function n(e){for(var t=[],i={},s=0;s<e.length;s++){var n=e[s],o=n[0],r=n[1],a=n[2],l=n[3],c={css:r,media:a,sourceMap:l};i[o]?i[o].parts.push(c):t.push(i[o]={id:o,parts:[c]})}return t}function o(e,t){var i=f(),s=b[b.length-1];if("top"===e.insertAt)s?s.nextSibling?i.insertBefore(t,s.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),b.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(t)}}function r(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function a(e){var t=document.createElement("style");return t.type="text/css",o(e,t),t}function l(e){var t=document.createElement("link");return t.rel="stylesheet",o(e,t),t}function c(e,t){var i,s,n;if(t.singleton){var o=v++;i=m||(m=a(t)),s=u.bind(null,i,o,!1),n=u.bind(null,i,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(t),s=d.bind(null,i),n=function(){r(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(t),s=h.bind(null,i),n=function(){r(i)});return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else n()}}function u(e,t,i,s){var n=i?"":s.css;if(e.styleSheet)e.styleSheet.cssText=y(t,n);else{var o=document.createTextNode(n),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function h(e,t){var i=t.css,s=t.media;if(s&&e.setAttribute("media",s),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function d(e,t){var i=t.css,s=t.sourceMap;s&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var n=new Blob([i],{type:"text/css"}),o=e.href;e.href=URL.createObjectURL(n),o&&URL.revokeObjectURL(o)}var p={},g=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},_=g(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),f=g(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,v=0,b=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=_()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var i=n(e);return s(i,t),function(e){for(var o=[],r=0;r<i.length;r++){var a=i[r],l=p[a.id];l.refs--,o.push(l)}if(e){var c=n(e);s(c,t)}for(var r=0;r<o.length;r++){var l=o[r];if(0===l.refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete p[l.id]}}}};var y=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()}])})},,,,,,,,,,,,function(e,t){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;e.exports=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(539);e.exports=s},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var n=i(185),o=s(n),r=i(3),a=s(r),l=i(540),c=s(l),u=i(8),h=s(u),d=i(139),p=s(d),g=o.default.extend({className:"native-audio-container",template:c.default,events:{"click .play-pause":"playPause","mousedown .audio-player":"onMouseDown","mousemove .audio-player":"onMouseMove","mouseup .audio-player":"onMouseUp","mouseleave .audio-player":"onMouseLeave"},initialize:function(e){e=e||{},this.streamUrl=e.streamUrl+"?plead=please-dont-download-this-or-our-lawyers-wont-let-us-host-audio",this.playing=!1,this.track=e.track,this.artist=e.artist,this.albumArt=e.albumArt,this.preview=e.preview,this.noId3=e.noId3,this.model=e.model,this.dragging=!1,this.mousedown=!1},render:function(){this.$el.html(this.template({post:this.model,streamUrl:this.streamUrl,track:this.track,artist:this.artist,albumArt:this.albumArt,noId3:this.noId3}));var e=this.$("audio"),t=this.$(".audio-source");return this.player=e[0],this.icon=this.$(".icon"),this.progress=this.$(".progress"),this.$player=this.$(".audio-player"),this.artist||this.track||this.$(".track-no-id3").css("display","block"),e.on("playing",a.default.bind(this.onPlay,this)),e.on("pause",a.default.bind(this.onPause,this)),e.on("timeupdate",a.default.bind(this.onTimeUpdate,this)),e.on("error",a.default.bind(this.onError,this)),t.on("error",a.default.bind(this.onError,this)),this.listenTo(p.default,"NativeAudio:play",this.stopOtherAudio),this},onPlay:function(){this.model&&p.default.trigger("NativeAudio:play",this.model.get("id")),this.icon.removeClass("icon_play").addClass("icon_pause"),this.playing=!0},stopOtherAudio:function(e){this.model&&this.model.get("id")!==e&&(this.pause(),this.setPlayerTime(0))},onMouseDown:function(e){(0,h.default)(e.target).hasClass("play-pause")||(this.mousedown=!0),this.dragging=!1},onError:function(){this.icon.removeClass("icon_pause icon_play").addClass("icon_close"),this.$el.addClass("error"),this.undelegateEvents()},onMouseMove:function(e){if(this.mousedown){this.dragging=!0,this.playing&&this.pause();var t=(0,h.default)(e.target),i=void 0;if(t.hasClass("audio-player"))i=e.offsetX/this.$player.outerWidth()*this.player.duration;else{var s=t.closest(".audio-player").offset();i=(e.pageX-s.left)/this.$player.outerWidth()*this.player.duration}this.setPlayerTime(i)}},onMouseUp:function(e){var t=(0,h.default)(e.target);if(this.playing){if(this.mousedown&&!this.dragging&&t.hasClass("audio-player")){var i=e.offsetX/this.$player.outerWidth()*this.player.duration;this.setPlayerTime(i)}}else this.play();this.mousedown=!1,this.dragging=!1},onMouseLeave:function(e){this.mousedown=!1,this.dragging=!1},onPause:function(){this.icon.removeClass("icon_pause").addClass("icon_play"),this.playing=!1},afterRender:function(){this.$el.toggleClass("audio-player--preview-player",this.preview)},playPause:function(e){e.stopPropagation(),this.playing?this.pause():this.play()},play:function(){this.player.play()},pause:function(){this.player.pause()},setPlayerTime:function(e){isNaN(e)||(this.player.currentTime=e)},teardown:function(){(0,h.default)(this.player).off()},onTimeUpdate:function(){this.player.currentTime===this.player.duration?this.progress.css("width",0):this.progress.css("width",this.player.currentTime/this.player.duration*100+"%")}});e.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="audio-player',albumArt&&(__p+=" has-art "),__p+='"><div class="progress"></div><div class="play-pause"><i class="icon icon_play"></i></div><div class="audio-info" ondragstart="return false;" ondrop="return false;"><div class="track-name">'+__e(track)+'</div><div class="track-artist">'+__e(artist)+'</div><div class="track-no-id3">'+__e(noId3)+'</div></div><audio preload="auto"><source class="audio-source" src="'+__e(streamUrl)+'"></audio></div> ',albumArt&&(__p+=' <div class="audio-image"><img src="'+__e(albumArt)+'" alt="'+__e(track)+'"></div> ');return __p}.toString()).apply(void 0,_values(_imports))},,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(549),r=i(428),a=i(174),l=i(189),c=i(137),u=i(139),h=i(550),d=i(551),p=a.extend({mixins:[l],defaults:{loaded:!1,paused:!0,muted:!0,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:1,isAd:!1,isInPeepr:!1,isFullscreen:!1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(e,t){this._id=s.uniqueId("crtplayer"),this.initialize(e,t)},initialize:function(e,t){t||(t={}),s.isObject(t.attributes)&&this.set(t.attributes),this.video=e,this.$video=n(this.video);var i=this.$video.data("crt-options")||{};this.$video.removeAttr("data-crt-options"),this.vjsOptions=s.defaults({crt:this,crtOptions:i},t.vjsOptions||{}),i&&i.duration&&this.set("duration",i.duration),this.vjsOptions.crtOptions.livestream&&(this.set("autoplay",!0),this.set("minLoopDuration",60)),r.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return r.write(function(){d(this.video,this.vjsOptions).then(s.bind(this.ready,this))},this),this},ready:function(e){this.player=e,this.player.muted(this.get("muted")),this.el=e.player_.el(),this.$el=n(this.el),this.$post=this.$el.closest(".post, .video-ad"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setLoopState(!0),this.setAutoheightState(s.get(this.vjsOptions,"crtOptions.autoheight")),this.setFullscreenControl(!h.prop("requestFullscreen")),this.shouldForceHD()&&this.player.src({src:this.vjsOptions.crtOptions.hdUrl,type:"video/mp4"}),this.get("watch")&&this.setupWatcher(),this.get("loaded")===!0||this.vjsOptions.crtOptions.livestream||this.player.load()},_bindEvents:function(){this.listenTo(u,"peepr:open",this.pause),this.listenTo(u,"post:form:show",this.pause),this.listenTo(u,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.one("loadedmetadata",s.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",s.bind(this.onUpdateDuration,this)),this.player.on("play",s.bind(this.onPlay,this)),this.player.on("pause",s.bind(this.onPause,this)),this.player.on("ended",s.bind(this.onEnded,this)),this.player.on("fullscreenchange",s.bind(this.onFullscreenChange,this)),this.player.on("error",s.bind(this.onError,this))},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(s.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(s.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(s.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()},this))},onClickPlayer:function(e){n(e.target).closest(".vjs-mute-control").length||n(e.target).closest(".vjs-fullscreen-control").length||this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||"undefined"==typeof this.player||null==this.player||(this.onTimeUpdate(),setTimeout(s.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return!(!this.get("autoplay")||c.bool("is_mobile")||!this.$el.is(":visible")||!(this.get("duration")>this.get("minLoopDuration")||0===this.get("duration")||this.vjsOptions.crtOptions.livestream))},shouldForceHD:function(){return!(!this.vjsOptions.forceHD||!this.vjsOptions.crtOptions.hdUrl)},play:function(e){e||(e={}),this.player.paused()&&(this.player.play(),e.skipLog||(e.type="userPlay",this.player.trigger(e)))},pause:function(e){e||(e={}),this.player.paused()||(this.player.pause(),e.skipLog||this.player.trigger("pause"))},onPlay:function(){this.set("paused",!1),this.pollTimeUpdate()},onPause:function(){this.set("paused",!0)},onUpdateDuration:function(e){this.set("duration",this.player.duration())},onLoadedMetadata:function(e){var t=this.shouldAutoplay();this.setMutedState(t),this.setAutoplayState(t),t&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",s.bind(this.onClickPlayer,this)),u.trigger("CrtPlayer:ready",this),this.trigger("playerReady",this),this.trigger("ready",this),this.set("loaded",!0)},onEnded:function(e){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("loop"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("end"))},onError:function(e){this.set("paused",!0),this.set("loop",!1),this.set("autoplay",!1),this.trigger("error",e)},onChangeAutoplay:function(e,t,i){this.setAutoplayState(t,i)},onChangeAutoheight:function(e,t){this.setAutoheightState(t)},onChangeDuration:function(e,t){this.setLoopState(!0)},onChangeLoop:function(e,t){this.setLoopState(t)},onChangeMuted:function(e,t){this.player.muted(t)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(e){s.isEmpty(e.embedID)||this.playerID===e.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(e){s.isUndefined(e)&&(e=this.get("loop")),this.set("loop",e),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(e){s.isUndefined(e)&&(e=this.get("muted")),this.set("muted",e)},setAutoplayState:function(e){s.isUndefined(e)&&(e=this.get("autoplay")),this.set("autoplay",e),this.toggleAttrClass("autoplay",e),!e&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(e){(s.isUndefined(e)||s.isNull(e))&&(e=this.get("autoheight")),this.set("autoheight",e),this.toggleAttrClass("autoheight",e)},setFullscreenControl:function(e){s.isUndefined(e)&&(e=this.get("hideFullscreen")),this.set("hideFullscreen",e),this.toggleAttrClass("hideFullscreen",e)},onTimeUpdate:function(){var e=.3,t=this.get("_position"),i=this.player.currentTime(),s=Math.abs(t-i);s<e&&this.set("_elapsed",this.get("_elapsed")+s),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},getPosition:function(){return Math.floor(this.get("_position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(e,t){this.classNames[e]&&r.write(function(){this.$el.toggleClass(this.classNames[e],t)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(),this.player=null)}});e.exports=p},,function(e,t,i){"use strict";var s=i(3),n=i(174),o={requestFullscreen:["requestFullScreen"]},r=n.extend({vendors:["moz","webkit","ms","o","khtml"],cssPrefixes:["-moz-","-webkit-","-ms-","-o-","",""],el:document.body||document.documentElement,get:s.memoize(function(e){var t=this._getProp(e);return!t&&o[e]&&s.each(o[e],function(e){var i=this._getProp(e);i&&(t=i)},this),t}),prop:function(e){return!!this.get(e)},cssFilters:s.memoize(function(){var e=document.createElement("div");return e.style.cssText=this.cssPrefixes.join("filter:blur(5px); "),!!e.style.length}),_getProp:function(e){var t=!1;return"string"==typeof this.el[e]?e:"string"==typeof this._styles()[e]?e:(e=e.charAt(0).toUpperCase()+e.substr(1),s.forEach(this.vendors,function(i){var s=i+e;s in this.el&&(t=s),s in this._styles()&&(t=s)},this),t)},_styles:s.memoize(function(){return this.el.style})});e.exports=new r},function(e,t,i){"use strict";function s(e,t){var i=n.merge({},g(),t);t.crtOptions.techOrder&&(i.techOrder=t.crtOptions.techOrder);var s=r.defer(),a=function(){var e;t.src&&t.type?(this.src(t),s.resolve(this)):t.file?(e=t.file.type||"video/mp4",this.src({src:l(t.file),type:e}),s.resolve(this),delete t.file):s.resolve(this)},c=o(e,i,a);return"function"==typeof c.skippy&&c.skippy(),s.promise}var n=i(3),o=i(552);window.videojs=o;var r=i(150),a=i(129),l=i(501),c=i(553),u=i(558),h=i(559);o.registerComponent("BigPlayToggle",i(560)),o.registerComponent("AnimatingMuteToggle",i(561)),o.registerComponent("CrtSeekBar",i(563)),o.registerComponent("LoadingSpinner",i(564)),o.registerComponent("HDToggle",i(565)),o.registerComponent("CrtDurationDisplay",i(566)),o.log=n.noop,o.log.error=n.noop,o.log.warn=n.noop,o.log.history=[];var d=function(e){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new c(this,e),this.detectBuffering=new u(this,e),this.eventDispatcher=new h(this,e)};o.plugin("crt",d);var p,g=function(){var e=a.get("Context/hosts");return p||(p={children:["mediaLoader","posterImage","bigPlayToggle","loadingSpinner",{name:"controlBar",children:["playToggle","timeDivider","crtDurationDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle"]},"errorDisplay"],hls:{withCredentials:!1},plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null,livestream:!1},controls:!0,autoplay:!1,volume:.8,muted:!0,flash:{swf:e.assets_host+"/assets/scripts/vendor/video-js/video-js-swf-5.10.4.swf"},techOrder:["html5","flash"]}),p};e.exports=s},,function(e,t,i){"use strict";var s=i(3),n=i(552),o=i(554),r=i(555),a=i(556),l=i(557),c=n.extend(o,{elSelector:".vjs-progress-holder",initialize:function(e,t){this.children={},this.$el=this.$$(this.elSelector),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,s.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,s.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,s.bind(this.onMouseOut,this)),this.player.on("dispose",s.bind(this.dispose,this))},createChildren:function(){this.children.hoverSliderHandle=new r(this.player),this.children.hoverSliderTime=new a(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new l(this.player)),this.appendChildren()},appendChildren:function(){s.each(this.children,s.bind(function(e){this.$el.append(e.render().$el)},this))},updateChildren:function(e){s.each(this.children,function(t){t.update(e)})},onMouseMove:function(e){this.$el.removeClass("auto-hide");var t=this.$el.offset(),i=this.$el.width(),s=e.pageX-t.left,n=Math.max(0,Math.min(1,(e.pageX-t.left)/i)),o=n*this.player.player().duration(),r=o/this.player.player().duration();s<0?s=0:s>i&&(s=i),this.updateChildren({hoverX:s,hoverTime:o,hoverPercent:r})},onMouseOut:function(e){this.$el.addClass("auto-hide")},onMouseEnter:function(e){this.$el.removeClass("auto-hide")},dispose:function(){s.each(this.children,function(e){s.result(e,"dispose")}),o.prototype.dispose.apply(this,arguments)}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(552),r=o.getComponent("Component"),a=o.extend(r,{constructor:function(e,t){this.options=t||{},this.player=e,this.$player=n(this.player.el()),this._selectorCache(),this.player.on("dispose",s.bind(this.dispose,this)),this.player.ready(s.bind(function(){this.initialize.apply(this,arguments)},this))},_selectorCache:function(){this.$$=s.memoize(function(e){return this.$player.find(e)},s.identity),this.$$.remove=s.bind(function(e){this.$$.cache.delete(e)},this),this.$$.clear=s.bind(function(){this.$$.cache=new s.memoize.Cache},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});e.exports=a},function(e,t,i){"use strict";var s=i(8),n=i(552),o=i(554),r=n.extend(o,{seeking:!1,render:function(){return this.$el=s('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},update:function(e){e||(e={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var t=e.hoverX||0,i=e.hoverTime||"0:00",s=n.formatTime(i);this.$time_el.html(s),this.$el.css("left",t+"px")}});e.exports=r},function(e,t,i){"use strict";var s=i(8),n=i(552),o=i(554),r=n.extend(o,{render:function(){return this.$el=s('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(e){e||(e={});var t=e.hoverX||0,i=e.hoverTime||"0:00",s=n.formatTime(i);this.$el.html(s),this.$el.css("left",t+"px")}});e.exports=r},function(e,t,i){"use strict";var s=i(8),n=i(552),o=i(554),r=n.extend(o,{filmstrip_thumbnail_count:10,render:function(){var e=this.player.options_.crtOptions.filmstrip,t=e.url,i=.5*e.width,n=.5*e.height,o=6;return this.$el=s('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=s('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:i+o+"px",height:n+o+"px"}),this.$thumbnail.css({width:i+"px",height:n+"px","background-image":"url("+t+")","background-size":i*this.filmstrip_thumbnail_count+"px "+n+"px"}),this.$el.append(this.$thumbnail),this},update:function(e){e||(e={});var t=e.hoverX||0;this.$el.css("left",t+"px");var i=isNaN(e.hoverPercent)?0:100*e.hoverPercent,s=100/(this.filmstrip_thumbnail_count-1),n=Math.floor(i/this.filmstrip_thumbnail_count)*s;this.$thumbnail.css("background-position",n+"% 0%")}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(552),o=i(554),r=n.extend(o,{elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(e,t){this.player.on("play",s.bind(this.startPolling,this)),this.player.on("ended",s.bind(this.stopPolling,this)),this.player.on("pause",s.bind(this.stopPolling,this)),this.player.one("dispose",s.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var e=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+e&&!this.player.paused()&&(this.lastWaitedTime=s.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+e&&!this.player.paused()){var t=s.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:t}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.checkBuffering(),s.delay(s.bind(this.tick,this),this.interval))},startPolling:function(e){this.polling||(this.polling=!0,this.tick())},stopPolling:function(e){this.polling=!1}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(552),r=i(139),a=i(137),l=i(554),c=o.extend(l,{videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,loadStartTime:0,triggerElement:n(),initialize:function(e,t){this.player.crt.on("playerReady",s.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData(),this.playerData.duration=this.player.duration(),this.player.options_.crtOptions["hls-service"]&&(s.isFinite(this.playerData.duration)?this.playerData.type="replay":this.playerData.type="live")},this)),this.$doc=n(document)},setPlayerData:function(){
var e=this.player.crt.$post.data("json");if(this.playerData={postData:e,platform:"web",app_version:null,type:"video",post_id:null,root_post_id:null,blog_uuid:null,vendor:null,duration:this.player.crt.get("duration"),time_elapsed:null},"undefined"!=typeof e)this.playerData.post_id=e["post-id"],this.playerData.root_post_id=e.root_id,this.playerData.blog_uuid=e.tumblelog;else{var t=this.player.options_.crtOptions;"undefined"!=typeof t["iframe-post-data"]&&(this.playerData.post_id=t["iframe-post-data"].post_id,this.playerData.blog_uuid=t["iframe-post-data"].blog);var i=t["hls-service"];i&&(this.playerData.type="live",this.playerData.vendor=i)}},bindEvents:function(){this.$player.on("mousedown touchstart",s.bind(this.setTriggerElement,this)),this.player.on("userPlay",s.bind(this.onUserPlay,this)),this.player.on("play",s.bind(this.onVJSPlay,this)),this.player.on("pause",s.bind(this.onVJSPause,this)),this.player.on("loop",s.bind(this.onLooped,this)),this.player.on("end",s.bind(this.onVideoEnded,this)),this.player.on("restart",s.bind(this.onRestart,this)),this.player.on("muteClicked",s.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",s.bind(this.onFullscreenChange,this)),this.player.on("error",s.bind(this.onError,this)),this.player.on("seeking",s.bind(this.onSeeking,this)),this.player.on("resolutionchange",s.bind(this.onResolutionChange,this)),this.player.on("timeupdate",s.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",s.bind(this.onStopWaiting,this)),this.player.on("firstplay",s.bind(this.onLoadStart,this)),this.player.on("loadeddata",s.bind(this.onLoadedData,this))},triggerEvent:function(e,t){t=this._buildLoggingData(t),r.trigger("VideoPlayer:"+e,{loggingData:t})},_buildLoggingData:function(e){return e=s.extend({},this.playerData,e),e.time_elapsed=this.player.crt.getElapsed(),e.position=this.player.crt.getPosition(),e},setTriggerElement:function(e){this.triggerElement=n(e.target)},onLogComplete:function(){this.triggerElement=n()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(e){var t=this.player.error(),i="MEDIA_ERR_CUSTOM";if(t){switch(t.code){case 1:i="MEDIA_ERR_ABORTED";break;case 2:i="MEDIA_ERR_NETWORK";break;case 3:i="MEDIA_ERR_DECODE";break;case 4:i="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:i="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("failed",{code:t.code,name:i})}},onUserPlay:function(e){this.onPlay(!0,e)},onVJSPlay:function(e){this.onPlay(!1,e)},onPlay:function(e,t){if(e||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),s={};t.onDock&&(s.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"auto_play":"play",s),this.onLogComplete()}},onVJSPause:function(){this.onPause(!1)},onPause:function(e){(e||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("loop")},onVideoEnded:function(){this.triggerEvent("end")},onRestart:function(e){var t=s.pick(e,["start","end"]);this.triggerEvent("restart",t)},onFullscreenChange:function(){var e=this.player.isFullscreen();this.triggerEvent("fullscreen",{fullscreen:e}),this.player.crt.set("isFullscreen",e),this.onLogComplete()},onMuteClicked:function(){var e=this.player.muted()?"mute":"unmute";this.triggerEvent(e),this.player.crt.set("muted","mute"===e),this.onLogComplete()},onSeeking:function(){if(0!==this.triggerElement.closest(".vjs-progress-control").length){this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition());var e={start:this.startSeekTime};this.triggerEvent("scrub_start",e),this.$doc.one("mouseup.crtEvents touchend.crtEvents",s.bind(this.onSeeked,this))}},onSeeked:function(){if(this.startSeekTime){var e={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("scrub_stop",e),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(e){var t=s.pick(e,"resolution");this.triggerEvent("resolutionchange",t)},onStopWaiting:function(e,t){!t.timeWaited||t.timeWaited<2e3||this.triggerEvent("waiting",t)},onLoadStart:function(){this.loadStartTime=s.now()},onLoadedData:function(){var e=s.now()-this.loadStartTime;this.triggerEvent("initialLoad",{loadTime:e})},logConversion:function(e){if(!this.videoConversionLogged&&a.bool("is_logged_in")&&!this.loggingInProgress){this.loggingInProgress=!0;var t=n.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",withFormKey:!0,data:"log="+JSON.stringify(e)});t.done(s.bind(this.onConversionSuccess,this)),t.fail(s.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});e.exports=c},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(552),r=i(179).animation,a=o.getComponent("ClickableComponent"),l=o.extend(a,{constructor:function(){a.prototype.constructor.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return a.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>'},{"aria-label":"play video"})},handleClick:function(){this.$el=this.$el||s(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.player().controls(!0)):this.togglePlay()},togglePlay:function(){r(this.$el,n.bind(function(e){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player().pause(),this.$el.removeClass("poof-play").addClass("poof-pause"))},ready:function(){"Flash"===this.player().techName_&&this.hide()}});e.exports=l},function(e,t,i){"use strict";var s=i(552),n=i(562),o=s.getComponent("MuteToggle"),r=s.getComponent("ClickableComponent"),a=s.extend(o,{constructor:function(e,t){o.prototype.constructor.call(this,e,t),this.addListeners(e)},addListeners:function(e){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var e="vjs-mute-control vjs-control";return this.player_.options_.muted&&(e+=" vjs-vol-0"),r.prototype.createEl.call(this,"div",{className:e,innerHTML:n()},{})},update:function(){var e=this.player_.volume(),t=3;0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2),this.controlText(this.player_.muted()?"Unmute":"Mute");for(var i=0;i<4;i++)s.removeClass(this.el_,"vjs-vol-"+i);s.addClass(this.el_,"vjs-vol-"+t)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(552),n=i(3),o=s.getComponent("SeekBar"),r=s.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.handle=document.createElement("div"),this.handle.className="vjs-seek-handle vjs-slider-handle",this.handle.setAttribute("aria-live","off"),this.el_.appendChild(this.handle),this.boundDetectDuration=n.bind(this.detectDuration,this),this.player().on("loadedmetadata",this.boundDetectDuration)},handleMouseMove:function(e){o.prototype.handleMouseMove.apply(this,arguments),this.update()},detectDuration:function(){n.isFinite(this.player().duration())||null==this.el_||this.dispose()},update:function(){if(this.el_){var e=this.getPercent();isNaN(e)&&(e=0);var t=(100*e).toFixed(2)+"%";this.handle.style.left=t,this.bar.el().style.width=t}},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});e.exports=r},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(552),r=o.getComponent("Component"),a=o.extend(r,{isHidden:!0,constructor:function(e,t){r.call(this,e,t),e.ready(n.bind(this.onReady,this))},onReady:function(){this.$player=s(this.player().el_),this.$el=s(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var e=n.bind(this.hideLoader,this),t=n.bind(this.showLoader,this);this.player().on("waiting",t),this.player().on("canplay",e),this.player().on("canplaythrough",e),this.player().on("playing",e),this.player().on("seeking",t),this.player().on("seeked",e),this.player().on("ended",e),this.player().on("resolutionchange",t)},createEl:function(){return r.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>'},{"aria-label":"loading"})},hideLoader:function(e){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(e){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){r.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(552),o=n.getComponent("Component"),r=n.extend(o,{sdURL:null,hdURL:null,forceHD:null,isUsingSD:!0,timeIntervalBinding:null,constructor:function(e,t){o.prototype.constructor.call(this,e,t),this.addListeners(e)},addListeners:function(e){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,this.forceHD=this.player_.options_.forceHD,!this.hdURL||this.forceHD)return o.prototype.createEl.call(this,"div",{},{});this.player_.addClass("vjs-has-hd-toggle");var e=o.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"},{});return e},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var e;this.isUsingSD?(this.sdURL=this.currentSource(),e=this.hdURL,n.removeClass(this.el_,"vjs-sd"),n.addClass(this.el_,"vjs-hd")):(e=this.sdURL,n.removeClass(this.el_,"vjs-hd"),n.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src({src:e,type:"video/mp4"})},toggleHDState:function(){var e=this.player_.currentTime(),t=this.player_.paused(),i=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"}),s.delay(s.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",s.bind(function(){this.player_.currentTime(e)},this)),this.timeIntervalBinding=s.bind(function(){this.player_.currentTime()-e>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),t&&(this.player_.pause(),this.player_.muted(i)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),s.defer(s.bind(function(){this.player_.load(),i===!1&&t===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});e.exports=r},function(e,t,i){"use strict";var s=i(552),n=i(3),o=s.getComponent("DurationDisplay"),r=s.extend(o,{constructor:function(){o.prototype.constructor.apply(this,arguments),this.boundDetectDuration=n.bind(this.detectDuration,this),this.player().on("loadedmetadata",this.boundDetectDuration)},detectDuration:function(){n.isFinite(this.player().duration())||null==this.el_||this.dispose()},dispose:function(){this.player().off("loadedmetadata",this.boundDetectDuration),o.prototype.dispose.apply(this,arguments)}});e.exports=r},,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(194).animate,o=i(178),r=i(200),a=i(235),l=i(236),c=i(189),u=o.extend({className:"post-forms-glass",mixins:[a,l,c],initialize:function(e){this.options=e=s.extend({active:!1,visible:!1},e),this.set({active:!!e.active,visible:!!e.visible}),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(e){return this.set("active",!(null!=e&&!e)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(e){return this.set("active",!(null==e&&!e)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var e=this._showing=n(this.$el,{opacity:1},{duration:r(150),display:"block"});return e},_hide:function(){var e=this._hiding=n(this.$el,{opacity:0},{duration:r(150),display:this.get("active")?"block":"none"});return e},_changeActive:function(e,t){t?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||s.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(e,t){t?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});e.exports=u},function(e,t,i){"use strict";var s=i(8),n=i(194).animate,o=i(178),r=i(200),a=i(235),l=i(236),c=i(189),u=i(581),h=o.extend({className:"post-forms-modal",mixins:[a,l,c],template:u,initialize:function(e){this.set("visible",e&&e.visible),this.get("visible")?this.$el.css({opacity:1,display:"block"}):this.$el.css({opacity:0,display:"none"}),this.$body=s("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(e){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=e,this.listenTo(e,"prepared",this._onSubViewPrepare),this.listenTo(e,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onSubViewPrepare:function(e){this.show()},_onSubViewTeardown:function(e){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var e=n(this.$el,{opacity:1},{duration:r(100),display:"block"});return e},_hide:function(){this._enableBodyScroll();var e=n(this.$el,{opacity:0},{duration:r(100),display:"none"});return e},_toggleVisible:function(e,t){t?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(194).animate,r=i(197),a=i(200),l=i(199),c=i(178),u=(i(132),i(235)),h=i(236),d=i(189),p=i(583),g=i(584),_=i(586),f=c.extend({mixins:[u,h,d,l],template:_,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(e){e instanceof c&&(e={postForm:e}),this.options=e=s.extend({},this.defaultOptions,e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),e.postForm&&this.setPostForm(e.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(e,t){o(this.$el,"stop"),t||s.isNumber(t)?o(this.$el,{"min-height":t},{duration:a(Math.min(Math.max(250,t),750))}):(t=s.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,t]},{duration:a(Math.min(Math.max(250,t),750))}).then(s.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(e,t){t?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(e,t){t?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(e){if(this._postFormComponent!==e)return this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=e,this.postForm=e.postForm,this},prepare:function(e){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=s.delay(s.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(e).then(s.bind(function(){return this._hideOriginalContent=!1,this},this))),n.resolve(this)},attach:function(e){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),n.resolve(this)},hideOriginalContent:function(e){var t=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return t||this.options.originalContent||(t=i),r([function(){null!=t&&this.$el.css("height",t),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return n.join(e(),this.originalContent.animateHide(a(100)))}],this)},showPostForm:function(e){var t=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return t||this.options.originalContent||(t=i),r([function(){if(!this.options.animateHeightWithContent&&!this.originalContent.get("hidden"))return this._hideOriginalContent||this.hideOriginalContent(e)},function(){var s=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&s.push(this._hideOriginalContent||this.hideOriginalContent(e)),null==i||null==t||(i===t?this.$el.height(i):s.push(o(this.$el,{height:[i,t]},{duration:a(150),easing:[.4,1.3,.7,1]}))),n.all(s)},function(){return this.set("placeholder",!1),this.postForm.animateShow(a(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height","")}],this)},hidePostForm:function(e){var t=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent||(i=t),r([function(){this.$el.css("height",t),this.set("midtransition",!0)},function(){return this.postForm.animateHide(a(100))},function(){if(this.set("pretransition",!0),null==i||null==t);else{if(i!==t)return o(this.$el,{height:[i,t]},{duration:a(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return n.join(e(),this.originalContent.animateShow(a(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new g),this.originalContent||(this.options.originalContent instanceof p?this.originalContent=this.options.originalContent:this.originalContent=new p({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,this.subViews.postForm=this.postForm,this.attachSubViews(),this},afterRender:function(){return this.$el.addClass("post-forms-above-glass is_persistent"),this.renderSubViews()},beforeTeardown:function(){return this.subViews.loader=null,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition is_persistent"),this.loader&&(this.loader.remove(),this.loader=null),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});e.exports=f},function(e,t,i){"use strict";var s=i(3),n=i(194).animate,o=i(178),r=i(235),a=i(189),l=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[r,a],initialize:function(e){this.set("hasContent",e&&e.el),this.originalCSS=this._getCSS(["opacity"]),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:hidden",this._onChangeHidden)},_getCSS:function(e){var t={};return s.forEach(e,function(e){t[e]=this.$el.css(e)},this),t},_onChangeEnabled:function(e,t){this.$el.toggleClass("no-pointer-events",!t)},_onChangeHidden:function(e,t){this.$el.toggleClass("collapse",t)},measureHeight:function(){if(!this.get("hasContent"))return null;var e=this.get("hidden");this.set("hidden",!1);var t=this.$el.outerHeight();return this.set("hidden",e),t},animateShow:function(e,t){return e||(e=0),t||(t=0),n(this.$el,{opacity:1},{duration:e,delay:t,begin:s.bind(function(){this.set("hidden",!1)},this)})},animateHide:function(e,t){return e||(e=0),t||(t=0),n(this.$el,{opacity:0},{duration:e,delay:t}).then(s.bind(function(){this.set("hidden",!0)},this))},render:function(){return this},teardown:function(){return this.$el.css(this.originalCSS),this}});e.exports=l},function(e,t,i){"use strict";var s=i(178),n=i(235),o=i(236),r=i(189),a=i(585),l=s.extend({className:"post-forms-loader",mixins:[n,o,r],template:a,initialize:function(e){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",e&&e.loading)},_onChangeLoading:function(e,t){this.isRendered()&&(t?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)transitionBackground&&(__p+=' <div class="post-transition-background"></div> '),__p+=" ",originalContent&&(__p+=' <div data-subview="originalContent"></div> '),__p+=' <div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(194).animate,r=i(583),a=i(236),l=i(189),c=i(139),u=i(205),h=r.extend({mixins:[a,l],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(e){this.postType=e},animateShow:function(e,t){return e||(e=0),t||(t=0),this.$el.css({display:"block",opacity:1}),function(i){var s=this.js$(i),r=s.children("i"),a=s.children(".new_post_label_text"),l=this.$(".new_post_label").not(s),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:1,translateY:[0,10],opacity:1},{duration:e,delay:t}),o(u,{translateY:[0,10],opacity:1},{duration:e,delay:t})];return s.length&&r.length&&h.push(o(r,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:e,delay:t}),o(a,{translateY:[0,0],opacity:1},{duration:e,delay:t})),n.all(h)}.call(this,this.postType)},animateHide:function(e,t){e||(e=0),t||(t=0),function(i){var s=this.js$(i),r=s.children("i"),a=s.children(".new_post_label_text"),l=this.$(".new_post_label").not(s),c=l.children("i"),u=l.children(".new_post_label_text"),h=[o(c,{scale:[1,1],translateY:[10,0],opacity:0},{duration:e,delay:t}),o(u,{translateY:[10,0],opacity:0},{duration:e,delay:t})];return s.length&&r.length&&h.push(o(r,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:e,delay:.5*e+t}),o(a,{translateY:[0,0],opacity:0},{duration:e,delay:t})),n.all(h)}.call(this,this.postType).then(s.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(e){if(e.stopPropagation(),e.preventDefault(),this.get("enabled")){var t=e.currentTarget.getAttribute("data-post-endpoint")||e.currentTarget.getAttribute("data-post-type");c.trigger("postForms:open",{postType:t,postFormType:u.inline})}}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+__e(icons.length)+'"> ',_.forEach(icons,function(e,t){__p+=' <div class="tab-post-type item" data-index="'+__e(t)+'" data-post-type="'+__e(e.name)+'"><div class="post-type-icon icon-'+__e(e.name)+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+__e(e.label)+"</span></div></div> "}),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(185),n=i(129),o=i(137),r=i(3),a=i(8),l=s.extend({events:{mouseleave:"onMouseLeave",mouseenter:"onMouseEnter"},defaults:{totalImages:5,changeOnHover:!0,image:!1},initialize:function(){return this.assetsHost=n.get("Context/hosts/assets_host"),this.isRetina=window.devicePixelRatio&&window.devicePixelRatio>1,this.$imageContainer=this.$(".preload-container"),o.bool("pride_logo_2017")?(this.set("changeOnHover",!1),this.$imageContainer.addClass("pride-logo"),this.set("image","LGBT-Flags"),this.addImageToContainer(),void this.setBackgroundImage(this.get("image"))):(this.generateImageIds(),this.get("image")||(this.applyRandomImage(),this.addImageToContainer()),this.setBackgroundImage(this.get("image")),void this.listenTo(this,"change:image",function(e,t){this.addImageToContainer(),this.setBackgroundImage(t)}))},generateImageIds:function(){this.imageIds=r.shuffle(r.range(1,this.get("totalImages")+1))},onMouseEnter:function(e){var t=this,i=this.getCurrentImageObject();i.get(0).complete?this.$el.addClass("opacity-switch"):i.on("load",function(){t.$el.is(":hover")&&t.get("image")===i.data("imgId")&&t.onMouseEnter()})},onMouseLeave:function(e){var t=this;this.$el.removeClass("opacity-switch"),this.get("changeOnHover")&&setTimeout(function(){t.applyRandomImage()},200)},addImageToContainer:function(){if(!this.getCurrentImageObject().get(0)){var e=this.isRetina?"@2x":"";a('<img data-img-id="'+this.get("image")+'">').attr("src",this.assetsHost+"/images/logo/hover-animations/"+this.get("image")+e+".png").appendTo(this.$imageContainer)}},applyRandomImage:function(){0===this.imageIds.length&&this.generateImageIds(),this.set("image",this.imageIds[0]),this.imageIds.shift()},getCurrentImageObject:function(){return this.$imageContainer.find('[data-img-id="'+this.get("image")+'"]')},setBackgroundImage:function(e){this.$imageContainer.css("background-image","url("+this.getCurrentImageObject().attr("src")+")")}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(140),r=i(591),a=i(600),l=n.extend({events:{click:"openPopover"},addUnreadCount:function(){this.$el.append(a({value:this.user.getUnreadCount()}))},initialize:function(){this.popover=null,this.user=o(),this.addUnreadCount(),this.popoverOptions={container:this.$el,viewOptions:{}}},openPopover:function(e){if(e.preventDefault(),this.popover)this.popover.show();else{var t=this.$el.closest(".l-header-container");t.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"===t.css("position")),r(s.bind(function(e){this.popover=new e(this.popoverOptions).render()},this))}}});e.exports=l},function(e,t,i){"use strict";var s=i(207),n=i(592),o=new n("account-popover"),r=function(e){o.start(),i.e(2,function(t){try{e(i(593))}catch(e){s(e,"account-popover")}finally{o.end()}})};e.exports=r},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(3),r=i(139),a=function(){function e(t){if(s(this,e),o.isString(t)?t={chunkName:t}:t||(t={}),!t.chunkName,!1)throw new Error("Async latency logger requires a chunkName");this.chunkName=t.chunkName||""}return n(e,[{key:"start",value:function(){this.startTime=Date.now()}},{key:"end",value:function(){this.startTime&&r.trigger("async-loading:complete:"+this.chunkName,{loggingData:{chunkName:this.chunkName,latency:Date.now()-this.startTime,userAgent:o.get(window,"navigator.userAgent",""),path:o.get(document,"location.pathname")}})}}]),e}();e.exports=a},,,,,,,,function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<span class="tab_notice tab-notice--outlined ',value>0&&(__p+="tab-notice--active"),__p+='"><span class="tab_notice_value">'+__e(value)+"</span></span>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(178),n=i(139),o=i(602),r=i(140),a=s.extend({events:{click:"openPopover"},addUnreadCount:function(){},initialize:function(){this.popover=null,this.user=r(),this.addUnreadCount(),this.popoverOptions={container:this.$el,viewOptions:{}}},openPopover:function(e){if(e.preventDefault(),this.popover)this.popover.show();else{var t=this.$el.closest(".l-header-container");t.length&&(this.popoverOptions.viewOptions.isFixedPosition="fixed"===t.css("position")),this.popover=new o(this.popoverOptions).render()}n.trigger("activityLinks:click",{loggingData:{source:"app-header"}})}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(603),r=i(140),a=n.extend({name:"ActivityPopover",view:function(e){return e=s.extend({},{model:r(),pinnedTarget:this.container,isFixedPosition:!0,autoTeardown:!1,teardownOnEscape:!1},e),new o(e)},show:function(){this.view.show()},render:function(){return this.view.render(),this.trigger("append"),
this}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(130),r=i(185),a=i(604),l=i(139),c=i(224),u=i(242),h=i(243),d=i(179).transition,p=i(150),g=i(605),_=i(609),f=i(611),m=i(172),v=i(432),b=r.extend({defaults:{popoverData:{},preventInteraction:!0,currentTumblelog:!1},className:"popover--activity-popover",mixins:[u],template:a,initialize:function(e){if(this.options=s.extend({},this.defaults,e),!this.get("currentTumblelog")){var t=this.model.channels.findWhere({is_current:!0});this.set("currentTumblelog",t)}},render:function(){return this.$el.html(this.template()),this.$pinned.addClass("active"),this.$activityNotifications=this.$(".activity-popover-notifications"),this.$activityHeader=this.$(".activity-popover-header"),this.$activityPopoverMenu=this.$(".popover_menu"),s.delay(s.bind(function(){this.$activityPopoverMenu.addClass("popover--active"),this.bindClickOutside(),this.addTumblelogPopoverZIndex()},this),1),this.subviews.tumblelogSelect=new g({className:"activity-popover-tumblelog-select-container",collection:this.model.channels,dropdownClass:"popover--activity-popover-tumblelog-select-dropdown",popoverOptions:{popoverContainer:".popover--activity-popover"}}),this.prepareActivityNotifications(),this.listenTo(this.subviews.tumblelogSelect,"change:currentTumblelog",this.updateSubviews),this},addTumblelogPopoverZIndex:function(){this.$el.attr("data-tumblelog-popover-zindex",this.$el.css("z-index"))},bindClickOutside:function(){var e={preventInteraction:!0,ignoreSelectors:[".popover_content_wrapper",".tumblelog_popover",".ui_peepr_glass",".drawer",".ui_dialog_pos"]};this.clickOutside=new h(this.el,e),this.clickOutside.on("click:outside",this.hide,this),this.clickOutside.on("click:inside",this.hideActivityPopover,this),this.listenTo(l,"DOMEventor:keyup:escape",this.hide)},unbindClickOutside:function(){this.clickOutside.remove(),this.clickOutside=null,this.stopListening(l,"DOMEventor:keyup:escape")},createSubviews:function(){this.removeSubviews(),this.toggleLoader(!1),this.subviews.sparkline=new _({model:this.get("currentTumblelog")}),this.subviews.activityNotifications=new f({model:this.get("currentTumblelog")}),this.rendered&&(this.appendSubview(this.subviews.sparkline,this.$activityHeader),this.appendSubview(this.subviews.activityNotifications,this.$activityNotifications))},hasNecessaryData:function(){return this.get("currentTumblelog").has("activity_notifications")},loadData:function(){return this.get("currentTumblelog").fetch_activity_notifications()},prepareActivityNotifications:function(){return p.promise(s.bind(function(e,t){this.hasNecessaryData()?e(this.createSubviews()):(this.toggleLoader(!0),this.loadData().then(s.bind(function(){e(this.createSubviews())},this)).catch(function(e){t(e)}))},this)).catch(s.bind(function(e){this.toggleLoader(!1),m.alert(o("Woops :("))},this))},updateSubviews:function(e,t){this.set("currentTumblelog",t),this.prepareActivityNotifications()},removeSubviews:function(){this.subviews&&s.each(this.subviews,function(e){e.get("removable")&&e.remove()})},toggleLoader:function(e){e===!0?this.loader?this.loader.set("loading",!0):this.loader=new v({$container:this.$el,type:"bar",classModifiers:"bottom",loading:!0}):this.loader&&this.loader.set("loading",!1)},beforeTeardown:function(){return this.remove(),this.$pinned.removeClass("active"),this},hideActivityPopover:function(e){var t=n(e.target),i=t.closest(".tumblelog_popover"),o=t.closest("[href]");s.isEmpty(i)||s.isEmpty(o)||!c.isTumblelogUrl(o.attr("href"))||this.hide()},hide:function(){this.unbindClickOutside(),this.$pinned.removeClass("active"),this.$activityPopoverMenu.removeClass("popover--active"),d(this.$el,s.bind(function(){this.afterHide()},this))},afterHide:function(){this.$el.css({display:"none"})},show:function(){this.bindClickOutside(),this.$pinned.addClass("active"),this.$el.css({display:"block"}),s.delay(s.bind(function(){this.$activityPopoverMenu.addClass("popover--active")},this),1)}});e.exports=b},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"><div class="activity-popover-header"> '+(null==(__t=_subview("tumblelogSelect"))?"":__t)+" "+(null==(__t=_subview("sparkline"))?"":__t)+" "+(null==(__t=_subview("loader"))?"":__t)+' </div><div class="activity-popover-notifications"> '+(null==(__t=_subview("activityNotifications"))?"":__t)+" </div></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(606),r=i(607),a=i(236),l=i(209),c=n.extend({template:o,mixins:[a],defaults:{currentTumblelog:!1,isOpen:!1,requiresDropdown:!1,showCaret:!0,showName:!0,dropdownClass:null,popoverOptions:null,avatarSize:96,badgeCountField:null,showTotalBadge:!0,showNumberInBadge:!1,includeCurrentBlogInTotalBadge:!1,maxBadgeCount:99,badgeActiveClass:"has-badge"},events:{"click [data-js-button]":"toggleDropdown"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"collection")),this.get("currentTumblelog")||this.set("currentTumblelog",this.collection.findWhere({is_current:!0})),this.set("requiresDropdown",this.collection.length>1),!s.isEmpty(this.get("badgeCountField"))&&this.get("requiresDropdown")||this.set("showTotalBadge",!1)},getTemplateData:function(){var e=this.get("showTotalBadge"),t=e&&this.get("showNumberInBadge"),i=e?this.getBadgeCount():null;return{avatarUrl:l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),displayName:this.getCurrentTumblelogProperty("name"),requiresDropdown:this.get("requiresDropdown"),hasBadge:e&&i>0,badgeCountString:t?this.getBadgeCountString(i):null}},createDropdown:function(){var e=s.extend({},this.get("popoverOptions"),{identifier:"blogSelector:dropdown",pinnedTarget:this.js$("avatar"),shift:{x:86,y:10},collection:this.collection,currentTumblelog:this.getCurrentTumblelog(),badgeCountField:this.get("badgeCountField"),maxBadgeCount:this.get("maxBadgeCount")});this.dropdown=new r(e),this.get("dropdownClass")&&this.dropdown.$el.addClass(this.get("dropdownClass")),this.listenTo(this.dropdown,"change:currentTumblelog",this.adjustCurrentTumblelog),this.listenTo(this.dropdown,"open",this._onDropdownOpen),this.listenTo(this.dropdown,"close",this._onDropdownClose)},_onDropdownOpen:function(){this.set("isOpen",!0)},_onDropdownClose:function(){this.set("isOpen",!1)},_onChangeIsOpen:function(e,t){this.js$("caret").toggleClass("is-open",t)},toggleDropdown:function(){this.get("requiresDropdown")&&(this.dropdown.isOrWasRecentlyRendered()||(this.createDropdown(),this.dropdown.render()))},afterRender:function(){return this.get("showTotalBadge")&&(this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this._onBadgeCountChange()),this.get("requiresDropdown")&&(this.createDropdown(),this.js$("button").addClass("has-dropdown"),this.listenTo(this,"change:isOpen",this._onChangeIsOpen),this.listenTo(this,"change:showCaret",this._onChangeShowCaret),this._onChangeIsOpen(this,this.get("isOpen")),this._onChangeShowCaret(this,this.get("showCaret"))),this.listenTo(this,"change:showName",this._onChangeShowName),this._onChangeShowName(this,this.get("showName")),this},getCurrentTumblelog:function(){return this.get("currentTumblelog")},getCurrentTumblelogProperty:function(e){var t=this.getCurrentTumblelog();if(t&&t.has(e)&&s.isString(e))return t.get(e)},adjustCurrentTumblelog:function(){var e;this.set("currentTumblelog",this.dropdown.get("currentTumblelog")),this.rendered&&(e=l(this.getCurrentTumblelogProperty("avatar_url"),this.get("avatarSize")),this.js$("avatar").attr("src",e),this.js$("label").text(this.getCurrentTumblelogProperty("name")),this.get("showTotalBadge")&&!this.get("includeCurrentBlogInTotalBadge")&&this._onBadgeCountChange())},teardown:function(){return this.remove(),this},getBadgeCount:function(){var e,t=this.get("currentTumblelog");return this.get("badgeCountField")?(e=s.sum(this.collection.pluck(this.get("badgeCountField"))),t&&!this.get("includeCurrentBlogInTotalBadge")&&(e-=t.get(this.get("badgeCountField"))),Math.max(0,e)):null},getBadgeCountString:function(e){var t=this.get("maxBadgeCount");return e>t?t+"+":e>0?e:""},updateBadge:function(e){var t=this.js$("badge");t.toggleClass(this.get("badgeActiveClass"),e>0),this.get("showNumberInBadge")&&t.text(this.getBadgeCountString(e))},_onBadgeCountChange:function(){this.updateBadge(this.getBadgeCount())},_onChangeShowCaret:function(e,t){this.js$("caret").toggle(t)},_onChangeShowName:function(e,t){this.js$("label").toggle(t)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="blog-selector-container"><div class="selected-blog" data-js-button><img class="avatar" src="'+__e(avatarUrl)+'" alt="'+(null==(__t=displayName)?"":__t)+'" data-js-avatar> <span class="name" data-js-label>'+(null==(__t=displayName)?"":__t)+"</span> ",requiresDropdown&&(__p+=' <span class="caret '+__e(hasBadge?"has-badge":"")+'" data-js-caret data-js-badge>',badgeCountString&&(__p+=__e(badgeCountString)),__p+="</span> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(608),r=i(242),a=i(236),l=i(209),c=i(427),u=n.extend({className:"popover--blog-selector-dropdown",events:{"click [data-js-tumblelog]":"selectBlog"},mixins:[a,r],template:o,defaults:{currentTumblelog:!1,avatarSize:96,badgeCountField:null,maxBadgeCount:99,badgeActiveClass:"tab-notice--active"},initialize:function(e){if(e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"collection")),!this.get("currentTumblelog")){var t=this.collection.findWhere({is_current:!0});this.set("currentTumblelog",t)}},selectBlog:function(e){var t=this.$(e.currentTarget).index();this.set("currentTumblelog",this.collection.at(t)),this.teardown()},createScrollbar:function(){this.scrollbar||(this.scrollbar=new c(this.js$("scrollbar")))},afterRender:function(){return this.js$("scrollbar").addClass("popover-sublist popover-sublist--scrollable"),s.defer(s.bind(this.createScrollbar,this)),this.delegateEvents(),this.isShowBadges()&&this.listenTo(this.collection,"change:"+this.get("badgeCountField"),this._onBadgeCountChange),this},isShowBadges:function(){return!s.isEmpty(this.get("badgeCountField"))},getBadgeCount:function(e){return this.get("badgeCountField")&&e?e.get(this.get("badgeCountField")):null},getBadgeCountString:function(e){var t=this.get("maxBadgeCount");return e<=0?"":e>t?t+"+":e},getTemplateData:function(){var e,t=this.toJSON(),i=this.get("currentTumblelog");return i&&s.extend(t,{currentTumblelog:i.get("name")}),e=this.collection.map(function(e){return s.extend({avatarUrl:l(e.get("avatar_url"),this.get("avatarSize")),displayName:e.getDisplayName(),badgeCountString:this.getBadgeCountString(this.getBadgeCount(e))},e.toJSON())},this),s.extend(t,{channels:e,isShowBadges:this.isShowBadges()}),t},beforeTeardown:function(){this.scrollbar&&(this.scrollbar.destroy(),this.scrollbar=null),this.stopListening()},teardown:function(){return this.remove()},updateBadge:function(e){var t,i=this.$$("[data-js-channel-badge="+e.get("name")+"]");0!==i.length&&(t=this.getBadgeCount(e),i.toggleClass(this.get("badgeActiveClass"),t>0),t>0&&i.find("[data-js-channel-badge-text]").text(this.getBadgeCountString(t)))},_onBadgeCountChange:function(e){return this.updateBadge(e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="pop-menu"><ul class="inner select-right" data-js-scrollbar> ',_.forEach(channels,function(e){__p+=' <li class="item-option '+__e(e.name===currentTumblelog?"selected":"")+'" data-js-tumblelog><div class="avatar"><img src="'+__e(e.avatarUrl)+'" alt="'+__e(e.name)+'"> ',isShowBadges&&(__p+=' <span class="unread-indicator tab_notice tab-notice--outlined on-light ',e.badgeCountString&&(__p+="tab-notice--active "),__p+='" data-js-channel-badge="'+__e(e.name)+'"><span class="tab_notice_value" data-js-channel-badge-text>'+__e(e.badgeCountString)+"</span></span> "),__p+=' </div><div class="info-container"><p class="name">'+__e(e.displayName)+'</p><p class="title">'+(null==(__t=e.directory_safe_title)?"":__t)+"</p></div></li> "}),__p+=" </ul></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(610),r=n.extend({template:o,className:"activity-popover-sparkline-container",defaults:{removable:!0,sparklineFormatting:{type:"line",lineColor:"#7f7f7f",fillColor:!1,lineWidth:4,spotColor:!1,minSpotColor:!1,maxSpotColor:!1,disableInteraction:!0,width:"72px",height:"30px"}},getTemplateData:function(){return{activityPageUrl:"/blog/"+this.model.get("name")+"/activity"}},addSparkline:function(){var e=this.$el.find(".sparkline"),t=JSON.parse(this.model.get("activity_data").sparkline);t&&0!==s.max(t)&&s.isFunction(e.sparkline)&&(e.sparkline(t,this.get("sparklineFormatting")),e.find("canvas").css({height:"15px",width:"36px"}))},afterRender:function(){s.defer(s.bind(this.addSparkline,this))},teardown:function(){return this.remove(),this}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<a class="activity-popover-sparkline-link" href="'+(null==(__t=activityPageUrl)?"":__t)+'" title="Activity"><div class="sparkline"></div></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(612),r=i(236),a=i(427),l=i(613),c=i(641),u=i(643),h=i(9),d=n.extend({className:"blog-activity",template:o,mixins:[r],defaults:{removable:!0,notificationWhiteList:["answer","ask","ask_answer","fanmail","follower","like","note_mention","photo_reply","post_attribution","reblog","reply","user_mention","like_rollup","reblog_naked_rollup","follower_rollup"]},addChannelScrollbar:function(){this.notificationScrollBar=new a(this.js$("blog-activity-notification-list"))},afterRender:function(){this.model.get("activity_notifications").length>1&&(s.defer(s.bind(this.addChannelScrollbar,this)),this.js$("blog-activity-notification-list").addClass("popover_sublist popover_sublist--scrollable"),this.createSubviews())},beforeTeardown:function(){this.notificationScrollBar&&this.notificationScrollBar.destroy()},createSubviews:function(){for(var e=this.model.get("activity_notifications"),t=void 0,i=0;i<e.length;i++){var n=e[i];if(s.contains(this.defaults.notificationWhiteList,n.type)){var o=!1,r=h.unix(n.timestamp).startOf("day");if(t&&r.fromNow()===t.fromNow()||(o=r),o){n.dateHeader=o;var a=new c({model:new u(n)});this.appendSubview(a,"ul[data-js-blog-activity-notification-list]")}var d=new l({model:new u(n)});this.appendSubview(d,"ul[data-js-blog-activity-notification-list]"),t=h.unix(n.timestamp).startOf("day")}}},teardown:function(){return this.remove(),this}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=model.activity_notifications.length>1?' <div class="blog-activity-content"><ul data-js-blog-activity-notification-list class="ui_notes"></ul></div><a href="/blog/'+__e(model.name)+'/activity" class="blog-activity-more">'+__e(__("See everything"))+"</a> ":' <div class="blog-activity--empty"><i class="icon_activity"></i><p class="blog-activity--empty-text">'+__e(__("Check out this tab when you make a post to see Likes, Reblogs, and new followers."))+"</p></div> ";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(139),a=i(149),l=i(614),c=i(221),u=i(137),h=i(140),d=i(626),p={answer:i(628),ask:i(629),ask_answer:i(630),fanmail:i(631),follower:i(632),like:i(633),note_mention:i(634),photo_reply:i(635),post_attribution:i(636),reblog:i(637),reply:i(638),user_mention:i(639),rollup:i(640)},g=o.extend({tagName:"li",className:"activity-notification",events:{"click .note_follow":"onClickFollow","click .note_unfollow":"onClickFollow"},defaults:{tumblelogToFollow:!1,followSource:"FOLLOW_SOURCE_ACTIVITY_POPOVER",following:!1,followText:n("Follow"),rollupParentType:{follower_rollup:"follower",like_rollup:"like",reblog_naked_rollup:"reblog"},showReplyLink:u.bool("notification_reply_link_to_notes")},initialize:function(e){if(this.options=s.defaults(e,this.defaults),this.rollupParentType=this.options.rollupParentType[this.model.get("type")],this.rollupParentType?(this.template=p.rollup,this.notificationType=this.rollupParentType,this.$el.addClass("rollup")):(this.template=p[this.model.get("type")],this.notificationType=this.model.get("type")),this.$el.addClass(this.notificationType),this.$el.attr("data-timestamp",this.model.get("timestamp")),this.replyString=n("Reply"),!this.get("tumblelogToFollow")){var t=this.model.get("from_tumblelog");t&&(this.isCurrentUser(),this.$el.attr("data-tumblelog-name",t.name),this.subviews.avatarView=new d({model:this.model,rollupParentType:this.rollupParentType}),t.is_friend&&this.$el.addClass("is_friend"),this.set("tumblelogToFollow",new a({name:t.name,following:t.is_friend})),this.listenTo(this.get("tumblelogToFollow"),"change:following",this.onFollowChange),this.setSafeModeData())}},getTemplateData:function(){return{model:this.model.attributes,followString:this.get("followText"),isFollowing:this.options.following,rollupParentType:this.rollupParentType,replyString:this.replyString}},beforeRender:function(){var e="",t={},i={};this.get("tumblelogToFollow")&&(this.options.following=this.get("tumblelogToFollow").get("following")),"note_mention"===this.notificationType?(e=this.model.get("new_post").url,t={tumblelog:this.model.get("new_post").tumblelog,postId:this.model.get("new_post").id},i={tumblelog:this.model.get("new_post").tumblelog,postId:this.model.get("new_post").id,replyNoteToTumblelogName:this.model.get("from_tumblelog").name}):s.includes(["user_mention","reblog"],this.notificationType)?(this.model.get("new_post")&&!this.model.get("new_post").diff&&"reblog"===this.notificationType&&this.$el.addClass("naked"),e=this.model.get("new_post").url,t={tumblelog:this.model.get("from_tumblelog").name,postId:this.model.get("new_post").id}):s.includes(["reply","photo_reply","answer","like","post_attribution","ask"],this.notificationType)&&this.model.get("from_tumblelog")?(e=this.model.get("post").url,t={tumblelog:this.model.get("post").tumblelog,postId:this.model.get("post").id},i={tumblelog:this.model.get("post").tumblelog,postId:this.model.get("post").id,replyNoteToTumblelogName:this.model.get("from_tumblelog").name}):"ask_answer"===this.notificationType?(e=this.model.get("post").url,t={tumblelog:this.model.get("from_tumblelog").name,postId:this.model.get("post").id}):"follower"===this.notificationType?(e=this.model.get("from_tumblelog").tumblr_url,t={tumblelog:this.model.get("from_tumblelog").name}):"fanmail"===this.notificationType?(e=this.model.get("post").url,t={}):(e=this.model.get("post").url,t={tumblelog:this.model.get("post").tumblelog}),this.model.set("peepr_json",JSON.stringify(t)),this.model.set("clickthrough_url",e),this.get("showReplyLink")&&this.model.set("peepr_notes_json",JSON.stringify(i))},isCurrentUser:function e(){var t=h().get("channels").map(function(e){var t=e.name;return t}),e=s.includes(t,this.model.get("from_tumblelog").name);this.model.set({isCurrentUser:e})},setSafeModeData:function(){var e=u.bool("safe_mode")&&h().get("safe_mode");this.model.set("isSafeModeEnabled",e),this.model.set("blogIsAdult",this.model.get("from_tumblelog").is_adult)},afterRender:function(){this.$tumblelogLink=this.$(".notification-tumblelog-link"),this.$ui_post_badge=this.$(".ui_post_badge");var e=this.model.get("post")||this.model.get("new_post"),t={},i="",n=e?e.type:"regular";switch(n){case"photo":case"photoset":t.backgroundImage="url('"+e.media_url+"')";break;case"video":e.video_thumbnail_url&&(t.backgroundImage="url('"+e.video_thumbnail_url+"')",i="has_video_thumbnail");break;case"note":e.is_ask?i="ask":e.is_answer&&(i="ask_answer");break;case"postcard":i="fanmail"}this.get("tumblelogToFollow")&&(this.toggleFollowLink(this.get("tumblelogToFollow").get("following")),this.$tumblelogLink.addClass("js-hover-trigger-TumblelogPopover"),this.$(".notification-tumblelog-link, .avatar").hoverIntent({over:s.bind(this.showBlogCardPopover,this),out:s.noop,sensitivity:3})),this.$ui_post_badge.css(t).addClass(i),c.drawPixelatedImages(this),this.$(".pixelated-avatar").removeClass("hide").addClass("show")},onClickFollow:function(e){e.preventDefault(),this.get("tumblelogToFollow").get("following")?this.confirmUnfollow():this.get("tumblelogToFollow").follow()},confirmUnfollow:function(){var e=this.get("tumblelogToFollow"),t=e.get("name"),i=e.requestUnfollow(),s={text:n("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+t+"</strong>"),text_ok:n("Ok"),text_cancel:n("Nevermind")};i.promise.then(function(){r.trigger("tumblelog:log_unfollow",{loggingData:{tumblelog:t}})}),r.trigger("dialog:confirm:promise",i,s)},onFollowChange:function(e,t){this.options.isFollowing=t,this.toggleFollowLink(t),this.$el.toggleClass("is_friend",t),t&&this.logFollowChange(e)},toggleFollowLink:function(e){this.$el.find(".follow-action-text").toggle(!e)},logFollowChange:function(e){r.trigger("activityLinks:clickPopoverFollow",{loggingData:{source:"app-header",platform:"web",tumblelog:e.get("name")}})},showBlogCardPopover:function(){this.popover&&(this.popover.teardown(),this.popover=null),this.popover=new l({model:this.get("tumblelogToFollow"),pinnedTarget:this.$el}),this.popover.$el.css("z-index",this.$el.closest(".popover").css("z-index")),this.popover.openPopover()},teardown:function(){return this.remove(),this}});e.exports=g},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(178),r=i(139),a=i(235),l=i(242),c=i(615),u=o.extend({mixins:[a,l],className:"tumblelog_popover popover popover--blog-card",blogCardView:null,initialize:function(e){e||(e={}),e.identifier="TumblelogPopover",this.$targetPost=n(e.pinnedTarget).closest(".post"),o.prototype.initialize.call(this,e)},openPopover:function(){return this.blogCardView?(this.render(),this):(this.blogCardView=new c({model:this.model,targetPost:this.$targetPost}),void this.listenToOnce(this.blogCardView,"ready",this.render))},closePopover:function(){this.animateOut(),s.delay(s.bind(this.teardown,this),250)},onMouseMove:function(e){this.overElement(e,this.$el)||this.overElement(e,this.$pinned)?this.teardownTimer&&(clearTimeout(this.teardownTimer),this.teardownTimer=null):this.teardownTimer||(this.teardownTimer=s.delay(s.bind(this.closePopover,this),300))},overElement:function(e,t){var i=t.offset();return e.pageX>i.left&&e.pageY>i.top&&e.pageX<i.left+t.outerWidth()&&e.pageY<i.top+t.outerHeight()},render:function(){return this.blogCardView.render(),this.$el.html(this.blogCardView.el),s.defer(s.bind(this.animateIn,this)),this.boundMouseMove=s.bind(this.onMouseMove,this),n("body").on("mousemove",this.boundMouseMove),this._logOpen(),this},animateIn:function(){return this.$el.css("opacity",1),this},animateOut:function(){return this.$el.css("opacity",0),this},_logOpen:function(){r.trigger("popover:blogcard:open",{loggingData:{blog:this.model.get("name")}})},teardown:function(){return n("body").off("mousemove",this.boundMouseMove),this.$el.remove(),this}});e.exports=u},function(e,t,i){"use strict";e.exports=i(616)},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(617),r=i(624),a=n.extend({defaults:{include_info_popover:!0,disableUnfollowConfirm:!1},className:"poptica_header",initialize:function(e){this.options=s.extend({},this.defaults,e);var t=s.extend({model:this.model},s.pick(this.options,"targetPost","include_info_popover","disableUnfollowConfirm"));this.header=new o(t),this.posts=new r({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.$el.append(this.header.render().el,this.posts.render().el),this}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(137),r=i(129),a=i(178),l=i(139),c=i(618),u=i(224),h=i(130),d=i(619),p=i(620),g=i(621),_=a.extend({className:"indash_tumblelog_compact",template:d,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(e){if(this.options=s.extend({},this.defaults,e||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=r.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!s.isEmpty(this.current_data)){var t=s.extend({},this.current_data,this.model.toJSON());this.model.set(t,{silent:!0})}this.model.get("global_theme_params")&&s.delay(s.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},render:function(){var e=this.model.toJSON();if(e.following||(e.following=!1),this.is_rendered||!e.global_theme_params)return this;var t=s.result(p,e.global_theme_params.title_font),i=c.hexToRgb(e.global_theme_params.title_color);return this.$el.html(this.template(s.merge({},e,{hide_headers_flag:o.bool("hide_default_headers_blog_cards"),blog_card_compact:!0,show_navigation:!0,show_share_controls:!1,show_user_controls:this.options.include_info_popover,show_follow_button:!0,show_dismiss_controls:!1,title_font_family:!!t&&t.family,title_color_rgb:String(s.values(i).join(",")),followText:h("Follow"),unfollowText:h("Unfollow")},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.__addSnowMan(),this.is_rendered=!0,this.$description.length&&(s.delay(s.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var e=this.$description_inner.html(),t=e.replace(/[\n\r]/g," ");this.$description_inner.html(t)},truncateDescription:function(){var e=this.$description_inner.get(0);if(!(e.scrollHeight<=e.clientHeight)){var t=this.model.get("global_theme_params"),i=t.background_color,n=c.hexToRgb(i);this.$description.append(this.description_gradient_template({background_color:String(s.values(n).join(","))}))}},__addSnowMan:function(){var e={el:this.$("[data-snowman-container]"),tumblelogName:this.model.get("name")};this.options.include_info_popover&&(e.infoPopover={el:this.$el,auto_show:!1,trigger:this.$el.find(".info_popover_button"),useRecipient:!0,showAsks:!0,showAnonymousAsks:!0,skip_glass:!0,targetPost:this.options.targetPost}),this.snowman=new g(e)},_onFollowClick:function(e){if(e.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var t={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(t):(l.trigger("tumblelog:log_follow"),this.model.follow(t))},_confirm_unfollow:function(e){var t={tumblelog:this.model.get("name")},i=this.model.requestUnfollow();if(this.options.disableUnfollowConfirm)i.resolve(),l.trigger("tumblelog:log_unfollow",{loggingData:t});else{var s=h("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),n={text:s,text_ok:h("Ok"),text_cancel:h("Nevermind")};i.promise.then(function(){l.trigger("tumblelog:log_unfollow",{loggingData:t})}),l.trigger("dialog:confirm:promise",i,n)}},_infoPopoverButtonClicked:function(e){e.preventDefault(),e.stopPropagation(),l.trigger("popticainfopopover:show")},_descriptionLinkClicked:function(e){e.preventDefault();var t=n(e.currentTarget).attr("href");try{if(u&&u.hasAllowedProtocol(t)){if(!u.isAbsoluteUrl(t)){var i="http://"+this.model.get("name")+".tumblr.com/";t="/"===t.charAt(0)?t.substr(1):t,t=i+t}window.open(t,"_blank")}}catch(e){}},_renderFollowButton:function(){var e=this.model.get("following");this.$el.find(".follow").toggle(!e),this.$el.find(".unfollow").toggle(e)},_hidePosts:function(){},_open_dialog:function(e,t){function i(e,t){e.is_disabled=e.is_menu_open,t&&t()}this.is_disabled=!0,e.fail(s.bind(i,null,this)),e.done(s.bind(i,null,this,t))},_renderInlineStyles:function(){var e=this.model.get("global_theme_params"),t=this.model.get("has_default_header")&&o.bool("hide_default_headers_blog_cards"),i=!(!(e.header_image_focused&&e.header_stretch&&e.show_header_image)||t),s=c.hexToHsv(e.background_color),n=c.hexToHsv(e.link_color),r=e.link_color;return c.compare(n,s)&&(r=c.readable(s)),i||(this.$(".navigation .nav_icon").css("color",r),this.$(".navigation .blog_name").css("color",r),this.$(".navigation button").css({color:e.background_color,"background-color":r})),this.$(".description a").css("color",e.link_color),this},_renderFontStyles:function(){if(p){var e=this.model.get("global_theme_params");if(s.has(p,e.title_font)){var t=s.result(p,e.title_font),i="webfont_"+t.path;if(t.path&&!n("head #"+i).length){var o=this.assets_host+"/fonts/"+t.path+"/stylesheet.css";o+=s.has(t,"_v")?"?v="+t._v:"",n("<link>",{id:i,rel:"stylesheet",type:"text/css",href:o}).appendTo(n("head"))}}}},description_gradient_template:s.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom, rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});e.exports=_},function(e,t,i){"use strict";function s(e,t,i){return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)}function n(e){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function o(e,t,i){var s=Math.min(Math.min(e,t),i),n=Math.max(Math.max(e,t),i),o=n-s,r={h:6,s:n?(n-s)/n:0,v:n/255};return o?n===e?r.h+=(t-i)/o:n===t?r.h+=2+(i-e)/o:r.h+=4+(e-t)/o:r.h=0,r.h=60*r.h%360,r}function r(e,t,i){var s,n,o;if(t){s=n=o=0;var r=(e+360)%360/60,a=i*t,l=i-a,c=a*(1-Math.abs(r%2-1));r<1?(s=a,n=c):r<2?(s=c,n=a):r<3?(n=a,o=c):r<4?(n=c,o=a):r<5?(o=a,s=c):(o=c,s=a),s+=l,n+=l,o+=l}else s=n=o=i;return{r:Math.round(255*s),g:Math.round(255*n),b:Math.round(255*o)}}function a(e){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var t=n(e),i=o(t.r,t.g,t.b);return i}function l(e,t,i){var n=r(e,t,i),o=s(n.r,n.g,n.b);return o}function c(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i,s,n,o=parseInt(e,16),r=t<0?0:255,a=t<0?-t:t,l=o>>16,c=o>>8&255,u=255&o;return i=Math.round((r-l)*a)+l,s=Math.round((r-c)*a)+c,n=Math.round((r-u)*a)+u,"#"+(16777216+65536*i+256*s+n).toString(16).slice(1)}function u(e,t,i){return"string"==typeof e&&(e=a(e)),t||(t=.2),i||(i=.8),e.s<t&&e.v>i}function h(e){return"string"==typeof e&&(e=a(e)),u(e)?"#444":"#FFF"}function d(e,t,i){var s={upperBound:.8,lowerBound:.2,diffBound:.1,hueBound:15};p.extend(s,i),"string"==typeof e&&(e=a(e)),"string"==typeof t&&(t=a(t));var n=s.upperBound,o=s.lowerBound,r=s.diffBound,l=s.hueBound,c=Math.abs(e.h-t.h),u=Math.abs(e.s-t.s),h=Math.abs(e.v-t.v);return c<=r&&u<=r&&h<=r||u<=r&&h<=r&&(u>=n||u<=o&&h>=n||h<=o&&c<=l)}var p=i(3);e.exports={rgbToHex:s,hexToRgb:n,rgbToHsv:o,hsvToRgb:r,hexToHsv:a,hsvToHex:l,brighten:c,readable:h,compare:d,isLight:u}},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){var is_blog_card_compact="boolean"==typeof blog_card_compact&&blog_card_compact,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,hide_default_header=!!is_blog_card_compact&&(has_default_header&&hide_headers_flag),expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img&&!hide_default_header?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||hide_default_header||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+=' <div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+__e(name)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'"> ',show_navigation&&(__p+=' <div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner"> ',"undefined"!==name&&(__p+=' <h3><a href="'+__e(url)+'" target="_blank" class="blog_name" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\'><span class="name"> '+__e(name)+' </span><span class="full_url">'+__e(expanded_name)+"</span></a></h3> "),__p+=" ",show_share_controls&&(__p+=' <a class="open_blog_button nav_icon icon_export"></a> '),__p+=" ",!customizable&&show_user_controls&&(__p+=' <a data-snowman-container class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> </a> '),__p+=" ",!customizable&&show_follow_button&&(__p+=" ",__p+=following?' <button class="chrome unfollow" type="button">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button" style="display:none">'+__e(followText)+"</button> ":' <button class="chrome unfollow" type="button" style="display:none">'+__e(unfollowText)+'</button> <button class="chrome follow" type="button">'+__e(followText)+"</button> ",__p+=" "),__p+=" </div></div> "),__p+=" ",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&!hide_default_header&&(__p+=' <div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+__e(global_theme_params.header_image_focused)+')"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+__e(global_theme_params.header_image_focused)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"> </a> ':' <img src="'+__e(global_theme_params.header_image_focused)+'" alt=""> ',__p+=" </div></div> "),__p+=" ",avatar_url&&global_theme_params.show_avatar&&(__p+=' <div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'"> ',__p+=is_blog_card_compact||!customizable?' <a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" data-peepr=\'{"tumblelog": "'+__e(name)+'"}\' alt="'+__e(title)+'"></a> ':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt=""> ',__p+=" </div> "),__p+=" ",(has_title||has_description)&&(__p+=' <div class="info_wrapper"><div class="info"> ',has_title&&(__p+=' <h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+__e(title)+"</h1> "),__p+=" ",has_description&&(__p+=' <div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div> "),__p+=" </div></div> "),__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},FangSong:{display_name:"Fang Song",family:"'FangSong', 'STFangsong', sans-serif"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},Kaiti:{display_name:"Kaiti",family:"'Kaiti TC', 'KaiTi', sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},SimHei:{display_name:"Sim Hei",family:"'SimHei', 'STHeiti', sans-serif"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};e.exports=i},function(e,t,i){"use strict";var s=i(173),n=i(622),o=s.extend({name:"Snowman",autoAppend:!0,initialize:function(e){this.view=new n(e)}});e.exports=o},function(e,t,i){"use strict";var s=i(185),n=i(623),o=i(149),r=s.extend({template:n,defaults:{canSubscribe:!1},events:{click:"__toggleInfoPopover"},initialize:function(e){return this.options=e,this.model||(this.model=new o({name:this.options.tumblelogName})),this.set({canSubscribe:this.model.get("can_subscribe"),isSubscribed:this.model.get("is_subscribed")}),this.listenTo(this.model,"change:is_subscribed",this.__subscribeActionSuccess),e.infoPopoverOnDemand||this.__createInfoPopover(),this},__subscribeActionSuccess:function(e){if(e.id===this.model.get("name")){var t=this.model.get("is_subscribed");this.$("[data-subscription-indicator]").toggleClass("is-subscribed",t)}},__toggleInfoPopover:function(e){e.preventDefault(),e.stopPropagation(),this.options.infoPopoverOnDemand&&!this.infoPopover&&this.__createInfoPopover(),this.infoPopover.toggle()},__createInfoPopover:function(){this.options.infoPopover&&(this.options.infoPopover.model=this.model,this.options.infoPopover.url=this.model.get("url"),this.options.infoPopover.useRecipient&&(this.options.infoPopover.recipient=this.model.get("name")),this.options.infoPopover.showAsks&&(this.options.infoPopover.asks=this.model.get("asks")),this.options.infoPopover.showAnonymousAsks&&(this.options.infoPopover.anonymous_asks=this.model.get("anonymous_asks")),this.infoPopover=new Tumblr.TumblelogPopover.PopticaInfoPopover(this.options.infoPopover))}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="snowman-container"><i data-subscription-indicator class="subscribe-activity '+(null==(__t=canSubscribe&&isSubscribed?"is-subscribed":"")?"":__t)+'"></i> <i class="snowman-icon"></i></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(178),r=i(139),a=i(625),l=o.extend({className:"recent_posts",template:a,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,blog_bg_color:!0,$popover:n(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(e){s.extend(this,this.defaults,e),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),s.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(this.model,"change:global_theme_params",this.renderInlineStyles)},fetchPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(e){this.model=e,this.posts=this.model.get("highlighted_posts"),s.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var e=this.model.toJSON();this.$el.html(this.template({loader_color:e.global_theme_params?e.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var e=this.model.get("global_theme_params");e&&this.blog_bg_color&&this.$el.css("background-color",e.background_color)},render:function(e){var t=this.posts||this.model.get("highlighted_posts");if(!s.isArray(t))return this;var i=t.join("");return t.length<2?(setTimeout(s.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time),this):(this.$el.addClass("has_"+t.length+"_posts"),e===!0?this.$el.addClass("is_cached").html(i):setTimeout(s.bind(function(){this.$el.addClass("is_loaded").html(i)},this),this.min_load_time),this)},onPostClick:function(e){},onMouseEnter:function(e){r.trigger("TumblelogPopover:mouseenter_posts")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj){var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+=' <div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(185),n=i(627),o=i(221),r=s.extend({template:n,className:"activity-notification__avatar",initialize:function(e){this.model.set("rollupParentType",e.rollupParentType||""),this.options=e},afterRender:function(){o.drawPixelatedImages(this),this.$(".pixelated-avatar").removeClass("hide").addClass("show")}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="ui_avatar"><div data-avatar-url="'+__e(model.from_tumblelog.avatar_url_128)+'" class="ui_avatar_link frame '+__e(model.type)+" "+__e(model.rollupParentType)+'" title="'+__e(model.from_tumblelog.name)+'"> ',__p+=model.blogIsAdult&&model.isSafeModeEnabled&&!model.isCurrentUser?' <canvas class="avatar pixelated-avatar needs-drawing hide" data-image-url="'+__e(model.from_tumblelog.avatar_url_48)+'" width="23" height="23" alt="'+__e(model.from_tumblelog.name)+'"> ':' <a data-peepr=\'{"tumblelog":"'+__e(model.from_tumblelog.name)+'"}\' target="_blank" href="'+__e(model.from_tumblelog.tumblr_url)+'" class="avatar" style="background-image: url(\''+__e(model.from_tumblelog.avatar_url_48)+'\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name">'+__e(model.from_tumblelog.name)+"</span></a> ",__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_answer"><blockquote> '+__e(model.note_meta.answer_text)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=model.from_tumblelog?' <div data-subview="avatarView"></div> ':' <div class="activity-notification__avatar"><div class="ui_avatar"><div data-avatar-url="/images/anonymous_avatar_64.gif" target="_blank" class="ui_avatar_link frame '+__e(model.type)+'" title="Anonymous"><div class="avatar" style="background-image: url(\'/images/anonymous_avatar_64.gif\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name"></span></div></div></div></div> ',__p+=' <div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity">'+(null==(__t=model.message)?"":__t)+"</span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'"></a><div class="activity-notification__icon"><a href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_answer"><blockquote> '+__e(model.note_meta.answer_text)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'"></a><div class="activity-notification__icon"><a href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"> ',!model.isCurrentUser&&model.from_tumblelog.can_be_followed&&(__p+=' <a class="follow-action-text note_follow" href="/follow/'+__e(model.from_tumblelog.name)+'" data-tumblelog-name="'+__e(model.from_tumblelog.name)+'" title="'+__e(followString)+'"> '+__e(followString)+" </a> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_reply"><blockquote> '+__e(model.note_meta.reply_text||"")+" </blockquote></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" data-peepr="'+__e(model.peepr_notes_json)+'" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message '+__e(model.new_post.diff?"conversational":"")+'"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=" </div> ",model.new_post&&model.new_post.diff&&(__p+=' <div class="activity-notification__activity_response is_part_reblog"><blockquote> '+__e(model.new_post.diff)+" </blockquote></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_reply"><blockquote> '+__e(model.note_meta.reply_text)+" </blockquote></div> ",model.peepr_notes_json&&!model.isCurrentUser&&(__p+=' <div class="activity-notification__activity_reply"><a class="activity-notification__activity_reply_link" data-peepr="'+__e(model.peepr_notes_json)+'" href="'+__e(model.clickthrough_url)+'" title="'+__e(replyString)+'"> '+__e(replyString)+" </a></div> "),__p+=' </div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message conversational"><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+' </span></div><div class="activity-notification__activity_response is_part_user_mention"><blockquote> '+(null==(__t=model.new_post.quote)?"":__t)+' </blockquote></div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"><a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.new_post.url)+'" target="_blank" class="ui_post_badge '+__e(model.new_post.type)+'"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){for(__p+='<div data-subview="avatarView"></div><div class="activity-notification__activity"><div class="activity-notification__activity_message"><div class="activity-notification__activity_rollup"> ',i=0;i<model.from_tumblelogs.length;i++)__p+=' <div class="ui_avatar"><div data-avatar-url="'+__e(model.from_tumblelogs[i].avatar_url_128)+'" class="ui_avatar_link frame '+__e(rollupParentType)+'" title="'+__e(model.from_tumblelogs[i].name)+'"> ',__p+=model.blogIsAdult&&model.isSafeModeEnabled&&!model.isCurrentUser?' <canvas class="avatar pixelated-avatar needs-drawing hide" data-image-url="'+__e(model.from_tumblelogs[i].avatar_url_48)+'" width="23" height="23" alt="'+__e(model.from_tumblelogs[i].name)+'"> ':' <a data-peepr=\'{"tumblelog":"'+__e(model.from_tumblelogs[i].name)+'"}\' target="_blank" href="'+__e(model.from_tumblelogs[i].tumblr_url)+'" class="avatar" style="background-image: url(\''+__e(model.from_tumblelogs[i].avatar_url_48)+'\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name">'+__e(model.from_tumblelogs[i].name)+"</span></a> ",
__p+=" </div></div> ";__p+=' </div><div class="activity-notification__activity_main"><span class="activity"> '+(null==(__t=model.message)?"":__t)+" </span> ",model.post&&model.post.summary&&(__p+=' <span class="summary">&#8220;'+__e(model.post.summary)+"&#8221;</span> "),__p+=' </div></div></div><a class="activity-notification__glass" target="_blank" href="'+__e(model.clickthrough_url)+'" data-peepr="'+__e(model.peepr_json)+'"></a><div class="activity-notification__icon"> ',model.post&&(__p+=' <a data-peepr="'+__e(model.peepr_json)+'" href="'+__e(model.post.url)+'" target="_blank" class="ui_post_badge '+__e(model.post.type)+'"></a> '),__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(185),n=i(642),o=i(9),r=i(130),a=s.extend({tagName:"li",className:"date_header date_activity clearfix",template:n,events:{},defaults:{},beforeRender:function(){var e=o();this.model.set("relativeDate",this.getRelativeDate(e))},getRelativeDate:function(e){var t=e.diff(this.model.attributes.dateHeader),i=o.duration(t).asHours(),s=Math.floor(i/24);return s<=0?r("Today"):s<=1?r("Yesterday"):r("%d days ago",s)},teardown:function(){return this.remove(),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="part_relative_date">'+__e(model.relativeDate)+'</div><div class="part_full_date">'+__e(model.dateHeader.format("dddd, MMMM D"))+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(143),n=s.extend({});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(137),r=i(173),a=i(139),l=i(140),c=i(171),u=i(172),h=i(149),d=i(645),p=i(646),g=i(647),_=i(649),f=i(650),m=i(653),v=i(660),b=i(406),y=i(675),w=i(676),k=i(681),C=i(682),x=i(711),S=i(779),T=i(673),E=i(661),P=i(780),I=i(781),F=i(703),N=i(438),A=new _,M={CONVERSATION_OPEN_TUMBLELOGS:"messaging:conversation:open:tumblelogs",CONVERSATION_OPEN_MODEL:"messaging:conversation:open:model",CONVERSATION_OPEN_ID:"messaging:conversation:open:id",CONVERSATION_OPEN_NAME:"messaging:conversation:open:name"},j=r.extend({name:"Messaging",defaults:{resetPollingTypingDebounceRate:3e4},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"inboxAnchorEl","inboxPopoverOptions")),this.eventBus=A,this.user=l(),this.channels=this._getChannelsEnabledForMessagingAsCollection(),this.activeWindow=new d,this.inboxCollection=new P,this.currentBlogModel=new S({channel:this._getInitiallySelectedChannel()}),this.favoritesCollection=new F,this.emptyInboxCollection=new F,this.unreadManager=new f({channels:this.channels}),this.inboxBadge=new k({el:this.inboxAnchorEl,channels:this.channels}).render(),this.messagingLogger=new p,this.messagingNotifier=new y({isEnabled:this.isDesktopNotificationEnabled(),notificationIcon:this.getMessagingNotificationIcon()}),this.keyboardManager=new b,this.windowPersistenceManager=new v({user:this.user,isSyncEnabled:!1}),this.notificationSoundManager=new w,this.searchImageQueries=new N,this.windowManager=new m({eventBus:this.eventBus,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,persistenceManager:this.windowPersistenceManager,inboxConfig:{constructor:C,options:{favoritesCollection:this.favoritesCollection,emptyInboxCollection:this.emptyInboxCollection,appendFavoritesToInboxLimit:this.getAppendFavoritesToInboxLimit(),isAutoFetch:!1,isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled()},popoverOptions:s.extend({autoTeardown:!0,pinnedSide:"bottom",isFixedPosition:!0,pinnedTarget:this.inboxAnchorEl},this.inboxPopoverOptions)},conversationConfig:{constructor:x,options:{isAutoFetch:!1,collection:this.searchImageQueries,imageUploadMaxBytes:this.getImageUploadMaxBytes(),canModifySafeMode:this.getCanModifySafeMode(),isSafeModeEnabled:o.bool("safe_mode")&&this.user.get("safe_mode")}}}),this._onConversationMessageInputThrottled=s.throttle(this._onConversationMessageInput,this.get("resetPollingTypingDebounceRate"),{leading:!0,trailing:!1}),this.listenTo(a,M.CONVERSATION_OPEN_TUMBLELOGS,this._onEventBusOpenConversationUsingTumblelogModels),this.listenTo(a,M.CONVERSATION_OPEN_MODEL,this._onEventBusOpenConversationUsingModel),this.listenTo(a,M.CONVERSATION_OPEN_ID,this._onEventBusOpenConversationUsingIdAndParticipant),this.listenTo(a,M.CONVERSATION_OPEN_NAME,this._onEventBusOpenConversationUsingBlogName),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this._onOpenConversationUsingConversationModel),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,this._onOpenConversationUsingParticipantModels),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,this._onConversationClickBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,this._onConversationClickMessagingBlog),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_DELETE_MODEL,this._onConversationDelete),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_FETCHING,this._onConversationFetching),this.listenTo(this.eventBus,this.eventBus.BLOCK,this._onBlock),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,this._onConversationMessagesSendRequested),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_SENT,this._onConversationMessageSent),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_FAILED,this._onConversationMessageFailed),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGE_INPUT,this._onConversationMessageInputThrottled),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED,this._playConversationSounds),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_MARK_AS_SPAM,this._onConversationMarkAsSpam),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this._onConversationImagePreviewAdd),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this._onConversationImagePreviewDismiss),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_PREVIEW_EDIT,this._onConversationImagePreviewEdit),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,this._onConversationImageLightbox),this.listenTo(this.eventBus,this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this._onConversationComposePluginClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,this._onEmptyInboxSuggestionClick),this.listenTo(this.eventBus,this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(this.eventBus,this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this._onEmptyInboxNewMessageClick),this.listenTo(a,"toaster:updateMessagingUnreadCounts",this._onPollUpdate),this.listenTo(a,"logout",this._onEventBusLogout),this.listenTo(this.currentBlogModel,"change",this._onCurrentBlogModelChange),this.listenTo(this.windowManager,"change",this._onWindowManagerChange),this.listenTo(this.unreadManager,"change:channel",this._onUnreadManagerChannelChange),this.listenTo(this.unreadManager,"change:conversation",this._onUnreadManagerConversationChange),this.listenTo(this.windowManager,"inbox:added",this._onWindowManagerInboxAdded),this.listenTo(this.windowManager,"inbox:removed",this._onWindowManagerInboxRemoved),this.listenTo(this.windowManager,"conversation:added",this._onWindowManagerConversationAdded),this.listenTo(this.windowManager,"conversation:removed",this._onWindowManagerConversationRemoved),this.listenTo(this.windowManager,"conversations:loaded",this._onWindowManagerConversationsLoaded),this.listenTo(this.windowManager,"conversation:minimized",this._onWindowManagerConversationMinimized),this.listenTo(this.windowManager,"conversation:unminimized",this._onWindowManagerConversationUnminimized),this.listenTo(this.messagingNotifier,"notification:display",this._onDesktopNotificationDisplayed),this.listenTo(this.messagingNotifier,"notification:permission:change",this._onDesktopNotificationPermissionChange),this.listenTo(this.channels,"change:unread_messages_count_sum",s.debounce(s.bind(this._onChannelsUnreadMessageCountChange,this),0)),this.messagingPoller=new g({channels:this.channels,user:this.user,callback:s.bind(this._onPollUpdate,this),frequency:this.getPollingFrequencyInbox()}),this._onWindowManagerChange(this.windowManager)},render:function(){return this.inboxAnchorEl&&this.inboxAnchorEl.on("click.messaging",s.bind(this._onClickInboxAnchor,this)),this.windowManager.loadConversationsState(),this},openInboxPopover:function(){this.inboxPopover||(this.inboxPopover=this.windowManager.addInbox(this.inboxCollection))},openConversationPopover:function e(t,i){var e;return s.isEmpty(t.get("participantUuid"))&&t.set("participantUuid",this.getCurrentBlogId()),e=this.windowManager.getConversationPopover(t),this.windowManager.removeInbox(this.inboxCollection),e?void e.refresh(t):void this.windowManager.addConversation(t,{context:i})},fetchInbox:function(){var e=this.getCurrentBlogId();if(this._pendingInboxRequest&&this._pendingInboxBlog){if(e===this._pendingInboxBlog)return;this._pendingInboxRequest.abort()}this._pendingInboxBlog=e,this._pendingInboxRequest=this.inboxCollection.fetchInbox(e).always(s.bind(function(){this._pendingInboxRequest=null,this._pendingInboxBlog=null},this)).done(s.bind(function(){this.messagingLogger.logInboxOpened(this.inboxCollection.size())},this))},getCurrentChannel:function(){return this.currentBlogModel.getChannel()},getCurrentBlogId:function(){return this.currentBlogModel.getId()},getPollingFrequencyInbox:function(){return s.get(this.data,"polling_frequency_inbox")},getCanModifySafeMode:function(){return s.get(this.data,"can_modify_safe_mode")},getPollingFrequencyConversation:function(){return s.get(this.data,"polling_frequency_conversation")},getAppendFavoritesToInboxLimit:function(){return s.get(this.data,"append_favorites_to_inbox_limit")},isDesktopNotificationEnabled:function(){return s.get(this.data,"is_desktop_notifications_enabled",!1)},isNewEmptyInboxEnabled:function(){return s.get(this.data,"is_new_empty_inbox_enabled",!1)},getBackoffRatesInbox:function(){return[1,1,2,2,4]},getBackoffRatesConversation:function(){return[1,1,1,1,2,2,2,2,4,4,4,4,8,8,8,8,16]},getMessagingNotificationIcon:function(){return s.get(this.data,"messaging_notification_icon","")},getImageUploadMaxBytes:function(){return s.get(this.data,"image_upload_max_bytes",10485760)},_onWindowManagerInboxAdded:function(e,t){this.fetchInbox()},_onWindowManagerInboxRemoved:function(e,t){delete this.inboxPopover,this.messagingLogger.logInboxClosed()},_onWindowManagerConversationAdded:function(e,t,i){var n=s.get(i,"isFromPersistence",!1);t.isMinimized()||(t.fetch().always(s.bind(function(){n||this.messagingLogger.logConversationOpened(e,s.get(i,"context"))},this)),t.focus())},_onWindowManagerConversationRemoved:function(e,t,i){this.messagingLogger.logConversationClosed(e,s.get(i,"context"))},_onWindowManagerConversationsLoaded:function(e,t){0===e.length&&0===t.length||this.messagingLogger.logConversationWindowsLoaded(e,t)},_onWindowManagerConversationMinimized:function(e,t){this.messagingLogger.logConversationMinimized(e)},_onWindowManagerConversationUnminimized:function(e,t){this.messagingLogger.logConversationUnminimized(e)},_getChannelsEnabledForMessagingAsCollection:function(){return new I(s.invoke(this.user.getChannelsEnabledForMessaging(),"toJSON"))},_getInitiallySelectedChannel:function(){return this.channels.get(this.user.getCurrentMessagingChannelUuid())||s.first(this.channels.models)},_onClickInboxAnchor:function(e){e.preventDefault(),this.openInboxPopover()},_onEventBusOpenConversationUsingIdAndParticipant:function(e,t,i){this._openConversationUsingIdAndParticipant(e,t,i)},_onEventBusOpenConversationUsingTumblelogModels:function(e,t){this._openConversationUsingTumblelogModels(e,t)},_onEventBusOpenConversationUsingModel:function(e,t){this.openConversationPopover(e,t)},_onEventBusOpenConversationUsingBlogName:function(e,t){this._openConversationFromBlogName(e,t)},_onOpenConversationUsingConversationModel:function(e,t){this.openConversationPopover(e,t)},_openConversationUsingIdAndParticipant:function(e,t,i){var n=new E({id:e,participantUuid:t});n.fetchConversation().then(s.bind(function(){this.openConversationPopover(n,i)},this))},_openConversationUsingTumblelogModels:function(e,t){var i=s.map(e,function(e){return new T(e.toJSON(),{parse:!0})});this._onOpenConversationUsingParticipantModels(i,t)},_onOpenConversationUsingParticipantModels:function(e,t){var i=new T(this.getCurrentChannel().toJSON()),n=s.find(e,function(e){return e.get("name")===i.get("name")});if(s.isEmpty(n)){var o=new E({participants:[i].concat(e),participantUuid:this.getCurrentBlogId()});this.openConversationPopover(o,t)}},_onPollUpdate:function(e){e=s.get(e,"unread_messages"),s.get(e,"error")!==!0&&this.unreadManager.setData(e)},_onConversationClickBlog:function(e){var t=s.get(e,"url"),i=s.get(e,"blogName"),n=s.get(e,"postId"),o=s.get(e,"searchTagTerm"),r=s.get(e,"originalEvent");r&&r.preventDefault(),a.trigger("peepr-open-request",{url:t,tumblelog_name:i,post_id:n,searchTagTerm:o}),this.messagingLogger.logPeeprOpen(t,i,n,o)},_onConversationClickMessagingBlog:function(e){var t=s.get(e,"blogName"),i=s.get(e,"originalEvent");i&&i.preventDefault(),this._openConversationFromBlogName(t,"conversation-permalink"),this.messagingLogger.logMessagingPermalinkOpen(t)},_onDesktopNotificationDisplayed:function(e){this.messagingLogger.logNotification(e)},_onDesktopNotificationPermissionChange:function(e){e?this.messagingLogger.logNotificationPermissionGranted():this.messagingLogger.logNotificationPermissionDenied()},_onConversationMarkAsSpam:function(e,t){var i;e&&t&&(i=n("%1$s will be blocked and reported. And any trace of this conversation will disappear from your inbox.",t.get("name")),u.confirm(i,s.bind(function(){this.messagingLogger.logConversationSpamIntent(e),this._removeConversation(e),e.markAsSpam().then(s.bind(function(){this.messagingLogger.logConversationSpamSuccess(e)},this)).fail(s.bind(function(){this.messagingLogger.logConversationSpamFail(e)},this))},this),null,n("Mark it spam"),n("Nevermind")))},_onConversationImagePreviewAdd:function(e,t){this.messagingLogger.logImagePreviewAdd(e,t)},_onConversationImagePreviewDismiss:function(e,t){this.messagingLogger.logImagePreviewDismiss(e,t)},_onConversationImagePreviewEdit:function(e,t){this.messagingLogger.logImagePreviewEdit(e,t)},_onConversationImageLightbox:function(e){var t=s.get(e,"lightBoxImageData"),i=s.get(e,"lightBoxIndex",0);a.trigger("lightbox-open-request",t,i)},_onConversationComposePluginClick:function(e,t){this.messagingLogger.logComposePluginClick(e,t)},_onBlock:function(e,t){s.isEmpty(e)||c.confirmBlock(e).then(s.bind(function(){c.block(e).then(s.bind(function(){this._onBlockSuccess(e,t)},this))},this))},_onBlockSuccess:function(e,t){s.isEmpty(e)||(t&&this._removeConversation(t),a.trigger("blocks:block_added",{loggingData:{from:"messaging"}}),this.messagingLogger.logBlock(e))},_removeConversation:function(e){this.windowManager.removeConversation(e),this.inboxCollection.remove(e)},_copyCollectionData:function(e,t){t.reset(e.models),t.setNextLink(e.getNextLink())},_onCurrentBlogModelChange:function(){var e=this.currentBlogModel.getPrevChannel(),t=this.currentBlogModel.getChannel();e&&this._copyCollectionData(this.inboxCollection,e.get("conversations")),t&&(this._copyCollectionData(t.get("conversations"),this.inboxCollection),this.user.setCurrentMessagingChannelUuid(t.get("uuid"))),this.fetchInbox()},_onConversationDelete:function(e){u.confirm(n("Permanently delete this conversation?"),s.bind(function(){this.messagingLogger.logConversationDeleted(e),e.destroy(),this.windowManager.removeConversation(e),this.inboxCollection.remove(e.get("id"))},this),null,n("Delete"),n("Nevermind"))},_onConversationFetching:function(e){this.unreadManager.setConversationModelCount(e,0)},_onUnreadManagerChannelChange:function(e,t){var i=this.getCurrentChannel(),n=s.sum(t);this.windowManager.isInboxOpen()&&i===e&&this.fetchInbox(),e.set("unread_messages_count_sum",n)},_onUnreadManagerConversationChange:function(e,t,i){this._generateBrowserNotification(e,t,i),this._setConversationUnreadCount(e,t,i)},_onChannelsUnreadMessageCountChange:function(e,t){var i=e.previous("unread_messages_count_sum");t>i&&this._playSoundName("notification-sound")},_playConversationSounds:function(){this._playSoundName("receive-sound")},_playSoundName:function(e){this.user.isSoundsEnabled()&&this.notificationSoundManager.playSoundName(e)},_setConversationUnreadCount:function(e,t,i){var s=this.windowManager.getConversationModelByIdAndParticipant(e,i.get("uuid"));s&&s.set("unreadCount",t)},_generateBrowserNotification:function(e,t,i){var s,n=!1;t<=0||(this.activeWindow.isActive&&this.windowManager.get("isConversationOpen")?(s=this.windowManager.getConversationModelByIdAndParticipant(e,i.get("uuid")),s&&this.windowManager.isConversationMinimized(s)&&(n=!0)):n=!0,n&&this.messagingNotifier.notifyOnUnread(e,i))},_showErrorMessage:function(e){u.alert(e)},_onWindowManagerChange:function(e){var t,i,s=e.isInboxOpen(),n=e.isConversationOpen(),o=s||n;return this.user.isVerifiedEmail()&&o?(n?(t=this.getPollingFrequencyConversation(),i=this.getBackoffRatesConversation()):(t=this.getPollingFrequencyInbox(),i=this.getBackoffRatesInbox()),this.messagingPoller.setFrequency(t),this.messagingPoller.setBackoffRates(i),void this.messagingPoller.start()):void this.messagingPoller.stop()},_onConversationMessagesSendRequested:function(){this._playSoundName("send-sound")},_onConversationMessageSent:function(e,t){this.messagingLogger.logMessageSent(e,t)},_onConversationMessageFailed:function(e,t){this.messagingLogger.logMessageFailed(e,t)},_onConversationMessageInput:function(e,t){this.messagingPoller.resetPollingFrequency(),this.messagingPoller.poll()},_openConversationFromBlogName:function(e,t){var i=new h({name:e});return i.fetch_popover_data().then(s.bind(function(){return s.isEmpty(i.get("uuid"))?void this._showErrorMessage(n("Could not load conversation.")):i.get("can_receive_messages")?void this._openConversationUsingTumblelogModels([i],t):void this._showErrorMessage(n("This Tumblr can't receive messages."))},this))},_onEventBusLogout:function(){this.windowPersistenceManager.clear()},_onEmptyInboxNewMessageClick:function(e){this.messagingLogger.logInboxEmptyNewMessageClick(this.currentBlogModel.getChannel().get("name"),e)},_onEmptyInboxSuggestionClick:function(e,t,i){this.messagingLogger.logEmptySuggestionClick(this.currentBlogModel.getChannel().get("name"),e.get("name"),t,i)}});e.exports=j},function(e,t,i){"use strict";var s=i(3),n=function(){window.onfocus=s.bind(this.onFocus,this),window.onblur=s.bind(this.onBlur,this)};n.prototype.onFocus=function(e){this.isActive=!0},n.prototype.onBlur=function(e){this.isActive=!1},n.prototype.isActive=!0;var o,r=function(){return null==o&&(o=new n),o};e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(139),r=n.extend({name:"MessagingLogger",defaults:{namespace:"messaging-interaction",isDebugEnabled:!1,platform:"web"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},logInboxOpened:function(e){var t={conversationCount:e};this._logIt("inbox:open",t)},logInboxClosed:function(){this._logIt("inbox:closed")},logConversationOpened:function(e,t){this._logIt("conversation:open",{conversationId:e.get("id"),context:t})},logConversationClosed:function(e,t){this._logIt("conversation:closed",{conversationId:e.get("id"),context:t})},logConversationDeleted:function(e){this._logIt("conversation:deleted",{conversationId:e.get("id")})},logConversationStarted:function(e,t){this._logIt("conversation:started",{context:t})},logMessageSent:function(e,t){!s.isEmpty(t)&&t.isNew()&&this.logConversationStarted(t),this._logIt("message:sent",this._getMessageLoggingData(e,t))},logMessageFailed:function(e,t){this._logIt("message:failure",this._getMessageLoggingData(e,t))},logFollow:function(e){this._logIt("conversation:follow",{blogName:e})},logBlock:function(e){this._logIt("block",{blockingBlog:e.currentTumblelog,blockedBlog:e.blockedTumblelog})},logNotification:function(e){this._logIt("notification:display",{conversationId:e})},logNotificationPermissionGranted:function(){this._logIt("notification:permission:granted")},logNotificationPermissionDenied:function(){this._logIt("notification:permission:denied")},logConversationWindowsLoaded:function(e,t){this._logIt("conversation:windows:loaded",{numOpen:e.length,numMinimized:t.length})},logConversationMinimized:function(e){this._logIt("conversation:minimized",{conversationId:e.get("id")})},logConversationUnminimized:function(e){this._logIt("conversation:unminimized",{conversationId:e.get("id")})},logConversationSpamIntent:function(e){this._logIt("conversation:spam:intent",{conversationId:e.get("id")})},logConversationSpamSuccess:function(e){this._logIt("conversation:spam:success",{conversationId:e.get("id")})},logConversationSpamFail:function(e){this._logIt("conversation:spam:fail",{conversationId:e.get("id")})},logImagePreviewAdd:function(e,t){this._logImagePreviewAction("add",e,t)},logImagePreviewDismiss:function(e,t){this._logImagePreviewAction("dismiss",e,t)},logImagePreviewEdit:function(e,t){this._logImagePreviewAction("edit",e,t)},logComposePluginClick:function(e,t){var i,n=t.getName();s.isEmpty(n)||(i=n+":intent",this._logIt(i,{conversationId:e.get("id")}))},logPeeprOpen:function(e,t,i,n){var o={url:e,blogName:t};s.isEmpty(i)||s.extend(o,{postId:i}),s.isEmpty(n)||s.extend(o,{searchTagTerm:n}),this._logIt("peepr:open",o)},logMessagingPermalinkOpen:function(e){var t={blogName:e};this._logIt("conversation-permalink:open",t)},logInboxEmptyNewMessageClick:function(e,t){var i={blogName:e},s=t?"new:inbox:empty:new-message:button:click":"old:inbox:empty:new-message:button:click";this._logIt(s,i)},logEmptySuggestionClick:function(e,t,i,s){var n={sendingBlog:e,receivingBlog:t,context:i},o=s?"new:inbox:empty:suggestion":"old:inbox:empty:suggestion";this._logIt(o,n)},_logImagePreviewAction:function(e,t,i){var n,o,r,a=i.get("context");s.isEmpty(a)||(n=i.get("loggingData"),o=a+":"+e,r=s.extend({},n,{conversationId:t.get("id")}),this._logIt(o,r))},_getMessageLoggingData:function(e,t){var i,n,o,r,a,l,c,u,h;return s.isEmpty(e)?null:(l=e.isPost(),i=l?0:(e.getMessage()||"").length,n=e.get("type"),o=e.get("context"),a=e.get("loggingData"),h=e.get("creationUserAction"),r=s.extend({},a,{conversationId:t?t.get("id"):null,messageLength:i,messageType:n}),s.isEmpty(h)||s.extend(r,{creationUserAction:h}),l&&(c=e.get("post").toJSON(),u=s.get(c,"blog.uuid")||s.get(c,"blog"),s.extend(r,{postBlogUuid:u,postId:s.get(c,"id")})),s.isEmpty(o)||s.extend(r,{context:o}),r)},_logIt:function(e,t){t=t||{},s.extend(t,{platform:this.get("platform")}),o.trigger(this.get("namespace")+":"+e,{loggingData:t})}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(648),o=n.extend({name:"MessagingPoller",defaults:s.defaults({url:"/services/poll",frequency:15e3},n.prototype.defaults),initialize:function(e){var t;return e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"channels","user")),t=s.pluck(s.where(this.channels.toJSON(),{is_messaging_bot:!1}),"mention_key"),this._requestData={token:this.user.get("polling_token"),unread_messages:!0,mention_keys:t.join(",")},n.prototype.initialize.apply(this,arguments)},getRequestData:function(){return this._requestData},hasResponseChanged:function(e){return!s.isEmpty(s.get(e,"unread_messages"))}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(173),r=o.extend({name:"BasePoller",defaults:{url:null,requestType:"GET",dataType:"JSON",cache:!1,frequency:6e4,backoffRates:[],stopAfterNumErrors:3,isPolling:!1,hasPolled:!1,isDebugEnabled:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"callback")),this.currentErrorCount=0,this.currentUnchangedCount=0},start:function(e){this.set("isPolling",!0),e?this.scheduleNextPoll():this.poll()},stop:function(){this.set("isPolling",!1),this.cancel()},cancel:function(){this.cancelCurrent(),this.cancelNext()},cancelCurrent:function(){this._currentRequest&&(s.result(this._currentRequest,"abort"),this._currentRequest=null)},cancelNext:function(){this._nextPollToken&&(clearTimeout(this._nextPollToken),this._nextPollToken=null)},beforeRemove:function(){this.stop()},setFrequency:function(e){this.set("frequency",e),this.resetPollingFrequency()},setBackoffRates:function(e){this.set("backoffRates",e),this.resetPollingFrequency()},resetPollingFrequency:function(){this.currentUnchangedCount=0,this.set("hasPolled",!1)},poll:function(){this.cancel(),this._lastPollTime=(new Date).getTime();var e=this.makeRequest.call(this);return e.done(s.bind(this._onRequestSuccess,this)).fail(s.bind(this._onRequestFail,this)).always(s.bind(this._onRequestAlways,this)),this._currentRequest=e,e},getRequestData:function(){return{}},hasResponseChanged:function(){return!0},resetErrorCount:function(){this.currentErrorCount=0,this.start()},parse:function(e){return e},getBackoffRate:function(){var e,t=this.get("backoffRates");return s.isEmpty(t)||!s.isArray(t)||0===this.currentUnchangedCount?1:(e=Math.min(this.currentUnchangedCount,t.length)-1,Math.max(1,s.get(t,e,1)))},getPollingFrequency:function(){return this.get("frequency")*this.getBackoffRate()},makeRequest:function(){var e=this.getRequestData(),t={url:this.get("url"),type:this.get("requestType"),dataType:this.get("dataType"),cache:this.get("cache"),data:e};return n.ajax(t)},scheduleNextPoll:function(){var e=this.getPollingFrequency();return this.set("hasPolled",!0),!!this.get("isPolling")&&void(!s.isFinite(e)||e<=0||(this.currentErrorCount<=this.get("stopAfterNumErrors")?(this.cancelNext(),this._nextPollToken=setTimeout(s.bind(this.poll,this),e)):this.stop()))},_onRequestSuccess:function(e){this.currentErrorCount=0,e=this.parse(e),this.callback&&this.callback(e,this._lastPollTime),this.hasResponseChanged(e)||!this.get("hasPolled")?this.currentUnchangedCount=0:this.currentUnchangedCount++},_onRequestFail:function(){this.currentErrorCount++},_onRequestAlways:function(){this.scheduleNextPoll()}});e.exports=r},function(e,t,i){"use strict";var s=i(7),n=i(3),o={CONVERSATION_FETCHING:"conversation:fetching",CONVERSATION_OPEN_CONVERSATION_MODEL:"conversation:open:model:conversation",CONVERSATION_OPEN_PARTICIPANT_MODELS:"conversation:open:model:partipants",CONVERSATION_OPEN_TUMBLR_URL:"conversation:open:tumblr:url",CONVERSATION_OPEN_MESSAGING_URL:"conversation:open:messaging:url",CONVERSATION_DELETE_MODEL:"conversation:delete:model",CONVERSATION_MESSAGE_SENT:"conversation:message:sent",CONVERSATION_MESSAGE_SENDING:"conversation:message:sending",CONVERSATION_MESSAGE_FAILED:"conversation:message:failed",CONVERSATION_MESSAGE_INPUT:"conversation:message:input",CONVERSATION_MESSAGES_SEND_REQUESTED:"conversation:messages:send:requested",CONVERSATION_MESSAGES_SENDING:"conversation:messages:sending",CONVERSATION_MESSAGES_UNREAD_FETCHED:"conversation:messages:unread:fetched",CONVERSATION_MARK_AS_SPAM:"conversation:spam",CONVERSATION_IMAGE_PREVIEW_ADD:"conversation:image:preview:add",CONVERSATION_IMAGE_PREVIEW_DISMISS:"conversation:image:preview:dismiss",CONVERSATION_IMAGE_PREVIEW_EDIT:"conversation:image:preview:edit",CONVERSATION_IMAGE_LIGHTBOX:"conversation:image:lightbox",CONVERSATION_COMPOSE_PLUGIN_CLICK:"conversation:compose:plugin:click",BLOCK:"block",NEW_EMPTY_INBOX_SUGGESTION_CLICK:"new:inbox:suggestion:click",NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:"new:inbox:new-message:click",OLD_EMPTY_INBOX_SUGGESTION_CLICK:"old:inbox:suggestion:click",OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK:"old:inbox:new-message:click"},r=function(){};r.extend=s.Model.extend,n.extend(r.prototype,s.Events),n.extend(r.prototype,o),e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(173),o=i(651),r=n.extend({name:"MessagingUnreadManager",defaults:{dataChannelKey:"mention_key",overridesExpirationInMs:500},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"channels"));var t=this.channels.map(function(e){return{channelId:e.get("uuid")}});this.unreadCollection=new o(t),this.unreadCollectionOverrides=new o(t),this.listenTo(this.unreadCollection,"change:data",this._onUnreadCollectionChange)},setData:function(e){this._pruneOverrides(),this._updateUnreadCollection(e),this.unreadData=e},setConversationModelCount:function(e,t){var i,s=e.get("id"),n=e.get("participantUuid"),o=this.unreadCollectionOverrides.findWhere({channelId:n});o&&(i=o.get("data")||{},i[s]=t,o.set({data:i,updateDate:new Date}),this._updateUnreadCollection(this.unreadData))},_getOverridesData:function(){var e=this.get("dataChannelKey");return this.unreadCollectionOverrides.reduce(function(t,i){var n=i.get("data"),o=this.channels.get(i.get("channelId")),r=o.get(e);return s.isEmpty(n)||(t[r]=n),t},{},this)},_pruneOverrides:function(){var e=new Date,t=this.get("overridesExpirationInMs");this.unreadCollectionOverrides.each(function(i){var n=i.get("updateDate");s.isDate(n)&&e-n>t&&i.set({updateDate:null,data:null})})},_updateUnreadCollection:function(e,t){var i=this._getOverridesData();this.unreadCollection.each(function(t){var n=this.channels.get(t.get("channelId")),o=n.get(this.get("dataChannelKey")),r=s.get(e,o),a=s.get(i,o);s.isEmpty(a)||(r=s.merge({},r,a)),t.set("data",r)},this)},_onUnreadCollectionChange:function(e){var t,i=e.get("data")||null,n=e.previous("data")||null,o=this.channels.get(e.get("channelId"));this.trigger("change:channel",o,i),s.each(i,function(e,i){t=s.get(n,i),t!==e&&this.trigger("change:conversation",i,e,o)},this)}});e.exports=r},function(e,t,i){"use strict";var s=i(148),n=i(652),o=s.extend({model:n});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({idAttribute:"channelId",defaults:{channelId:null,data:null}});e.exports=n},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(150),r=i(173),a=i(654),l=i(655),c=i(657),u=i(658),h=i(659),d=r.extend({name:"MessagingWindowManager",defaults:{isInboxOpen:!1,isConversationOpen:!1,inboxAnimationSpeed:100,conversationAnimationSpeed:250,isMultipleOpenWindowsEnabled:!1,conversationPopoversContainerClass:"messaging-conversation-popovers",containerClass:"messaging-conversations-container",openConversationsContainerClass:"messaging-open-conversations",minimizedConversationsContainerClass:"messaging-minimized-conversations",bodyClassConversationsHasOpen:"messaging-conversations-open",bodyClassConversationsHasMinimized:"messaging-conversations-minimized",containerClassConversationsHasOpen:"has-open",containerClassConversationsHasMinimized:"has-minimized",persistenceKeyOpen:"open",persistenceKeyMinimized:"minimized"},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"eventBus","user","channels","currentBlogModel","keyboardManager","inboxConfig","conversationConfig","persistenceManager")),this.openConversations=new l,this.minimizedConversations=new l,this.onlineStatusModel=new c,this.onlineStatusModel.on("sync",this._setParticipantOnlineStatuses,this),this.listenTo(this.openConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onConversationsCollectionChange),this.listenTo(this.openConversations,"add remove",this._onOpenConversationsCollectionChange),this.listenTo(this.minimizedConversations,"add remove",this._onMinimizedConversationsCollectionChange),
this.listenTo(this.openConversations,"add",this._onConversationAdd),this.listenTo(this.openConversations,"remove",this._onConversationRemove),this.listenTo(this.minimizedConversations,"add",this._onConversationAdd),this.listenTo(this.minimizedConversations,"remove",this._onConversationRemove),this.persistenceManager&&this.listenTo(this.persistenceManager,"sync",this._onPersistenceManagerSync)},remove:function(e){this.isInboxOpen()&&this.removeInbox(),this.isConversationOpen()&&this.removeConversations(e)},saveConversationsState:function(e,t){this.persistenceManager&&!this.get("isSyncing")&&this.persistenceManager.save(e.pluck("model"),t)},loadConversationsState:function(){var e,t;this.persistenceManager&&(t=this.persistenceManager.load(this.get("persistenceKeyMinimized")),e=this.persistenceManager.load(this.get("persistenceKeyOpen")),t.then(n.bind(function(e){var t=this;this._addLoadedConversationModels(e,this.minimizedConversations,{isMinimized:!0}),e.length&&setTimeout(function(){t._getOnlineStatusOfParticipants(e)},1e3),this.trigger("conversations:loaded:minimized",e)},this)),e.then(n.bind(function(e){this._addLoadedConversationModels(e,this.openConversations),this.trigger("conversations:loaded:open",e)},this)),o.join(e,t).spread(n.bind(function(e,t){this.trigger("conversations:loaded",e,t)},this)))},_addLoadedConversationModels:function(e,t,i){n.each(e,function(e,s){n.delay(n.bind(function(){this._addLoadedConversationModel(e,t,i)},this),s)},this)},_getOnlineStatusOfParticipants:function(e){this.otherParticipants=e.map(function(e){return e.getOtherParticipant()}),this.onlineStatusModel.fetch({data:{participantIds:this.otherParticipants.map(function(e){return e.get("uuid")})}})},_setParticipantOnlineStatuses:function(e){var t=this;e=e.toJSON(),n.forIn(e,function(e,i){var s=n.find(t.otherParticipants,function(e){return e.get("name")===i});s.set("seconds_since_last_activity",e)}),delete this.otherParticipants},_addLoadedConversationModel:function(e,t,i){var s={skipAnimationOnRender:!0},n=this._createConversationPopover(e,s,i),o={isFromPersistence:!0,context:"persistence"};return t.add({model:e,popover:n,options:o},o)},addInbox:function(e,t){var i=this.get("inboxAnimationSpeed");return this.isInboxOpen()?this.inboxPopover:(this.inboxCollection=e,this.inboxPopover=this._createInboxPopover(e),this.trigger("inbox:adding",e,this.inboxPopover,t),i>0?setTimeout(n.bind(function(){this._afterInboxOpened(t)},this),i):this._afterInboxOpened(t),this.listenToOnce(this.inboxPopover,"close",function(){this._onInboxClose(t)}),this.set("isInboxOpen",!0),this.inboxPopover)},removeInbox:function(e){e||(e=this.inboxCollection),e===this.inboxCollection&&this.inboxPopover&&this.inboxPopover.teardown()},isInboxOpen:function(){return this.get("isInboxOpen")},addConversation:function(e,t){var i,s=this.get("isMultipleOpenWindowsEnabled");return s||this.minimizeConversations(!0),i=this._createConversationPopover(e),e.set("lastOpenedDateTs",(new Date).getTime()),this.openConversations.add({model:e,popover:i,options:t}),i},removeConversation:function(e,t){var i=this._getWindowModel(e);this.openConversations.remove(i,{skipAnimation:t})},isConversationMinimized:function(e){var t,i=this.getConversationPopover(e);return!!i&&(t=i.getView(),t&&t.isMinimized())},removeConversations:function(e){this.openConversations.remove(this.openConversations.models,{skipAnimation:e})},isConversationOpen:function(){return this.get("isConversationOpen")},getConversationPopover:function(e){var t=this._getWindowModel(e);return t?t.getPopover():null},getConversationModelByIdAndParticipant:function(e,t){return this.openConversations.getByIdAndParticipant(e,t)||this.minimizedConversations.getByIdAndParticipant(e,t)},minimizeConversations:function(e){var t=n.clone(this.openConversations.models);n.each(t,function(t){t.getView().minimize(e)})},_createConversationPopover:function(e,t,i){var s,o=n.result(this.conversationConfig,"options"),r=n.get(this.conversationConfig,"constructor"),a=n.get(this.conversationConfig,"popoverOptions"),l=n.bind(function(t){return n.extend({},o,{eventBus:this.eventBus,user:this.user,channels:this.channels,model:e,popoverContainer:t.el,keyboardManager:this.keyboardManager},i)},this);return a=n.extend({},a,{viewConstructor:r,viewOptions:l},t),this.conversationsPopoversContainer||this._createConversationsPopoversContainer(),s=new u(a),s.render(),this._removeTimer&&clearTimeout(this._removeTimer),s},_createInboxPopover:function(e){var t,i=n.result(this.inboxConfig,"options"),s=n.get(this.inboxConfig,"constructor"),o=n.result(this.inboxConfig,"popoverOptions"),r=n.bind(function(t){return n.extend({},i,{eventBus:this.eventBus,collection:e,user:this.user,channels:this.channels,currentBlogModel:this.currentBlogModel,keyboardManager:this.keyboardManager,popoverContainer:t.el})},this);return o=n.extend({},o,{viewConstructor:s,animationSpeed:this.get("inboxAnimationSpeed"),viewOptions:r}),t=new a(o),t.render(),t},_removeConversationPopover:function(e,t){var i=this.get("conversationAnimationSpeed");t||i<=0?e.remove():e.teardown(),this._checkRemoveConversationPopoversContainer(t)},_checkRemoveConversationPopoversContainer:function(e){var t=this.get("conversationAnimationSpeed"),i=function(){var e=this.openConversations.length>0,t=this.minimizedConversations.length>0;e||t||this._removeConversationPopoversContainer()};this._removeTimer&&(clearTimeout(this._removeTimer),this._removeTimer=null),e||t<=0?i.call(this):this._removeTimer=setTimeout(n.bind(function(){i.call(this),this._removeTimer=null},this),t)},_focusNextConversationWindow:function(e){return this._incrementFocusConversationWindow(e,1)},_focusPreviousConversationWindow:function(e){return this._incrementFocusConversationWindow(e,-1)},_incrementFocusConversationWindow:function(e,t){var i,s,o,r,a,l=[];return l.push.apply(l,this.openConversations.models),l.push.apply(l,this.minimizedConversations.models),a=l.length,!(a<2)&&(i=n.indexOf(l,e),s=i+=t,!(s>=a||s<0)&&(o=n.get(l,s),!n.isEmpty(o)&&(r=o.getPopover(),r.focus(),!0)))},_callAfterDelay:function(e,t){t>0?setTimeout(n.bind(e,this),t):e.call(this)},_onConversationAdd:function(e,t,i){var s=n.get(i,"isMoving",!1);s||this._afterConversationWindowModelAdded(e,i)},_onConversationRemove:function(e,t,i){var s=n.get(i,"skipAnimation",!1),o=n.get(i,"isMoving",!1);o||this._afterConversationWindowModelRemoved(e,s)},_onPersistenceManagerSync:function(e,t){this._syncFlushData||(this._syncFlushData={}),n.set(this._syncFlushData,e,t),this._syncFlushTimer||(this._syncFlushTimer=setTimeout(n.bind(function(){this._flushSync(this._syncFlushData),delete this._syncFlushTimer,delete this._syncFlushData},this),50))},_flushSync:function(e){var t=n.get(e,this.get("persistenceKeyOpen"),[]),i=n.get(e,this.get("persistenceKeyMinimized"),[]),s=this.openConversations.pluck("model"),o=this.minimizedConversations.pluck("model"),r=this._getConversationLookupCache(t),a=this._getConversationLookupCache(i),l=this._getConversationLookupCache(s),c=this._getConversationLookupCache(o),u=[],h=[],d=[],p=[];this.set("isSyncing",!0),n.each(l,n.bind(function(e,t){n.has(r,t)||(n.has(a,t)?h.push(e):u.push(e))},this)),d=n.reduce(c,n.bind(function(e,t,i){return!n.has(a,i)&&n.has(r,i)&&e.push(t),e},this),[]),p=n.reduce(r,n.bind(function(e,t,i){return n.has(l,i)||n.has(c,i)||e.push(t),e},this),[]),n.each(h,n.bind(function(e){var t=this.openConversations.getByConversationModel(e);t.getView().minimize(!0)},this)),n.each(d,n.bind(function(e){var t=this.minimizedConversations.getByConversationModel(e);t.getView().unminimize(!0)},this)),n.each(u,n.bind(function(e){this.removeConversation(e,!0)},this)),n.each(p,n.bind(function(e){this.addConversation(e)},this)),this.set("isSyncing",!1)},_getConversationLookupCacheKey:function(e){var t=[e.getParticipantId()].concat(e.getParticipantsIds());return t.join(":")},_getConversationLookupCache:function(e){return n.mapKeys(e,this._getConversationLookupCacheKey)},_insertElementAtIndex:function(e,t,i){var s=t.children();0===s.length||0===i?t.prepend(e):i>=s.length?t.append(e):e.insertBefore(n.get(s,i))},_onConversationWindowTab:function(e,t){this._focusNextConversationWindow(e)&&t.preventDefault()},_onConversationWindowShiftTab:function(e,t){this._focusPreviousConversationWindow(e)&&t.preventDefault()},_onMinimizedConversationsCollectionChange:function(e,t,i){n.get(i,"isFromPersistence")||this.saveConversationsState(this.minimizedConversations,this.get("persistenceKeyMinimized"))},_onOpenConversationsCollectionChange:function(e,t,i){n.get(i,"isFromPersistence")||this.saveConversationsState(this.openConversations,this.get("persistenceKeyOpen"))},_onConversationsCollectionChange:function(){var e=this.openConversations.length>0||this.minimizedConversations.length>0;this.set("isConversationOpen",e),this._addBodyClasses(),this._addContainerClasses()},_addBodyClasses:function(){var e=s("body");e.toggleClass(this.get("bodyClassConversationsHasOpen"),this.openConversations.length>0),e.toggleClass(this.get("bodyClassConversationsHasMinimized"),this.minimizedConversations.length>0)},_addContainerClasses:function(){var e=this.conversationsPopoversContainer;e&&(e.toggleClass(this.get("containerClassConversationsHasOpen"),this.openConversations.length>0),e.toggleClass(this.get("containerClassConversationsHasMinimized"),this.minimizedConversations.length>0))},_onInboxClose:function(e){var t=this.get("inboxAnimationSpeed");this.trigger("inbox:removing",this.inboxCollection,this.inboxPopover,e),this.set("isInboxOpen",!1),t>0?setTimeout(n.bind(function(){this._afterInboxClosed(e)},this),t):this._afterInboxClosed(e)},_onChangeConversationMinimized:function(e,t){var i=t?this.openConversations:this.minimizedConversations,s=t?this.minimizedConversations:this.openConversations,n=i.getByConversationModel(e),o=t?"conversation:minimized":"conversation:unminimized",r={isMoving:!0};t||this.get("isMultipleOpenWindowsEnabled")||this.minimizeConversations(!0),i.remove(n,r),s.add(n,r),this.trigger(o,n.getConversation(),n.getPopover())},_afterInboxOpened:function(e){this.trigger("inbox:added",this.inboxCollection,this.inboxPopover,e)},_afterInboxClosed:function(e){this.trigger("inbox:removed",this.inboxCollection,this.inboxPopover,e),this.inboxPopover=null,this.inboxCollection=null},_createConversationsPopoversContainer:function(){return this.conversationsPopoversContainer?this.conversationsPopoversContainer:(this.conversationsPopoversContainer=s("<div />").addClass(this.get("conversationPopoversContainerClass")),this.openConversationsContainer=new h({collection:this.openConversations,className:[this.get("containerClass"),this.get("openConversationsContainerClass")].join(" ")}).render(),this.minimizedConversationsContainer=new h({collection:this.minimizedConversations,className:[this.get("containerClass"),this.get("minimizedConversationsContainerClass")].join(" "),isScrollEnabled:!0,isAdjustToBrowserHeightEnabled:!0}).render(),this.conversationsPopoversContainer.append(this.openConversationsContainer.$el),this.conversationsPopoversContainer.append(this.minimizedConversationsContainer.$el),s("body").append(this.conversationsPopoversContainer),this._addContainerClasses(),this.conversationsPopoversContainer)},_removeConversationPopoversContainer:function(){this.conversationsPopoversContainer&&(this.conversationsPopoversContainer.remove(),this.conversationsPopoversContainer=null),this.openConversationsContainer&&(this.openConversationsContainer.remove(),this.openConversationsContainer=null),this.minimizedConversationsContainer&&(this.minimizedConversationsContainer.remove(),this.minimizedConversationsContainer=null)},_getWindowModel:function(e){return this.openConversations.getByConversationModel(e)||this.minimizedConversations.getByConversationModel(e)},_addConversationWindowEvents:function(e){var t=e.getView();this.listenTo(t,"keydown:tab",function(t){this._onConversationWindowTab(e,t)}),this.listenTo(t,"keydown:shift+tab",function(t){this._onConversationWindowShiftTab(e,t)}),this.listenToOnce(t,"close",function(){this.removeConversation(e.getConversation())}),this.listenTo(t,"change:isMinimized",function(t,i){this._onChangeConversationMinimized(e.getConversation(),i)})},_afterConversationWindowModelAdded:function(e){var t=e.getConversation(),i=e.getPopover(),s=e.getOptions(),n=this.get("conversationAnimationSpeed"),o=function(){this.trigger("conversation:added",t,i,s)};this.trigger("conversation:adding",t,i,s),this._addConversationWindowEvents(e),this._callAfterDelay(o,n)},_afterConversationWindowModelRemoved:function(e,t){var i=this.get("conversationAnimationSpeed"),s=e.getView(),o=e.getPopover(),r=e.getConversation(),a=e.getOptions(),l=function(){this.trigger("conversation:removed",r,o,a)};this.stopListening(o),this.stopListening(s),this._removeConversationPopover(o,t),this.trigger("conversation:removing",r,o,a),t||i<=0?l.call(this):setTimeout(n.bind(l,this),i)}});e.exports=d},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(242),a=o.extend({className:"popover--inbox-popover",mixins:[r],defaults:{animationSpeed:100},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"viewOptions","viewConstructor"))},render:function(){return this.$wrapper=n("<div />").addClass("popover-inner").appendTo(this.$el),this.$wrapper.addClass("hide-popover"),this.$pinned.addClass("active"),this._createView(this.viewOptions),s.defer(s.bind(function(){this.$wrapper.removeClass("hide-popover")},this)),this},teardown:function(){var e=this.get("animationSpeed");return this.$wrapper.addClass("hide-popover"),this.$pinned.removeClass("active"),e>0?setTimeout(s.bind(this._afterHide,this),this.get("animationSpeed")):this._afterHide(),this},getView:function(){return this.inboxView},_createView:function(e){e=s.isFunction(e)?e.call(this,this):e,this.inboxView&&this.inboxView.remove(),this.inboxView=new this.viewConstructor(e),this.$wrapper.html(this.inboxView.render().$el)},_afterHide:function(){this.inboxView&&this.inboxView.remove(),this.$el.remove()}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(656),r=n.extend({model:o,comparator:function(e){return e.getConversation().get("lastOpenedDateTs")},getByIdAndParticipant:function(e,t){var i=this.find(function(i){var s=i.getConversation();return s.get("id")===e&&s.get("participantUuid")===t});return i?i.getConversation():null},getByConversationModel:function(e){return this.find(function(t){var i=t.getConversation();return!s.isEmpty(i)&&i.isSameConversation(e)})}});e.exports=r},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{popover:null,model:null,options:null,skipAnimation:!1,isMinimizing:!1},getOptions:function(){return this.get("options")},getConversation:function(){return this.get("model")},getPopover:function(){return this.get("popover")},getView:function(){var e=this.getPopover();return e?e.getView():null}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(143),o=n.extend({url:"/svc/onlinestatus",parse:function(e){return s.result(e,"response")||{}}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.extend({className:"popover--conversation-popover",defaults:{animationSpeed:250,skipAnimationOnRender:!1,skipAnimationOnRemove:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"viewOptions","viewConstructor")),s.isFunction(this.viewOptions)&&(this.viewOptions=this.viewOptions.call(this,this))},render:function(){return this.conversationView=new this.viewConstructor(this.viewOptions),this.$el.html(this.conversationView.render().$el),!this.get("skipAnimationOnRender")&&this.get("animationSpeed")>=0&&this._animateIn(),this},teardown:function(){var e=this.get("animationSpeed");return!this.get("skipAnimationOnRemove")&&e>=0?(this.$el.addClass("hide-popover"),setTimeout(s.bind(this.remove,this),e)):this.remove(),this},beforeRemove:function(){this.conversationView&&this.conversationView.remove()},getView:function(){return this.conversationView},poll:function(){var e=this.getView();if(e)return e.poll()},refresh:function(e){var t=this.getView();if(t)return t.refresh(e)},fetch:function(){var e=this.getView();if(e)return e.fetch()},focus:function(){var e=this.getView();if(e)return e.focus()},isMinimized:function(){var e=this.getView();if(e)return e.isMinimized()},_animateIn:function(){this.$el.addClass("hide-popover"),s.defer(s.bind(function(){this.rendered&&this.$el.removeClass("hide-popover")},this))}});e.exports=o},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(185),r=i(427),a=o.extend({defaults:{isScrollEnabled:!1,isAdjustToBrowserHeightEnabled:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"collection"))},render:function(){return this.get("isScrollEnabled")?(this.$rootContainer=s("<div />").addClass("scroller").appendTo(this.$el),this.scrollBar=new r({el:this.$rootContainer.get(0)}),this.get("isAdjustToBrowserHeightEnabled")&&this.listenTo(this.scrollBar,"resize",this._onScrollResize)):this.$rootContainer=this.$el,this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this._renderAllPopovers(),this.scrollBar&&n.defer(n.bind(this._updateScroll,this)),this},remove:function(){this.scrollBar&&(this.stopListening(this.scrollBar),this.scrollBar.remove())},_renderAllPopovers:function(){var e=this.$rootContainer;this.rendered&&(e.empty(),this.collection.each(n.bind(function(t){var i=t.getPopover();this.rendered&&i&&e.append(i.$el)},this)))},_updateScroll:function(){this.rendered&&this.scrollBar&&(this.get("isAdjustToBrowserHeightEnabled")&&this._updateScrollHeight(),this.scrollBar.update())},_updateScrollHeight:function(){var e,t,i=89;this.scrollBar&&this.rendered&&(e=s(window).height(),t=this.$rootContainer.get(0).scrollHeight,this.$el.height(Math.min(e-i,t)),this.$rootContainer.scrollTop(t))},_onCollectionAdd:function(e,t,i){var s=e.getPopover(),o=s.$el,r=t.indexOf(e),a=this.$rootContainer,l=a.children();this.rendered&&(0===l.length||0===r?a.prepend(o):r>=l.length?a.append(o):o.insertBefore(n.get(l,r)),this.scrollBar&&this._updateScroll())},_onCollectionRemove:function(e,t,i){this.scrollBar&&n.defer(n.bind(this._updateScroll,this))},_onCollectionReset:function(e,t){this._renderAllPopovers()},_onScrollResize:function(){this._updateScrollHeight()}});e.exports=a},function(e,t,i){"use strict";var s=i(8),n=i(150),o=i(3),r=i(173),a=i(661),l=r.extend({name:"MessagingWindowPersistence",defaults:{storageKeyPrefix:"messaging",isSyncEnabled:!1},initialize:function(e){e=o.extend({},e),o.extend(this.attributes,o.pick(e,o.keys(this.defaults))),o.extend(this,o.pick(e,"user")),this.get("isSyncEnabled")&&this._addSyncListeners()},save:function(e,t){var i,s=n.defer(),r=this._getStorageKey(t);return i=o.map(e,this._getObjectFromModel),this._saveLocalStorage(r,i),s.resolve(),s.promise},load:function(e){var t=n.defer(),i=this._getStorageKey(e),s=this._loadLocalStorage(i),r=o.map(s,this._getModelFromObject);return t.resolve(r||[]),t.promise},clear:function(){var e,t=window.localStorage;if(t){e=this._getStorageKey();try{o.each(o.keys(t),function(i){o.startsWith(i,e+":")&&t.removeItem(i)})}catch(e){this._triggerError(e)}}},remove:function(){this.get("isSyncEnabled")&&this._removeSyncListeners()},_addSyncListeners:function(){s(window).on("storage.messaging-window-persistence",o.bind(this._onStorageChange,this))},_removeSyncListeners:function(){s(window).off(".messaging-window-persistence")},_onStorageChange:function(e){var t,i,s=o.get(e,"originalEvent.key"),n=o.get(e,"originalEvent.newValue"),r=this._getStorageKey(),a=s.substring(r.length+1);if(!o.isEmpty(s)&&!o.isEmpty(a)&&o.startsWith(s,r)&&!o.isEmpty(n))try{t=JSON.parse(n),i=o.map(t,this._getModelFromObject),this.trigger("sync",a,i),this.trigger("sync:"+a,i)}catch(e){this._triggerError(e)}},_getStorageKey:function(e){var t=[this.get("storageKeyPrefix"),this.user.get("name"),e];return o.compact(t).join(":")},_saveLocalStorage:function(e,t){if(window.localStorage)try{window.localStorage.setItem(e,JSON.stringify(t))}catch(e){this._triggerError(e)}},_loadLocalStorage:function(e){var t;if(!window.localStorage)return[];try{return t=window.localStorage.getItem(e),o.isEmpty(t)?[]:JSON.parse(t)}catch(e){return this._triggerError(e),[]}},_getObjectFromModel:function(e){var t=["uuid","url","name","avatar_url","theme"],i=e.get("participants").map(function(e){return e.pick(t)});return{id:e.get("id"),participantUuid:e.get("participantUuid"),participants:i,lastOpenedDateTs:e.get("lastOpenedDateTs")}},_getModelFromObject:function(e){return new a(e)},_triggerError:function(e){this.trigger("error",e)}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(662),r=i(663),a=i(143),l=i(664),c=i(670),u=i(672),h=a.extend({url:"/svc/conversations/messages",mixins:[o,r],relations:{messages:c,participants:u},relationsOrder:["participants","messages"],defaults:{id:null,status:null,last_modified_ts:null,last_read_ts:null,participants:null,messages:null,can_send:!0,is_possible_spam:!1,is_blurred_images:!1,lastOpenedDateTs:null,participantUuid:null,unreadCount:0},fetchNonErrorCodes:[404],fetchNoRetryOnErrorCodes:[403,429],isUnread:function(){return this.get("last_modified_ts")>this.get("last_read_ts")},flushMessageQueue:function(e){return this.flushQueue(this.sendMessage,e)},canRetryFetch:function(e){return s.isFinite(e)&&!s.contains(this.fetchNoRetryOnErrorCodes,e)},markAsRead:function(){var e=(new Date).getTime();this.set({last_read_ts:parseInt(e/1e3,10),unreadCount:0})},parse:function(e,t){var i=s.get(e,"response")||e;return s.get(t,"isFetchInbox")&&s.extend(i,this.pick("is_possible_spam","is_blurred_images")),i},destroy:function(e){var t={conversation_id:this.get("id"),participant:this.get("participantUuid")};return e=s.extend({},e,{url:this.url+"?"+n.param(t)}),a.prototype.destroy.call(this,e)},markAsSpam:function(e){e=e||"inline";var t={conversation_id:this.get("id"),participant:this.get("participantUuid"),context:e,type:"spam"};return n.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:t})},fetchConversation:function(e){var t=new n.Deferred,i=function(){t.resolve.apply(this,arguments)},o=function(){t.reject.apply(this,arguments)};return this.fetch(this._getFullFetchOptions(e)).then(s.bind(i,this)).fail(s.bind(function(e,t){var n=s.get(e,"status");this.isNew()&&s.contains(this.fetchNonErrorCodes,n)?i.call(this,{},t):o.apply(this,arguments)},this)),t},poll:function(e,t){var i;return this.isNew()?(new n.Deferred).reject():(i={participant:this.get("participantUuid"),conversation_id:this.get("id")},t&&s.extend(i,{limit:t}),this.get("messages").poll({isPolling:!0,data:i}))},getConversationDataForMessage:function(){var e={participant:this.get("participantUuid")};return this.isNew()?s.extend(e,{participants:this.getParticipantsIds()}):s.extend(e,{conversation_id:this.get("id")}),e},addMessage:function(e,t){return t=t||{},e.set(this.getConversationDataForMessage()),this.get("messages").add(e),e},sendMessage:function(e,t){return t=t||{},e.set(this.getConversationDataForMessage()),e.save(null,t).then(s.bind(function(e){var i=this.parse(e,t);this.isNew()?this.set(s.omit(i,"messages")):this.set(s.pick(i,"is_possible_spam"))},this))},getParticipantModel:function(){return this.get("participants").get(this.get("participantUuid"))},getParticipantId:function(){return this.get("participantUuid")},getParticipantsIds:function(){return this.get("participants").pluck("uuid")},getOtherParticipant:function(){var e=this.get("participants").getWithout([this.getParticipantId()]);return s.first(e)},getInboxMessage:function(){var e=this.get("messages").where({isError:!1});return s.last(e)},isSameConversation:function(e){var t=e.getParticipantId(),i=e.getParticipantsIds(),n=this.getParticipantId(),o=this.getParticipantsIds();return n===t&&s.union(o,i).length===o.length},unblurImages:function(){this.set("is_blurred_images",!1);var e={conversation_id:this.get("id"),participant:this.get("participantUuid"),type:"unblur"};n.ajax({url:"/svc/conversations/flag",method:"POST",withFormKey:!0,data:e})},shouldBlurImageMessage:function(e){return!(!this.get("is_blurred_images")||!e.isImage())&&e.get("participant")!==this.getParticipantId()},_getFullFetchOptions:function(e){var t=this.isNew()?this._getDataForFetchByParticipants():this._getDataForFetchById();return t=s.extend({},t,{participant:this.get("participantUuid")}),s.extend({},e,{isFetching:!0,cache:!1,reset:!0,data:t})},_getDataForFetchById:function(e){return{conversation_id:this.get("id")}},_getDataForFetchByParticipants:function(e){return{participants:this.getParticipantsIds()}}},{createPostMessage:function(e,t,i){return i=s.extend({},i,{type:l.POST,post:{blog:t,id:e}}),new l(i)},createTextMessage:function(e,t){return t=s.extend({},t,{type:l.TEXT,message:e,content:{text:e}}),new l(t)},createImagePostMessage:function(e,t,i,s,n,o){var r=h.createPostMessage(e,t,o),a=r.getPost();return a.setType("photo"),a.addThumbnail(i,s,n),r},createImageMessage:function(e,t,i,n,o){return o=s.extend({},o,{type:l.IMAGE,file:t,image:{original_size:{width:i,height:n,url:e}}}),new l(o)},createStickerMessage:function(e,t,i,n){return n=s.extend({},n,{type:l.STICKER,sticker_id:e,sticker:{url:t,original_size_url:i}}),new l(n)}});e.exports=h},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(145),r=new o({defaults:{relationKeys:function(){return s.keys(this.relations)},getRelations:function(){return s.pick(this.attributes,this.relationKeys())}},before:{initialize:function(e,t){this._bootstrapRelations(e,t)}},extend:{_isModelOrCollection:function(e){return e instanceof n.Collection||e instanceof n.Model},_bootstrapRelations:function(e,t){this._isBootstrapped||(s.forEach(this.relations,function(i,n){var o=this.attributes[n];!s.isEmpty(o)&&o instanceof i||(this.attributes[n]=new i(e[n],t))},this),this._isBootstrapped=!0)}},around:{set:function(e,t,i,o){var r,a,l,c,u,h,d=this.attributes,p=this.relationKeys(),g=!this._isBootstrapped;return s.isObject(t)?(r=t,o=i):(r={})[t]=i,o=o||{},u=s.result(o,"relationalSetOptions")||{},this._bootstrapRelations(r,o),a=s.pick(r,p),s.isEmpty(a)?e.apply(this,s.rest(arguments)):(h=s.isEmpty(this.relationsOrder)?s.keys(a):this.relationsOrder,g||s.forEach(h,function(e){r[e]&&(c=a[e],l=d[e],this._isModelOrCollection(l)&&(o.unset?l instanceof n.Collection?l.reset():l instanceof n.Model&&l.clear():(this._isModelOrCollection(c)&&(c=c.toJSON()),o.reset&&l instanceof n.Collection?l.reset(c,s.extend({},o,u[e])):l.set(c,s.extend({},o,u[e])))))},this),e.call(this,s.omit(r,p),o))},toJSON:function(e){var t=e.apply(this,s.rest(arguments))||{};for(var i in this.relations)this.relations.hasOwnProperty(i)&&(t[i]=s.result(t[i],"toJSON")||t[i]);return t}}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(145),r=new o({extend:{getQueue:function(){return this.queue||(this.queue=[]),this.queue},getQueueItems:function(){return s.pluck(this.getQueue(),"item")},clearQueue:function(){this.getQueue().length=0},isFlushingQueue:function(){return this._isFlushingQueue===!0},hasQueue:function(){return this.getQueue().length>0},appendToQueue:function(e,t){var i=this.getQueue();return e=this._getItemsAsArray(e),i.push.apply(i,this._constructItemWrappers(e,t)),i},prependToQueue:function(e,t){var i=this.getQueue();return e=this._getItemsAsArray(e),i.unshift.apply(i,this._constructItemWrappers(e,t)),i},removeFromQueue:function(e){return e=this._getItemsAsArray(e),this.queue=s.reduce(this.getQueue(),function(t,i){var n=s.get(i,"item");return s.contains(e,n)?t:(t.push(i),t)},[]),this.queue},flushQueue:function(e,t){var i,o=this.getQueue();return this._isFlushingQueue?this._flushQueueDeferred:s.isFunction(e)?(this._isFlushingQueue=!0,this._flushQueueDeferred=new n.Deferred,i=function(){var n,r,a;if(this._isFlushingQueue){if(0===o.length)return this._isFlushingQueue=!1,void this._onQueueSuccess(t);n=o.shift(),r=s.get(n,"item"),a=s.get(n,"options"),this._onQueueItemStart(r,a,t),e.call(this,r,a,t).then(s.bind(function(){this._onQueueItemSuccess(r,a,t),i.call(this)},this)).fail(s.bind(function(){this._isFlushingQueue=!1,this._onQueueItemFail(r,a,t)},this))}},i.call(this),this._flushQueueDeferred):(new n.Deferred).reject()},abortFlush:function(){this._isFlushingQueue&&(this._isFlushingQueue=!1,this._flushQueueDeferred.reject())},_getItemsAsArray:function(e){return s.isArray(e)||(e=[e]),e},_constructItemWrappers:function(e,t){return s.map(e,function(e){return{item:e,options:t}})},_onQueueItemStart:function(e,t,i){this._flushQueueDeferred.notify(e,!1,t,i,this.getQueueItems())},_onQueueItemSuccess:function(e,t,i){this._flushQueueDeferred.notify(e,!0,t,i,this.getQueueItems())},_onQueueItemFail:function(e,t,i){this._flushQueueDeferred.reject(e,t,i,this.getQueueItems())},_onQueueSuccess:function(e){this._flushQueueDeferred.resolve(e)}}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(143),r=i(466),a=i(662),l=i(665),c=i(666),u=i(667),h={TEXT:"TEXT",POST:"POSTREF",IMAGE:"IMAGE",STICKER:"STICKER"},d=o.extend({mixins:[a],relations:{content:l,post:c,image:u},idAttribute:"ts",defaults:{conversation_id:null,type:h.TEXT,ts:null,participant:null,participants:null,content:null,message:null,post:null,image:null,file:null,sticker:null,sticker_id:null,collapseGroup:null,clientTs:null,tsHeader:null,isQueued:!1,isPending:!1,isError:!1,isCollapsed:!1,canRetry:!0,hasAnimation:!1,context:null,creationUserAction:null},persistedFields:["conversation_id","type","participant","participants","message","post","context","sticker_id"],saveNoRetryOnErrorCodes:[403,404],validSendMessageContexts:["post-chrome","messaging-gif","messaging-image-upload"],initialize:function(){return this.set("clientTs",Date.now()),o.prototype.initialize.apply(this,arguments)},parse:function(e,t){var i=s.get(e,"response.messages.data.0")||e,n=s.get(i,"images");return s.isArray(n)&&s.extend(i,{image:s.first(n)}),i},save:function(e,t){var i,a,l,c,u;return t=s.extend({validate:!0,parse:!0},t),e=e||{},e&&this.set(e),a=this.toJSON(),l=s.pick(a,this.persistedFields),c=this._getServerLoggingContext(),s.isEmpty(c)?delete l.context:s.extend(l,{context:c}),s.extend(t,{data:l,emulateJSON:!0}),this.isImage()?(u=this.get("file"),this.uploader=new r({name:"data",uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:this.url(),fileUpload:{multiple:!1,formData:l}}),this.uploader.addFiles([u]),i=this.uploader.getCurrentRequest(),i?i.then(s.bind(function(e){t.parse&&(e=this.parse(e,t)),this.set(e,t)},this)):(i=new n.Deferred,i.reject())):i=o.prototype.save.call(this,e,t),this.set({isPending:!0,isQueued:!1}),i.then(s.bind(function(){this.set("isError",!1)},this)).fail(s.bind(function(e){this.set({isError:!0,canRetry:this._canRetryOnErrorCode(s.get(e,"status"))})},this)).always(s.bind(function(){this.set("isPending",!1)},this)),i},getActionMarkup:function(e,t,i){return t=t||"",i=i||"",this.isText()?s.isEmpty(e)?null:t+s.escape(e)+i:this.isPost()?this.getPost().getActionMarkup(e,t,i):this.isImage()?this.getImage().getActionMarkup(e,t,i):null},getPost:function(){return this.get("post")},getImage:function(){return this.get("image")},getTimestamp:function(){var e=this.get("ts");return e?parseInt(e,10):this.get("clientTs")},getMessage:function(){return this.isText()?this.get("content").get("text"):this.isPost()?this.getPost().getMessage():""},isError:function(){return this.get("isError")},isText:function(){return this.get("type")===h.TEXT},isPost:function(){return this.get("type")===h.POST},isImage:function(){return this.get("type")===h.IMAGE},isDisabledPost:function(){return this.isPost()&&this.get("post").isDisabled()},isPending:function(){return this.get("isPending")},canRetry:function(){return this.get("canRetry")},_canRetryOnErrorCode:function(e){return s.isFinite(e)&&!s.contains(this.saveNoRetryOnErrorCodes,e);
},_getServerLoggingContext:function(){var e=this.get("context");return!s.isEmpty(e)&&(e=s.first(e.split(":")),s.contains(this.validSendMessageContexts,e))?e:null}},h);e.exports=d},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{text:null,formatting:[]}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(143),r=i(224),a=o.extend({defaults:{type:null,summary:null,state:null,photos:[]},setType:function(e){var t=["photo","link","quote","audio","video","chat"];s.contains(t,e)&&this.set("type",e)},getMessage:function(){return"gif"===this.getType()?null:this.get("summary")},getActionMarkup:function(e,t,i){var o,r,a,l,c;return t=t||"",i=i||"",e=s.escape(e),r=!s.isEmpty(e),l=r?n("%1$s%2$s%3$s sent a post that's no longer available",t,e,i):n("sent a post that's no longer available"),this.isDisabled()?l:(o=this.getType(),a=r?n("%1$s%2$s%3$s sent a post",t,e,i):n("sent a post"),c=r?{photo:n("%1$s%2$s%3$s sent a photo post",t,e,i),photoset:n("%1$s%2$s%3$s sent a photoset",t,e,i),gif:n("%1$s%2$s%3$s sent a GIF",t,e,i),link:n("%1$s%2$s%3$s sent a link",t,e,i),quote:n("%1$s%2$s%3$s sent a quote",t,e,i),audio:n("%1$s%2$s%3$s sent an audio post",t,e,i),video:n("%1$s%2$s%3$s sent a video",t,e,i),chat:n("%1$s%2$s%3$s sent a chat",t,e,i)}:{photo:n("sent a photo post"),photoset:n("sent a photoset"),gif:n("sent a GIF"),link:n("sent a link"),quote:n("sent a quote"),audio:n("sent an audio post"),video:n("sent a video"),chat:n("sent a chat")},s.has(c,o)?s.get(c,o):a)},getType:function(){var e;if("photo"===this.get("type")){if(this._isThumbnailGIF())return"gif";if(e=this.get("photos")||[],e.length>1)return"photoset"}return this.get("type")},getThumbnail:function(e){var t,i=this._getClientThumbnail();return s.isEmpty(i)?(t=this._getPostThumbnail(e),s.isEmpty(t)?null:t):i},hasThumbnail:function(e){return!s.isEmpty(this.getThumbnail(e))},getScaledDimensionsForWidth:function(e,t){var i;return s.has(e,"width")&&s.has(e,"height")?(i=Math.round(s.get(e,"height")/(s.get(e,"width")/t)),{width:t,height:i}):null},isDisabled:function(){return"disabled"===this.get("state")},addThumbnail:function(e,t,i){!s.isEmpty(e)&&s.isNumber(t)&&s.isNumber(i)&&this.set("clientThumbnail",{url:e,width:t,height:i})},_getClientThumbnail:function(){return this.get("clientThumbnail")},_getPostThumbnail:function(e){var t,i,n=this.get("thumbnail_url"),o=this.get("thumbnail_height"),r=this.get("thumbnail_width"),a=this.get("photos");return e=e||250,!s.isEmpty(a)||!s.isEmpty(n)&&s.isFinite(o)&&s.isFinite(r)?s.isEmpty(a)?{url:n,height:o,width:r}:(i=s.sortBy(s.get(s.first(a),"alt_sizes"),"width"),t=s.find(i,function(t){return s.get(t,"width",0)>=e}),s.isEmpty(t)?s.last(i):t):null},_isThumbnailGIF:function(){var e,t=s.get(this.getThumbnail(),"url");return!s.isEmpty(t)&&(e=r.getExtension(t),"gif"===(e||"").toLowerCase())}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(143),r=i(662),a=i(668),l=i(669),c=o.extend({mixins:[r],relations:{alt_sizes:a,original_size:l},defaults:{alt_sizes:null,original_size:null},getActionMarkup:function(e,t,i){return e=s.escape(e),t=t||"",i=i||"",s.isEmpty(e)?n("sent a photo"):n("%1$s%2$s%3$s sent a photo",t,e,i)},getAltSizes:function(){return this.get("alt_sizes")},getHighResImageUrl:function(){var e=this.getAltSizes().sort().last();return s.isEmpty(e)?null:e.get("url")},getOriginalSize:function(){return this.get("original_size")},hasAltSizes:function(){return!this.getAltSizes().isEmpty()},getImageAtSize:function(e){var t,i=this.getAltSizes().sort();return e=e||250,i.isEmpty()?this.getOriginalSize():(t=i.find(function(t){return t.get("width")>=e}),s.isEmpty(t)&&(t=i.last()),t)}});e.exports=c},function(e,t,i){"use strict";var s=i(148),n=i(669),o=s.extend({model:n,comparator:function(e){return e.get("width")}});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({idAttribute:"url",defaults:{width:null,height:null,url:null}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(671),r=i(664),a=n.extend({url:"/svc/conversations/messages",mixins:[o],model:r,_getRoot:function(e){return s.has(e,"response")?s.get(e,"response.messages"):e},parse:function(e,t){return s.get(this._getRoot(e),"data")||[]},parsePreviousLink:function(e,t){return s.get(this._getRoot(e),"_links.previous")},parseNextLink:function(e,t){return s.get(this._getRoot(e),"_links.next")},poll:function(e){return e=e||{},s.extend(e,{cache:!1,remove:!1,skipParseLinks:!0}),this.fetch(e)}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(145),r=new o({extend:{setNextLink:function(e){var t,i=this.hasNextPage();this._nextLink=e,t=this.hasNextPage(),i!==t&&this.trigger("change:hasNextPage",this,t)},setPreviousLink:function(e){var t,i=this.hasPreviousPage();this._previousLink=e,t=this.hasPreviousPage(),i!==t&&this.trigger("change:hasPreviousPage",this,t)},getNextLink:function(){return this._nextLink},getPreviousLink:function(){return this._previousLink},hasNextPage:function(){return!s.isEmpty(this.getNextLink())},hasPreviousPage:function(){return!s.isEmpty(this.getPreviousLink())},fetchNextPage:function(e,t){return e=e||{},this.hasNextPage()?(e.isInfiniteScroll!==!1&&s.extend(e,{skipParsePreviousLink:!0,remove:!1}),this._fetchPage(this.getNextLink(),e)):n.reject()},fetchPreviousPage:function(e,t){return e=e||{},this.hasPreviousPage()?(e.isInfiniteScroll!==!1&&s.extend(e,{skipParseNextLink:!0,remove:!1}),this._fetchPage(this.getPreviousLink(),e)):n.reject()},_fetchPage:function(e,t){var i=s.isString(e)?e:e.href;return t=t||{},s.extend(t,{url:i}),this.fetch(t)}},defaults:{parsePreviousLink:function(e,t){return null},parseNextLink:function(e,t){return null}},before:{reset:function(e){this.setPreviousLink(null),this.setNextLink(null)},parse:function(e,t){t=t||{},t.skipParseLinks||(!t.skipParsePreviousLink&&s.isFunction(this.parsePreviousLink)&&this.setPreviousLink(this.parsePreviousLink(e,t)),!t.skipParseNextLink&&s.isFunction(this.parseNextLink)&&this.setNextLink(this.parseNextLink(e,t)))}}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(673),r=n.extend({model:o,getSortedByChannels:function(e,t){var i=this.clone(),n=t?-1:1,o=e.length;return i.sortBy(function(t){var i=s.indexOf(e,t.get("uuid")),r=i>-1,a=r?o-i:-1;return n*a})},getWithout:function(e){var t=this.clone();return t.filter(function(t){return!s.contains(e,t.get("uuid"))})}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(662),o=i(209),r=i(143),a=i(674),l=r.extend({url:"/svc/conversations/participant_info",mixins:[n],relations:{theme:a},defaults:{theme:null,is_blog_following_you:!1,is_following_blog:!1,duration_blog_following_you:null,duration_following_blog:null,seconds_since_last_activity:-1,blog_tags:[]},idAttribute:"uuid",parse:function(e){return!s.has(e,"theme")&&s.has(e,"global_theme_params")&&s.extend(e,{theme:s.get(e,"global_theme_params")}),s.get(e,"response",e)},getAvatarUrl:function(e){return e=e||96,o(this.get("avatar_url"),e)},getAvatarShape:function(){return this.get("theme").get("avatar_shape")},getBlogTags:function(){var e=this.get("blog_tags");return s.isArray(e)?e:[]},getDescription:function(){return this.get("theme").get("show_description")!==!0?"":this.get("description")},fetchAdditionalInfo:function(e,t){return t=s.extend({},t,{merge:!0,data:{q:this.get("uuid"),participant:e}}),this.fetch(t)},isFollowingYou:function(){return this.get("is_blog_following_you")===!0},isFollowing:function(){return this.get("is_following_blog")===!0},isMutuals:function(){return this.isFollowingYou()&&this.isFollowing()},getDurationFollowingYouSeconds:function(){var e=this.get("duration_blog_following_you");return this.isFollowingYou()&&s.isNumber(e)?e:null},getDurationFollowingSeconds:function(){var e=this.get("duration_following_blog");return this.isFollowing()&&s.isNumber(e)?e:null},getDurationMutualsSeconds:function(){var e,t;return this.isMutuals()?(e=this.getDurationFollowingSeconds(),t=this.getDurationFollowingYouSeconds(),Math.min(e,t)):null}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(618),o=i(143),r=o.extend({defaults:{background_color:null,link_color:null,avatar_shape:null,header_image_focused:null,show_header_image:!0,adjustBrightnessFactor:.3},getHeaderImage:function(){return this.get("show_header_image")===!0?this.get("header_image_focused"):null},getBackgroundTint:function(){return this.getTint(this.get("background_color"))},getAccentTint:function(){return this.getTint(this.get("link_color"))},getTint:function(e){var t;return this.get("tint"+e)?this.get("tint"+e):s.isEmpty(e)?null:(t=n.isLight(e,.5)?n.isLight(e,.05,.95)?r.TINT_WHITE:r.TINT_LIGHT:r.TINT_DARK,this.set("tint"+e,t),t)},isDark:function(e){return this.getTint(e)===r.TINT_DARK},isReadableOn:function(e,t){return e=n.hexToHsv(e),t=n.hexToHsv(t),!n.compare(e,t)},adjustColorForBackground:function(e,t){var i=this.get("adjustBrightnessFactor");return this.isReadableOn(e,t)?e:this.adjustBrightness(e,this.isDark(e)?i:i*-1)},getReadableColor:function(e,t){return this.isReadableOn(e,t)?e:n.readable(e)},adjustBrightness:function(e,t){return n.brighten(e,t)},getTintSuffix:function(e){return e===r.TINT_WHITE?"-white":e===r.TINT_LIGHT?"-light":e===r.TINT_DARK?"-dark":void 0}},{TINT_LIGHT:"light",TINT_DARK:"dark",TINT_WHITE:"white"});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(173),r=i(139),a=o.extend({name:"MessagingNotifier",defaults:{isEnabled:!1,notificationTimeout:5e3,notificationIcon:null},initialize:function(e){s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},notifyOnUnread:function(e,t){var i=n("New message for %1$s",t.get("name")),s={conversationId:e,channelUuid:t.get("uuid")};this._generateNotification(i,s)},_supportsNotifications:function(){return this.get("isEnabled")&&"Notification"in window},_needsNotificationPermission:function(){return this._supportsNotifications()&&"granted"!==window.Notification.permission&&"denied"!==window.Notification.permission},_isNotificationPermissionGranted:function(){return this._supportsNotifications()&&"granted"===window.Notification.permission},_requestPermission:function(e){window.Notification.requestPermission(e)},_generateNotification:function(e,t){var i,n;this._supportsNotifications()&&(n={icon:this.get("notificationIcon")},this._isNotificationPermissionGranted()?(i=new Notification(e,n),i instanceof Notification&&(i.addEventListener("click",s.bind(function(e){r.trigger("messaging:conversation:open:id",t.conversationId,t.channelUuid,"notification"),e.target.close()}),this),s.delay(s.bind(function(){this.close()},i),this.get("notificationTimeout")),this.trigger("notification:display",t.conversationId))):this._needsNotificationPermission()&&this._requestPermission(s.bind(function(i){this.trigger("notification:permission:change","granted"===i),this._generateNotification(e,t)},this)))}});e.exports=a},function(e,t,i){"use strict";var s,n=i(173),o=i(3),r=i(677),a=i(678),l=i(679),c=n.extend({name:"NotificationSoundManager",initialize:function(){var e=o.get(this.data,"sounds",[]),t=o.get(this.data,"soundpacks",{});this.soundCollection=new r(this._getSoundModels(e)),this.soundPackCollections=this._getSoundpackCollections(t)},playSoundName:function(e){var t=this.soundCollection.get(e);o.isEmpty(t)||this._playSoundModel(t)},playRandomFromSoundpack:function(e){var t=o.get(this.soundPackCollections,e);t&&this._playSoundModel(t.sample())},_playSoundModel:function(e){var t=new l({model:e}).render();this.listenToOnce(t,"ended",this._removeSoundView),t.play()},_removeSoundView:function(e){e.remove()},_getSoundModels:function(e){return o.map(e,function(e,t){return new a({name:t,filePath:e})})},_getSoundpackCollections:function(e){var t=this;return o.reduce(e,function(e,i,s){return e[s]=new r(t._getSoundModels(i)),e},{})}}),u=function(){return null==s&&(s=new c),s};e.exports=u},function(e,t,i){"use strict";var s=i(148),n=i(678),o=s.extend({model:n});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({idAttribute:"name",defaults:{name:null,filePath:null,fileType:"audio/mpeg"}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(680),r=n.extend({tagName:"audio",template:o,defaults:{filePath:null,fileType:null},events:{ended:"triggerRemove"},initialize:function(e){s.extend(this,s.pick(e,"model"))},getTemplateData:function(){return this.model.toJSON()},play:function(){this.el.play()},triggerRemove:function(){this.trigger("ended",this)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<source src="'+__e(filePath)+'" type="'+__e(fileType)+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.extend({renderWithTemplate:s.noop,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"channels"))},afterRender:function(){this.listenTo(this.channels,"change:unread_messages_count_sum",this._onChangeChannelUnreadCount),this._onChangeChannelUnreadCount()},updateBadge:function(e){e>0&&this.$(".tab_notice_value").text(e>99?"99+":e),this.$(".tab_notice").toggleClass("tab-notice--active",e>0)},_onChangeChannelUnreadCount:function(){this.updateBadge(s.sum(this.channels.pluck("unread_messages_count_sum")))}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(236),r=i(185),a=i(432),l=i(683),c=i(696),u=i(702),h=i(706),d=i(691),p=i(710),g=r.extend({className:"messaging-inbox",template:p,defaults:{isLoading:!1,isAutoFetch:!0,isEmpty:!1,isLoadingEmptyInboxFavorites:!1,numFavorites:5},mixins:[o],subviews:{headerView:{constructor:c,options:function(e){return{eventBus:e.eventBus,user:e.user,channels:e.channels,currentBlogModel:e.currentBlogModel,popoverContainer:e.popoverContainer,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},composeView:{constructor:u,options:function(e){return{eventBus:e.eventBus,favoritesCollection:e.favoritesCollection,currentBlogModel:e.currentBlogModel,keyboardManager:e.keyboardManager,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},conversationsView:{constructor:l,options:function(e){return{eventBus:e.eventBus,collection:e.collection,emptyInboxCollection:e.emptyInboxCollection,currentBlogModel:e.currentBlogModel,channels:e.channels,favoritesCollection:e.favoritesCollection,appendFavoritesToInboxLimit:e.appendFavoritesToInboxLimit,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},inboxRecipientsView:{constructor:d,options:function(e){return{eventBus:e.eventBus,collection:e.favoritesCollection,title:n("Recently Followed"),context:"new:inbox:empty",isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},emptyView:{constructor:h,options:function(e){return{eventBus:e.eventBus,collection:e.emptyInboxCollection}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection","user","channels","favoritesCollection","emptyInboxCollection","popoverContainer","currentBlogModel","appendFavoritesToInboxLimit","keyboardManager","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.loader=new a({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.set({isLoading:!this.getCurrentChannel().get("isInboxFetched"),isEmpty:0===this.collection.length}),this.listenTo(this,"change",this._setViewStates),this.listenTo(this.collection,"sync error",this._onSyncCollection),this.listenTo(this.collection,"update reset",this._onChangeCollection),this.listenTo(this.collection,"request",this._onRequestCollection),this.listenTo(this.composeView,"submit",this._onComposeSubmitRecipient),this.listenTo(this.headerView,"change:isComposing",this._setViewStates),this._setViewStates(),this.get("isAutoFetch")&&this.fetch(),this._fetchEmptyInboxFavorites(),this.isNewEmptyInboxEnabled&&this._fetchFavorites()},beforeRemove:function(){this.keyboardManager.remove("inbox")},getTemplateData:function(){return{isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled}},getCurrentChannel:function(){return this.currentBlogModel.getChannel()},fetch:function(e){this.collection.fetchInbox(this.currentBlogModel.getId(),e)},_onComposeSubmitRecipient:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_NAMES,e)},_setViewStates:function(){var e=this.get("isEmpty"),t=this.get("isLoading")||this.get("isLoadingEmptyInboxFavorites"),i=this.headerView.get("isComposing");this.loader.set("loading",t&&!i),this.conversationsView.toggle(!i&&!e&&!t),this.emptyView.toggle(e&&!i&&!t&&!this.isNewEmptyInboxEnabled),this.inboxRecipientsView&&this.inboxRecipientsView.toggle(e&&!i&&!t&&this.isNewEmptyInboxEnabled),this.composeView.$el.toggle(i),i&&this.composeView.focus()},_onChangeCollection:function(){this.set("isEmpty",0===this.collection.length)},_onSyncCollection:function(){this.set({isLoading:!1,isEmpty:0===this.collection.length}),this.getCurrentChannel().set("isInboxFetched",!0)},_onRequestCollection:function(e,t,i){this.set({isEmpty:0===this.collection.length,isLoading:!this.getCurrentChannel().get("isInboxFetched")})},_fetchEmptyInboxFavorites:function(){var e=this;this.set("isLoadingEmptyInboxFavorites",!0),this.emptyInboxCollection.fetchFavorites(null,null,null,this.isNewEmptyInboxEnabled,"empty").then(function(){e.rendered&&(e.isNewEmptyInboxEnabled||e.favoritesCollection.reset(s.take(e.emptyInboxCollection.toJSON(),e.get("numFavorites"))))}).always(function(){e.rendered&&e.set("isLoadingEmptyInboxFavorites",!1)})},_fetchFavorites:function(){var e=this.get("numFavorites"),t=this.currentBlogModel.getId();this.favoritesCollection.fetchFavorites(e,t,null,!0)}});e.exports=g},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(684),a=i(236),l=i(290),c=i(685),u=i(690),h=i(691),d=i(695),p=o.extend({className:"inbox-conversations",template:d,mixins:[a,r],defaults:{isPaginating:!1,showFavorites:!1,hasNextPage:!0,showLoadingContainer:!0,appendFavoritesToInboxLimit:3},subviews:{conversations:{constructor:c,enableBatchRendering:!0,options:function(e){return{eventBus:e.eventBus,channels:e.channels,currentBlogModel:e.currentBlogModel}},collection:function(e){return e.collection}},paginationLoaderView:{constructor:l,options:{variation:"small h-centered",loading:!1}},favoritesView:{constructor:h,options:function(e){return{showMessageOnEmpty:!1,eventBus:e.eventBus,collection:e.favoritesCollection,title:n(e.isNewEmptyInboxEnabled?"Recently Followed":"More Tumblrs to talk to"),context:"inbox:moretumblrs",isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection","channels","favoritesCollection","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el}),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:showFavorites",this._onChangeShowFavorites),this.listenTo(this,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this,"change:showLoadingContainer",this._onChangeShowLoadingContainer),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this.collection,"update reset change",this._onCollectionChange),this.listenTo(this.favoritesCollection,"update reset",this._onFavoritesCollectionChange),this.listenTo(this.collection,"reset",this._onCollectionReset),this.listenTo(this,"batch:rendered:conversations",this._onConversationsBatchRendered),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"change:hasNextPage",this._onChangeCollectionHasNextPage),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollBottom),this._setViewStates(),this._onChangeCollectionHasNextPage(this.collection,this.collection.hasNextPage()),this._onChangeShowFavorites(this,this.get("showFavorites")),this._onChangeHasNextPage(this,this.get("hasNextPage")),this._onChangeShowLoadingContainer(this,this.get("showLoadingContainer")),s.defer(s.bind(this.updateScrollBar,this))},toggle:function(e){this.$el.toggle(e),this.updateScrollBar()},beforeRemove:function(){this.scrollBar&&this.scrollBar.destroy()},getNextPage:function(){this.rendered&&this.collection.hasNextPage()&&(this.set("isPaginating",!0),this.collection.fetchNextPage().always(s.bind(function(){this.rendered&&this.set("isPaginating",!1)},this)))},updateScrollBar:function(){this.scrollBar&&this.scrollBar.update()},_setViewStates:function(){var e=this.get("hasNextPage"),t=this.collection.length>0&&!e&&this.collection.length<=this.get("appendFavoritesToInboxLimit");this.set({showFavorites:t,showLoadingContainer:e}),this.updateScrollBar()},_saveModelOrder:function(){this.lastModelOrder=this._getModelOrderString()},_getModelOrderString:function(){return s.pluck(this.collection.models,"cid").join(" ")},_onCollectionSort:function(e){var t=this._getModelOrderString();this.lastModelOrder&&t.indexOf(this.lastModelOrder)===-1&&this.renderCollectionSubviews("conversations"),this._saveModelOrder()},_onCollectionChange:function(e,t){this._setViewStates(),this._saveModelOrder()},_onCollectionSync:function(){this._onChangeCollectionHasNextPage(this.collection,this.collection.hasNextPage())},_onCollectionReset:function(e){this.$el.scrollTop(0),this._saveModelOrder()},_onConversationsBatchRendered:function(){this.updateScrollBar()},_onChangeCollectionHasNextPage:function(e,t){this.set("hasNextPage",t&&e.length>=10)},_onChangeHasNextPage:function(e,t){this._setViewStates()},_onChangeIsPaginating:function(e,t){this.paginationLoaderView.set("loading",t)},_onScrollBottom:function(e){e&&this.getNextPage()},_onChangeShowFavorites:function(e,t){this.favoritesView.$el.toggle(t)},_onChangeShowLoadingContainer:function(e,t){this.js$("loader-container").toggle(t)},_onFavoritesCollectionChange:function(){this.updateScrollBar()}});e.exports=p},function(e,t,i){"use strict";var s=i(3),n=i(145),o=new n({defaults:{removeCollectionSubviews:function(e){var t=this[e];this.subviews[e]&&!s.isEmpty(t)&&(t=this[e],this._subviews=s.difference(this._subviews,t),s.invoke(t,"remove"),this[e].length=0)},removeCollectionSubview:function(e,t){var i,n=this[e];this.subviews[e]&&!s.isEmpty(n)&&(i=s.findWhere(n,{model:t}),i&&(this._subviews=s.without(this._subviews,i),i.remove(),this[e]=s.without(this[e],i)))},addNewCollectionSubview:function(e,t,i){var n=this.subviews[e];if(i||(i=this._getSubviewCollection(e)),n&&i){var o=n.container||this._createDefaultContainerFunction(e),r=n.prepareViewForAdd||this._createDefaultPrepareViewForAddFunction(e),a=n.options||{},l={insertionIndex:i.indexOf(t)},c=s.has(this,e),u=this.createCollectionSubviewRenderer([t],o,r,a,e,c,l);return this._isBatchRenderingInProgress(e)?void this.once("rendered:"+e,u,this):void(this.rendered?u():this.once("rendered",u,this))}},sortCollectionSubviews:function(e,t){var i,n=this.subviews[e];t||(t=this._getSubviewCollection(e)),n&&t&&this[e]&&(i=s.pluck(t.models,"cid"),i=s.zipObject(i,s.range(0,i.length)),this[e]=s.sortBy(this[e],function(e){return s.get(i,e.model.cid,0)}))},batchRenderCollectionSubviews:function(e){var t=this.subviews[e];if(t){var i=t.container||this._createDefaultContainerFunction(e),n=t.prepareView||this._createDefaultPrepareViewFunction(e),o=t.options||{},r=s.result(t,"batchSize")||5,a=s.result(t,"batchDelay")||100,l=this._getSubviewCollection(e),c=s.chunk(l.models,r),u=s.map(c,function(t,r){return s.bind(function(){var s=this.createCollectionSubviewRenderer(t,i,n,o,e,r>0);return s.call(this)},this)},this),h=s.bind(function(){this._scheduleBatchRenders(e,u,a)},this);this.rendered?h():this.once("rendered",h,this)}},_isBatchRenderingInProgress:function(e){return s.get(this._deferredRenders,e,[]).length>0},_scheduleBatchRenders:function(e,t,i){var n=t.length,o=function(){this._afterBatchRenderCollectionSubviews(e)},r=function(t){t.call(this,e),this._afterEachBatchRenderCollectionSubviews(e),n--,0===n&&o.call(this)};return this._deferredRenders||(this._deferredRenders={}),s.has(this._deferredRenders,e)||(this._deferredRenders[e]=[]),this._cancelBatchRenders(e),0===n?void o.call(this):void s.each(t,function(t,n){var o;return 0===n?void r.call(this,t):(o=setTimeout(s.bind(function(){r.call(this,t),this._deferredRenders[e]=s.without(this._deferredRenders[e],o)},this),i*(n+1)),void this._deferredRenders[e].push(o))},this)},_cancelBatchRenders:function(e){s.isEmpty(this._deferredRenders)||(s.isEmpty(e)||s.has(this._deferredRenders,e))&&(s.isEmpty(e)?(s.each(this._deferredRenders,function(e,t){s.each(e,function(e){clearTimeout(e)},this)},this),this._deferredRenders={}):(s.each(this._deferredRenders[e],function(e){clearTimeout(e)},this),this._deferredRenders[e].length=0))},_afterEachBatchRenderCollectionSubviews:function(e){this.trigger("batch:rendered:"+e)},_afterBatchRenderCollectionSubviews:function(e){this.trigger("rendered:"+e)},_attachCollectionListeners:function(e){var t=this._getSubviewCollection(e);t&&(this.listenTo(t,"add",s.partial(this.addNewCollectionSubview,e)),this.listenTo(t,"remove",s.partial(this.removeCollectionSubview,e)),this.listenTo(t,"reset",s.partial(this.renderCollectionSubviews,e)),this.listenTo(t,"update",s.partial(this.sortCollectionSubviews,e)))},_getSubviewCollection:function(e){var t=s.get(this.subviews[e],"collection");return t===!0?this.collection:s.isFunction(t)?t(this):t?t:null},_createDefaultPrepareViewForAddFunction:function(e){var t=this.subviews[e];return s.bind(function(i,n){var o=i.children(),r=new t.constructor(n),a=n.insertionIndex;return r.$el.attr("data-subview",e),s.isNumber(a)&&a<o.length?r.$el.insertBefore(o.get(a)):i.append(r.$el),r},this)}},before:{renderSubviews:function(){s.each(this.subviews,function(e,t){e.collection&&this._attachCollectionListeners(t)},this)},beforeRemove:function(){this._cancelBatchRenders()}},around:{renderCollectionSubviews:function(e,t){var i=this.subviews[t];if(i)return this.removeCollectionSubviews(t),s.result(i,"enableBatchRendering")===!0?this.batchRenderCollectionSubviews(t):e.apply(this,s.rest(arguments))}}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(686),a=i(687),l=i(236),c=i(221),u=i(137),h=i(140),d=i(688),p=o.extend({className:"inbox-conversation",template:r,mixins:[l],subviews:{statusIndicator:{constructor:d,options:function(e){return{isOnline:e.otherParticipant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:u.bool("status_indicators_ui"),name:e.otherParticipant.get("name")}}}},defaults:{maxInitialMessageLength:100,currentMessage:null},events:{"click [data-open-conversation]":"_onClickConversation"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","channels","currentBlogModel")),this.participants=this.model.get("participants"),this.sortedParticipants=this.participants.getSortedByChannels(this._getOwnSortedBlogIds()),this.otherParticipant=s.first(this.sortedParticipants),this.set("currentMessage",this.model.getInboxMessage())},afterRender:function(){this.listenTo(this.model,"change:last_read_ts change:last_modified_ts",this._onChangeTimestamps),this.listenTo(this,"change:currentMessage",this._onChangeCurrentMessage),this._onChangeCurrentMessage(this,this.get("currentMessage"));var e=this.$el.find(".pixelated-avatar");s.each(e,s.bind(function(e){n(e).removeClass("hide").addClass("show"),c.drawPixelatedImages(this)},this))},openConversation:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL,this.model,"inbox")},getTemplateData:function(){var e=h(),t=this.otherParticipant.get("is_adult"),i=e.get("channels").map(function(e){return e.name}),n=s.contains(i,this.model.get("blogName")),o=u.bool("safe_mode")&&e.get("safe_mode");return{name:this.otherParticipant.get("name"),avatarUrl:this.otherParticipant.getAvatarUrl(),message:this._getEscapedMessageMarkup(this.get("currentMessage")),isSafeModeEnabled:o,isUser:n,blogIsAdult:t}},getMessageParticipant:function(e){return this.participants.get(e.get("participant"))},_getEscapedMessageMarkup:function(e){var t,i=this._getAdditionalBlogName(e),n=s.escape(e.getMessage());return s.isEmpty(n)||(n=n.substring(0,this.get("maxInitialMessageLength"))),t=e.getActionMarkup(i,'<span class="name">',"</span>"),s.compact([t,n]).join(": ")},_safeTruncateMessage:function(e){var t=this.js$("message"),i=this.js$("message-text"),n=function(){a(t),s.isFunction(e)&&e.call(this,i.html())};t.height()?n.call(this):(this.$el.css("visibility","hidden"),s.defer(s.bind(function(){this.rendered&&(n.call(this),this.$el.css("visibility",""))},this)))},_isLastMessageFromSelf:function(e){return!s.isEmpty(e)&&!s.isEmpty(this.otherParticipant)&&this.otherParticipant.get("uuid")!==e.get("uuid")},_getAdditionalBlogName:function(e){var t;return s.isEmpty(e)?null:(t=this.getMessageParticipant(e),s.isEmpty(t)?null:this._isLastMessageFromSelf(t)?t.get("name"):null)},_onChangeTimestamps:function(e){this.set("currentMessage",this.model.getInboxMessage())},_onChangeCurrentMessage:function(e,t){var i=this.getMessageParticipant(t),n=t.get("truncatedText");this.$el.toggleClass("is-unread",this.model.isUnread()&&!this._isLastMessageFromSelf(i)),s.isEmpty(n)?(this.js$("message-text").html(this._getEscapedMessageMarkup(t)),this._safeTruncateMessage(function(e){t.set("truncatedText",e)})):this.js$("message-text").html(n)},_onClickConversation:function(e){e.preventDefault(),this.openConversation()},_getOwnSortedBlogIds:function(){return this.channels.getSortedIds(this.currentBlogModel.getId())}});e.exports=p},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-open-conversation href="#" class="inbox-row"><div data-subview="statusIndicator"></div> ',__p+=blogIsAdult&&isSafeModeEnabled&&!isUser?' <canvas class="avatar post-activity-avatar-image post_sub_avatar_image pixelated-avatar needs-drawing hide" data-image-url="'+__e(avatarUrl)+'" width="36" height="36" alt="'+__e(name)+'"></canvas> ':' <img class="avatar" src="'+__e(avatarUrl)+'"> ',__p+=' <div class="info-container"><div class="name-container"><h3 class="name">'+__e(name)+'</h3></div><h4 class="message" data-js-message><span class="text" data-js-message-text>'+(null==(__t=message)?"":__t)+"</span></h4></div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";function s(e,t){return e.scrollHeight-t.maxHeight<5}function n(e){return parseInt(c(e).css("max-height"),10)}function o(e,t,i){var n,o=e.nodeValue,r=l.get(t,"truncationString","..."),a="",c="",u=0,h=o.length;if(s(i,t))return!0;for(;u<=h;)n=u+h>>>1,a=l.trimRight(o.substring(0,n))+r,e.nodeValue=a,s(i,t)?(u=n+1,a.length>c.length&&(c=a)):h=n-1;return c.length>0?(e.nodeValue=c,!0):(e.nodeValue="",!1)}function r(e,t,i){var s=c(e).contents();l.each(s.get().reverse(),function(e){e.nodeType===Node.TEXT_NODE?o(e,t,i):r(e,t,i)})}function a(e,t){if(t=t||{},l.defaults(t,{truncationString:"..."}),e instanceof c&&(e=e.get(0)),l.has(t,"maxHeight")||l.extend(t,{maxHeight:n(e)}),l.isFinite(l.get(t,"maxHeight"))&&!s(e,t))return r(e,t,e)}var l=i(3),c=i(8);e.exports=a},function(e,t,i){"use strict";var s=i(130),n=i(185),o=i(689),r=n.extend({template:o,className:"status-indicator-wrapper",initialize:function(e){this.set({isOnline:e.isOnline&&e.canSeeUIFlag,ariaText:s("%1$s is online",e.name)})},render:function(){return this.get("isOnline")?n.prototype.render.call(this):this}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;
module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div aria-label="'+__e(ariaText)+'" title="online" class="status-indicator"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(427),o=n.extend({defaults:s.defaults({isDisabled:!1,isAtTop:!1,isAtBottom:!1,topThreshold:50,bottomThreshold:50},n.prototype.defaults),initialize:function(e){return this.options=e||{},n.prototype.initialize.call(this,this.options.el,this.options)},render:function(){return this.listenTo(this,"change:isAtTop",this._changeIsAtTop),this.listenTo(this,"change:isAtBottom",this._changeIsAtBottom),n.prototype.render.apply(this,arguments)},_stealScroll:function(e){return this.get("isDisabled")?(e.preventDefault(),void e.stopPropagation()):n.prototype._stealScroll.apply(this,arguments)},update:function(){return this._updateInfiniteScrollFlags(),n.prototype.update.apply(this,arguments)},_onScrollStop:function(){return this._updateInfiniteScrollFlags(),n.prototype._onScrollStop.apply(this,arguments)},getCurrentPositions:function(){return this._setCurrentPositions(),{height:this._currentHeight,scrollBottom:this._currentScrollBottom,scrollTop:this._currentScrollTop}},isAtTop:function(){return this.get("isAtTop")},isAtBottom:function(){return this.get("isAtBottom")},_isAtTop:function(e){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollTop<=e&&this._currentHeight>e},_isAtBottom:function(e){return this._isUserScroll()&&!this.get("isDisabled")&&this._currentScrollBottom<=e&&this._currentHeight>e},_isUserScroll:function(){var e,t=5;return!!s.isFinite(this._previousScrollHeight)&&(e=Math.abs(this._currentScrollHeight-this._previousScrollHeight),e<=t)},setDisabled:function(e){this.set("isDisabled",e)},isDisabled:function(){return this.get("isDisabled")},_setCurrentPositions:function(){var e=this.container;this._previousScrollHeight=this._currentScrollHeight,this._currentScrollHeight=e.scrollHeight,this._currentHeight=e.clientHeight,this._currentScrollBottom=e.scrollHeight-e.scrollTop-this.container.clientHeight,this._currentScrollTop=e.scrollTop},_updateInfiniteScrollFlags:function(){return!this.destroyed&&(this._setCurrentPositions(),void this.set({isAtTop:this._isAtTop(this.get("topThreshold")),isAtBottom:this._isAtBottom(this.get("bottomThreshold"))}))},_changeIsAtTop:function(e,t){this.trigger("scrolltop",t)},_changeIsAtBottom:function(e,t){this.trigger("scrollbottom",t)}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(684),r=i(236),a=i(191),l=i(413),c=i(692),u=i(694),h=n.extend({className:"inbox-recipients",template:u,mixins:[r,a,o,l],keycommands:{"keydown:down":"_onKeyPressDown","keydown:up":"_onKeyPressUp","keydown:enter":"_onKeyPressEnter"},defaults:{isEmpty:!0,showMessageOnEmpty:!0,selectedView:null,context:"inbox:recipients"},subviews:{recipients:{constructor:c,options:function(e){return{eventBus:e.eventBus,onSelect:s.bind(e._onSubviewSelect,e),onClear:s.bind(e._onSubviewClear,e),context:e.context,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}},collection:function(e){return e.collection}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection","title","context","isNewEmptyInboxEnabled")),this.keyboardViewName="recipients",this.disableKeys()},afterRender:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this.collection,"sync",this._onCollectionSync),this.listenTo(this.collection,"sort",this._onCollectionSort),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this._onCollectionChange(this.collection),this._onChangeIsEmpty(this,this.get("isEmpty"))},getTemplateData:function(){return{title:this.title,noResultsText:this.collection.getNoResultsFoundMessage()}},toggle:function(e){this.$el.toggle(e),e&&this.deselect(this.keyboardViewName)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onChangeIsEmpty:function(e,t){this.get("showMessageOnEmpty")?this.js$("no-results-container").toggle(t):(this.js$("container").toggle(!t),this.js$("no-results-container").hide())},_shuffleNoResultsText:function(){this.js$("no-results-text").text(this.collection.getNoResultsFoundMessage())},_onCollectionSort:function(){this.renderCollectionSubviews("recipients")},_onCollectionChange:function(e){this.set("isEmpty",0===e.length),this.deselect(this.keyboardViewName)},_onCollectionSync:function(e){0===e.length&&this.get("showMessageOnEmpty")&&this._shuffleNoResultsText()},_onSubviewSelect:function(e){this.set("selectedView",e),this.setSelectedIndex(this.keyboardViewName,s.indexOf(this.recipients,e))},_onSubviewClear:function(e){this.set("selectedView",null),this.deselect(this.keyboardViewName)},_onKeyPressDown:function(e){var t;e.preventDefault(),t=this.isLastSelected(this.keyboardViewName)?this.selectFirst(this.keyboardViewName):this.selectNext(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressUp:function(e){var t;e.preventDefault(),t=this.isFirstSelected(this.keyboardViewName)?this.selectLast(this.keyboardViewName):this.selectPrevious(this.keyboardViewName),this.set("selectedView",t)},_onKeyPressEnter:function(e){var t,i=this.get("selectedView");e.preventDefault(),i?t=i.model:1===this.collection.length&&(t=this.collection.first()),t&&this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[t],this.context)}});e.exports=h},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(687),r=i(236),a=i(185),l=i(693),c=a.extend({className:"inbox-recipient",template:l,mixins:[r],defaults:{isSelected:!1,context:"inbox:recipients"},events:{"click [data-start-conversation]":"_onStartConversationClick",mouseenter:"_onRecipientHover",mouseleave:"_onRecipientLeave"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","onSelect","onClear","context","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.isNewEmptyInboxEnabled&&o(this.js$("tags-string"))},setSelected:function(e){this.rendered&&this.set("isSelected",e)},getTemplateData:function(){return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),isNewEmptyInboxEnabled:this.isNewEmptyInboxEnabled,tagsString:this.getTagsString()}},getTagsString:function(){var e=this.model.get("tags");return s.isEmpty(e)?null:e.length>1?n("Posts about #%1$s and #%2$s",e[0],e[1]):1===e.length?n("Posts about #%1$s",e[0]):void 0},_onStartConversationClick:function(e){e.preventDefault(),this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[this.model],this.get("context")),this.isNewEmptyInboxEnabled&&this.eventBus.trigger(this.eventBus.NEW_EMPTY_INBOX_SUGGESTION_CLICK,this.model,this.get("context"),!0)},_onChangeIsSelected:function(e,t){this.$el.toggleClass("selected",t)},_onRecipientHover:function(){s.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onRecipientLeave:function(){s.isFunction(this.onClear)&&this.onClear(this,this.model)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a data-start-conversation href="/conversation/new/'+__e(name)+'" class="inbox-row"><img class="avatar" src="'+__e(avatarUrl)+'"><div class="info-container"> ',__p+=isNewEmptyInboxEnabled?" <h3>"+__e(name)+'</h3><h4 class="tags" data-js-tags-string>'+__e(tagsString)+'</h4><h4 class="send-link">'+__e(__("Send a message"))+"</h4> ":" <h3>"+__e(name)+"</h3><h4>"+__e(title)+"</h4> ",__p+=" </div></a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div data-js-container> ",title&&(__p+=" <h2>"+__e(title)+"</h2> "),__p+=' <div data-subview="recipients[]"></div><div data-js-no-results-container class="no-results"><p data-js-no-results-text>'+__e(noResultsText)+"</p></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-js-conversations-container><div data-subview="conversations[]"></div><div data-subview="favoritesView"></div></div><div class="inbox-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(697),r=i(699),a=i(701),l=n.extend({className:"inbox-header",template:a,defaults:{isComposing:!1},subviews:{senderView:{constructor:o,options:function(e){return{eventBus:e.eventBus,user:e.user,channels:e.channels,popoverContainer:e.popoverContainer,currentBlogModel:e.currentBlogModel}}},composeToggleView:{constructor:r,options:function(e){return{eventBus:e.eventBus,isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","user","channels","popoverContainer","currentBlogModel","isNewEmptyInboxEnabled"))},afterRenderSubviews:function(){this.listenTo(this.composeToggleView,"change:isComposing",function(e,t){this.set("isComposing",t)}),this.listenTo(this,"change:isComposing",function(e,t){this.composeToggleView.set("isComposing",t)})}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(605),r=i(698),a=n.extend({className:"inbox-sender",template:r,subviews:{blogSelector:{constructor:o,options:function(e){return{className:"inbox-sender-blog-selector",collection:e.channels,popoverOptions:{popoverContainer:e.popoverContainer},currentTumblelog:e.channels.findWhere({uuid:e.currentBlogModel.getId()}),badgeCountField:"unread_messages_count_sum"}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","user","channels","currentBlogModel","popoverContainer"))},afterRenderSubviews:function(){this.listenTo(this.blogSelector,"change:currentTumblelog",this._onBlogSelectorChange)},_onBlogSelectorChange:function(e,t){this.currentBlogModel.setChannel(t)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="blogSelector" class="blog-selector"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(700),a=o.extend({className:"inbox-compose-toggle",template:r,defaults:{isComposing:!1},events:{"click [data-js-compose-toggle]":"_onClickToggleCompose"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","isNewEmptyInboxEnabled"))},afterRender:function(){this.listenTo(this,"change:isComposing",this._onChangeIsComposing)},getTemplateData:function(){return{message:n(this.isNewEmptyInboxEnabled?"New Message":"Compose message")}},_onChangeIsComposing:function(e,t){this.$el.toggleClass("active",t)},_onClickToggleCompose:function(e){var t=void 0;e.preventDefault(),this.set("isComposing",!this.get("isComposing")),t=this.isNewEmptyInboxEnabled?this.eventBus.NEW_EMPTY_INBOX_NEW_MESSAGE_CLICK:this.eventBus.OLD_EMPTY_INBOX_NEW_MESSAGE_CLICK,this.eventBus.trigger(t,this.isNewEmptyInboxEnabled)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<a href="#" class="compose-toggle compose-start" data-js-compose-toggle>'+__e(message)+'</a><a href="#" class="compose-toggle compose-cancel" data-js-compose-toggle>'+__e(__("Nevermind"))+"</a>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="senderView"></div><div data-subview="composeToggleView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(130),r=i(185),a=i(236),l=i(703),c=i(691),u=i(432),h=i(705),d=r.extend({className:"inbox-compose",template:h,defaults:{isShowFavorites:!0,isLoading:!1,showLoadingAfterMs:250,hasEditorFocus:!1},events:{"input [data-js-textinput]":"_onTextInputChange","focus [data-js-textinput]":"_onTextInputFocus","blur [data-js-textinput]":"_onTextInputBlur"},mixins:[a],subviews:{favoritesView:{constructor:c,options:function(e){return{showMessageOnEmpty:!1,eventBus:e.eventBus,collection:e.favoritesCollection,title:o(e.isNewEmptyInboxEnabled?"Recently Followed":"Favorites"),context:"inbox:favorites",isNewEmptyInboxEnabled:e.isNewEmptyInboxEnabled}}},searchResultView:{constructor:c,options:function(e){return{eventBus:e.eventBus,collection:e.collection,context:"inbox:typeahead"}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","favoritesCollection","currentBlogModel","keyboardManager","isNewEmptyInboxEnabled")),this.collection=new l,this._debouncedSearch=s.bind(s.debounce(this._search,250),this)},afterRenderSubviews:function(){this.loader=new u({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this._onChangeIsShowFavorites(this,this.get("isShowFavorites"))},_setKeyboardState:function(){this.keyboardManager.remove("inbox:compose"),this.get("hasEditorFocus")&&(this.get("isShowFavorites")?this.keyboardManager.add("inbox:compose:favorites",this.favoritesView):this.keyboardManager.add("inbox:compose:results",this.searchResultView))},_onChangeHasEditorFocus:function(e,t){this._setKeyboardState()},fetchResults:function(e){var t=this.currentBlogModel.getChannel().get("uuid");return this.set("isLoading",!0),this.collection.fetchByQuery(e,t).always(s.bind(function(){this.rendered&&this.set({isShowFavorites:!1,isLoading:!1})},this))},clear:function(){this.js$("textinput").val("")},focus:function(){this.js$("textinput").focus()},blur:function(){this.js$("textinput").blur()},beforeRemove:function(){this.keyboardManager.remove("inbox:compose")},_search:function(e){s.isEmpty(e)?this.set("isShowFavorites",!0):this.fetchResults(e)},_onTextInputChange:function(e){this._debouncedSearch(n(e.target).val())},_onTextInputBlur:function(e){this.set("hasEditorFocus",!1)},_onTextInputFocus:function(e){this.set("hasEditorFocus",!0)},_onChangeIsShowFavorites:function(e,t){this.favoritesView.toggle(t),this.searchResultView.toggle(!t),this._setKeyboardState()},_onChangeIsLoading:function(e,t){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),t?void(this._loaderTimeout=setTimeout(s.bind(function(){this.loader.set("loading",!0)},this),this.get("showLoadingAfterMs"))):this.loader.set("loading",!1)}});e.exports=d},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(130),r=i(148),a=i(673),l=i(704),c=r.extend({url:"/svc/conversations/participant_suggestions",model:a,resultCache:{},fetchFlags:["empty","post"],initialize:function(){return this.getNoResultsFoundMessage=l([o("That isn't anyone."),o("Uh, who?"),o("Huh what?"),o("Never heard of 'em."),o("???"),o("Eh?"),o("Whaaa?")]),r.prototype.initialize.apply(this,arguments)},parse:function(e,t){return n.get(e,"response.blogs")||e},fetchByQuery:function(e,t,i){return i=i||{},n.extend(i,{reset:!0,data:{q:e,participant:t}}),this.fetch(i)},fetchFavorites:function(e,t,i,s,o,r){return e=e||8,r=r||{},n.extend(r,{reset:!0,data:{limit:e,participant:t,include_recent:i,exclude_active:s},flag:o}),this.fetch(r)},fetch:function(e){var t=JSON.stringify(n.get(e,"data")),i=n.get(e,"flag",""),o=new s.Deferred,a=n.get(this.resultCache,t);return this.cancelFetch(),a&&this.fetchFlags.indexOf(i)!==-1?(this.reset(a),this.trigger("sync",this),o.resolve(),o):(this._request=r.prototype.fetch.apply(this,arguments),this._request.then(n.bind(function(e){this.fetchFlags.indexOf(i)!==-1&&n.set(this.resultCache,t,this.parse(e))},this)).always(n.bind(function(){this._request=null},this)),this._request)},cancelFetch:function(){this._request&&(this._request.abort(),this._request=null)}});e.exports=c},function(e,t,i){"use strict";function s(e){var t,i;return e=e||[],function(){return n.isEmpty(t)&&(t=n.shuffle(e),n.isEmpty(i)||(t=n.without(t,i))),i=t.pop()}}var n=i(3);e.exports=s},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="inbox-compose-input"><label class="label"><span class="label-text-container"> '+__e(__("To:"))+' </span><span class="input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="input" data-js-textinput></span></label></div><div class="inbox-compose-main"><div data-subview="loader"></div><div data-subview="favoritesView"></div><div data-subview="searchResultView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(236),r=i(185),a=i(707),l=i(709),c=r.extend({className:"inbox-empty",template:l,mixins:[o],subviews:{blogsView:{constructor:a,options:function(e){return{collection:e.collection,eventBus:e.eventBus}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection"))},getTemplateData:function(){return{header:n("Talk to a Tumblr")}},toggle:function(e){this.$el.toggle(e)}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(708),a=o.extend({className:"inbox-empty-blogs",template:r,defaults:{numItemsPerRow:4},events:{"click [data-js-start-conversation]":"_onStartConversation"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection"))},afterRender:function(){this.listenTo(this.collection,"update reset",this.render)},getTemplateData:function(){var e,t=this.get("numItemsPerRow"),i=s.map(this.collection.models,function(e){return s.extend(e.toJSON(),{avatarUrl:e.getAvatarUrl()})});return i.length>0&&(e=Math.max(1,Math.floor(i.length/t)),i=i.slice(0,e*t)),{blogs:i}},_onStartConversation:function(e){var t=n(e.currentTarget).attr("data-js-start-conversation"),i=this.collection.findWhere({name:t});this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS,[i],"inbox:empty"),this.eventBus.trigger(this.eventBus.OLD_EMPTY_INBOX_SUGGESTION_CLICK,i,"old:inbox:empty",!1),e.preventDefault()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)_.isEmpty(blogs)||(__p+=' <div class="blogs"> ',_.each(blogs,function(e){__p+=' <a class="blog" href="/messaging/conversation/'+__e(e.name)+'" data-js-start-conversation="'+__e(e.name)+'"><img class="avatar" src="'+__e(e.avatarUrl)+'" alt="'+__e(e.name)+'" title="'+__e(e.name)+'" width="40" height="40"> </a> '}),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><div class="header-container"><h2 class="header" data-js-header>'+__e(header)+'</h2></div><div data-subview="blogsView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div data-subview="headerView"></div><div data-subview="composeView"></div><div class="inbox-main"><div data-subview="loader"></div><div data-subview="conversationsView"></div></div> ',isNewEmptyInboxEnabled&&(__p+=' <div class="empty-suggestions"><div data-subview="inboxRecipientsView"></div></div> '),__p+=' <div data-subview="emptyView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(194),r=i(130),a=i(185),l=i(290),c=i(236),u=i(179).animation,h=i(550),d=i(139),p=i(712),g=i(714),_=i(740),f=i(742),m=i(746),v=i(749),b=i(751),y=i(726),w=i(661),k=i(753),C=i(756),x=i(718).html,S=i(704),T=i(758),E=i(763),P=i(766),I=i(778),F=a.extend({template:I,className:"messaging-conversation-wrapper",defaults:{isError:!1,canSend:!0,isPossibleSpam:!1,isLoading:!0,isHidePendingPost:!1,isFetching:!0,isFetched:!1,isFetchingIcebreakers:!1,isOffline:!1,isAutoFetch:!0,isMinimized:!1,isDropping:!1,isCurrentDropValid:!0,animateInMessageDuration:500,minimizeOpeningClass:"is-minimize-opening",minimizeClosingClass:"is-minimize-closing",droppingClassName:"is-dropping",noBlurSupportClass:"no-blur-support",imagePreviewAnimateInDurationMs:300,imagePreviewAnimateOutDurationMs:200,imagePreviewAnimateInEasing:[.22,.685,.03,.895],imagePreviewAnimateOutEasing:[.895,.03,.685,.22],imageUploadMaxBytes:null,canModifySafeMode:!0},events:{"click [data-js-tumblelog-name]":"_onBlogClick","click [data-js-messaging-tumblelog-name]":"_onMessagingBlogClick","click [data-js-lightbox-url]":"_onImageLightboxUrlClick","click [data-js-main]":"_onMainContainerClick",dragover:"_onDragOver",dragenter:"_onDragEnter",dragleave:"_onDragLeave",drop:"_onDragDrop",keydown:"_onKeyDown"},mixins:[c],subviews:{conversationLoaderView:{constructor:l,options:{variation:"small centered",loading:!1}},headerView:{constructor:p,options:function(e){return{eventBus:e.eventBus,participants:e.sortedParticipants,theme:e.theme,channels:e.channels,user:e.user}}},messagesView:{constructor:g,options:function(e){return{eventBus:e.eventBus,collection:e.model.get("messages"),participants:e.model.get("participants"),conversation:e.model,isSafeModeEnabled:e.isSafeModeEnabled,messageFormatter:e.messageFormatter,animateInMessage:s.bind(e._animateInMessage,e),otherParticipant:e.otherParticipant,canModifySafeMode:e.canModifySafeMode}}},previewView:{constructor:f,options:function(e){return{animateInDurationMs:e.get("imagePreviewAnimateInDurationMs"),animateOutDurationMs:e.get("imagePreviewAnimateOutDurationMs"),animateInEasing:e.get("imagePreviewAnimateInEasing"),animateOutEasing:e.get("imagePreviewAnimateOutEasing")}}},composeView:{constructor:m,options:function(e){return{eventBus:e.eventBus,keyboardManager:e.keyboardManager,keyboardNamespace:e.keyboardNamespace+":compose",pluginsArray:e.getPluginsArray(),pluginAnimateInDurationMs:e.get("imagePreviewAnimateOutDurationMs"),pluginAnimateOutDurationMs:e.get("imagePreviewAnimateInDurationMs"),pluginAnimateInEasing:e.get("imagePreviewAnimateOutEasing"),pluginAnimateOutEasing:e.get("imagePreviewAnimateInEasing")}}},minimizedView:{constructor:v,options:function(e){return{eventBus:e.eventBus,model:e.model}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","user","model","channels","messageFormatter","popoverContainer","keyboardManager","collection","isSafeModeEnabled","canModifySafeMode")),this.keyboardNamespace="conversation:"+this.cid,this.model||(this.model=new w),this.messageFormatter||(this.messageFormatter=new x),this.conversation=this.model,this.sortedParticipants=this._getSortedParticipantsCopy(),this.otherParticipant=this.conversation.getOtherParticipant(),this.getGenericErrorMessage=S([r("Something went screwy."),r("Something's busted."),r("Something got snagged."),r("Something's acting up."),r("Something sucks!"),r("Internet is being dumb."),r("Computer weirdness."),r("The server is being foolish."),r("Something fizzled."),r("The internet evaporated."),r("The internet is being wiggly."),r("Something went splat."),r("Server turned to dust."),r("Something's wonky."),r("Something's not happening."),r("Something's not working."),r("Something got messed up."),r("Unknown, totally annoying error."),r("A nameless error mysteriously occurred."),r("Our computer is a loser."),r("Something pooped out."),r("Something fell into a volcano."),r("Something is all gummed up."),r("Something melted.")]),this.permanentPostErrorMessage=r("Can't send this post."),this.getRetryPostErrorMessage=S([r("Hrm. Post didn't send."),r("Blegh. Post didn't send."),r("Fffft. Post didn't send."),r("Welp. Post didn't send."),r("Sending machine broke.")]),this.customErrorMessages={403.7001:r("Please verify your email address before talking to a Tumblr."),403.7003:r("Sorry, %1$s only allows messages from Tumblrs they follow.",this.otherParticipant.get("name")),409:r("You can only send messages to Tumblrs you follow."),429:r("You've hit the daily limit on new conversations. Impressive.")},this.getSpamErrorMessage=S([r("Look sketchy?"),r("Look suspicious?"),r("Look fishy?"),r("Look shady?"),r("Seem fake?"),r("Is this spam?")]),this.easeOutExpo=[.19,1,.22,1],this.dragCount=0},render:function(){return this.imageUploadPlugin=new E({imageUploadMaxBytes:this.getImageUploadMaxBytes()}),a.prototype.render.apply(this,arguments)},afterRenderSubviews:function(){this.listenTo(this,"change:isError change:isLoading",this._setOpenViewStates),this.listenTo(this,"change:isHidePendingPost change:isFetching change:isError change:isFetchingIcebreakers",this._setLoadingState),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:canSend",this._onChangeCanSend),this.listenTo(this,"change:isPossibleSpam",this._onChangeIsPossibleSpam),this.listenTo(this,"change:isMinimized",this._onChangeIsMinimized),this.listenTo(this,"change:isDropping",this._onChangeIsDropping),this.listenTo(this,"change:isCurrentDropValid",this._onChangeIsCurrentDropValid),this.listenTo(d,"tumblr_lightbox:form:hide",this._onTumblrLightboxFormHide),this.listenTo(this.composeView,"submit",this._onComposeSubmit),this.listenTo(this.composeView,"resize",this._onComposeResize),this.listenTo(this.composeView,"input",this._onComposeInput),this.listenTo(this.composeView,"focus",this._onComposeFocus),this.listenTo(this.composeView,"blur",this._onComposeBlur),this.listenTo(this.composeView,"plugin:preview:add:image",this._onComposeViewPluginPreviewAddImage),this.listenTo(this.composeView,"plugin:click",this._onComposeViewPluginClick),this.listenTo(this.composeView,"pasteBlob",this._onComposePasteBlob),this.listenTo(this.headerView,"closeClick",this._onTriggeredClose),this.listenTo(this.headerView,"minimizeClick",this._onHeaderMinimizeClick),this.listenTo(this.headerView,"moreActionsClick",this._onHeaderMoreActions),this.listenTo(this.conversation,"change:id",this._onChangeId),this.listenTo(this.conversation,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.conversation,"change:can_send",this._onChangeConversationCanSend),this.listenTo(this.conversation,"change:is_possible_spam",this._onChangeConversationIsPossibleSpam),this.listenTo(this.conversation.get("messages"),"change:hasNextPage",this._onChangeMessagesHasNextPage),this.listenTo(this.messagesView,"pillClick",this._onPillClick),this.listenTo(this.messagesView,"messageRetryClick",this._onMessageRetryClick),this.listenTo(this.messagesView,"messageImageUnblur",this._onMessageImageUnblur),this.listenTo(this.composeView,"close",this._onTriggeredClose),this.listenTo(this.minimizedView,"click",this._onMinimizedViewClick),this.listenTo(this.previewView,"close",this._onPreviewViewClose),this.listenTo(this.previewView,"closing",this._onPreviewViewClosing),this.listenTo(this.previewView,"dismiss",this._onPreviewViewDismiss),this.listenTo(this.previewView,"edit",this._onPreviewViewEdit),this._setLoadingState(),this._setMainViewStates(),this._setOpenViewStates(),this._onChangeConversationCanSend(this.conversation,this.conversation.get("can_send")),this._onChangeCanSend(this,this.get("canSend")),this._onChangeConversationIsPossibleSpam(this.conversation,this.conversation.get("is_possible_spam")),this._onChangeIsPossibleSpam(this,this.get("isPossibleSpam")),this.get("isAutoFetch")&&this.fetch(),this.mainTheme=this._applyTheme(this.el),this.js$("conversation-open").toggleClass(this.get("noBlurSupportClass"),!h.cssFilters())},beforeRemove:function(){this.conversation.get("messages").reset(this.conversation.getInboxMessage()),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("close")},fetch:function(e){return e=e||{},s.extend(e,{error:s.bind(this._onFetchConversationFail,this)}),this.set("isFetching",!0),this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this._pendingQueueItems=this.conversation.getQueueItems(),this.conversation.clearQueue(),this.conversation.fetchConversation(e).then(s.bind(this._onFetchConversationSuccess,this)).always(s.bind(this._onFetchConversationAlways,this))},poll:function(e,t){return e=e||{},this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING,this.conversation),this.conversation.poll(e,t).then(s.bind(function(){this.messagesView.scrollToBottom()},this))},refresh:function(e){this._queueMessages(e.getQueueItems()),this.unminimize(),this.focus()},focus:function(){return this.isMinimized()?this.focusMinimized():this.focusCompose(),this},getImageUploadMaxBytes:function(){return this.get("imageUploadMaxBytes")},getPluginsArray:function(){var e=[];return e.push(new T({collection:this.collection})),s.isEmpty(this.imageUploadPlugin)||e.push(this.imageUploadPlugin),e.push(new P),e},isMinimized:function(){return this.get("isMinimized")},focusMinimized:function(){this.minimizedView&&this.minimizedView.focus()},focusCompose:function(){this.composeView&&this.composeView.focus()},toggleMinimize:function(e,t){var i,o,r,a=new n.Deferred,l=this.get("minimizeOpeningClass"),c=this.get("minimizeClosingClass"),u=this.js$("conversation-open"),h=this.js$("conversation-minimized"),d=[a];return e===this.isMinimized()?(new n.Deferred).resolve():(i=function(){
this.set("isMinimized",e)},o=function(){a.resolve()},t?(i.call(this),o.call(this)):e?this._addAnimationClass(u,c).then(s.bind(function(){i.call(this),this._addAnimationClass(h,l).then(s.bind(o,this))},this)):this._addAnimationClass(h,c).then(s.bind(function(){i.call(this),this._addAnimationClass(u,l).then(s.bind(o,this))},this)),e||this.get("isFetched")||(r=this.fetch(),d.push(r)),n.when.apply(n,d))},minimize:function(e){return this.toggleMinimize(!0,e)},unminimize:function(e){return this.toggleMinimize(!1,e)},_showError:function(e){var t,i;return this.conversationErrorView&&this.conversationErrorView.remove(),i=this.js$("main"),t=new b(e),i.append(t.render().$el),this.conversationErrorView=t,this.set({isError:!0,isOffline:!0}),this._applyTheme(t.el),t},_hideError:function(){this.conversationErrorView&&(this.conversationErrorView.remove(),this.conversationErrorView=null),this.set({isError:!1,isOffline:!1}),this.focus()},_onFetchConversationSuccess:function(){this.rendered&&(this.set("isFetched",!0),this._hideError(),this.conversation.markAsRead(),this.otherParticipant.set(this.conversation.getOtherParticipant().toJSON()),this.messagesView.statusBannerView.trigger("setActiveTime",this.otherParticipant.get("seconds_since_last_activity")),this.minimizedView.trigger("setIsOnline",this.otherParticipant.get("seconds_since_last_activity")!==-1),this._queueMessages(this._pendingQueueItems),this._pendingQueueItems=null,this.conversation.get("messages").hasNextPage()||(this.set("isFetchingIcebreakers",!0),this._createIcebreakersView().always(s.bind(function(){this.set("isFetchingIcebreakers",!1),this.focus()},this))))},_flushMessageQueue:function(){var e;return this.conversation.hasQueue()?(e=this.conversation.getQueueItems(),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SEND_REQUESTED,e,this.conversation),this.conversation.isFlushingQueue()?this._flushDefer:(this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_SENDING,e,this.conversation),this._flushDefer=this.conversation.flushMessageQueue().progress(s.bind(this._onFlushProgress,this)).fail(s.bind(this._onFlushFail,this)).always(s.bind(this._onFlushAlways,this)),this._flushDefer)):(new n.Deferred).reject()},_onFlushProgress:function(e,t){this.rendered&&this.set("isHidePendingPost",!t&&!this._canRenderPendingMessage(e)),t?this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENT,e,this.conversation):this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENDING,e,this.conversation)},_onFlushFail:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_FAILED,e,this.conversation),this.rendered&&(this._canRenderPendingMessage(e)||(this.conversation.get("messages").remove(e),this._showPostSendingError(e)),this._flushMessageQueue())},_onFlushAlways:function(){this.rendered&&(this.set("isHidePendingPost",!1),this.focus())},_onFetchConversationFail:function(e,t){var i,n=t.status,o=s.get(t,"responseJSON.errors.0.code");this.rendered&&(s.isFinite(o)&&o>0&&(i=this.customErrorMessages[n+"."+o]),s.isEmpty(i)&&(i=s.get(this.customErrorMessages,n,this.getGenericErrorMessage())),this._showError({message:i,buttonCallback:s.bind(this._onConversationErrorRetryClick,this),showButton:e.canRetryFetch(s.get(t,"status"))}))},_showPostSendingError:function(e){var t,i,n;this.rendered&&(e.canRetry()?(t=this.getRetryPostErrorMessage(),n=s.partial(this._onPostSendingErrorRetryClick,e)):(t=this.permanentPostErrorMessage,i=r("Close"),n=this._onPostSendingErrorCloseClick),this._showError({message:t,buttonCallback:s.bind(n,this),buttonText:i}))},_onPostSendingErrorCloseClick:function(){this._hideError()},_onPostSendingErrorRetryClick:function(e){this._resendMessage(e).then(s.bind(function(){this._hideError()},this))},_onFetchConversationAlways:function(){this.rendered&&this.set("isFetching",!1)},_onComposeSubmit:function(e,t){var i,n,o=this.previewView.getMessage(),r=!s.isEmpty(e),a=!s.isEmpty(o);r&&(i=w.createTextMessage(e,{hasAnimation:!0,creationUserAction:t})),a&&(o.set({isFromPreview:!0,hasAnimation:!0,creationUserAction:t}),r&&i.set({context:o.get("context")})),n=s.compact([o,i]),a?this.previewView.close().then(s.bind(function(){s.delay(s.bind(function(){this.rendered&&this._queueMessages(n)},this),150)},this)):this._queueMessages(n),this.messagesView.scrollToBottom()},_canRenderPendingMessage:function(e){return!s.isEmpty(e)&&(!e.isPost()||e.getPost().hasThumbnail())},_queueMessages:function(e,t){return s.isEmpty(e)?(new n.Deferred).reject():(t=s.extend({},t,{isSendingMessage:!0}),s.isArray(e)||(e=[e]),s.each(e,s.bind(function(e){e.set("isQueued",!0),this.conversation.addMessage(e,t)},this)),this.conversation.appendToQueue(e,t),this._flushMessageQueue())},_resendMessage:function(e){var t=this.conversation.get("messages");return t.last()!==e&&t.remove(e),this._queueMessages(e)},_onComposeResize:function(){this.messagesView.updateScrollBar()},_onComposeInput:function(e,t){this.trigger("compose:input",e,t),this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_INPUT,this.conversation,e)},_onComposeFocus:function(e){this.trigger("compose:focus",e)},_onComposeBlur:function(e){this.trigger("compose:blur",e)},_onComposePasteBlob:function(e){this._isFileDropEnabled()&&this._addImageToFilePreview(e,"clipboard")},_onChangeId:function(e){e.isNew()||this.trigger("created",e)},_onChangeUnreadCount:function(e,t){0===t||this.isMinimized()||(this.messagesView.isAtBottom()?this._fetchUnreadMessages().then(s.bind(function(){this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGES_UNREAD_FETCHED)},this)):this.messagesView.showPill(t).then(s.bind(this._fetchUnreadMessages,this)).catch(s.noop))},_fetchUnreadMessages:function(){var e=this.conversation.get("unreadCount"),t=Math.min(10,e+5);return 0===e?(new n.Deferred).reject():(this.conversation.markAsRead(),this.poll(null,t))},_getSortedParticipantsCopy:function(){var e=this.conversation.get("participants"),t=this.channels.getSortedIds(this.conversation.get("participantUuid")),i=e.getSortedByChannels(t,!0);return new e.constructor(i)},_setLoadingState:function(){var e=this.get("isFetching")||this.get("isHidePendingPost")||this.get("isFetchingIcebreakers");this.set("isLoading",!this.get("isError")&&e)},_setMainViewStates:function(){var e=this.get("isMinimized"),t=this.js$("conversation-open"),i=this.js$("conversation-minimized");t.toggle(!e),i.toggle(e),e?i.css("display",""):t.css("display","")},_setOpenViewStates:function(){var e=this.get("isError"),t=this.get("isLoading");this.messagesView.toggle(!e&&!t),this.composeView.set("isDisabled",e||t),this.conversationLoaderView.set("loading",t)},_setDragDropClasses:function(){var e=this.get("droppingClassName"),t=this.get("isCurrentDropValid"),i=this.get("isDropping"),s=this._isFileDropEnabled(),n=s&&i&&t;this.js$("conversation-open").toggleClass(e,n),this.js$("conversation-minimized").toggleClass(e,n)},_createIcebreakersView:function(){var e;return this.icebreakersView?(e=new n.Deferred,e.reject(),e):this.otherParticipant.fetchAdditionalInfo(this.conversation.getParticipantId()).then(s.bind(function(){var e;this.rendered&&(e=this.conversation.isNew(),this.icebreakersView=new C({participant:this.otherParticipant,isShowTags:e,isShowRelationship:!e,isShowDescription:!e}),this.messagesView.addHeaderView(this.icebreakersView))},this))},_onTriggeredClose:function(){this.trigger("close")},_onHeaderMoreActions:function(e){this.actionsPopover&&this.actionsPopover.isOrWasRecentlyRendered()||this._showMoreActionsPopover(e)},_onHeaderMinimizeClick:function(){this.minimize()},_onMinimizedViewClick:function(){this.unminimize()},_onPillClick:function(){this.focus()},_onBlogClick:function(e){var t=n(e.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_TUMBLR_URL,{blogName:t.attr("data-js-tumblelog-name"),postId:t.attr("data-js-post-id"),searchTagTerm:t.attr("data-js-tumblelog-tag"),url:t.attr("href"),originalEvent:e})},_onMessagingBlogClick:function(e){var t=n(e.currentTarget);this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_MESSAGING_URL,{blogName:t.attr("data-js-messaging-tumblelog-name"),url:t.attr("href"),originalEvent:e})},_onImageLightboxUrlClick:function(e){e.preventDefault();var t,i=n(e.currentTarget),o=i.attr("data-js-lightbox-width"),r=i.attr("data-js-lightbox-height"),a=i.attr("data-js-lightbox-lowres-url"),l=i.attr("data-js-lightbox-url");s.isEmpty(a)||s.isEmpty(l)||(t={width:o,height:r,low_res:a,high_res:l},s.get(t,"low_res")&&(this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_LIGHTBOX,{lightBoxImageData:[t]}),this.composeView.set("isLightboxOpen",!0)))},_onActionsBlock:function(e){var t=this.conversation.getParticipantModel();s.isEmpty(t)||this.eventBus.trigger(this.eventBus.BLOCK,{currentTumblelog:t.get("name"),blockedTumblelog:e,context:"messaging"},this.conversation)},_onActionsDelete:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_DELETE_MODEL,this.conversation)},_applyTheme:function(e){var t;return s.isEmpty(this.otherParticipant)?null:(t=this.otherParticipant.get("theme"),s.isEmpty(t)?null:new y({el:e,theme:t}).render())},_showMoreActionsPopover:function(e){var t;this.actionsPopover&&this.actionsPopover.remove(),this.actionsPopover=new k({autoTeardown:!0,pinnedSide:"bottom",pinnedTarget:e,popoverContainer:this.popoverContainer,viewOptions:{participants:this.conversation.get("participants"),user:this.user}}),t=this.actionsPopover.getView(),this.listenTo(t,"block",this._onActionsBlock),this.listenTo(t,"delete",this._onActionsDelete),this.actionsPopover.render()},_animateInMessage:function(e,t,i){var n,r,a=e.$el,l=this.composeView.$el.offset(),c=a.offset(),u=Math.max(0,l.top-c.top)+a.height();i.get("isFromPreview")?n=0:(r=t.offset(),n=l.left-r.left),this.messagesView.setIsAnimating(!0),o.animate(a,{translateY:[0,u],translateX:[0,n],opacity:[1,1]},{duration:this.get("animateInMessageDuration"),easing:this.easeOutExpo,complete:s.bind(function(){this.messagesView.setIsAnimating(!1),i.set("hasAnimation",!1),a.css("transform","")},this)})},_addAnimationClass:function(e,t){var i=new n.Deferred;return e.removeClass(t),u(e,function(){e.removeClass(t),i.resolve()}),e.addClass(t),i},_addImageToFilePreview:function(e,t){var i=function(){this.imageUploadPlugin.addImageFile(e,t)};this.isMinimized()?this.unminimize().then(s.bind(i,this)):i.call(this)},_isFileDropEnabled:function(){return this.rendered&&!this.previewView.hasImage()&&this.get("canSend")&&!this.get("isError")},_onConversationErrorRetryClick:function(e){return this.fetch()},_onChangeIsOffline:function(e,t){this.composeView.set("isOffline",t)},_onMessageRetryClick:function(e){this._resendMessage(e)},_onMessageImageUnblur:function(e){this.conversation.unblurImages()},_onChangeConversationCanSend:function(e,t){this.set("canSend",t)},_onChangeConversationIsPossibleSpam:function(e,t){this.set("isPossibleSpam",t)},_onChangeCanSend:function(e,t){var i=r("This Tumblr can't receive messages.");this.composeView.toggle(t),!t&&this.canSendErrorView||t&&!this.canSendErrorView||(t?(this.messagesView.removeFooterView(this.canSendErrorView),delete this.canSendErrorView):(this.canSendErrorView=new _({message:i,showErrorIcon:!0}),this.messagesView.addFooterView(this.canSendErrorView)))},_onChangeIsPossibleSpam:function(e,t){t&&this.isPossibleSpamView||!t&&!this.isPossibleSpamView||(t?(this.isPossibleSpamView=new _({message:this.getSpamErrorMessage(),actionText:r("Mark as spam"),actionCallback:s.bind(this._onMarkAsSpamLinkClick,this)}),this.messagesView.addFooterView(this.isPossibleSpamView)):(this.messagesView.removeFooterView(this.isPossibleSpamView),delete this.isPossibleSpamView))},_onChangeIsMinimized:function(e,t){this._setMainViewStates(),t||s.defer(s.bind(function(){this.messagesView.updateScrollBar(),this.focus(),this.conversation.get("unreadCount")>0&&(this._fetchUnreadMessages(),this.messagesView.scrollToBottom())},this)),this.trigger(t?"minimized":"unminimized")},_onChangeIsDropping:function(e,t){this._setDragDropClasses()},_onChangeIsCurrentDropValid:function(e,t){this._setDragDropClasses()},_onMainContainerClick:function(){window.getSelection().isCollapsed&&this.focus()},_onKeyDown:function(e){var t=e.keyCode;9===t&&(e.shiftKey?this.trigger("keydown:shift+tab",e):this.trigger("keydown:tab",e))},_onDragOver:function(e){var t=s.get(e,"originalEvent.dataTransfer.types",[]),i=s.contains(t,"Files"),n=this._isFileDropEnabled();e.preventDefault(),this.set("isCurrentDropValid",i),s.set(e,"originalEvent.dataTransfer.dropEffect",i&&n?"copy":"none")},_onDragEnter:function(){this.dragCount++,this.set("isDropping",!0)},_onDragLeave:function(){this.dragCount--,this.set("isDropping",this.dragCount>0)},_onDragDrop:function(e){var t=s.get(e,"originalEvent.dataTransfer.files",[]);if(e.preventDefault(),this.dragCount=0,this.set("isDropping",!1),0!==t.length)return this.previewView.hasImage()?void(this.isMinimized()&&this.unminimize()):void(this._isFileDropEnabled()&&this._addImageToFilePreview(s.last(t),"drop"))},_onComposeViewPluginPreviewAddImage:function(e){this.previewView.addImage(e),this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!1),this.focus(),this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_ADD,this.conversation,e)},_onComposeViewPluginClick:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_COMPOSE_PLUGIN_CLICK,this.conversation,e)},_onPreviewViewClosing:function(e){this.focus()},_onPreviewViewClose:function(e){this.messagesView.updateScrollBar(),this.composeView.toggleAutoValidation(!0),this.focus()},_onPreviewViewDismiss:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_DISMISS,this.conversation,e)},_onPreviewViewEdit:function(e){this.eventBus.trigger(this.eventBus.CONVERSATION_IMAGE_PREVIEW_EDIT,this.conversation,e)},_onMarkAsSpamLinkClick:function(){this.eventBus.trigger(this.eventBus.CONVERSATION_MARK_AS_SPAM,this.conversation,this.otherParticipant)},_onChangeMessagesHasNextPage:function(e,t){!this.rendered||this.conversation.isNew()||t||this._createIcebreakersView()},_onTumblrLightboxFormHide:function(){this.composeView.set("isLightboxOpen",!1)}});e.exports=F},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(713),a=n.extend({className:"conversation-header",template:r,mixins:[o],defaults:{separator:"+"},attributes:{"data-js-theme-background-color-or-image-class":!0,"data-js-theme-accent-color-on-background":!0},events:{"click [data-js-close]":"_onClickCloseButton","click [data-js-more-actions]":"_onClickMoreActions","click [data-js-minimize]":"_onClickMinimizeButton"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants","user","channels"))},getTemplateData:function(){var e;return e=this.channels.length>1?this.participants.toJSON():s.invoke(this.participants.getWithout(this.channels.pluck("uuid")),"toJSON"),e=s.filter(e,function(e){return!s.isEmpty(s.get(e,"name"))}),{participants:e,separator:this.get("separator")}},_onClickCloseButton:function(e){this.trigger("closeClick"),e.preventDefault()},_onClickMoreActions:function(e){var t=e.currentTarget;this.trigger("moreActionsClick",t),e.preventDefault()},_onClickMinimizeButton:function(e){this.trigger("minimizeClick"),e.preventDefault()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="conversation-header-image" data-js-theme-header-image></div><div class="conversation-header-main"><div data-js-title class="title"> ';var lastIndex=participants.length-2;__p+=" ",_.each(participants,function(e,t){__p+=' <a href="'+__e(e.url)+'" target="_blank" data-js-tumblelog-name="'+__e(e.name)+'">'+__e(e.name)+"</a> "+__e(t===lastIndex?" "+separator+" ":t<lastIndex?", ":"")+" "}),__p+=' </div><div class="controls" data-js-theme-accent-color-on-background><a href="#" data-js-more-actions class="more-actions">'+__e(__("Actions"))+'</a><a href="#" data-js-minimize class="minimize">'+__e(__("Minimize"))+'</a><a href="#" data-js-close class="close">'+__e(__("Close"))+"</a></div></div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(9),o=i(150),r=i(185),a=i(684),l=i(236),c=i(290),u=i(690),h=i(715),d=i(734),p=i(736),g=i(737),_=r.extend({className:"conversation-messages",template:p,mixins:[l,a],defaults:{isVisible:!0,isPaginating:!1,tsHeaderThreshold:36e5,collapseMessagesThreshold:6e4,pillClickScrollSpeed:500,pillBottomThreshold:80},subviews:{paginationLoaderView:{constructor:c,options:{variation:"small h-centered",loading:!1}},messagesView:{constructor:h,options:function(e){return{eventBus:e.eventBus,participants:e.participants,conversation:e.conversation,formatter:e.messageFormatter,animateInMessage:e.animateInMessage,isSafeModeEnabled:e.isSafeModeEnabled,afterRetryClick:s.bind(e.afterRetryClick,e),afterImageUnblur:s.bind(e.afterImageUnblur,e),canModifySafeMode:e.canModifySafeMode}},collection:function(e){return e.collection}},statusBannerView:{constructor:g,options:function(e){return{otherParticipant:e.otherParticipant,name:e.otherParticipant.get("name")}}},pillView:{constructor:d,options:function(e){return{eventBus:e.eventBus}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","collection","participants","conversation","messageFormatter","animateInMessage","isSafeModeEnabled","otherParticipant","canModifySafeMode"))},afterRenderSubviews:function(){this.scrollBar=new u({el:this.el,bottomThreshold:this.get("pillBottomThreshold")}),this.listenTo(this.collection,"update reset",this._onCollectionUpdate),this.listenTo(this.collection,"change:hasNextPage",this._onChangeHasNextPage),this.listenTo(this.collection,"change:isError",this._onChangeMessageIsError),this.listenTo(this.scrollBar,"scrolltop",this._onScrollChangeIsAtTop),this.listenTo(this.scrollBar,"scrollbottom",this._onScrollChangeIsAtBottom),this.listenTo(this.scrollBar,"scrollstop",this._createPositionSnapshot),this.listenTo(this.pillView,"click",this._onPillViewClick),this.listenTo(this,"change:isPaginating",this._onChangeIsPaginating),this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this._onChangeHasNextPage(this.collection,this.collection.hasNextPage()),s.defer(s.bind(function(){this._processMessages(),this.updateScrollBar(),this.scrollToBottom()},this))},beforeRemove:function(){this.scrollBar&&this.scrollBar.destroy()},scrollToBottom:function(e){this._setScrollTop(this.el.scrollHeight,e)},getNextPage:function(){this.collection.hasNextPage()&&(this.set("isPaginating",!0),this.collection.fetchNextPage({at:0,isPaginating:!0,scrollBottom:this._getCurrentScrollBottom()}).always(s.bind(function(){this.set("isPaginating",!1)},this)))},updateScrollBar:function(){var e,t=this.scrollBar.isDisabled();this.scrollBar.setDisabled(!0),this.scrollBar&&this.scrollBar.update(),e=this._getPositionDiff(),e&&this._setScrollTop(this.$el.scrollTop()+e.height+e.scrollTop),this._createPositionSnapshot(),this.scrollBar.setDisabled(t)},afterRetryClick:function(e){this.trigger("messageRetryClick",e)},afterImageUnblur:function(e){this.trigger("messageImageUnblur",e)},toggle:function(e){this.set("isVisible",e)},isAtBottom:function(){return!this._lastPosition||!this.scrollBar||this._lastPosition.scrollBottom<this.get("pillBottomThreshold")},showPill:function(e){return this._pillDefer&&this._pillDefer.reject(),this._pillDefer=o.defer(),this.pillView.setCount(e),this._pillDefer.promise},addHeaderView:function(e){var t=this._getCurrentScrollBottom();return this.js$("header").append(e.render().$el),this._adjustScrollbarAfterNewElements(t),e},removeHeaderView:function(e){return e.remove()},addFooterView:function(e){return this.js$("footer").append(e.render().$el),e},removeFooterView:function(e){return e.remove()},setIsAnimating:function(e){this.$el.toggleClass("is-animating",e)},_onChangeIsVisible:function(e,t){this.$el.css("visibility",t?"":"hidden"),t&&(this.updateScrollBar(),this.scrollToBottom())},_setScrollTop:function(e,t){t?this.$el.animate({scrollTop:e},t):this.$el.scrollTop(e),this._createPositionSnapshot()},_getCurrentScrollBottom:function(){return this.el.scrollHeight-this.$el.scrollTop()},_onCollectionUpdate:function(e,t){this._processMessages(t),s.get(t,"isPaginating")&&this._adjustScrollbarAfterNewElements(s.get(t,"scrollBottom")),s.defer(s.bind(function(){this.rendered&&this._adjustScrollbarAfterFetch(t)},this))},_adjustScrollbarAfterFetch:function(e){this.scrollBar&&this.scrollBar.update(),s.get(e,"isPolling")||s.get(e,"isPaginating")||this.scrollToBottom(),this._createPositionSnapshot()},_adjustScrollbarAfterNewElements:function(e){s.isNumber(e)&&(this.scrollBar.setDisabled(!0),this._setScrollTop(this.el.scrollHeight-e),s.delay(s.bind(function(){this.scrollBar.setDisabled(!1)},this),500))},_onChangeIsPaginating:function(e,t){this.paginationLoaderView.set("loading",t)},_onChangeHasNextPage:function(e,t){this.js$("loader-container").toggle(t)},_processMessages:function(e){var t,i=this.get("tsHeaderThreshold"),n=this.get("collapseMessagesThreshold"),o=(new Date).getTime();s.get(e,"isPolling")&&(o="new"),this.collection.each(function(e){e.set({tsHeader:this._getTimestampHeader(e,t,i),isCollapsed:this._getIsCollapsed(e,t,n,o)}),t=e},this)},_getTimestampHeader:function(e,t,i){var s=e?e.getTimestamp():null,o=t?t.getTimestamp():null,r=!o||s-o>i;return r?n(s).calendar():null},_getIsCollapsed:function(e,t,i,s){return e.has("collapseGroup")||e.set("collapseGroup",e.isNew()?"new":s),!!t&&(e.get("collapseGroup")===t.get("collapseGroup")&&(e.get("participant")===t.get("participant")&&e.getTimestamp()-t.getTimestamp()<i))},_getScrollPosition:function(){return this.scrollBar.getCurrentPositions()},_createPositionSnapshot:function(){this._lastPosition=this._getScrollPosition()},_getPositionDiff:function(){if(this._lastPosition){var e=this._getScrollPosition();return{scrollTop:this._lastPosition.scrollTop-e.scrollTop,scrollBottom:this._lastPosition.scrollBottom-e.scrollBottom,height:this._lastPosition.height-e.height}}},_onScrollChangeIsAtTop:function(e){e&&this.getNextPage()},_onScrollChangeIsAtBottom:function(e){e&&this._pillDefer&&(this._pillDefer.resolve(this.pillView.getCount()),this.pillView.setCount(0))},_onPillViewClick:function(){this.pillView.setCount(0),this.scrollToBottom(this.get("pillClickScrollSpeed")),this._pillDefer&&this._pillDefer.resolve()},_onChangeMessageIsError:function(){this.scrollToBottom()}});e.exports=_},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(236),a=i(664),l=i(716),c=i(717),u=i(723),h=i(725),d=i(728),p=i(730),g=i(732),_=o.extend({className:"conversation-message",template:l,mixins:[r],defaults:{pendingClassName:"is-pending"},events:{"click [data-js-retry-button]":"_onRetryClick"},messagesTypes:{},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants","conversation","afterRetryClick","formatter","animateInMessage","afterImageUnblur","isSafeModeEnabled","canModifySafeMode")),this.addMessageType(a.STICKER,g,function(e){return{conversation:e.conversation}}),this.isSafeModeEnabled&&this.model.get("post").get("is_nsfw")?this.addMessageType(a.POST,h,function(e){return{conversation:e.conversation,canModifySafeMode:e.canModifySafeMode}}):this.addMessageType(a.POST,u),this.addMessageType(a.IMAGE,d,function(e){return{conversation:e.conversation,afterImageUnblur:s.bind(e.afterImageUnblur,e)}}),this.addMessageType(a.TEXT,c,function(e){return{formatter:e.formatter}})},afterRenderSubviews:function(){var e=this.createMessageView(this.model.get("type"));return e?(this.js$("message-container").html(e.render().$el),this.model.get("hasAnimation")&&s.isFunction(this.animateInMessage)&&this.animateInMessage(this,this.js$("message-bubble"),this.model),this.listenTo(this.model,"change:isPending",this._onChangeIsPending),this.listenTo(this.model,"change:isError",this._onChangeIsError),this.listenTo(this.model,"change:isCollapsed",this._onChangeIsCollapsed),this.listenTo(this.model,"change:isQueued",this._onChangeIsQueued),this.listenTo(this.model,"change:tsHeader",this._onChangeTsHeader),this.listenTo(this.model,"change:isPending change:isError change:canRetry change:id",this.setRetryButtonState),this._onChangeIsPending(this.model,this.model.get("isPending")),this._onChangeIsError(this.model,this.model.get("isError")),this._onChangeTsHeader(this.model,this.model.get("tsHeader")),this._onChangeIsCollapsed(this.model,this.model.get("isCollapsed")),this._onChangeIsQueued(this.model,this.model.get("isQueued")),void this.setRetryButtonState()):void this.remove()},addMessageType:function(e,t,i){this.messagesTypes[e]={constructor:t,options:i}},getMessageType:function(e){return s.get(this.messagesTypes,e)},createMessageView:function(e){var t,i=this.getMessageType(e);return s.isEmpty(i)||!s.has(i,"constructor")?null:(t=s.get(i,"options",{}),s.isFunction(t)&&(t=t.call(this,this)),s.extend(t,{model:this.model,participants:this.participants,eventBus:this.eventBus,setRetryButtonState:s.bind(this.setRetryButtonState,this)}),new i.constructor(t))},setRetryButtonState:function(){var e,t,i,s,o,r,a,l;this.rendered&&(e=this.js$("retry-button",!0),0!==e.length&&(o=this.model.isNew(),t=this.model.get("isPending"),i=this.model.get("canRetry"),s=this.model.get("isError"),r=n(i?"Retry":"Could not send"),a=t?n("Trying..."):r,l=s&&o,e.toggle(l),l&&(e.text(a).prop("disabled",t||!i),e.toggleClass(this.get("pendingClassName"),t))))},_onChangeTsHeader:function(e,t){this.timestampView&&this.timestampView.remove(),s.isEmpty(t)||(this.timestampView=new p({model:this.model}),this.$el.prepend(this.timestampView.render().$el))},_onChangeIsCollapsed:function(e,t){this.$el.toggleClass("collapsed",t)},_onChangeIsPending:function(e,t){this.$el.toggleClass("pending",t)},_onChangeIsError:function(e,t){this.$el.toggleClass("error",t)},_onChangeIsQueued:function(e,t){this.$el.toggleClass("queued",t)},_onRetryClick:function(e){e.preventDefault(),this.model.get("canRetry")&&(this.trigger("retryClick",this.model),s.isFunction(this.afterRetryClick)&&this.afterRetryClick(this.model))}});e.exports=_},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<div data-js-message-container></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(718).html,a=i(722),l=n.extend({className:"conversation-message-text message-container",mixins:[o],template:a,defaults:{fullWidthBubblePercentThreshold:60,fullWidthBubbleClass:"full-width-bubble"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants")),this.formatter=e.formatter||new r},afterRenderSubviews:function(){this.listenTo(this.model.get("content"),"change",this.render),this.$el.width()?this._setBubbleStyles():s.defer(s.bind(this._setBubbleStyles,this))},getTemplateData:function(){var e=this.participants.get(this.model.get("participant")),t=this.model.toJSON(),i=this.formatter.render(s.get(t,"content.text"),s.get(t,"content.formatting"));return{message:i,avatarUrl:e?e.getAvatarUrl():null,name:e?e.get("name"):null,url:e?e.get("url"):null}},_setBubbleStyles:function(){var e=this.get("fullWidthBubblePercentThreshold"),t=this.js$("message-bubble"),i=this.$el.width(),s=t.width();s>e/100*i&&t.addClass(this.get("fullWidthBubbleClass"))}});e.exports=l},function(e,t,i){"use strict";e.exports={html:i(719)}},function(e,t,i){"use strict";var s=i(3),n=i(720),o=i(721),r=n.extend({name:"html",formatters:{link:o},escape:function(e){return s.escape(e)},applyFormatting:function(e,t){var i=s.bind(this.escape,this),n=s.bind(this.getFormatter,this),o={};s.forEach(t,function(e){var t=n(e.type);if(t){var i=e.position,r=e.attributes,a=i[0],l=i[1];s.isEmpty(o[a])&&(o[a]=[]),s.isEmpty(o[l])&&(o[l]=[]),o[a].push(s.bind(t.open,this,r)),o[l].unshift(s.bind(t.close,this,r))}},this);var r,a,l=s.sortBy(s.keys(o),function(e){return s.parseInt(e)}),c="",u=0;return s.forEach(l,function(t){r=o[t],a=e.substr(u,t-u),c+=i(a),s.forEach(r,function(e){c+=e()}),u=t},this),a=e.substr(u),c+=i(a)}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(174),o=n.extend({name:"unknown",formatters:{},constructor:function(e){this.options=e||{},s.isFunction(this.formatters)?this.formatters=this.formatters():this.formatters=s.clone(this.formatters||{})},registerFormatter:function(e,t){this.formatters[e]=t},getFormatter:function(e){return s.result(this.formatters,e)},escape:function(e){return e},applyFormatting:function(e,t){return this.escape(e)},postFilter:function(e){return e},render:function(e,t){return this.postFilter(this.applyFormatting(e,t))}});e.exports=o},function(e,t,i){"use strict";function s(e){return n(e).omit(n.isUndefined).reduce(function(e,t,i){return(e?e+" ":"")+o('%s="%s"',n.escape(i),n.escape(t))},"")}var n=i(3),o=i(6).sprintf,r={open:function(e){var t=s({"data-js-tumblelog-name":e.blog_name,"data-js-post-id":e.post_id,"data-js-messaging-tumblelog-name":e.messaging_blog_name,target:"_blank",href:e.url});return"<a "+t+">"},close:function(e){return"</a>"}};e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a><div class="message-bubble" data-js-message-bubble><div class="message-bubble-header"><a href="'+__e(url)+'" class="name" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+'</a><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+'</button></div><div class="message">'+(null==(__t=message)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(687),a=i(724),l=n.extend({className:"conversation-message-post",mixins:[o],template:a,defaults:{thumbnailWidth:210},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants","model","setRetryButtonState"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError change:isPending",this._onModelChange),this.listenTo(this.model.get("post"),"change:summary change:state",this._onModelChange),this._startTruncateSummary()},getThumbnailAtWidth:function(e){var t,i=this.model.get("post"),n=i.getThumbnail(e);return s.isEmpty(n)?null:(t=i.getScaledDimensionsForWidth(n,e),s.extend({},n,t))},getTemplateData:function(){var e=this.model.get("post"),t=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:e.getType(),isDisabled:e.isDisabled(),isError:this.model.get("isError"),isPending:this.model.get("isPending"),actionString:t?e.getActionMarkup(t.get("name")):null,message:e.getMessage(),thumbnail:i,avatarUrl:t?t.getAvatarUrl():null,name:t?t.get("name"):null,blogUrl:t?t.get("url"):null,url:e.get("post_url"),postBlogName:e.get("blog_name"),postId:e.get("id")}},_startTruncateSummary:function(){s.defer(s.bind(this._truncateSummary,this))},_truncateSummary:function(){r(this.js$("summary",!0))},_onModelChange:function(){this.renderWithTemplate(),
this._startTruncateSummary(),s.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+"</span> ",_.isEmpty(message)||(__p+=' <span class="text">'+__e(message)+"</span> "),__p+=" </div> ",_.isEmpty(url)||(__p+=" </a> "),__p+=' <button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> ",_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'" class="icon"></a> '),__p+=" "),__p+=" </div> ",_.isEmpty(thumbnail)||(__p+=' <div class="thumbnail"> ',_.isEmpty(url)||(__p+=' <a href="'+__e(url)+'" data-js-tumblelog-name="'+__e(postBlogName)+'" data-js-post-id="'+__e(postId)+'"> '),__p+=' <img src="'+__e(_.get(thumbnail,"url"))+'" width="'+__e(_.get(thumbnail,"width"))+'" height="'+__e(_.get(thumbnail,"height"))+'"> ',_.isEmpty(url)||(__p+=" </a> "),__p+=" </div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(723),o=i(726),r=i(727),a=i(139),l=i(8),c=n.extend({className:"conversation-message-safemode-post",template:r,events:{"click .link-safemode-settings":"_onlinkClick"},initialize:function(e){s.extend(this,s.pick(e,"conversation","canModifySafeMode")),n.prototype.initialize.apply(this,arguments)},getTemplateData:function(){var e=this.model.get("post"),t=this.participants.get(this.model.get("participant")),i=this.getThumbnailAtWidth(this.get("thumbnailWidth"));return{postType:e.getType(),isDisabled:e.isDisabled(),actionString:t?e.getActionMarkup(t.get("name")):null,thumbnail:i,avatarUrl:t?t.getAvatarUrl():null,name:t?t.get("name"):null,blogUrl:t?t.get("url"):null,canModifySafeMode:this.canModifySafeMode?this.canModifySafeMode:null}},afterRenderSubviews:function(){this.theme=new o({el:this.el,theme:this.conversation.getOtherParticipant().get("theme")}).render()},_onlinkClick:function(e){event.preventDefault();var t={source:"messaging_post"};a.trigger("safeMode:FilteringSettingLinkClicked",{loggingData:t}),window.open(l(e.currentTarget).attr("href"))}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(236),r=i(189),a=n.extend({mixins:[o,r],defaults:{removeDataAttrAfterApplyingTheme:!0},configuration:{"theme-background-color":{themeField:"background_color",applyStyle:"background-color"},"theme-accent-color":{themeField:"link_color",applyStyle:"color"},"theme-accent-color-on-white":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.adjustColorForBackground(t,"#ffffff"))}},"theme-accent-color-on-grey":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.adjustColorForBackground(t,"#f2f2f2"))}},"theme-accent-color-on-background":{themeField:"link_color",unsetMissingStyle:"color",applyStyle:function(e,t,i){e.css("color",i.getReadableColor(t,i.get("background_color")))}},"theme-accent-color-as-background":{themeField:"link_color",unsetMissingStyle:"background-color",applyStyle:function(e,t,i){e.css("background-color",i.adjustColorForBackground(t,"#ffffff"))}},"theme-button":{themeField:function(e){var t=e.get("background_color"),i=e.get("link_color");return s.isEmpty(t)||s.isEmpty(i)?null:{text:t,background:e.getReadableColor(i,t)}},applyStyle:function(e,t,i){e.addClass("themed"),i.getHeaderImage()||e.css({"background-color":t.background,"border-color":t.background,color:t.text})}},"theme-header-image":{themeField:function(e){return e.getHeaderImage()},applyStyle:function(e,t){e.css("background-image","url("+t+")")}},"theme-background-tint":{themeField:function(e){return e.getTintSuffix(e.getBackgroundTint())},applyStyle:function(e,t,i){e.addClass("theme-background"+t)}},"theme-background-color-or-image-class":{themeField:"background_color",applyStyle:function(e,t,i){s.isEmpty(i.getHeaderImage())?e.css("background-color",t):e.addClass("has-image")}},"theme-avatar-shape-class":{themeField:"avatar_shape",applyStyle:function(e,t){e.addClass("avatar-shape--"+t)}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"theme"))},render:function(){this.theme&&s.each(this.configuration,function(e,t){var i,n,o=e.unsetMissingStyle,r=e.applyStyle;if(i=s.isFunction(e.themeField)?e.themeField.call(this,this.theme):this.theme.get(e.themeField),n=this.js$(t),0!==n.length){if(s.isEmpty(i))return void(s.isFunction(o)?o.call(this,n,i,this.theme):s.isEmpty(o)?s.isFunction(r)||n.css(r,""):n.css(o,""));s.isFunction(r)?r.call(this,n,i,this.theme):n.css(r,i),this.get("removeDataAttrAfterApplyingTheme")&&n.removeAttr("data-js-"+t)}},this)},setTheme:function(e){return this.theme=e,this.render()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container conversation-message-post--'+__e(postType)+" "+__e(_.isEmpty(thumbnail)?"no-thumbnail":"has-thumbnail")+__e(isDisabled?" is-disabled":"")+'"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div> ',isDisabled?__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header">'+__e(actionString)+"</div></div> ":(__p+=' <div class="message-bubble" data-js-message-bubble><div class="message-bubble-header" data-js-summary><span class="name">'+__e(actionString)+'</span></div><div class="post-content-inner"><p><span class="message">'+__e(__("This post may contain sensitive media."))+"</span><br> ",__p+=canModifySafeMode?" "+(null==(__t=__("%1$sSafe Mode is on%2$s",'<a class="link link-safemode-settings" href="/settings/account" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ":" "+(null==(__t=__("%1$sWhy am I seeing this?%2$s",'<a class="link link-safemode-settings" href="/docs/nsfw" target="_blank" data-js-theme-accent-color>',"</a>"))?"":__t)+" ",__p+=' </p></div><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button></div> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(236),a=i(221),l=i(290),c=i(729),u=o.extend({className:"conversation-message-image",mixins:[r],template:c,defaults:{thumbnailWidth:210,isBlurred:!1,blurClassName:"is-blur",unblurringClassName:"is-unblurring",errorClassName:"is-error",pendingClassName:"is-pending",blurAnimationDurationMs:300,blurMessageString:null},events:{"click [data-js-overlay-container]":"_onOverlayContainerClick"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants","conversation","model","setRetryButtonState","afterImageUnblur")),this.set("blurMessageString",n("Blurred because you don't follow this Tumblr yet. Click to reveal.")),this.image=this.model.getImage()},afterRenderSubviews:function(){this.listenTo(this,"change:isBlurred",this._onChangeIsBlurred),this.listenTo(this.model,"change:isPending",this._onModelIsPendingChange),this.listenTo(this.model,"change:isError",this._onModelIsErrorChange),this.listenTo(this.conversation,"change:is_blurred_images",this._onChangeConversationIsBlurredImages),this.listenTo(this.image.getAltSizes(),"update reset",this._onModelImagesUpdate),this._onChangeConversationIsBlurredImages(this.conversation,this.conversation.get("is_blurred_images")),this._onChangeIsBlurred(this,this.get("isBlurred"))},getTemplateData:function(){var e=this.image.getImageAtSize(this.get("thumbnailWidth")),t=this.getThumbnailDimensions(e),i=s.get(t,"width"),n=s.get(t,"height"),o=this.participants.get(this.model.get("participant"));return this.thumbnailUrl=this.thumbnailUrl||e.get("url"),{name:o?o.get("name"):null,avatarUrl:o?o.getAvatarUrl():null,blogUrl:o?o.get("url"):null,highResUrl:this.image.hasAltSizes()?this.image.getHighResImageUrl():null,lowResUrl:this.thumbnailUrl,thumbnailImageUrl:this.thumbnailUrl,originalWidth:this.image.getOriginalSize().get("width"),originalHeight:this.image.getOriginalSize().get("height"),thumbnailWidth:i,thumbnailHeight:n}},getThumbnailDimensions:function(e){var t=this.get("thumbnailWidth"),i=a.heightForWidth(t,e.get("width"),e.get("height"));return s.extend({},{width:t,height:i})},_onModelIsPendingChange:function(e,t){t?(this.imageLoaderView=new l({variation:"small centered",loading:t}),this.js$("image-loader-container").append(this.imageLoaderView.render().$el)):this._removeImageLoader(),this.$el.toggleClass(this.get("pendingClassName"),t)},_onModelIsErrorChange:function(e,t){this.$el.toggleClass(this.get("errorClassName"),t)},_removeImageLoader:function(){this.imageLoaderView&&this.imageLoaderView.remove()},_onModelImagesUpdate:function(){this.renderWithTemplate(),this._toggleBlurred(this.get("isBlurred")),s.isFunction(this.setRetryButtonState)&&this.setRetryButtonState()},_toggleBlurred:function(e){var t=this.get("unblurringClassName"),i=this.js$("overlay-text",!0),n=!e&&this.previous("isBlurred"),o=this.get("blurClassName");this.$el.toggleClass(o,e).toggleClass(t,n),e?i.text(this.get("blurMessageString")):n||i.empty(),this._unblurTimer&&clearTimeout(this._unblurTimer),n&&(this._unblurTimer=s.delay(s.bind(function(){this.rendered&&(i.empty(),this.$el.removeClass(t),delete this._unblurTimer)},this),this.get("blurAnimationDurationMs")))},_onChangeIsBlurred:function(e,t){this._toggleBlurred(t)},_onChangeConversationIsBlurredImages:function(e,t){this.set("isBlurred",t&&e.shouldBlurImageMessage(this.model))},_onOverlayContainerClick:function(e){this.get("isBlurred")&&(e.preventDefault(),e.stopImmediatePropagation(),this.set("isBlurred",!1),s.isFunction(this.afterImageUnblur)&&this.afterImageUnblur(this.model))}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=' <a href="'+__e(highResUrl)+'" data-js-lightbox-url="'+__e(highResUrl)+'" data-js-lightbox-width="'+__e(originalWidth)+'" data-js-lightbox-height="'+__e(originalHeight)+'" data-js-lightbox-lowres-url="'+__e(lowResUrl)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><div class="conversation-image-loader" data-js-image-loader-container></div><img data-js-message-image src="'+__e(thumbnailImageUrl)+'" width="'+__e(thumbnailWidth)+'" height="'+__e(thumbnailHeight)+'"><div class="overlay" data-js-overlay-container><p class="text" data-js-overlay-text></p></div></div> ',_.isEmpty(highResUrl)||_.isEmpty(lowResUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(731),r=n.extend({className:"conversation-message-timestamp",template:o,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus"))},getTemplateData:function(){return{label:this.model.get("tsHeader")}}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-js-label class="inline-activity timestamp">'+__e(label)+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(733),a=n.extend({className:"conversation-message-sticker message-container",mixins:[o],template:r,defaults:{thumbnailWidth:210,rawWidth:1280,errorClassName:"is-error"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participants","conversation"))},afterRenderSubviews:function(){this.listenTo(this.model,"change:isError",this._onModelIsErrorChange)},getTemplateData:function(){var e=this.model.toJSON(),t=e.sticker.original_size_url,i=e.sticker.url,s=this.participants.get(this.model.get("participant"));return{name:s?s.get("name"):null,avatarUrl:s?s.getAvatarUrl():null,blogUrl:s?s.get("url"):null,rawUrl:t?t:null,url:i?i:null,thumbnailWidth:this.get("thumbnailWidth"),rawWidth:this.get("rawWidth")}},_onModelIsErrorChange:function(e){this.$el.toggleClass(this.get("errorClassName"),e)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message-container has-thumbnail"><div class="avatar"><a href="'+__e(blogUrl)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"><img src="'+__e(avatarUrl)+'"></a></div><div class="message-bubble" data-js-message-bubble><button class="retry-button" data-js-retry-button>'+__e(__("Retry"))+"</button> ",_.isEmpty(rawUrl)||(__p+=' <a href="'+__e(rawUrl)+'" data-js-lightbox-url="'+__e(rawUrl)+'" data-js-lightbox-width="'+__e(rawWidth)+'" data-js-lightbox-height="'+__e(rawWidth)+'" data-js-lightbox-lowres-url="'+__e(url)+'"> '),__p+=' <div class="thumbnail" data-js-thumbnail><img data-js-message-image src="'+__e(url)+'" width="'+__e(thumbnailWidth)+'"></div> ',_.isEmpty(rawUrl)||(__p+=" </a> "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(236),a=i(735),l=o.extend({className:"conversation-pill hide-pill",template:a,mixins:[r],events:{"click [data-js-unread-button]":"_onClick"},defaults:{count:0,maxCount:99},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus"))},afterRender:function(){this.listenTo(this,"change:count",this._onChangeCount),this._onChangeCount(this,this.get("count"))},setCount:function(e){this.set("count",s.isFinite(e)?e:0)},getCount:function(){return this.get("count")},getTitle:function(e){var t,i;return s.isFinite(e)?(t=this.get("maxCount"),i=e>t?t+"+":e,e>1?n("%1$s unread messages",i):n("%1$s unread message",i)):null},getTemplateData:function(){return{title:this.getTitle(this.get("count"))}},_onChangeCount:function(e,t){var i=this.getTitle(t);this.$el.toggleClass("hide-pill",0===t||s.isEmpty(i)),t>0&&this.js$("unread-button").text(i)},_onClick:function(e){e.preventDefault(),this.trigger("click")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<button tabindex="-1" data-js-theme-button data-js-unread-button class="unread-button">'+__e(title)+"</button>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="conversation-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div><div data-js-header></div><div data-subview="messagesView[]" class="message-list"></div><div data-subview="statusBannerView"></div><div data-subview="pillView"></div><div data-js-footer></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(137),o=i(185),r=i(688),a=i(738),l=i(739),c=o.extend({template:a,className:"chat-status-banner",subviews:{statusIndicator:{constructor:r,options:function(e){return{isOnline:e.get("seconds_since_last_activity")!==-1,canSeeUIFlag:n.bool("status_indicators_ui"),name:e.get("name")}}}},initialize:function(e){this.set("name",s.get(e,"name","")),this.listenTo(this,"setActiveTime",function(e){this.set("lastOnlineString",l(e)),this.render()})},render:function(){return this.get("lastOnlineString")?o.prototype.render.call(this):this}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<span class="status-text"><div data-subview="statusIndicator"></div>'+__e(lastOnlineString)+"</span>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";function s(e){return!(e===-1||e>o)&&(e>=r?n("Active in the last 4 hours"):e>=a?n("Active in the last 3 hours"):e>=l?n("Active in the last 2 hours"):e>=0&&n("Active in the last hour"))}var n=i(130),o=14400,r=10800,a=7200,l=3600;e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(741),r=n.extend({className:"conversation-message-error",template:o,defaults:{message:null,showErrorIconClass:"show-icon",showErrorIcon:!1,actionText:null},events:{"click [data-js-action]":"_onClickAction"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","actionCallback"))},getTemplateData:function(){return{message:this.get("message"),actionText:this.get("actionText")}},afterRender:function(){this.$el.toggleClass(this.get("showErrorIconClass"),this.get("showErrorIcon"))},_onClickAction:function(e){e.preventDefault(),s.isFunction(this.actionCallback)&&this.actionCallback()}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="message"> '+__e(message)+" ",_.isEmpty(actionText)||(__p+=' <span class="action-container"><a href="#" data-js-action class="action">'+__e(actionText)+"</a></span> "),__p+=" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(185),r=i(236),a=i(221),l=i(743),c=i(194),u=i(744),h=o.extend({className:"conversation-preview",template:l,mixins:[r],events:{"click [data-js-image-container]":"_onImageContainerClick","click [data-js-preview-remove]":"_onClickPreviewRemove"},defaults:{isVisible:!1,isEditable:!1,maxHeight:150,maxWidth:210,animateInDurationMs:300,animateOutDurationMs:200,animateInEasing:[.22,.685,.03,.895],animateOutEasing:[.895,.03,.685,.22]},afterRender:function(){this.listenTo(this,"change:isVisible",this._onChangeIsVisible),this.listenTo(this,"change:isEditable",this._onChangeIsEditable),this._onChangeIsVisible(this,this.get("isVisible")),this._onChangeIsEditable(this,this.get("isEditable"))},hasImage:function(){return!n.isEmpty(this.previewImageModel)},addImage:function(e){var t=e.get("height"),i=e.get("width"),s=this.get("maxHeight"),o=this.get("maxWidth"),r=a.maxSize(i,t,o,s),l=this.js$("image-container");return this.previewImageView&&this.previewImageView.remove(),this.previewImageView=new u({src:e.get("url"),width:n.get(r,"width"),height:n.get(r,"height")}),l.append(this.previewImageView.render().$el),this.set("isVisible",!0),this.set("isEditable",n.isFunction(e.get("editCallback"))),this.previewImageModel=e,this._slideElement(l)},_slideElement:function(e,t){var i=new s.Deferred,o=e.height(),r=e.offset().top-this.$el.offset().top,a=o+r;return c.animate(e,{translateY:t?[a,0]:[0,a]},{duration:t?this.get("animateOutDurationMs"):this.get("animateInDurationMs"),easing:t?this.get("animateOutEasing"):this.get("animateInEasing"),complete:n.bind(function(){i.resolve(),e.css("transform","")},this)}),i},getMessage:function(){return n.isEmpty(this.previewImageModel)?null:this.previewImageModel.get("message")},close:function(){return this.trigger("closing",this.previewImageModel),this._slideElement(this.js$("image-container"),!0).then(n.bind(this._onAfterCloseAnimation,this))},_onAfterCloseAnimation:function(){var e=this.previewImageModel;this.previewImageView.remove(),delete this.previewImageModel,delete this.previewImageView,this.set("isVisible",!1),this.trigger("close",e)},_onImageContainerClick:function(e){var t,i=this.previewImageModel;this.get("isEditable")&&!n.isEmpty(i)&&(t=i.get("editCallback"),n.isFunction(t)&&(e.preventDefault(),t(e),this.trigger("edit",i)))},_onClickPreviewRemove:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("dismiss",this.previewImageModel),this.close()},_onChangeIsVisible:function(e,t){this.$el.toggle(t)},_onChangeIsEditable:function(e,t){this.$el.toggleClass("editable",t)}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="conversation-preview-image-container" data-js-image-container><a href="#" class="conversation-preview-remove" data-js-preview-remove>'+__e(__("Remove"))+"</a></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(745),r=n.extend({className:"conversation-preview-image",template:o,defaults:{width:null,height:null,src:null,context:null,loggingData:null},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<img src="'+__e(src)+'" width="'+__e(width)+'" height="'+__e(height)+'" alt="'+__e(__("GIF"))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(194),o=i(130),r=i(236),a=i(191),l=i(185),c=i(747),u=i(704),h=i(748),d=l.extend({className:"conversation-compose",template:h,mixins:[r,a],events:{"click [data-js-submit-button]":"_onSubmitButtonClick","input [data-js-text-input]":"_onTextInputChange","keydown [data-js-text-input]":"_onTextInputKeydown","focus [data-js-text-input]":"_onTextInputFocus","blur [data-js-text-input]":"_onTextInputBlur","paste [data-js-text-input]":"_onTextInputPaste"},keycommands:{"keydown:escape":"_onKeyPressEscape"},defaults:{isValid:!0,isDisabled:!1,isOffline:!1,placeholder:null,offlinePlaceholder:null,currentPlaceholder:null,currentText:null,hasEditorFocus:!1,isAutoValidationEnabled:!0,buttonSubmittedClass:"submitted",hideComposePluginsClass:"hide-compose-plugins-container",hidingComposePluginsClass:"hiding-compose-plugins-container",isShufflePlaceholder:!0,isPluginsVisible:!0,composeAnimationSpeed:200,pluginAnimateInDurationMs:200,pluginAnimateOutDurationMs:300,pluginAnimateInEasing:[.895,.03,.685,.22],pluginAnimateOutEasing:[.22,.685,.03,.895],isLightboxOpen:!1},subviews:{composePluginsView:{constructor:c,options:function(e){return{pluginsArray:e.pluginsArray}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","keyboardManager","keyboardNamespace","pluginsArray","isGifSearchEnabled","isSendAPost")),this.getRandomPlaceholder=u([o("New message"),o("Your message here"),o("Write a message"),o("Say something"),o("Say your thing")]),s.isEmpty(this.pluginsArray)&&this.hideComposePluginsView(!0),this.set("isShufflePlaceholder",s.isEmpty(this.get("placeholder"))),s.isEmpty(this.get("placeholder"))&&this.set("placeholder",this.getRandomPlaceholder()),this.set("currentPlaceholder",this.get("placeholder")),s.isEmpty(this.get("offlinePlaceholder"))&&this.set("offlinePlaceholder",o("Currently offline")),this.keyboardManager&&this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this,"change:isValid",this._onChangeIsValid),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isOffline",this._onChangeIsOffline),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:currentText",this._onChangeCurrentText),this.listenTo(this,"change:hasEditorFocus",this._onChangeHasEditorFocus),this.listenTo(this,"change:isAutoValidationEnabled",this._onChangeIsAutoValidationEnabled),this.listenTo(this.composePluginsView,"plugin:preview:add:image",this._onComposePluginPreviewAddImage),this.listenTo(this.composePluginsView,"plugin:click",this._onComposePluginClick),this._onChangeIsValid(this,this.get("isValid")),this._onChangeIsDisabled(this,this.get("isDisabled")),this._onChangeIsOffline(this,this.get("isOffline")),this._onChangeCurrentPlaceholder(this,this.get("currentPlaceholder")),this._onChangeCurrentText(this,this.get("currentText")),this._setValidState(),s.defer(s.bind(function(){this._resizeInput()},this))},getTemplateData:function(){return{placeholder:this.get("placeholder"),isSendAPost:this.isSendAPost}},hideComposePluginsView:function(e){var t,i=this.get("hideComposePluginsClass"),o=this.get("hidingComposePluginsClass");if(this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!1),e)return void this.$el.addClass(i);this.$el.addClass(o),this._resizeInput(),t=this.composePluginsView.$el.outerWidth(),n.animate(this.$el,{marginLeft:[-t,0]},{duration:this.get("pluginAnimateOutDurationMs"),easing:this.get("pluginAnimateOutEasing"),complete:s.bind(function(){this._resizeInput(),this.$el.css("marginLeft","").addClass(i).removeClass(o)},this)})}},showComposePluginsView:function(e){var t,i=this.get("hideComposePluginsClass");if(!this.get("isPluginsVisible")){if(this.set("isPluginsVisible",!0),e)return void this.$el.removeClass(i);t=this.composePluginsView.$el.outerWidth(),this.$el.css("margin-left",-t).removeClass(i),this._resizeInput(),n.animate(this.$el,{marginLeft:[0,-t]},{duration:this.get("pluginAnimateInDurationMs"),easing:this.get("pluginAnimateInEasing"),complete:s.bind(function(){this._resizeInput(),this.$el.css("marginLeft","")},this)})}},toggle:function(e){this.$el.toggle(e),e&&this.$el.css("display","")},submit:function(e){var t=this.get("currentText");this.get("isValid")&&!this.get("isDisabled")&&(this.trigger("submit",t,e),this._startAnimation(s.bind(function(){this.trigger("submit:animated",t,e)},this)),this.clear())},escape:function(){this.get("isLightboxOpen")||(s.isEmpty(this.get("currentText"))?this.trigger("close"):this.clear())},clear:function(){this.js$("text-input").val(""),this.set("currentText",""),this.get("isShufflePlaceholder")&&this._setPlaceholderState(),this._resizeInput()},focus:function(){s.defer(s.bind(function(){this.rendered&&this.js$("text-input").focus()},this))},getMessage:function(){return this.js$("text-input").val()},setPlaceholder:function(e){this.set({placeholder:e,isShufflePlaceholder:!1}),this._setPlaceholderState()},beforeRemove:function(){this.keyboardManager&&this.keyboardManager.remove(this.keyboardNamespace)},toggleAutoValidation:function(e){this.set("isAutoValidationEnabled",e)},_onComposePluginPreviewAddImage:function(e){this.trigger("plugin:preview:add:image",e)},_onComposePluginClick:function(e){this.trigger("plugin:click",e)},_onKeyPressEscape:function(e){e.preventDefault(),this.escape()},_onTextInputChange:function(){var e=s.trim(this.js$("text-input").val());this._resizeInput(),this.set("currentText",e),this.trigger("input",e,this)},_setValidState:function(){return this.get("isAutoValidationEnabled")?void this.set("isValid",!s.isEmpty(this.get("currentText"))):void this.set("isValid",!0)},_resizeInput:function(){var e,t=this.js$("text-input"),i=t.get(0);this._originalInputHeight||(this._originalInputHeight=t.outerHeight()),this.$el.css("height",this.$el.height()),t.css("height","auto"),e=i.scrollHeight,Math.abs(e-this._originalInputHeight)<5&&(e=this._originalInputHeight),t.css("height",e),this.$el.css("height",""),this._detectResize()},_detectResize:function(){var e=this.$el.height();return this._previousHeight?void(e!==this._previousHeight&&(this.trigger("resize",e),this._previousHeight=e)):void(this._previousHeight=e)},_startAnimation:function(e){var t=this.js$("submit-button"),i=this.get("buttonSubmittedClass");return s.isEmpty(i)?void(s.isFunction(e)&&e.call(this)):(t.addClass(i),void s.delay(s.bind(function(){t.removeClass(i),s.isFunction(e)&&e.call(this)},this),this.get("composeAnimationSpeed")))},_setPlaceholderState:function(){this.set("currentPlaceholder",this.get("isShufflePlaceholder")?this.getRandomPlaceholder():this.get("placeholder"))},_onChangeCurrentText:function(e,t){this._setValidState()},_onChangeIsValid:function(e,t){this.js$("submit-button").prop("disabled",!t||this.get("isDisabled"))},_onSubmitButtonClick:function(e){e.preventDefault(),this.submit("button")},_onChangeIsDisabled:function(e,t){this.js$("text-input").prop("disabled",t),this.js$("submit-button").prop("disabled",t||!this.get("isValid")),this.composePluginsView.toggleDisabled(t)},_onChangeIsOffline:function(e,t){t?(this.set("previousPlaceholder",this.get("placeholder")),this.set("currentPlaceholder",this.get("offlinePlaceholder"))):this.set("currentPlaceholder",this.get("previousPlaceholder"))},_onChangeCurrentPlaceholder:function(e,t){this.js$("text-input").attr("placeholder",t)},_onTextInputFocus:function(){this.set("hasEditorFocus",!0),this.trigger("focus",this)},_onTextInputBlur:function(){this.set("hasEditorFocus",!1),this.trigger("blur",this)},_onTextInputPaste:function(e){var t,i,n=s.get(e,"originalEvent.clipboardData.items",[]),o=s.filter(n,{kind:"file"});this.get("isDisabled")||0!==o.length&&(t=s.last(o),t&&(i=s.result(t,"getAsFile"),this.trigger("pasteBlob",i)))},_onTextInputKeydown:function(e){13!==e.keyCode||e.shiftKey||(this.submit("keyboard"),
e.preventDefault())},_onChangeHasEditorFocus:function(e,t){this.keyboardManager&&this.keyboardManager.toggle(this.keyboardNamespace,e,t)},_onChangeIsAutoValidationEnabled:function(e,t){this._setValidState()}});e.exports=d},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.extend({className:"conversation-compose-plugins-container",mixins:[],renderWithTemplate:s.noop,defaults:{isDisabled:!1},initialize:function(e){e=s.extend({},e),s.extend(this,s.pick(e,"pluginsArray"))},afterRender:function(){this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),s.each(this.pluginsArray,s.bind(this._addPluginView,this)),this._onChangeIsDisabled(this,this.get("isDisabled"))},toggleDisabled:function(e){this.set("isDisabled",e)},_addPluginView:function(e){e.render(),this.$el.append(e.el),this.listenTo(e,"preview:add:image",this._onPluginViewPreviewAddImage),this.listenTo(e,"click",this._onPluginViewClick)},_onPluginViewPreviewAddImage:function(e){this.trigger("plugin:preview:add:image",e)},_onPluginViewClick:function(e){this.trigger("plugin:click",e)},_onChangeIsDisabled:function(e,t){s.each(this.pluginsArray,s.bind(function(e){e.toggleDisabled(t)}),this)}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+=isSendAPost?' <div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="compose-text-input-container"><div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ":' <div class="text-input-container"><textarea class="text-input" placeholder="'+__e(placeholder)+'" rows="1" maxlength="4096" data-js-text-input></textarea></div><div class="compose-text-input-container"><div data-subview="composePluginsView" class="compose-plugins-container"></div><div class="submit-button"><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">'+__e(__("Send"))+"</button></div></div> ";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(137),o=i(185),r=i(236),a=i(688),l=i(750),c=o.extend({className:"conversation-minimized",tagName:"a",attributes:{href:"#"},template:l,mixins:[r],events:{click:"_onClick"},defaults:{maxBadgeCount:99,activeBadgeClass:"tab-notice--active",newMessageClass:"new-message"},subviews:{statusIndicator:{constructor:a,options:function(e){return{isOnline:e.get("isOnline"),canSeeUIFlag:n.bool("status_indicators_ui"),name:e.participant.get("name")}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus")),this.participant=this.model.getOtherParticipant(),this.set({blogName:this.participant?this.participant.get("name"):null,avatarUrl:this.participant?this.participant.getAvatarUrl():null})},setIsOnline:function(e){this.set("isOnline",e),this.renderSubviews()},afterRenderSubviews:function(){this.listenTo(this.model,"change:unreadCount",this._onChangeUnreadCount),this.listenTo(this.model,"sync",this._onConversationSync),this.listenTo(this,"setIsOnline",this.setIsOnline),this.listenTo(this.participant,"change:seconds_since_last_activity",function(e,t){this.setIsOnline(t!==-1)})},updateBadge:function(e){var t=this.get("maxBadgeCount"),i=this.get("activeBadgeClass");e>0&&this.js$("badge-value").text(e>t?t+"+":e),this.js$("badge").toggleClass(i,e>0)},animate:function(){var e=this.get("newMessageClass");this.$el.addClass(e),s.delay(s.bind(function(){this.$el.removeClass(e)},this),250)},focus:function(){this.$el.focus()},blur:function(){this.$el.blur()},_onChangeUnreadCount:function(e,t){this.updateBadge(t),t>0&&this.animate()},_onConversationSync:function(e){this.renderWithTemplate(),this.renderSubviews()},_onClick:function(e){e.preventDefault(),this.blur(),this.trigger("click")}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="avatar"><img src="'+__e(avatarUrl)+'" title="'+__e(blogName)+'"></div><div data-subview="statusIndicator"></div><div class="conversation-minimized-badge tab_notice tab-notice--outlined" data-js-badge><span class="tab_notice_value" data-js-badge-value>2</span></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(185),r=i(236),a=i(752),l=o.extend({className:"conversation-error",mixins:[r],template:a,defaults:{message:null,isLoading:!1,showButton:!0,buttonText:null,buttonTextLoading:null,buttonTextCurrent:null},events:{"click [data-js-button]":"_onClickButton"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","buttonCallback")),s.isEmpty(this.get("message"))&&this.set("message",n("Something went screwy.")),s.isEmpty(this.get("buttonText"))&&this.set("buttonText",n("Retry")),s.isEmpty(this.get("buttonTextLoading"))&&this.set("buttonTextLoading",n("Retrying...")),s.isEmpty(this.get("buttonTextCurrent"))&&this.set("buttonTextCurrent",this.get("buttonText"))},afterRender:function(){this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:buttonTextCurrent",this._onChangeButtonTextCurrent),this.listenTo(this,"change:showButton",this._onChangeShowButton),this._onChangeIsLoading(this,this.get("isLoading")),this._onChangeShowButton(this,this.get("showButton"))},getTemplateData:function(){return{message:this.get("message"),buttonText:this.get("buttonTextCurrent")}},_onClickButton:function(e){e.preventDefault(),this.get("isLoading")||(this.set("isLoading",!0),this.trigger("buttonClick"),s.isFunction(this.buttonCallback)&&this.buttonCallback.call(this,this))},_onChangeIsLoading:function(e,t){var i=t?this.get("buttonTextLoading"):this.get("buttonText");this.set("buttonTextCurrent",i),this.js$("button").toggleClass("disabled",t).prop("disabled",t)},_onChangeButtonTextCurrent:function(e,t){this.js$("button").text(t)},_onChangeShowButton:function(e,t){this.js$("button").toggle(t)}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="content"><label>'+__e(message)+'</label><button data-js-theme-button data-js-button class="chrome">'+__e(buttonText)+"</button></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(242),a=i(754),l=o.extend({className:"popover--conversation-actions info_popover popover_gradient popover",mixins:[r],initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"viewOptions")),this.view=new a(this.viewOptions)},render:function(){return this.$wrapper=n("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$wrapper.html(this.view.render().$el),this},teardown:function(){return this.remove()},getView:function(){return this.view}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(755),a=o.extend({className:"conversation-actions",tagName:"ul",template:r,events:{"click [data-js-block-blogname]":"_onBlockClick","click [data-js-delete-conversation]":"_onDeleteConversationClick"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","user","participants")),this.blockableParticipants=this.participants.getWithout(this.user.channels.pluck("uuid"))},getTemplateData:function(){return{blockableParticipants:s.invoke(this.blockableParticipants,"toJSON")}},_onBlockClick:function(e){var t=n(e.currentTarget),i=t.attr("data-js-block-blogname");e.preventDefault(),s.isEmpty(i)||this.trigger("block",i)},_onDeleteConversationClick:function(e){e.preventDefault(),this.trigger("delete")}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<li><a class="external-link" href="/settings/dashboard">'+__e(__("Sound settings"))+'</a></li><li><a href="#" data-js-delete-conversation>'+__e(__("Delete conversation"))+"</a></li> ",_.each(blockableParticipants,function(e){__p+=' <li><a href="#" data-js-block-blogname="'+__e(e.name)+'">'+__e(__("Block %1$s",e.name))+"</a></li> "});return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(9),r=i(137),a=i(185),l=i(236),c=i(315),u=i(687),h=i(726),d=i(688),p=i(757),g=s.template('<a href="<%- blogUrl %>/tagged/<%- tag %>" data-js-tumblelog-name="<%- blogName %>" data-js-tumblelog-tag="<%- tag %>">'),_=a.extend({className:"conversation-icebreakers",template:p,mixins:[l],defaults:{isShowTags:!0,isShowRelationship:!0,isShowDescription:!0},subviews:{statusIndicator:{constructor:d,options:function(e){return{isOnline:e.participant.get("seconds_since_last_activity")!==-1,canSeeUIFlag:r.bool("status_indicators_ui"),name:e.participant.get("name")}}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"eventBus","participant"))},getTemplateData:function(){return{description:this.get("isShowDescription")?this._getCleanDescriptionString():null,relationship:this.get("isShowRelationship")?this._getRelationshipString():null,tagsMarkup:this.get("isShowTags")?this._getTagsDescriptionMarkup():null,name:this.participant.get("name"),avatarUrl:this.participant.getAvatarUrl(),url:this.participant.get("url")}},afterRender:function(){this.theme=new h({el:this.el,theme:this.participant.get("theme")}).render(),this.get("isShowDescription")&&s.defer(s.bind(function(){u(this.js$("description"))},this))},_getOpeningTagAnchor:function(e){var t=this.participant.get("name"),i=this.participant.get("url");return g({blogUrl:i,blogName:t,tag:e})},_getClosingTagAnchor:function(){return"</a>"},_getOpeningTagText:function(){return'<span class="text">'},_getClosingTagText:function(){return"</span>"},_getTagsDescriptionMarkup:function(){var e=this.participant.getBlogTags(),t=this._getOpeningTagText(),i=this._getClosingTagText(),o=this._getClosingTagAnchor();return e.length>1?n("%1$sPosts about%2$s %3$s#%4$s%5$s %6$sand%7$s %8$s#%9$s%10$s",t,i,this._getOpeningTagAnchor(e[0]),s.escape(e[0]),o,t,i,this._getOpeningTagAnchor(e[1]),s.escape(e[1]),o):1===e.length?n("%1$sPosts about%2$s %3$s#%4$s%5$s",t,i,this._getOpeningTagAnchor(e[0]),s.escape(e[0]),o):null},_getCleanDescriptionString:function(){return c.stripTags(this.participant.getDescription())},_getRelationshipString:function(){var e;if(this.participant.isMutuals()){if(e=this._getRelativeTimeString(this.participant.getDurationMutualsSeconds()),!s.isEmpty(e))return n("Mutuals for %1$s",e)}else if(this.participant.isFollowingYou()){if(e=this._getRelativeTimeString(this.participant.getDurationFollowingYouSeconds()),!s.isEmpty(e))return n("Followed you %1$s ago",e)}else if(this.participant.isFollowing()&&(e=this._getRelativeTimeString(this.participant.getDurationFollowingSeconds()),!s.isEmpty(e)))return n("Following for %1$s",e);return n("Not following each other")},_getRelativeTimeString:function(e){return s.isNumber(e)?o(Date.now()-1e3*e).fromNow(!0):null}});e.exports=_},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<a class="avatar" href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'" data-js-theme-avatar-shape-class><img src="'+__e(avatarUrl)+'"><div data-subview="statusIndicator"></div></a><div class="name"><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'">'+__e(name)+"</a></div> ",_.isEmpty(description)||(__p+=' <div class="description" data-js-description><a href="'+__e(url)+'" target="_blank" data-js-tumblelog-name="'+__e(name)+'"> '+__e(description)+" </a></div> "),__p+=" ",_.isEmpty(relationship)||(__p+=' <div class="relationship">'+__e(relationship)+"</div> "),__p+=" ",_.isEmpty(tagsMarkup)||(__p+=' <div class="tags">'+(null==(__t=tagsMarkup)?"":__t)+"</div> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(403),r=i(759),a=i(761),l=i(661),c=i(762),u=r.extend({className:"conversation-compose-plugin conversation-compose-plugin--gif-search",template:c,defaults:n.defaults({selectedGif:null,query:"",resultLimit:200,resultImageWidth:250},r.prototype.defaults),events:{click:"_onClick"},initialize:function(e){e=n.extend({},e),n.extend(this,n.pick(e,"collection")),this.popoverOptions={collection:this.collection,query:this.get("query"),resultLimit:this.get("resultLimit"),imageWidth:this.get("resultImageWidth"),loggingContext:this.getName(),loadFullImageBeforeSelect:!1,autoTeardown:!0,teardownOnEscape:!0,pinnedTarget:this.$el,pinnedSide:"top",isFixedPosition:!0}},getName:function(){return"messaging-gif"},onEdit:function(e,t,i){var n,o,r;this.$el.is(":visible")||(o=s(i.currentTarget),r=o.height(),n={pinnedTarget:o,shift:{x:0,y:Math.ceil(r*-.8)}}),this._openGifSearchPopover(e,t,n)},_onClick:function(e){e.preventDefault(),this._openGifSearchPopover(this.get("query")),this.trigger("click",this)},_openGifSearchPopover:function(e,t,i){var s;this.gifSearchPopover&&this._closePopover(),s=n.extend({},this.popoverOptions,i,{query:e,selectedImageUrl:t}),this.gifSearchPopover=new o(s),this.gifSearchPopover.render(),this.toggleActive(!0),this.listenToOnce(this.gifSearchPopover,"close",this._onGifSearchPopoverClose),this.listenToOnce(this.gifSearchPopover,"selectImage",this._onGifSearchPopoverSelectImage),this.listenTo(this.collection,"search",function(e){this.set("query",e)})},_closePopover:function(){this.stopListening(this.gifSearchPopover),this.stopListening(this.collection),this.gifSearchPopover.teardown(),this.toggleActive(!1)},_onGifSearchPopoverSelectImage:function(e){var t,i,s,o,r,c,u,h=n.get(e,"postId"),d=n.get(e,"postBlogUuid"),p=this.get("resultImageWidth"),g=this.getName();n.isEmpty(h)||n.isEmpty(d)||(s=n.get(e,"mediaUrl",""),r=n.get(e,"width"),c=n.get(e,"height"),u=this.get("query"),o=s.replace(/_\d+\./,"_"+p+"."),t=l.createImagePostMessage(h,d,o,r,c,{context:g,loggingData:{query:u}}),i=new a({url:o,width:r,height:c,message:t,context:g,editCallback:n.bind(n.partial(this.onEdit,u,s),this),loggingData:{query:u,postId:h,postBlogUuid:d}}),this.addToImagePreview(i),this._closePopover())},_onGifSearchPopoverClose:function(){this._closePopover()}});e.exports=u},function(e,t,i){"use strict";var s=i(760),n=s.extend({tagName:"button",attributes:{"data-js-theme-accent-color-on-white":!0},afterRender:function(){this.listenTo(this,"change:isActive",this._onChangeIsActive),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this._onChangeIsActive(this,this.get("isActive")),this._onChangeIsDisabled(this,this.get("isDisabled"))},_onChangeIsActive:function(e,t){this.$el.toggleClass("active",t)},_onChangeIsDisabled:function(e,t){this.$el.prop("disabled",t)}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.extend({defaults:{isDisabled:!1,isActive:!1},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},getName:function(){return null},addToImagePreview:function(e){this.trigger("preview:add:image",e)},toggleActive:function(e){this.set("isActive",e)},toggleDisabled:function(e){this.set("isDisabled",e)}});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{message:null,url:null,width:null,height:null,editCallback:null}});e.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add GIF"));return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(8),r=i(236),a=i(172),l=i(759),c=i(761),u=i(661),h=i(764),d=i(765),p=l.extend({className:"conversation-compose-plugin conversation-compose-plugin--image-upload",template:d,mixins:[r],defaults:s.defaults({isFilePickerOpen:!1},l.prototype.defaults),events:{click:"_onClick",focus:"_onFocus","change [data-js-file-picker]":"_onFilePickerChange","click [data-js-file-picker]":"_onFilePickerClick"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,"imageUploadMaxBytes"))},getName:function(){return"messaging-image-upload"},afterRender:function(){this.listenTo(this,"change:isFilePickerOpen",this._onChangeIsFilePickerOpen),l.prototype.afterRender.apply(this,arguments)},addImageFile:function(e,t){var i=void 0,o=void 0,r=Math.floor(this.get("imageUploadMaxBytes")/1048576);this.messagingImageUploader=new h({file:e,imageUploadMaxBytes:this.get("imageUploadMaxBytes")}),this.messagingImageUploader.uploadImage().then(s.bind(function(n){var r=s.get(n,"src"),a=s.get(n,"width"),l=s.get(n,"height");o=u.createImageMessage(r,e,a,l,{context:this.getName(),loggingData:{imageSource:t}}),i=new c({url:r,file:e,width:a,height:l,message:o,context:this.getName(),editCallback:s.bind(this.onEdit,this),loggingData:{imageSource:t}}),this.addToImagePreview(i)},this),function(e){var t=s.get(e,"type");if(t)switch(t){case"format":a.alert(n("Invalid file type."));break;case"size":a.alert(n("Image must be smaller than %1$sMB",r))}else a.alert(n("Something about that file is off. Try sending something else."))})},_openFilePicker:function(){this.$el.focus(),this.set("isFilePickerOpen",!0),this.js$("file-picker").click()},onEdit:function(){this._openFilePicker()},_onFilePickerChange:function(e){var t=s.first(o(e.target).prop("files"));this.set("isFilePickerOpen",!1),this.js$("file-picker").val(""),this.addImageFile(t,"filesystem")},_onFilePickerClick:function(e){e.stopPropagation()},_onClick:function(e){this._openFilePicker(),this.trigger("click",this)},_onFocus:function(){this.set("isFilePickerOpen",!1)},_onChangeIsFilePickerOpen:function(e,t){this.toggleActive(t)}});e.exports=p},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(173),r=i(218),a=i(219),l=o.extend({name:"MessagingImageUploader",defaults:{imageUploadMaxBytes:null,file:null},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},uploadImage:function(){var e=new n.Deferred,t=this.get("imageUploadMaxBytes"),i=this.get("file"),o=function(){e.resolve.apply(this,arguments)},l=function(){e.reject.apply(this,arguments)};return i?s.get(i,"type","").match(/image\/(jpg|jpeg|png|gif)/i)?s.get(i,"size")>t?e.reject({type:"size"}):(a.read(i).then(function(e){r.load(e.objectUrl||e.base64).then(o,l)}),e):e.reject({type:"format"}):e.reject()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add Photo"))+' <input type="file" class="input-file-picker" data-js-file-picker name="messaging-photo" accept="image/*" tabindex="-1">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(236),o=i(761),r=i(661),a=i(759),l=i(767),c=i(777),u=a.extend({className:"conversation-compose-plugin conversation-compose-plugin--stickers",template:c,mixins:[n],defaults:s.defaults({},a.prototype.defaults),events:{click:"_onClick"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e)),this.popoverOptions={autoTeardown:!0,teardownOnEscape:!0,pinnedTarget:this.$el,pinnedSide:"top",isFixedPosition:!0}},getName:function(){return"messaging-stickers"},onEdit:function(){this._openStickersPopover()},_openStickersPopover:function(){this.stickersPopover&&this._closePopover(),this.stickersPopover=new l(this.popoverOptions),this.stickersPopover.render(),this.toggleActive(!0),this.listenToOnce(this.stickersPopover,"close",this._onCloseStickersPopover),this.listenToOnce(this.stickersPopover,"stickers:select:sticker",this._onSelectStickersPopover)},_onClick:function(e){e.preventDefault(),this._openStickersPopover(),this.trigger("click",this)},_closePopover:function(){this.stopListening(this.stickersPopover),this.stickersPopover.teardown(),this.toggleActive(!1)},_onCloseStickersPopover:function(){this._closePopover()},_onSelectStickersPopover:function(e,t){var i=void 0,n=void 0,a=e.toJSON(),l=a.id,c=a.sticker_pack_id,u=a.url,h=a.original_size_url,d=250,p={stickerId:l,stickerPackId:c};i=r.createStickerMessage(l,u,h,{context:this.getName(),loggingData:p}),n=new o({url:u,width:d,height:d,message:i,context:this.getName(),editCallback:s.bind(this.onEdit,this),loggingData:p}),this.addToImagePreview(n),this._closePopover()}});e.exports=u},function(e,t,i){"use strict";var s=i(185),n=i(242),o=i(768),r=s.extend({className:"popover--stickers",mixins:[n],initialize:function(e){this.stickers=new o,this.listenTo(this.stickers,"all",this.trigger)},render:function(){this.stickers.render().$el.appendTo(this.$el)},teardown:function(){return this.$el.remove(),this}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(173),r=i(769),a=i(770),l=i(771),c=function(){};c.extend=n.Model.extend,s.extend(c.prototype,n.Events);var u=new c,h=o.extend({name:"Stickers",defaults:{selectedStickerPack:null},initialize:function(e){e=s.extend({},e);var t=s.get(this.data,"stickers",[]);this.stickers=new r(this._createStickerModels(t)),this.eventBus=u;var i=s.extend({eventBus:this.eventBus,stickers:this.stickers},e);this.view=new l(i),this.listenTo(this.eventBus,"select:sticker",this._onSelectSticker)},render:function(){return this.view.render(),this.trigger("append"),this.view},_onSelectSticker:function(e,t){this.trigger("stickers:select:sticker",e,t)},_createStickerModels:function(e){return s.map(e,function(e){return new a({description:e.description,id:e.id,media_key:e.media_key,sticker_pack_id:e.sticker_pack_id,url:e.url,original_size_url:e.original_size_url})})}});e.exports=h},function(e,t,i){"use strict";var s=i(148),n=i(770),o=s.extend({model:n});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{description:null,id:null,media_key:null,sticker_pack_id:null,url:null,original_size_url:null}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(772),r=i(776),a=n.extend({className:"messaging-stickers-container",template:r,subviews:{stickerResultsView:{constructor:o,options:function(e){return{eventBus:e.eventBus,collection:e.stickers}}}},initialize:function(e){e=s.extend({},e),s.extend(this,s.pick(e,"eventBus","stickers"))}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(684),r=i(236),a=i(427),l=i(773),c=i(775),u=n.extend({className:"messaging-stickers-results",mixins:[r,o],template:c,subviews:{stickerResultView:{constructor:l,options:function(e){return{eventBus:e.eventBus}},collection:function(e){return e.collection}}},initialize:function(e){e=s.extend({},e),s.extend(this,s.pick(e,"eventBus","collection"))},afterRenderSubviews:function(){this.scrollbar=new a(this.$el.first()),this.updateScrollbar()},beforeRemove:function(){this.scrollbar&&this.scrollbar.destroy()},updateScrollbar:function(){this.rendered&&this.scrollbar&&s.defer(s.bind(this.scrollbar.update,this.scrollbar))}});e.exports=u},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(774),a=n.extend({className:"messaging-stickers-result",mixins:[o],template:r,events:{click:"_onClick"},initialize:function(e){e=s.extend({},e),s.extend(this,s.pick(e,"eventBus"))},getTemplateData:function(){var e=this.model.toJSON();return{stickerId:e.id,src:e.url}},_onClick:function(e){e.preventDefault(),this.eventBus.trigger("select:sticker",this.model,this)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-js-sticker-result data-sticker-id="'+__e(stickerId)+'"><a href="#"><img src="'+__e(src)+'" width="100px"></a></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="messaging-stickers-results-wrapper" data-subview="stickerResultView[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="stickerResultsView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(__("Add Sticker"));return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="messaging-conversation messaging-conversation--open" data-js-theme-background-tint data-js-conversation-open data-js-theme-accent-color-on-white><div data-subview="headerView"></div><div class="conversation-main" data-js-theme-background-color data-js-main><div data-subview="messagesView"></div><div data-subview="conversationLoaderView"></div></div><div data-subview="previewView"></div><div data-subview="composeView"></div></div><div class="messaging-conversation messaging-conversation--minimized" data-js-conversation-minimized data-js-theme-accent-color-on-white data-js-theme-avatar-shape-class><div data-subview="minimizedView"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{channel:null},getChannel:function(){return this.get("channel")},setChannel:function(e){return this.set("channel",e)},getId:function(){return this.get("channel").get("uuid")},getPrevChannel:function(){return this.previous("channel")},getPrevProperty:function(e){var t=this.getPrevChannel();return t?t.get(e):null},getPrevId:function(){return this.getPrevProperty("uuid")}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(671),r=i(661),a=n.extend({url:"/svc/conversations",mixins:[o],model:r,comparator:function(e){return-e.get("last_modified_ts")},_getRoot:function(e){return s.has(e,"response")?s.get(e,"response"):e},parse:function(e,t){return s.get(this._getRoot(e),"conversations")||[]},parsePreviousLink:function(e,t){return s.get(this._getRoot(e),"_links.previous")},parseNextLink:function(e,t){return s.get(this._getRoot(e),"_links.next")},fetchInbox:function(e,t){t=t||{};var i=s.extend({},t.data,{participant:e});return s.extend(t,{cache:!1,remove:!1,skipParseLinks:0!==this.length,data:i,isFetchInbox:!0}),this.fetch(t)},getUnreadCount:function(){return s.reduce(this.models,function(e,t){return t.isUnread()?e+1:e},0)}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(148),o=i(782),r=n.extend({model:o,getSortedModels:function(e){return this.sortBy(function(t){return t.get("uuid")===e?-1:0})},getSortedIds:function(e){var t=this.getSortedModels(e);return s.pluck(s.invoke(t,"toJSON"),"uuid")}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(143),o=i(662),r=i(780),a=i(149),l=n.extend({idAttribute:"uuid",mixins:[o],relations:{conversations:r},defaults:{conversations:null,unread_messages_count_sum:0}});s.defaults(l.prototype,a.prototype),e.exports=l},function(e,t,i){"use strict";var s,n=i(8),o=i(173),r=i(784),a=i(785),l=o.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){n(".l-footer").length&&(this.footerView=new r({el:".l-footer"})),n(".sidebar_nav").length&&(this.sidebarFooterView=new a({el:".pinned_sidebar_footer"}))}});e.exports=function(){return s||(s=new l),s}},function(e,t,i){"use strict";var s=i(185),n=s.extend({});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(139),r=i(179).transition,a=n.extend({defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(o,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility),this.$nav=this.$el.find(".sidebar_nav")},onScroll:function(e){e&&(e.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0))},toggleVisibility:function(e,t){t===!0?(this.showElement(),s.defer(s.bind(function(){this.$nav.toggleClass("visible",t)},this))):(r(this.$nav,s.bind(function(){this.hideElement()},this)),this.$nav.toggleClass("visible",t)),o.trigger("toastr:canDisplayToggle",t)},hideElement:function(){this.$el.css("display","none")},showElement:function(){this.$el.css("display","block")}});e.exports=a},function(e,t,i){"use strict";var s=i(8),n=i(173),o=i(139),r=i(550),a=n.extend({name:"SponsoredPosts",initialize:function(){if(this.isScrollEnabled=!1,this.transform=r.get("transform"),this.transform){this.rings=s(),this.ctas=s();var e=s.proxy(this.checkForRingsAndCTAs,this);o.on("AutoPaginator:after",e),o.on("sponsoredPosts:checkRings",e),this.checkForRingsAndCTAs()}},checkForRingsAndCTAs:function(){this.rings=this.rings.add(".sponsored_badge_icon .ring, .recommendation-reason-footer .icon_explore"),this.ctas=this.ctas.add(".tsp-cta-animated").map(function(){var e=s(this);this.$el=e,this.elHeight=e.height(),this.elBottom=e.offset().top+e.height(),this.$aCTA=e.find("a.cta"),this.$aCTA.css("color","#ffffff"),this.$overlay=e.find(".tsp-opacity-overlay");var t=/([\d]+)[^\d]+([\d]+)[^\d]+([\d]+).+/.exec(this.$overlay.css("border-top-color")),i=t[1],n=t[2],o=t[3];return this.overlayColor=i+", "+n+", "+o,this.$aCTA.addClass("cta-color-applied"),this}),!this.isScrollEnabled&&(this.rings.length>0||this.ctas.length>0)&&(this.isScrollEnabled=!0,o.on("DOMEventor:flatscroll",this.onWindowScroll,this))},onWindowScroll:function(e){var t=e.windowScrollTop,i=void 0,s=void 0;for(i=0,s=this.rings.length;i<s;i++)this.rings[i].style[this.transform]="rotate("+t+"deg)";for(i=0,s=this.ctas.length;i<s;i++)this._setCtaVisual(e,this.ctas[i]);
},_setCtaVisual:function(e,t){var i=200,s=e.windowHeight-(t.elBottom-e.windowScrollTop),n=void 0;s<t.elHeight?n=1:s>=0&&s<=i?n=1-s/i:(n=0,this.ctas=this.ctas.not(t),t.$el.removeClass("tsp-cta-animated"));var o=2*(n-.5),r="rgba("+t.overlayColor+", "+o+")";t.$overlay.css({opacity:n,"border-color":r});var a=n<.5?"#FFFFFF":"";t.$aCTA.css("color",a)}});e.exports=a},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(139),r=i(173),a=i(788),l=i(791),c=i(129),u=r.extend({name:"peepr",params:"",selector:"body",initialize:function(){var e=c.get("Components/Peepr")||{};this.params=e,e.blog_name&&(this.listenToOnce(o,"peepr:close",this.onPeeprClose),s(document).ready(n.bind(this.onPeeprRequestWithParams,this))),this.$container=s(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(o,"peepr-open-request",this.onPeeprRequest),this.$container.on("click","[data-peepr]",n.bind(this.onPeeprTargetClicked,this))},onPeeprTargetClicked:function(e){if(!e.ctrlKey&&!e.metaKey){e.preventDefault();var t=s(e.currentTarget),i=t.data("peepr");if(i){var n=i.tumblelog,r=i.postId,a=i.searchTagTerm,l=i.replyNoteToTumblelogName;o.trigger("peepr-open-request",{tumblelog_name:n,post_id:r,searchTagTerm:a,reply_note_to_tumblelog_name:l})}else window.open(t.attr("href"))}},onPeeprClose:function(){window.Backbone.history.navigate("/dashboard")},onPeeprRequestWithParams:function(){o.trigger("peepr-open-request",{tumblelog_name:this.params.blog_name,post_id:this.params.post_id,reply_note_to_tumblelog:this.params.replyNoteToTumblelogName})},onPeeprRequest:function(e){e.tumblelog_name&&(e.editing_appearance="undefined"!=typeof e.editing_appearance&&e.editing_appearance,this.open(e))},open:function(e){e.className="peepr-drawer",a().canOpen()&&a().open(l,e,"peepr-drawer-container")}});e.exports=u},function(e,t,i){"use strict";var s,n=i(8),o=i(3),r=i(130),a=i(173),l=i(139),c=i(191),u=i(172),h=i(789),d=a.extend({name:"drawer",selector:"body",mixins:[c],defaults:{suspended:!1,needsCloseConfirmation:!1},keycommands:{"keydown:escape":"initiateClose"},initialize:function(){this.$glass=null,this.$container=n(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(l,"post:form:show",this.suspend),this.listenTo(l,"post:form:hide",this.resume),this.listenTo(l,"drawer:suspend",this.suspend),this.listenTo(l,"drawer:resume",this.resume),this.listenTo(l,"drawer:enableCloseConfirmation",this.enableCloseConfirmation),this.listenTo(l,"drawer:disableCloseConfirmation",this.disableCloseConfirmation),this.listenTo(l,"drawer:hideGlass",this.hideGlass),this.listenTo(l,"indashblog:post:photo_lightbox",this.disableKeys),this.listenTo(l,"tumblr_lightbox:form:hide",this.enableKeys),this.$container.on("click.drawerOpen keyup","[data-drawer-open]",o.bind(this.onClickOpen,this))},suspend:function(){this.set("suspended",!0)},resume:function(){this.set("suspended",!1)},enableCloseConfirmation:function(){this.set("needsCloseConfirmation",!0)},disableCloseConfirmation:function(){this.set("needsCloseConfirmation",!1)},canOpen:function(){return!this.get("suspended")&&!this.view},isSuspended:function(){return this.get("suspended")},isOpen:function(){return!!this.view},toggle:function(e,t){this.canOpen?this.open(e,t):this.close()},open:function(e,t,i,s){this.containerDrawerName=s,this.view=new h({subviews:{"drawer-content":{constructor:e,options:t||{}}}}),this.view.$el.addClass(i),this._toggleContainerDrawerClass(s,!0),this.showGlass(),l.trigger("keycommands:suspend"),this.append(),this.trigger("open"),l.trigger("drawer:open")},replace:function(e,t,i,s){this.view?(this._toggleContainerDrawerClass(this.containerDrawerName,!1),this._toggleContainerDrawerClass(s,!0),this.view.animateRemove(),this.view=null,this.containerDrawerName=s,o.delay(o.bind(function(){this.view=new h({subviews:{"drawer-content":{constructor:e,options:t||{}}}}),this.view.$el.addClass(i),this.append()},this),400)):this.open(e,t,i)},onClickOpen:function(e){if("keyup"!==o.get(e,"type")||13===o.get(e,"keyCode")){e.preventDefault();var t=n(e.currentTarget).attr("data-drawer-open");this.trigger("open:"+t),l.trigger("drawer:open:"+t)}},initiateClose:function(){this.view&&!this.get("suspended")&&(this.get("needsCloseConfirmation")===!0?u.confirm(r("Close without sending?"),o.bind(this.close,this),this.noop,r("OK"),r("Cancel")):this.close())},close:function(){this.view&&(this._toggleContainerDrawerClass(this.containerDrawerName,!1),this.view.animateRemove(),this.view=null,this.containerDrawerName=null,this.hideGlass(),l.trigger("keycommands:resume"),this.trigger("close"),l.trigger("drawer:close"))},remove:function(){return this.close(),this},showGlass:function(){this.$glass=n("<div>",{class:"ui_peepr_glass"}).appendTo(this.$container);var e=o.bind(function(){this.$container.addClass("peepr")},this);this.animationDelay=o.delay(e,50),this.$glass.on("click",o.bind(this.initiateClose,this))},hideGlass:function(){var e=this.$glass;this.$glass=null,this.$container.removeClass("peepr"),this.animationDelay&&clearTimeout(this.animationDelay),o.delay(function(){e.remove()},150)},_getContainerClassNameForDrawerName:function(e){return o.isEmpty(e)?null:"peepr--"+e},_toggleContainerDrawerClass:function(e,t){var i=this._getContainerClassNameForDrawerName(e);o.isEmpty(this.$container)||o.isEmpty(i)||this.$container.toggleClass(i,t)}});e.exports=function(){return s||(s=new d),s}},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(139),r=i(185),a=i(790),l=r.extend({template:a,className:"drawer",defaults:{visible:!1},initialize:function(e){e.subviews&&(this.$body=s("body"),this.bindEvents())},bindEvents:function(){this.listenTo(o,"DOMEventor:keydown:tab",this.disableKey)},afterRender:function(){this.show()},disableKey:function(e){var t=s(e.target).is("input");t||e.preventDefault()},show:function(){this.get("visible")||(this.set("visible",!0),this.toggleAnimation("open",!0))},hide:function(e){this.get("visible")?(this.set("visible",!1),this.toggleAnimation("open",!1),n.delay(e,500)):e()},toggleAnimation:function(e,t){var i=n.bind(function(){this.$el.toggleClass(e,t)},this);window.requestAnimationFrame?window.requestAnimationFrame(i):n.defer(i)},animateRemove:function(){return this.hide(n.bind(function(){this.remove()},this)),this}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+=null==(__t=_subview("drawer-content"))?"":__t;return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(139),r=i(185),a=i(137),l=i(792),c=i(793),u=i(794),h=i(795),d=i(798),p=i(799),g=i(801),_=i(803),f=i(805),m=i(806),v=i(149),b=i(807),y=i(140),w=i(1032),k=r.extend({template:u,subviews:{posts:{constructor:h},emptyStateMessage:{constructor:p},header:{constructor:d},bigLoader:{constructor:f},timeline:{constructor:b},survey:{constructor:g},overlay:{constructor:w}},initialize:function(e){this.$body=n("body"),this.options=e,this.loadCount=0,this.user=y(),this.set("isSafeModeEnabled",a.bool("safe_mode")&&this.user.get("safe_mode")),this.set("oneTruePost",a.bool("one_true_post_on_peepr")),this.get("isSafeModeEnabled")&&(this.set("shouldBypassSafeMode",s.get(this.options,"should_bypass_safemode",!1)),this.set("canModifySafeMode",s.get(this.options,"can_modify_safe_mode",!1))),this.setCollection(),this.postKeycommandsView=new m({el:this.$el}),this.bindEvents(),this.fetchPostsAndOrBlog(),o.trigger("peepr:open",{tumblelog_name:this.options.tumblelog_name,post_id:this.options.post_id,loggingData:{tumblelog_name:this.options.tumblelog_name,post_id:this.options.post_id}}),l.setup()},setupSubviews:function(){if(this.get("isSafeModeEnabled")&&this.get("isAdult")&&!this.get("shouldBypassSafeMode")){this.$el.addClass("overlay-container"),this.posts.remove();var e={blogName:this.options.tumblelog_name};o.trigger("safeMode:SafeModeBlogPageShown",{loggingData:e})}else this.get("isSafeModeEnabled")&&this.overlay&&this.overlay.remove()},fetchPostsAndOrBlog:function(){var e=this;this.get("oneTruePost")?(this.collection.fetchBlog(),this.listenToOnce(o,"peepr:timeline:posts-fetched",function(){e.collection.trigger("peepr:postsAndBlogFetch")})):this.collection.fetchPostsAndBlog()},setCollection:function(){var e=this;this.collection&&this.collection.stopListening();var t=new v({name:this.options.tumblelog_name});this.set("shouldBypassSafeMode",s.get(this.options,"should_bypass_safemode",!1)),this.set("canModifySafeMode",s.get(this.options,"can_modify_safe_mode",!1)),this.collection=new _([],{blogNameOrId:this.options.tumblelog_name,tumblelogData:t.toJSON(),postId:this.options.post_id,shouldBypassSafeMode:this.get("shouldBypassSafeMode"),canModifySafeMode:this.get("canModifySafeMode")}),this.listenTo(this.collection.tumblelog,"change:global_theme_params",this.setBkgColor),this.listenTo(this.collection,"error",this.onSyncError),this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.onFirstSync),this.listenTo(this.collection,"emptyState",function(t){e.emptyStateMessage.setNewMessage(t)}),s.each(this.subviews,function(e){e.options=s.defaults({collection:this.collection,editing_appearance:this.options.editing_appearance,searchTagTerm:this.options.searchTagTerm||""},e.options||{})},this)},bindEvents:function(){this.$el.scroll(this.onBodyScroll),this.listenTo(o,"peepr-open-request",this.onPeeprOpenRequest),this.listenTo(o,"peepr:like_update",this.onPostLike),this.listenTo(o,"peepr:follow_update",this.onHeaderFollow),this.listenTo(o,"indashblog:post:reblog",this.onLegacyReblog),this.listenTo(o,"indashblog:search:start indashblog:search:clear",this.scrollToPosts)},afterRender:function(){this.autoPager&&(this.autoPager.close(),this.autoPager=null),document.activeElement.blur(),this.get("oneTruePost")||this.get("shouldBypassSafeMode")||(this.autoPager=new c({$target:this.$(".peepr-body")}),this.listenTo(this.autoPager,"trigger",s.throttle(this.onAutopagerTrigger,500,{trailing:!1}))),this.get("shouldBypassSafeMode")&&o.trigger("safeMode:NsfwPostPreview")},onAutopagerTrigger:function(){this.collection.fetchMore(),this.log("paginate",{postCount:this.collection.length})},onBodyScroll:function(e){var t={windowScrollTop:n(e.currentTarget).scrollTop()};window.requestAnimationFrame?requestAnimationFrame(function(){o.trigger("peepr-body-scroll",t)}):o.trigger("peepr-body-scroll",t)},onLegacyReblog:function(e){var t="POST_CONTEXT_PEEPR";e.reblog_key||(e.reblog_key=this.collection.get(e.id).get("reblog_key")),o.trigger("postForms:reblog",{reblogSource:t,reblogId:e.id,reblogKey:e.reblog_key,pt:e.pt}),this.listenToOnce(o,"postForms:saved",this.onPostFormReblogSuccess),this.log("peepr_reblog",{postId:e.id})},onPostFormReblogSuccess:function(e,t){this.log("peepr_reblog_success",{postId:t.responseJSON.post.id})},onPostLike:function(e,t){this.log("peepr_like_update",{postId:t.id,liked:t.liked})},onHeaderFollow:function(e){this.log("peepr_follow",{following:e})},onFirstSync:function(){this.rendered&&(this.set("isAdult",this.collection.tumblelog.get("nsfw")),this.setupSubviews(),this.setBkgColor(),this.bigLoader.hide(),this.$(".indash_blog").addClass("intro"),s.delay(s.bind(function(){this.rendered&&this.$(".indash_blog").removeClass("intro"),this.options.reply_note_to_tumblelog_name&&o.trigger("drawer:notes:open",this.options.reply_note_to_tumblelog_name)},this),1e3),this.log(this.loadCount?"reload":"load"),this.loadCount++)},onPeeprOpenRequest:function(e){e.tumblelog_name&&(this.options=e,this.setCollection(),this.reload())},reload:function(){this.autoPager&&this.stopListening(this.autoPager),this.removeSubviews(),this.render(),this.fetchPostsAndOrBlog()},setBkgColor:function(){var e=this.collection.tumblelog.get("global_theme_params")||{};s.has(e,"background_color")&&this.$(".peepr-body").css("background-color",e.background_color)},scrollToPosts:function(){this.headerScrollHeight=this.headerScrollHeight||this.$(".header_image_wrapper").height()-this.$(".navigation").height(),this.$el.scrollTop(this.headerScrollHeight)},onSyncError:function(){this.log("ajax-error",{offset:this.collection.length,path:window.location.href})},log:function(e,t){var i=s.defaults({blogname:this.options.tumblelog_name,postId:this.options.postId,loadCount:this.loadCount},t||{});o.trigger("peepr:log:"+e,{loggingData:{payload:i}})},remove:function(){this.log("close"),this.collection.stopListening(),this.postKeycommandsView&&this.postKeycommandsView.remove(),o.trigger("peepr:close",this.options.tumblelog_name,this.options.post_id),r.prototype.remove.call(this)}});e.exports=k},function(e,t,i){"use strict";var s,n=i(8),o=i(3),r=i(139),a=i(173),l=a.extend({name:"TrackingPixels",initialize:function(){this.listenTo(r,"component:TrackingPixels",this.initPixels)},initPixels:function(e){e.init&&o.each(e.init,function(e){e.script&&n("body").append(e.script)})}});e.exports={setup:function(){return s||(s=new l),s}}},function(e,t,i){"use strict";var s=i(139),n=i(3),o=i(7),r=i(174),a=i(138),l=r.extend({defaults:{offset:175,throttle:200,lockStep:!1,triggerCachingDelta:-1},constructor:function(e){this.options=n.extend({},this.defaults,e),this.handler=n.bind(this.options.$target?this.onTargetScroll:this.onWindowScroll,this),this.options.throttle&&(this.handler=n.throttle(this.handler,this.options.throttle)),this.locked=!1,this.bindEvents()},forceCheck:function(e){this.options.$target?this.handler(null,e):this.handler(a.rect(),e)},bindEvents:function(){this.options.$target?this.options.$target.parent().on("scroll",this.handler):(this.listenTo(s,"DOMEventor:flatscroll",this.handler),this.listenTo(s,"DOMEventor:flatresize",this.handler))},unlock:function(){this.locked=!1},onWindowScroll:function(e,t){if(!this.locked&&(this.buffer||(this.buffer=this.getBuffer(e)),this.nearBottom(e))){var i=n.clone(e);if(!t&&this.options.triggerCachingDelta!==-1&&this.triggerCache){var s=Math.abs(e.windowScrollTop-this.triggerCache.windowScrollTop);if(s<this.options.triggerCachingDelta)return}this.trigger("trigger"),this.options.lockStep&&(this.locked=!0),t||this.options.triggerCachingDelta===-1||(this.triggerCache=i)}},onTargetScroll:function(e,t){var i=this.options.$target.parent().height(),s=this.options.$target.outerHeight(),n=this.options.$target.position().top,o={windowScrollTop:-n,documentHeight:s,windowHeight:i};this.onWindowScroll(o,t)},getRemainingDocHeight:function(e){return e.documentHeight-e.windowScrollTop-e.windowHeight-this.buffer},getBuffer:function(e){var t=e.windowHeight;return!n.isNull(t)&&Math.round(.666*t)},nearBottom:function(e){if(n.isNull(e.windowScrollTop))return!1;var t=this.options.offset,i=this.getRemainingDocHeight(e);return i<t},close:function(){this.options.$target&&this.options.$target.parent().off("scroll",this.handler)}});n.extend(l.prototype,o.Events),e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="peepr-body"><div class="indash_blog"><header data-subview="header" class="header"></header> ',oneTruePost?__p+=' <div data-subview="timeline" class="timeline"></div> ':(__p+=' <div class="empty-state-message" data-subview="emptyStateMessage"></div><main data-subview="posts" class="posts"></main> ',isSafeModeEnabled&&shouldBypassSafeMode&&(__p+=' <div data-subview="survey" class="survey"></div> '),__p+=" ",isSafeModeEnabled&&(__p+=' <div data-subview="overlay" class="overlay"></div> '),__p+=" "),__p+=' </div></div><div data-subview="bigLoader"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(139),r=i(185),a=i(137),l=i(796),c=i(290),u=i(797),h=r.extend({className:"posts",template:u,initialize:function(){this.postViews=[],this.listenTo(o,"indashblog:post:photo_lightbox",this.onLightboxRequest),this.listenTo(this.collection,"sync",this.onCollectionSync),this.listenTo(this.collection,"reset",this.onCollectionReset),this.listenTo(this.collection,"request",this.onCollectionRequest),this.listenTo(this.collection,"add",this.renderPost),this.counter=1,this.adViews=[],this.listenTo(o,"indashblog:inject:ad",this.setupDarla),this.listenTo(o,"DOMEventor:flatresize",this.setMinHeight),this.listenTo(o,"indashblog:search:results-end",this.onSearchResultsEnd)},afterRender:function(){return this.loader=new c,this.$el.append(this.loader.render().$el),s.delay(this.setMinHeight.bind(this),2e3),this},setupDarla:function(e){this.darlaAd=e.ads},setMinHeight:function(){if(this.rendered&&!this.collection.shouldBypassSafeMode){var e=n(window).height();this.navHeight=s.isUndefined(this.navHeight)?[".peepr-body .navigation",".peepr-body .info_wrapper",".peepr-body .blogless-advertiser"].reduce(function(e,t){return e+n(t).outerHeight()},0):this.navHeight,this.$el.css("min-height",e-this.navHeight+"px")}},renderPost:function(e){if(!a.bool("one_true_post")){var t=new window.Tumblr.IndashBlog.PostView({model:e});this.postViews.push(t);var i=this.$("[data-js-peepr-post-container]");if(i.append(t.render().el),this.postViews.length%10===2&&this.darlaAd){var n=this.collection.tumblelog.get("global_theme_params")||{};this.counter+=1,this.counter%=10;var o=new l({el:this.darlaAd,headerThemeParams:n,counter:this.counter});this.adViews.push(o),i.append(o.$el),o.render()}s.defer(s.bind(function(){this.make_tags_draggable()},t))}},onSearchResultsEnd:function(e){e&&(this.searchResultsEndView=e,this.$("[data-js-peepr-post-container]").append(this.searchResultsEndView.render().$el))},onCollectionReset:function(){this.searchResultsEndView&&this.searchResultsEndView.remove(),this.darlaAd&&(s.each(this.adViews,function(e){e.remove()}),this.adViews=[]),this.collection.length?this.collection.each(this.renderPost,this):(s.each(this.postViews,function(e){e.remove()}),this.postViews=[])},onCollectionRequest:function(){this.loader.set("loading",!0)},onCollectionSync:function(){this.loader.set("loading",!1)},onLightboxRequest:function(e){var t=e.post,i=t.get("photos"),n=e.photoset_index||1,r=[];s.each(i,function(e){r.push({width:e.original_size.width,height:e.original_size.height,low_res:e.alt_sizes[0].url,high_res:e.original_size.url})}),o.trigger("lightbox-open-request",r,n)}});e.exports=h},function(e,t,i){"use strict";var s=i(185),n=s.extend({initialize:function(e){this.options=e||{},this.counter=this.options.counter},render:function(){if(window.DARLA){var e=this.$el.find(".ad-content").first().attr("data-yam-ad-id");window.DARLA.add({name:"LRECP",sp:"1197719223",ps:"LREC",ssl:!0}),window.DARLA.addPos({asz:"300x250",dest:"tgt-"+e,h:"250",id:e,pos:"LREC-"+this.counter,w:"300"}),window.DARLA.render.RenderMgr.nuke("LREC-"+this.counter),window.DARLA.event("LRECP",{ps:"LREC-"+this.counter});var t=this.options.headerThemeParams;t.title_color&&t.link_color&&(this.$(".section_header").css("color",t.title_color),this.$(".sponsored_badge .ring").css("color",t.title_color),this.$(".sponsored_badge .dollar_sign").css("color",t.title_color),this.$(".ad-link").css("color",t.link_color))}}});e.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<div data-js-peepr-post-container></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(139),r=i(185),a=i(129),l=i(620),c=r.extend({renderWithTemplate:s.noop,className:"header",initialize:function(e){this.options=e,this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.insertHeader)},insertHeader:function(){this.header=new window.Tumblr.IndashBlog.HeaderView({model:this.collection.tumblelog,el:this.$el,is_peepr:!0,show_share_controls:!0,show_follow_button:!0,show_user_controls:!0,show_dismiss_controls:!1,on_customize_open:s.bind(this.renderAllFontStyles,this)}).render(),this.setupHeader()},setupHeader:function(){var e=this.collection.tumblelog.get("global_theme_params").title_font;this.renderSingleFontStyle(e),this.$(".navigation").width(this.$el.width()||585),o.trigger("indashblog:ready-animation-start"),this.options.editing_appearance&&this.header.start_customizing(),this.options.searchTagTerm&&o.trigger("peeprsearch:change:term",{term:this.options.searchTagTerm})},renderAllFontStyles:function(){s.each(l,function(e){this.appendFontToHead(e)},this)},renderSingleFontStyle:function(e){var t=s.result(l,e);t&&this.appendFontToHead(t)},appendFontToHead:function(e){var t=a.get("Context/hosts/assets_host")||"",i="webfont_"+e.path;if(e.path&&!n("head #"+i).length){var o=t+"/fonts/"+e.path+"/stylesheet.css";o+=s.has(e,"_v")?"?v="+e._v:"",n("<link>",{id:i,rel:"stylesheet",type:"text/css",href:o}).appendTo(n("head"))}},remove:function(){this.header&&this.header.remove(),r.prototype.remove.call(this)}});e.exports=c},function(e,t,i){"use strict";var s=i(185),n=i(800),o=s.extend({template:n,setNewMessage:function(e){e.indexOf("\\n")>0&&(e=e.replace(/\\n/,"")),this.set("message",e);var t=this.collection.tumblelog.get("global_theme_params")||{};this.set("accentColor",t.title_color?t.title_color:""),this.render()},render:function(){return this.get("message")?s.prototype.render.call(this):this}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div style="color:'+__e(accentColor)+'" class="empty-state-message-box">'+__e(message)+"</div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(185),n=i(802),o=i(236),r=i(3),a=i(8),l=i(139),c=s.extend({className:"survey",template:n,mixins:[o],events:{"click [data-js-feedback]":"_onClickFeedbackButton"},initialize:function(e){this.$el.hide(),this.options=e,this.listenTo(this.collection,"peepr:postsAndBlogFetch",this.setupSurvey)},getTemplateData:function(){var e=this.collection.length?this.collection.first().get("survey")[0]:null,t=r.get(e,"submission_confirmation"),i=r.get(e,"title"),s=r.get(e,"options");return this.options=s,{title:i,submissionConfirmation:t,options:s}},setupSurvey:function(){var e=this;this.renderWithTemplate();var t=this.collection.tumblelog.get("global_theme_params").title_color,i=this.collection.tumblelog.get("global_theme_params").background_color,s=this.js$("feedback");s.each(function(s,n){e.$(n).css({"background-color":t,color:i})});var n=this.js$("text");n.each(function(i,s){e.$(s).css("color",t)}),this.$el.show()},_onClickFeedbackButton:function(e){var t=parseInt(e.currentTarget.attributes["data-index"].value,10),i=this.options[t].link.href,s=this.options[t].link.method,n=this.options[t].link.body_params;a.ajax({method:s,url:i,withFormKey:!0,data:n}).done(r.bind(this._callback,this)),l.trigger("safeMode:SurveyOptionSelected",{loggingData:r.pick(n,["post_id","survey_id","user_response"])})},_callback:function(){this.js$("header-survey").hide(),this.js$("thanks-text").show()}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="survey-body"><div data-js-header-survey class="header-survey"><div data-js-text class="help-text"> ',_.isEmpty(title)||(__p+=" "+__e(title)+" "),__p+=' </div><div class="reply-text"> ',_.isEmpty(options)||(__p+=" ",_.each(options,function(e,t){__p+=' <button data-js-feedback data-index="'+__e(t)+'" class="tx-button">'+__e(e.text)+"</button> "}),__p+=" "),__p+=' </div></div><div data-js-text data-js-thanks-text class="thanks-text hide"> ',_.isEmpty(submissionConfirmation)||(__p+=" "+__e(submissionConfirmation)+" "),__p+=" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(150),o=i(139),r=i(308),a=i(148),l=i(804),c=a.extend({model:r,url:"/svc/indash_blog",blogNameOrId:"",_hasFetchedEverything:!1,initialize:function(e,t){this.loading=!1,this.tumblelog=new l,t=t||{},this.blogNameOrId=t.blogNameOrId,this.postId=t.postId,this.shouldBypassSafeMode=s.get(t,"shouldBypassSafeMode",!1),t.tumblelogData&&this.tumblelog.set(t.tumblelogData),t.url&&(this.url=t.url),this.listenTo(o,"indashblog:post:like",this.likePostbyId),this.bindBlogSearchEvents()},bindBlogSearchEvents:function(){this.listenTo(o,"indashblog:search:start",this.blogSearchStarted),this.listenTo(o,"indashblog:search:complete",this.blogSearchCompleted),this.listenTo(o,"indashblog:search:post-added",this.blogSearchPostAdded),this.listenTo(o,"indashblog:search:results-end",this.blogSearchResultsEnd),this.listenTo(o,"indashblog:search:clear",this.blogSearchClear)},blogSearchStarted:function(){this.searchMode=!0,this.reset(),this.trigger("request",this),this.loading=!0,o.trigger("indashblog:search:fetch-requested")},blogSearchPostAdded:function(e){this.add(e)},blogSearchCompleted:function(e){this.reset(e),this.trigger("sync",this),this.loading=!1},blogSearchResultsEnd:function(e){this._hasFetchedEverything=!0,this.loading=!1,this.trigger("sync",this)},blogSearchClear:function(){this.searchMode=!1,this.reset(),this.trigger("request",this),this.fetch()},fetchPostsAndBlog:function(e){var t=this,i=this.fetch(e),s=this.fetchBlog(e);n.all([i,s]).then(function(){t.trigger("peepr:postsAndBlogFetch")})},fetchBlog:function(e){return n(this.isTumblelogComplete()?null:this.tumblelog.fetch({tumblelog_name_or_id:this.blogNameOrId}))},fetch:function(e){if(!this.loading)return this.searchMode?(this.trigger("request",this),void o.trigger("indashblog:search:fetch-requested",e)):(e=e||{},e.blogNameOrId&&(this.blogNameOrId=e.blogNameOrId),e.data={tumblelog_name_or_id:this.blogNameOrId,post_id:this.postId||null,limit:this.postId?1:e.limit||10,offset:e.offset||0,should_bypass_safemode:this.shouldBypassSafeMode},this.loading=!0,a.prototype.fetch.call(this,e))},fetchMore:function(e){if(e=e||{},!this.hasFetchedEverything()&&!this.loading){if(this.searchMode)return this.trigger("request",this),void o.trigger("indashblog:search:fetch-requested",e);var t=this.models.length;return this.postId&&(t-=1,this.postId=null),e=s.extend({offset:t,remove:!1},e),this.fetch(e)}},parse:function(e,t){if(this.tumblelog.set("isOnline",s.get(e,"response.seconds_since_last_activity",-1)!==-1),(!e.response.posts.length||e.response.posts.length<t.data.limit)&&(this._hasFetchedEverything=!0),e.response.tumblelog&&this.tumblelog.set(e.response.tumblelog),e.response.peepr_ad&&o.trigger("indashblog:inject:ad",{ads:e.response.peepr_ad}),s.has(e.response,"empty_tumblelog_message")||s.has(e.response,"post_not_found_message")){var i=e.response.empty_tumblelog_message||e.response.post_not_found_message;this.trigger("emptyState",i)}return e.response.tracking_html&&!s.isEmpty(e.response.tracking_html)&&o.trigger("component:TrackingPixels",{init:e.response.tracking_html}),this.loading=!1,e.response.posts},reset:function(){this._hasFetchedEverything=!1,a.prototype.reset.apply(this,arguments)},hasFetchedEverything:function(){return this._hasFetchedEverything},likePostbyId:function(e,t){var i=this.get(e);i&&(t=t||"mouse",i.like(t),o.trigger("peepr:like_update",i.get("tumblelog"),i.toJSON()))},isTumblelogComplete:function(){return this.tumblelog.has("global_theme_params")}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(149),o=i(139),r=i(143),a=i(620),l=r.extend({url:"/svc/indash_blog/header",initialize:function(e,t){t=t||{},this.listenTo(this,"change",this.onModelChange)},onModelChange:function(e){this.tumblelog=this.tumblelog||new n({name:this.get("name")}),this.tumblelog_name_or_id=this.get("name");var t=this.tumblelog.get("following");if(!s.isUndefined(t)&&this.get("following")!==t){var i={source:this.get("following")?"FOLLOW_SOURCE_PEEPR_HEADER":"UNFOLLOW_SOURCE_PEEPR_HEADER"};this.tumblelog.save_following({following:this.get("following")},i),o.trigger("peepr:follow_update",this.get("following"))}if(e.hasChanged("following")){var r={can_subscribe:e.get("following")};e.get("following")||(r.is_subscribed=!1),this.set(r)}this.tumblelog.set(this.toJSON())},get_theme_param:function(e){var t=this.get("global_theme_params")||{};return t[e]},set_theme_params:function(e){var t=s.clone(this.get("global_theme_params"));this.set("global_theme_params",s.extend({},t,e))},parse:function(e,t){return s.get(e,"response",e)},fetch:function(e){return e=e||{},e.data={tumblelog_name_or_id:e.tumblelog_name_or_id||this.get("name")},r.prototype.fetch.call(this,e)},save:function(e,t){var i=s.extend({},this.defaults,e);return i.global_theme_params=s.omit(i.global_theme_params,["header_image_dimens","header_image_focused"]),t=t||{},t.contentType="application/json",t.data=JSON.stringify({tumblelog_name_or_id:this.get("name"),tumblelog:i}),t.withFormKey=!0,r.prototype.save.call(this,e,t)},getAvailableFonts:function(){return a}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(290),r=n.extend({renderWithTemplate:s.noop,className:"peepr-big-loader",initialize:function(e){this.options=s.defaults({},e),this.loader=new o,this.loader.set("loading",this.options.loading)},render:function(){this.$el.append(this.loader.render().$el)},toggle:function(e){this.options.loading=e,this.loader.set("loading",e),this.$el.toggleClass("hidden",!e)},show:function(){this.toggle(!0)},hide:function(){this.toggle(!1)}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(139),r=i(191),a=i(178),l=a.extend({mixins:[r],keycommands:{"keydown:j":"scrollToNextItem","keydown:k":"scrollToPrevItem","keydown:l":"like","keydown:r":"reblog","keydown:s":"share","keydown:period":"ttt","keydown:enter":"openBlog"},defaults:{selector:".post",scrollOffset:60,speed:200},initialize:function(e){this.options=s.defaults(e||{},this.defaults),this.listenTo(o,"post:form:show indashblog:keycommands:suspend",this.disableKeys),this.listenTo(o,"post:form:hide indashblog:keycommands:resume",this.enableKeys),this.listenTo(o,"keycommands:resume",this.onDashboardKeycommandsResume),this.listenTo(o,"drawer:close",this.resumeDashboardKeycommands)},onDashboardKeycommandsResume:function(){o.trigger("keycommands:suspend")},resumeDashboardKeycommands:function(){this.stopListening(o,"keycommands:resume"),o.trigger("keycommands:resume")},indexPageableItems:function(){var e={};this.currentPosition=this.getScrollOffset(),this.goToPosition=0,this.$(this.options.selector).each(function(t){var i=n(this);e[t]=Math.round(i.position().top)}),this.positions=e},getScrollOffset:function(){return this.$el.scrollTop()},like:function(){var e=this.findPostId();e&&o.trigger("indashblog:post:like",e,"keyboard")},reblog:function(){var e=this.findPostId();e&&o.trigger("indashblog:post:reblog",{id:e},"keyboard")},share:function(){var e=this.$(".post[data-post-id="+this.findPostId()+"] [data-subview=share]");s.isEmpty(e)||1!==e.length||e.get(0).click()},ttt:function(){this.goToPosition=1,this.$el.stop().animate({scrollTop:0},this.options.speed,s.bind(function(){this.animating=!1},this))},openBlog:function(){var e=this.$("[data-post-id="+this.findPostId()+"] .reblog_info.post_info_link");e.length&&o.trigger("peepr-open-request",{url:e.attr("href"),tumblelog_name:e.data("tumblelog-name")})},scrollToNextItem:function(){this.indexPageableItems(),this.nextPosition(),o.trigger("keycommands:jk",{loggingData:{source:"peepr"
}})},scrollToPrevItem:function(){this.indexPageableItems(),this.previousPosition(),o.trigger("keycommands:jk",{loggingData:{source:"peepr"}})},nextPosition:function(){for(var e in this.positions){var t=this.positions[e];t>this.currentPosition+this.options.scrollOffset&&(t<this.goToPosition||!this.goToPosition)&&(this.goToPosition=t)}this.animate()},previousPosition:function(){for(var e in this.positions){var t=this.positions[e];t<this.currentPosition-this.options.scrollOffset&&t>this.goToPosition&&(this.goToPosition=t)}this.animate()},animate:function(){this.goToPosition&&!this.animating&&(this.animating=!0,this.$el.stop().animate({scrollTop:this.goToPosition-this.options.scrollOffset},this.options.speed,s.bind(function(){this.animating=!1},this)))},findPostId:function(){if(this.goToPosition-this.options.scrollOffset===this.getScrollOffset()){var e=s.invert(this.positions)[this.goToPosition];if(e){var t=this.$(this.options.selector).get(e);if(t)return n(t).data("post-id")}}return!1}});e.exports=l},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(139),r=i(185),a=i(808),l=r.extend({className:"flag--one-true-post",initialize:function(){var e=this;a(function(t){e.component=new t({container:e.el,variant:"peepr",url:"/svc/tumblelog/"+e.collection.tumblelog.get("name")+"/peepr",fetch:!1}),e.shouldRenderImmediately&&e.render(),e.component.fetch().then(function(){o.trigger("peepr:timeline:posts-fetched")})}),this.listenTo(o,"DOMEventor:flatresize",this.setMinHeight)},render:n.noop,afterRender:function(){n.isEmpty(this.component)?this.shouldRenderImmediately=!0:(this.setMinHeight(),this.component.view.set("$scrollTarget",this.$el.closest(".peepr-body")),this.component.append())},setMinHeight:function(){if(this.rendered){var e=s(window).height();this.navHeight=n.isUndefined(this.navHeight)?[".peepr-body .navigation",".peepr-body .info_wrapper",".peepr-body .blogless-advertiser"].reduce(function(e,t){return e+s(t).outerHeight()},0):this.navHeight,this.$el.css("min-height",e-this.navHeight+"px")}}});e.exports=l},function(e,t,i){"use strict";var s=i(207),n=function(e){i.e(3,function(t){try{e(i(809))}catch(e){s(e,"timeline")}})};e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";function s(e){n||(n=r.get("Context/hosts"));var t=o.snakeCase(e);return o.endsWith(t,"_host")||(t+="_host"),o.get(n,t)}var n,o=i(3),r=i(129),a={get:o.memoize(s)};e.exports=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";function s(e){return"string"==typeof e||e&&"object"===("undefined"==typeof e?"undefined":l(e))&&"[object String]"===p.call(e)||!1}function n(){var e=new _;return e.cid=f,f+=1,m[e.cid]=e,e}function o(e,t){for(var i,s=v.length-1;s>=0;s--)v[s].message_callback(e,t);for(s=b.length-1;s>=0;s--)i=b[s],i&&i.shouldRespond&&i.shouldRespond(e,t)&&i.cb(e,t)}function r(e){if(e||(e={}),!(u&&u.stringify&&u.parse))throw"Must have JSON parsing and stringify";if(e.iframe&&(e.window=e.iframe.contentWindow,!e.origin)){var t=e.iframe.src,i=t.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);i&&(e.origin=i[1])}this.namespace=e.namespace?e.namespace+":":"",this.origin=e.origin||"*",this.responders={_method_callback_responder:y,_syn:d(this._syn,this)},this._on_connected=new g,this._unanswered_calls={},this.on_connection(d(this.enable_sending_post_message,this)),v.push(this),e.window&&this.setWindow(e.window)}function a(e,t,i){i||(i=this.origin),e.postMessage(t,i)}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=i(128),u=c("JSON",function(e){return e&&e.stringify}),h=[].slice,d=function(e,t){return function(){return e.apply(t,arguments)}},p=Object.prototype.toString,g=i(894),_=i(895),f=1,m={},v=[],b=[];!function(){var e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],i="attachEvent"===e?"onmessage":"message";t(i,function(e){var t;if("string"==typeof e.data){try{e.data&&"{"===e.data[0]&&(t=u.parse(e.data))}catch(e){}t&&t.method&&o(e,t)}},!1)}();var y=function(e){if(e.cid_response&&e.cid_response in m){var t=m[e.cid_response];t.resolve.call(null,this,e.response),delete m[e.cid_response]}};r.prototype.setWindow=function(e){if(e){this.window=e;var t=this.call("_syn");t.then(d(function(e,t){"ack"===t&&this._is_connected()},this))}},r.on=function(e,t){var i;i="*"===e?function(){return!0}:"*"===e[e.length-1]?function(t,i){return 0===i.method.indexOf(e.substring(0,e.length-2))}:function(t,i){return i.method===e},b.push({shouldRespond:i,cb:t})},r.off=function(e){for(var t,i=b.length-1;i>=0;i--)if(b[i].cb===e){t=i;break}return!!(t&&t>-1)&&(b.splice(t,1),!0)},r.prototype.match_origin=function(e){return"*"===this.origin||this.origin===e},r.prototype.message_callback=function(e,t){var i;if((!this.window||e.source===this.window)&&this.match_origin(e.origin)){if(t.method&&t.method.slice(0,this.namespace.length)===this.namespace&&(i=t.method.slice(this.namespace.length,t.method.length)),t.args&&s(t.args))try{t.args=u.parse(t.args)}catch(e){return}this.call_responder(i,e,t)}},r.prototype.call_responder=function(e,t,i){var s,n;if(e){if(i.args||(i.args=[]),n=this.responders[e],!n)return this._unanswered_calls[e]||(this._unanswered_calls[e]=[]),void this._unanswered_calls[e].push(arguments);s=n.apply(t,i.args),i.cid&&"_method_callback_responder"!==e&&this.send_to_window(t.source,"_method_callback_responder",{cid_response:i.cid,response:s})}},r.prototype._syn=function(){return this._is_connected(),"ack"},r.prototype._is_connected=function(){this.connected||(this.connected=!0,this._on_connected.trigger(this))},r.prototype.on_connection=function(e){return this._on_connected.push.apply(this._on_connected,arguments),this},r.prototype.method=function e(t){var i=this,e=function(){var e=1<=arguments.length?h.call(arguments,0):[];return e.unshift(t),i.send.apply(i,e)};return e},r.prototype.call=function(){var e=1<=arguments.length?h.call(arguments,0):[];return this.window?(e.unshift(this.window),this.call_on_window.apply(this,e)):void console.warn("no window specified on channel")},r.prototype.call_on_window=function(e,t){var i=3<=arguments.length?h.call(arguments,2):[],s=n();try{var o=u.stringify({method:this.namespace+t,args:i,cid:s.cid});"_syn"===t||"_method_callback_responder"===t?a.call(this,e,o):this.send_post_message(e,o)}catch(e){s.reject(e)}return s.promise()},r.prototype.send=function(){var e=1<=arguments.length?h.call(arguments,0):[];return this.window?(e.unshift(this.window),this.send_to_window.apply(this,e)):void console.warn("no window specified on channel")},r.prototype.send_to_window=function(e,t){var i=3<=arguments.length?h.call(arguments,2):[],s=u.stringify({method:this.namespace+t,args:i});"_syn"===t||"_method_callback_responder"===t?a.call(this,e,s):this.send_post_message(e,s)},r.prototype.send_post_message=function(){this._delayed_sent_messages||(this._delayed_sent_messages=[]),this._delayed_sent_messages.push(arguments)},r.prototype.enable_sending_post_message=function(){if(this.send_post_message=a,this._delayed_sent_messages){for(var e=0;e<this._delayed_sent_messages.length;e+=1)a.apply(this,this._delayed_sent_messages[e]);delete this._delayed_sent_messages}},r.prototype.listening_to=function(e){return e in this.responders},r.prototype.listen_to=function(e,t,i){if(s(e)){if(e in this.responders)return void console.warn("already listening to this method, turn it off first");if(i&&(t=d(t,i)),this.responders[e]=t,this._unanswered_calls[e]){var n,o=this._unanswered_calls[e];delete this._unanswered_calls[e];for(var r=0;r<o.length;r+=1)n=o[r],this.call_responder.apply(this,n)}}else{var a=e;for(e in a)a.hasOwnProperty(e)&&this.listen_to(e,a[e],i)}},r.prototype.stop_listen_to=function(e){return"_method_callback_responder"===e?void console.warn("cannot disable the method callback responder"):void delete this.responders[e]},r.prototype.ensureChannelConnection=function(e){this.send_to_window(e,"_syn")},e.exports=r},function(e,t){"use strict";function i(){this.length=0}var s=[].slice,n=[].push;i.prototype={slice:s,indexOf:Array.prototype.indexOf},i.prototype.push=function(){if(this.triggered_with)for(var e=1<=arguments.length?s.call(arguments,0):[],t=0;t<e.length;t+=1)e[t].apply(null,this.triggered_with);return n.apply(this,arguments)},i.prototype.trigger=function(){var e=1<=arguments.length?s.call(arguments,0):[],t=this.length;this.triggered_with=e;for(var i=0;i<t;i+=1)this[i].apply(null,this.triggered_with);return this},e.exports=i},function(e,t,i){"use strict";function s(){this._on_resolved=new r,this._on_rejected=new r,this.then=o(this.then,this),this.fail=o(this.fail,this),this.resolve=o(this.resolve,this),this.reject=o(this.reject,this)}var n=[].slice,o=function(e,t){return function(){return e.apply(t,arguments)}},r=i(894);s.prototype.then=function(){return this._on_resolved.push.apply(this._on_resolved,arguments),this},s.prototype.success=s.prototype.then,s.prototype.fail=function(){return this._on_resolved.push.apply(this._on_rejected,arguments),this},s.prototype.resolve=function(){if(!this.resolved&&!this.rejected)return this._on_resolved.trigger.apply(this._on_resolved,arguments),this.resolved=!0,this},s.prototype.reject=function(){if(!this.resolved&&!this.rejected)return this._on_rejected.trigger.apply(this._on_rejected,arguments),this.rejected=!0,this},s.prototype.reject_timeout=function(){var e=1<=arguments.length?n.call(arguments,0):[],t=e.shift();return setTimeout(o(function(){this.reject.apply(this,e)},this),t),this},s.prototype.promise=function(){function e(){var e=this;this.fail=function(){return t.fail.apply(t,arguments),e},this.then=function(){return t.then.apply(t,arguments),e},this.success=this.then,this.reject_timeout=function(){return t.reject_timeout.apply(t,arguments),e},this.cid=t.cid}var t=this;return new e},e.exports=s},,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(903),r=i(173),a=i(129),l=i(139),c=i(548),u=i(137),h=[],d=r.extend({name:"CrtControl",maxLoopTime:10,playerSelector:"[data-crt-video]",peeprOpen:!1,initialize:function(e){e=e||{},this.listenTo(l,"CrtControl:newPlayer",this.playerFactory,this),this.listenTo(l,"DOMEventor:flatscroll",s.throttle(this.onScroll,500),this),this.listenTo(l,"peepr:close",this.onPeeprClose,this),this.listenTo(l,"peepr:open",this.onPeeprOpen,this)},onPeeprOpen:function(){this.peeprOpen=!0},onPeeprClose:function(){this.peeprOpen=!1},findPlayers:function(e){var t=n(this.playerSelector);t.length&&this.playerFactory(t,e)},playerFactory:function(e,t){s.defer(s.bind(function(){s.each(e,function(e){this.newPlayer(e,t)},this)},this))},newPlayer:function(e,t){var i=this;if(e.player)return e.player;var s=new c(e,t);return h.push(s),s.render(),this.bindPlayerEvents(s),l.trigger("CrtControl:playerCreated",s),this.isThirdPartyTrackingEligible(t)&&o(function(e){var t={videoPlayer:s};i.beaconTracking=new e(t)}),s},isThirdPartyTrackingEligible:function(e){return u.bool("moat_viewability_beacons")&&s.get(e,"attributes.isAd",!1)&&!s.isEmpty(a.get("Components/BeaconTracking"))},bindPlayerEvents:function(e){this.listenTo(e,"ready",this.onPlayerReady),this.listenTo(e,"teardown",this.onPlayerTeardown)},onPlayerReady:function(){this.playInViewport()},onPlayerTeardown:function(e){if(e=s.where(h,{_id:e._id}),e.length){var t=s.indexOf(h,e[0]);t>-1&&(e=h.splice(t,1))}},onScroll:function(){this.playInViewport()},pauseAutoplaying:function(){s.each(h,function(e){e.get("autoplay")&&e.get("loaded")&&e.pause()})},getInViewport:function(){var e=this;return s.filter(h,function(t){return!(!t.watcher||e.peeprOpen&&!t.get("isInPeepr"))&&(t.watcher.isFullyInViewport&&t.$el.is(":visible"))})},playInViewport:function(){var e=this.getInViewport();if(e.length){var t=e[0];t.get("paused")&&t.get("autoplay")&&(this.pauseAutoplaying(),t.play())}}});e.exports=new d},function(e,t,i){"use strict";var s=i(207),n=function(e){i.e(4,function(t){try{e(i(904))}catch(e){s(e,"beacon-tracking")}})};e.exports=n},,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(207),n=function(e){i.e(5,function(t){try{e(i(926))}catch(e){s(e,"post-activity")}})};e.exports=n},,,function(e,t,i){"use strict";function s(e){return(e||a())-a.realStartedAt}var n=i(3),o=i(129),r=n.once(function(){return o.get("Context/time")}),a=n.get(window,"Tumblr.getRealNow");if(!a){var l=window.performance,c=l&&l.timing&&l.timing.responseStart||Date.now();a=function(){return r()+(Date.now()-c)},a.startedAt=(new Date).getTime(),a.realStartedAt=a()}e.exports={getRealNow:a,startedAt:a.startedAt,realStartedAt:a.realStartedAt,getElapsed:s}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(3),n=i(7),o=i(173),r=i(140),a=i(149),l=i(139),c=i(974),u=i(975),h=i(703),d=i(673),p=i(1018),g=new h,_=o.extend({name:"MessagingSharePost",initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),this.options=e,this.user=r(),this.channels=this._getChannelsEnabledForMessagingAsCollection(),this.messagingShareLogger=new c},render:function(){return this.openPopover(this.options),this},openPopover:function(e){var t,i,n=s.get(e,"postId"),o=s.get(e,"blogUuid"),r=s.get(e,"favoritesNames",[]),a=s.get(e,"popoverContainer"),l=s.get(e,"pinnedTarget"),c=s.get(e,"externalNetworksData",{}),h=new p(s.extend({post_id:n,tumblelog_name:o},c));return s.isEmpty(n)?null:s.isEmpty(o)?null:s.isEmpty(l)?null:(t={viewOptions:s.bind(function(e){return{shareData:{blogUuid:o,postId:n},popoverContainer:e.el,favoritesCollection:g,additionalFavorites:this._getAdditionalFavoritesAsParticipants(r),channels:this.channels,externalNetworksDataModel:h,isExternalSharingEnabled:this.isExternalSharingEnabled(),senderBlogUuid:this.user.getCurrentMessagingChannelUuid()}},this),autoTeardown:!0,teardownOnEscape:!1,pinnedSide:"bottom",isFixedPosition:!1,pinnedTarget:l,popoverContainer:a},this.messagingShareLogger.logShareIntent(n,o),i=new u(t).render(),this._afterPopoverOpen(i),i)},isExternalSharingEnabled:function(){return s.get(this.data,"is_external_sharing_enabled",!1)},_afterPopoverOpen:function(e){var t=e.getView();this.listenToOnce(e,"close",function(){this._onPopoverClose(e)}),this.listenTo(t,"external:click",this._onPopoverExternalNetworkShareClick),this.listenTo(t,"external:success",this._onPopoverExternalNetworkShareSuccess),this.listenTo(t,"external:fail",this._onPopoverExternalNetworkShareFail),l.trigger("keycommands:suspend")},_onPopoverClose:function(e){this.stopListening(e),this.stopListening(e.getView()),l.trigger("keycommands:resume")},_onPopoverExternalNetworkShareClick:function(e){this.messagingShareLogger.logExternalNetworkClicked(e)},_onPopoverExternalNetworkShareSuccess:function(e){this.messagingShareLogger.logExternalNetworkShareSuccess(e)},_onPopoverExternalNetworkShareFail:function(e){this.messagingShareLogger.logExternalNetworkShareFail(e)},_getChannelsEnabledForMessagingAsCollection:function(){return new n.Collection(this.user.getChannelsEnabledForMessaging())},_getAdditionalFavoritesAsParticipants:function(e){return s.reduce(e,function(e,t){var i=new a({name:t});return i.get("uuid")&&i.get("can_receive_messages")&&e.push(new d(i.toJSON(),{parse:!0})),e},[],this)}});e.exports=_},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(173),r=i(139),a=o.extend({name:"MessagingShareLogger",defaults:{namespace:"postchrome-interactions",platform:"web",isDebugEnabled:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults)))},logShareIntent:function(e,t){this._logIt("share:intent",{postId:e,postBlogUuid:t})},logExternalNetworkClicked:function(e){var t=e.getName(),i=e.getPostModel(),o=n.extend({},this._getCommonExternalShareData(e),{viewType:e.getType()});this._logIt("share:external",o),r.trigger("dashboard-share:"+t),e.isTypePopup()&&!n.isEmpty(i)&&s.ajax({url:"/svc/share/"+t,method:"POST",withFormKey:!0,data:{post_id:i.get("post_id"),tumblelog_name:i.get("tumblelog_name"),share_fallback:!0}})},logExternalNetworkShareSuccess:function(e){this._logIt("share:external:success",this._getCommonExternalShareData(e))},logExternalNetworkShareFail:function(e){this._logIt("share:external:fail",this._getCommonExternalShareData(e))},_logIt:function(e,t){t=t||{},n.extend(t,{platform:this.get("platform")}),r.trigger(this.get("namespace")+":"+e,{loggingData:t})},_getCommonExternalShareData:function(e){var t=e.getPostModel(),i={network:e.getName()};return n.isEmpty(t)||n.extend(i,{postId:t.get("post_id"),tumblelogName:t.get("tumblelog_name")}),i}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(242),a=i(976),l=o.extend({className:"popover--messaging-share-post popover popover_menu popover_gradient",mixins:[r],initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"viewOptions"))},render:function(){var e=s.isFunction(this.viewOptions)?this.viewOptions(this):this.viewOptions;return this.$wrapper=n("<div />").addClass("popover-inner popover_inner").appendTo(this.$el),this.$pinned.addClass("active"),this.sharePostView&&(this.stopListening(this.sharePostView),this.sharePostView.remove()),this.sharePostView=new a(e),this.listenToOnce(this.sharePostView,"close",this.teardown),this.$wrapper.html(this.sharePostView.render().$el),this},teardown:function(){return this.sharePostView&&this.sharePostView.remove(),this.remove()},getView:function(){return this.sharePostView}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(139),r=i(236),a=i(191),l=i(185),c=i(432),u=i(977),h=i(290),d=i(978),p=i(980),g=i(984),_=i(1012),f=i(1014),m=i(1016),v=i(406),b=i(661),y=i(726),w=i(746),k=i(703),C=i(1017),x=l.extend({className:"messaging-share-post",template:u,defaults:{senderBlog:null,isSending:!1,isLoading:!1,isLoadingFavorites:!1,isDisabled:!1,isEmpty:!1,isShowFavorites:!0,isShowMessage:!1,isShowExternalNetworksRow:!0,isExternalSharingEnabled:!0,isShowingExternalNetworkSubview:!1,closeAfterExternalNetworkShareMs:3e3,showLoadingAfterMs:250,numFavorites:10,defaultPlaceholder:null,additionalFavoritesPlaceholder:null,sendingPlaceholder:null,currentPlaceholder:null,focusIndex:0,isResultContainerFocused:!1,isExternalNetworksContainerFocused:!1,loadingClass:"is-loading",baseLoggingContext:"post-chrome",tabbingView:null},mixins:[r,a],keycommands:{"keydown:up":"_onKeyPressUp","keydown:down":"_onKeyPressDown","keydown:tab":"_onKeyPressTab","keydown:shift+tab":"_onKeyPressShiftTab","keydown:escape":"_onKeyPressEscape"},subviews:{searchView:{constructor:d,options:function(e){return{collection:e.collection,selectedRecipientModel:e.selectedRecipientModel,keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:search"}}},resultsView:{constructor:p,options:function(e){return{collection:e.collection,selectedRecipientModel:e.selectedRecipientModel,keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:results"}}},messageView:{constructor:w,options:function(e){return{isAutoValidationEnabled:!1,className:"messaging-share-post-message",placeholder:e.get("currentPlaceholder"),keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:message",buttonSubmittedClass:"submitted--send-a-post",animationSpeed:250,pluginsArray:e.pluginsArray,isSendAPost:!0}}},externalNetworksView:{constructor:g,options:function(e){return{isExternalSharingEnabled:e.get("isExternalSharingEnabled"),keyboardManager:e.keyboardManager,keyboardNamespace:"messagingshare:external",externalNetworksDataModel:e.externalNetworksDataModel}}},errorView:{constructor:f},favoritesLoaderView:{constructor:h,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(e){var t;e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"favoritesCollection","shareData","channels","popoverContainer","additionalFavorites","externalNetworksDataModel")),this.collection=new k,t=this.channels.findWhere({uuid:s.get(e,"senderBlogUuid")})||this.channels.first(),this.keyboardManager=new v({allowMultipleActiveViews:!0}),s.isEmpty(this.get("defaultPlaceholder"))&&this.set("defaultPlaceholder",n("Say something if you like...")),s.isEmpty(this.get("additionalFavoritesPlaceholder"))&&this.set("additionalFavoritesPlaceholder",n("Discuss this post if you like...")),s.isEmpty(this.get("sendingPlaceholder"))&&this.set("sendingPlaceholder",n("Sending...")),this.set({currentPlaceholder:this.get("defaultPlaceholder"),senderBlog:t}),this.additionalFavoritesIds=s.pluck(s.invoke(this.additionalFavorites,"toJSON"),"uuid"),this.channelIds=this.channels.pluck("uuid"),this.selectedRecipientModel=new C,this.blogSelectorPlugin=new m({collection:this.channels,currentTumblelog:t,popoverOptions:{popoverContainer:this.popoverContainer}}),this.pluginsArray=[this.blogSelectorPlugin],this.disableKeys()},afterRenderSubviews:function(){this.loader=new c({$container:this.$el,type:"bar",classModifiers:"top",loading:!1}),this._onSearchInputDebounced=s.bind(s.debounce(function(){this._onSearchInput(this.searchView.getQuery())},250),this),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isSending",this._onChangeIsSending),this.listenTo(this,"change:isDisabled",this._onChangeIsDisabled),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this,"change:isLoadingFavorites",this._onChangeisLoadingFavorites),this.listenTo(this,"change:isEmpty",this._onChangeIsEmpty),this.listenTo(this,"change:isShowFavorites",this._onChangeIsShowFavorites),this.listenTo(this,"change:isShowExternalNetworksRow",this._onChangeIsShowExternalNetworksRow),this.listenTo(this,"change:isShowMessage",this._onChangeIsShowMessage),this.listenTo(this,"change:currentPlaceholder",this._onChangeCurrentPlaceholder),this.listenTo(this,"change:focusIndex",this._onChangeFocusIndex),this.listenTo(this.blogSelectorPlugin.getBlogSelector(),"change:currentTumblelog",this._onBlogSelectorChange),this.listenTo(this.messageView,"submit:animated",this._onMessageSubmit),this.listenTo(this.searchView,"search",this._onSearchInputDebounced),this.listenTo(this.searchView,"clear",this._onSearchClear),this.listenTo(this.searchView,"focus",this._onViewFocusChange),this.listenTo(this.searchView,"submit",this._onSearchSubmit),this.listenTo(this.messageView,"focus",this._onViewFocusChange),this.listenTo(this.resultsView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"focus",this._onViewFocusChange),this.listenTo(this.externalNetworksView,"share:subview:show",this._onExternalNetworkShowSubview),this.listenTo(this.externalNetworksView,"share:success",this._onExternalNetworkShareSuccess),this.listenTo(this.externalNetworksView,"share:fail",this._onExternalNetworkShareFail),this.listenTo(this.externalNetworksView,"share:click",this._onExternalNetworkClick),this.listenTo(this.collection,"sync",this._onCollectionSync),this._setViewStates(),this._fetchFavorites(),this._setCollectionState(),this.messageTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.messageView.el}),this.searchTheme=new y({removeDataAttrAfterApplyingTheme:!1,el:this.searchView.el}),s.defer(s.bind(function(){this.rendered&&this.searchView.focus()},this)),this.keyboardManager.add("messagingshare:main",this),this.focusKeys()},beforeRemove:function(){this.keyboardManager.remove("messagingshare")},fetchByQuery:function(e){s.isEmpty(e)?this.set({isEmpty:!1,isShowFavorites:!0,isLoading:!1}):(this.set("isLoading",!0),this.collection.fetchByQuery(e,this.get("senderBlog").get("uuid")).always(s.bind(function(){this.rendered&&this.set("isLoading",!1)},this)))},getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},clearSelectedRecipient:function(){this.selectedRecipientModel.set("participant",null)},sendPost:function(e,t){var i,n,r,a=this.shareData,l=s.get(this.shareData,"postId"),c=s.get(this.shareData,"blogUuid"),u=[],h=!s.isEmpty(e),d=this._getLoggingContext();this.get("isDisabled")||this.get("isSending")||s.isEmpty(a)||(n=b.createPostMessage(l,c,{context:d,creationUserAction:t}),u.push(n),h&&(r=b.createTextMessage(e,{context:d,creationUserAction:t}),u.push(r)),i=this._createConversation(),s.isEmpty(i)||(this.set("isSending",!0),i.appendToQueue(u),o.trigger("messaging:conversation:open:model",i,d),this.close()))},close:function(){this.trigger("close")},_createConversation:function(){var e=this.get("senderBlog"),t=this.getSelectedRecipient();if(s.isEmpty(e)||s.isEmpty(t))return null;var i=e.toJSON(),n=t.toJSON();return new b({participantUuid:e.get("uuid"),participants:[i,n]})},_onCollectionSync:function(e){var t;return!this.rendered||s.isEmpty(this.searchView.getQuery())?void this._setCollectionState():(this.clearSelectedRecipient(),t=0===this.collection.length,t&&this.errorView.setTitle(this.collection.getNoResultsFoundMessage()),this.set({isShowFavorites:!1,isEmpty:t}),void this._resetResultsScroll())},_resetResultsScroll:function(){this.resultsView.$el.scrollLeft(0)},_resetExternalNetworksScroll:function(){this.externalNetworksView.$el.scrollLeft(0)},_applyTheme:function(e){this.messageTheme.setTheme(e),this.searchTheme.setTheme(e)},_setViewStates:function(){var e=this.get("isShowMessage"),t=this.get("isEmpty"),i=this.get("isLoadingFavorites"),s=this.get("isShowExternalNetworksRow");this.js$("submission").toggleClass("show-submission",e),this.js$("external").toggle(s),this.errorView.$el.toggle(t),this.resultsView.toggle(!t),this.favoritesLoaderView.set("loading",i),this._setFocusViews()},_onSearchInput:function(e){this.rendered&&this.fetchByQuery(e)},_onSearchClear:function(){this.rendered&&(this.fetchByQuery(null),this.clearSelectedRecipient())},_onSearchSubmit:function(){this.get("isShowFavorites")||1===this.collection.length&&this.selectedRecipientModel.set("participant",this.collection.first())},_setPlaceholderState:function(){var e=this.getSelectedRecipient(),t=this.get("isSending"),i=!s.isEmpty(e)&&s.contains(this.additionalFavoritesIds,e.get("uuid"));return t?void this.set("currentPlaceholder",this.get("sendingPlaceholder")):void this.set("currentPlaceholder",i?this.get("additionalFavoritesPlaceholder"):this.get("defaultPlaceholder"))},_setButtonState:function(){var e=this.get("isSending"),t=this.get("isDisabled"),i=e||t;this.messageView.set("isDisabled",i)},_setDisabledState:function(){var e=this.getSelectedRecipient(),t=this.get("senderBlog"),i=!s.isEmpty(e)&&e.get("uuid")===t.get("uuid");this.set("isDisabled",i)},_setCollectionState:function(){this.get("isShowFavorites")&&this.collection.reset(this.favoritesCollection.toJSON())},_setFocusViews:function(){var e=[this.searchView],t=[];this.get("isEmpty")||this.get("isLoadingFavorites")||(e.push(this.resultsView),t.push(this.resultsView)),this.get("isShowExternalNetworksRow")&&(e.push(this.externalNetworksView),t.push(this.externalNetworksView)),this.get("isShowMessage")&&e.push(this.messageView),this._focusViews=e,this._tabbableViews=t},_getLoggingContext:function(){var e,t,i=this.get("baseLoggingContext"),n=this.getSelectedRecipient();return s.isEmpty(n)?i:(e=s.contains(this.additionalFavoritesIds,n.get("uuid")),t=e?"trail":this.get("isShowFavorites")?"favorites":"search",i+":"+t)},_onChangeIsSending:function(e,t){this._setButtonState(),this._setPlaceholderState()},_onChangeIsDisabled:function(e,t){this._setButtonState()},_onChangeSelectedRecipient:function(e,t){var i=!s.isEmpty(t);i?(this.messageView.focus(),this._applyTheme(t.get("theme"))):this.searchView.focus(),this.set("isShowMessage",i),this._setViewStates(),this._setDisabledState(),this._setPlaceholderState()},_onChangeIsEmpty:function(){this._setViewStates()},_onChangeIsShowFavorites:function(){this._setCollectionState(),this._resetResultsScroll()},_onChangeIsShowExternalNetworksRow:function(){this._setViewStates(),this._resetExternalNetworksScroll()},_onChangeIsShowMessage:function(e,t){this.set("isShowExternalNetworksRow",!t)},_onBlogSelectorChange:function(e,t){this.set("senderBlog",t),this.messageView.focus(),this._setDisabledState()},_onChangeIsLoading:function(e,t){return this._loaderTimeout&&(clearTimeout(this._loaderTimeout),this._loaderTimeout=null),t?void(this._loaderTimeout=setTimeout(s.bind(function(){this.rendered&&(this.loader.set("loading",!0),this.$el.addClass(this.get("loadingClass")))},this),this.get("showLoadingAfterMs"))):(this.$el.removeClass(this.get("loadingClass")),void this.loader.set("loading",!1))},_onChangeisLoadingFavorites:function(){this._setViewStates()},_onMessageSubmit:function(e,t){this.sendPost(e,t)},_onChangeCurrentPlaceholder:function(e,t){this.messageView.setPlaceholder(t)},_addAdditionalFavorites:function(){!s.isEmpty(this.additionalFavorites)&&s.isArray(this.additionalFavorites)&&s.each(this.additionalFavorites.reverse(),function(e){var t=e.get("uuid"),i=this.favoritesCollection.get(t);s.contains(this.channelIds,t)||(s.isEmpty(i)?this.favoritesCollection.unshift(e):(this.favoritesCollection.remove(t),this.favoritesCollection.unshift(i)))},this)},_fetchFavorites:function(){var e=this;this.set("isLoadingFavorites",!0),this.favoritesCollection.fetchFavorites(this.get("numFavorites"),null,!0,!1,"post").always(function(){e.rendered&&(e._addAdditionalFavorites(),e._setCollectionState(),e.set("isLoadingFavorites",!1))})},_getFocusViews:function(){return this._focusViews},_moveFocusUp:function(){this.set("focusIndex",Math.max(0,this.get("focusIndex")-1))},_moveFocusDown:function(){var e=this._getFocusViews()||[];this.set("focusIndex",Math.min(e.length-1,this.get("focusIndex")+1))},_onViewFocusChange:function(e){var t=this._getFocusViews(),i=s.indexOf(t,e);this.set("tabbingView",s.contains(this._tabbableViews,e)?e:null),this.set("focusIndex",i,{silent:!0})},_onChangeFocusIndex:function(e,t){var i=s.get(this._getFocusViews(),t);this.set("tabbingView",s.contains(this._tabbableViews,i)?i:null),s.result(i,"focus")},_onKeyPressTab:function(e){var t=this.get("tabbingView");e.preventDefault(),s.isEmpty(t)||t.isLastFocused()?this._moveFocusDown():t.focusNext()},_onKeyPressShiftTab:function(e){var t=this.get("tabbingView");e.preventDefault(),s.isEmpty(t)||t.isFirstFocused()?this._moveFocusUp():t.focusPrevious()},_onKeyPressEscape:function(e){this.close(),e.preventDefault()},_onKeyPressUp:function(e){e.preventDefault(),this._moveFocusUp()},_onKeyPressDown:function(e){e.preventDefault(),this._moveFocusDown()},_onExternalNetworkShowSubview:function(e){var t="messagingshare:externalnetwork",i=new _({externalNetworkSubview:e});i.render(),this.disableKeys(),this.keyboardManager.add(t,i),this.listenToOnce(i,"goBack",function(){this.stopListening(e),this.keyboardManager.remove(t,i),this.enableKeys(),i.remove(),this.set("isShowingExternalNetworkSubview",!1),this.searchView.focus()}),this.listenToOnce(i,"close",function(){this.close()}),this.js$("external-network-subview-wrapper").html(i.$el),this.set("isShowingExternalNetworkSubview",!0)},_onExternalNetworkShareSuccess:function(e){setTimeout(s.bind(function(){this.rendered&&this.close()},this),this.get("closeAfterExternalNetworkShareMs")),this.trigger("external:success",e)},_onExternalNetworkShareFail:function(e){this.trigger("external:fail",e)},_onExternalNetworkClick:function(e){this.trigger("external:click",e)}});e.exports=x},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="searchView"></div><div class="messaging-share-post-main"><div class="messaging-share-post-results-wrapper"><div data-subview="errorView"></div><div data-subview="resultsView"></div><div data-subview="favoritesLoaderView"></div></div><div data-subview="loader"></div></div><div data-js-external class="messaging-share-post-external-networks-wrapper"><div data-subview="externalNetworksView"></div></div><div data-js-submission class="messaging-share-post-submission"><div data-subview="messageView"></div></div><div data-js-external-network-subview-wrapper></div>';
return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(236),a=i(191),l=i(979),c=o.extend({className:"messaging-share-post-search",template:l,mixins:[r,a],events:{"input [data-js-input]":"_onInputChange","focus [data-js-input]":"_onInputFocus","blur [data-js-input]":"_onInputBlur",click:"_onContainerClick"},defaults:{hasSelectedBlogNameClass:"has-selected-blog",isFocused:!1,currentQuery:""},keycommands:{"keydown:backspace":"_onKeyPressBackspace","keydown:enter":"_onKeyPressEnter"},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"selectedRecipientModel","keyboardManager","keyboardNamespace")),this.disableKeys()},afterRender:function(){this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipient),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:currentQuery",this._onChangeCurrentQuery),this.js$("selected-blog").hide()},focus:function(){this.js$("input").focus()},getQuery:function(){return this.get("currentQuery")},_clearInput:function(){this._setInputValue()},_setInputValue:function(e){e=e||"",this.js$("input").val(e),this._prevVal=e},_getSelectedRecipient:function(){return this.selectedRecipientModel.get("participant")},_hasSelectedRecipient:function(){return!s.isEmpty(this._getSelectedRecipient())},_onChangeSelectedRecipient:function(e,t){this._setBlogPillRecipient(t),s.isEmpty(t)?this._setInputValue(this.get("currentQuery")):this._clearInput()},_setBlogPillRecipient:function(e){var t=!s.isEmpty(e);this.js$("selected-blog").text(t?e.get("name"):"").toggle(t),this.$el.toggleClass(this.get("hasSelectedBlogNameClass"),t)},_setCurrentQuery:function(e,t){t&&this.unset("currentQuery",{silent:!0}),this.set("currentQuery",e)},_onInputChange:function(e){var t,i,s=n(e.currentTarget).val();this._prevVal!==s&&(t=this.get("currentQuery"),i=this._hasSelectedRecipient()&&s===t,this._setCurrentQuery(s,i),this._prevVal=s)},_onKeyPressBackspace:function(e){this._hasSelectedRecipient()&&(e.preventDefault(),this._setCurrentQuery("",!0))},_onKeyPressEnter:function(e){e.preventDefault(),this.trigger("submit",this)},_onContainerClick:function(){this.focus()},_onInputFocus:function(){this.set("isFocused",!0)},_onInputBlur:function(){this.set("isFocused",!1)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onChangeCurrentQuery:function(e,t){t=t||"",this._hasSelectedRecipient()&&this._setBlogPillRecipient(null),s.isEmpty(t)?this.trigger("clear"):this.trigger("search",t)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="search-input-wrapper" data-js-search-container><div class="search-input-container"><input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="search-input" placeholder="'+__e(__("Message to..."))+'" data-js-input> <button class="selected-blog" data-js-selected-blog data-js-theme-accent-color-as-background></button></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(684),r=i(191),a=i(427),l=i(413),c=i(981),u=i(983),h=n.extend({className:"messaging-share-post-results",template:u,defaults:{isFocused:!1,focusedView:null,selectedView:null},mixins:[r,o,l],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{resultView:{constructor:c,options:function(e){return{onSelect:s.bind(e._onSubviewSelect,e),onFocus:s.bind(s.partial(e._setIsFocusedDebounced,!0),e),onBlur:s.bind(s.partial(e._setIsFocusedDebounced,!1),e)}},collection:function(e){return e.collection}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"collection","selectedRecipientModel","keyboardNamespace","keyboardManager")),this.keyboardViewName="resultView",this.disableKeys()},afterRenderSubviews:function(){this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:selectedView",this._onChangeSelectedView),this.listenTo(this.selectedRecipientModel,"change:participant",this._onChangeSelectedRecipientModel),this._setIsFocusedDebounced=s.debounce(s.bind(this._setIsFocused,this),0),this.scrollbar=new a(this.$el),this.updateScrollbar()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(e){this.$el.toggle(e),e||this.resetFocus()},focus:function(){var e=this.get("selectedView"),t=!s.isEmpty(e);t&&this.setSelectedIndex(this.keyboardViewName,s.indexOf(this.resultView,e)),t?this.set("focusedView",this.getSelectedView(this.keyboardViewName)):this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){this.set("focusedView",this.selectNext(this.keyboardViewName))},focusPrevious:function(){this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(e){this.rendered&&this.scrollbar&&s.defer(s.bind(this.scrollbar.update,this.scrollbar))},beforeRemove:function(){this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},_onKeyPressLeft:function(e){e.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(e){e.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(e){e.preventDefault()},_onChangeFocusedView:function(e,t){var i=this.previous("focusedView");i&&i.setFocused(!1),t&&t.setFocused(!0)},_onChangeSelectedView:function(e,t){var i=this.previous("selectedView");i&&i.setSelected(!1),t&&t.setSelected(!0)},_onSubviewSelect:function(e,t){var i=e!==this.get("selectedView")?e:null,n=s.isEmpty(i)?null:t;this.selectedRecipientModel.set("participant",n),this.set("selectedView",i)},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onChangeSelectedRecipientModel:function(e,t){var i;return s.isEmpty(t)?void this.set("selectedView",null):(i=s.find(this.resultView,function(e){return e.model.get("uuid")===t.get("uuid")}),void this.set("selectedView",i))}});e.exports=h},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(982),r=i(726),a=n.extend({className:"messaging-share-post-result",tagName:"a",attributes:{href:"#",tabIndex:1},events:{click:"_onSelect",focus:"_onFocus",blur:"_onBlur"},defaults:{isSelected:!1,isFocused:!1,selectedClass:"is-selected",focusedClass:"is-focused"},template:o,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"onSelect","onFocus","onBlur"))},afterRender:function(){this.listenTo(this,"change:isSelected",this._onChangeIsSelected),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.conversationTheme=new r({theme:this.model.get("theme"),el:this.el}).render()},getTemplateData:function(){return{name:this.model.get("name"),title:this.model.get("title"),avatarUrl:this.model.getAvatarUrl(),avatarShape:this.model.getAvatarShape()}},setSelected:function(e){this.rendered&&this.set("isSelected",e)},setFocused:function(e){this.rendered&&this.set("isFocused",e)},_onSelect:function(e){e.preventDefault(),s.isFunction(this.onSelect)&&this.onSelect(this,this.model)},_onFocus:function(e){e.preventDefault(),s.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(e){e.preventDefault(),s.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onChangeIsSelected:function(e,t){this.$el.toggleClass(this.get("selectedClass"),t)},_onChangeIsFocused:function(e,t){this.$el.toggleClass(this.get("focusedClass"),t),t&&this.$el.focus()}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="container" data-js-theme-accent-color-on-grey><div class="avatar" data-js-theme-avatar-shape-class><img src="'+__e(avatarUrl)+'" alt="'+__e(name)+'" title="'+__e(name)+'"></div><div class="name">'+__e(name)+'</div><div class="title">',__p+=_.isEmpty(title)?"&nbsp;":__e(title),__p+="</div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="resultView[]"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(684),r=i(191),a=i(427),l=i(308),c=i(290),u=i(413),h=i(985),d=i(987),p=i(989),g=i(1011),_=n.extend({className:"messaging-share-post-external-networks",template:g,defaults:{isLoading:!1,isFocused:!1,focusedView:null,isExternalSharingEnabled:!0},mixins:[r,o,u],keycommands:{"keydown:left":"_onKeyPressLeft","keydown:right":"_onKeyPressRight","keydown:backspace":"_onKeyPressBackspace","keydown:shift+backspace":"_onKeyPressBackspace"},subviews:{networkView:{constructor:d,options:function(e){return{onFocus:s.bind(s.partial(e._setIsFocusedDebounced,!0),e),onBlur:s.bind(s.partial(e._setIsFocusedDebounced,!1),e),onShowSubview:s.bind(e._onShowSubview,e),onShareSuccess:s.bind(e._onShareSuccess,e),onShareFail:s.bind(e._onShareFail,e),onShareClick:s.bind(e._onShareClick,e)}},collection:function(e){return e.collection}},networksLoaderView:{constructor:c,options:{className:"messaging-share-post-favorites-loader",variation:"small centered",loading:!1}}},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"keyboardNamespace","keyboardManager","externalNetworksDataModel")),this._setIsFocusedDebounced=s.debounce(s.bind(this._setIsFocused,this),0),this.keyboardViewName="networkView",this.collection=new h,this.disableKeys()},afterRenderSubviews:function(){if(this.listenTo(this.collection,"reset update",this._onCollectionChange),this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this,"change:focusedView",this._onChangeFocusedView),this.listenTo(this,"change:isLoading",this._onChangeIsLoading),this.listenTo(this.externalNetworksDataModel,"request",this._externalNetworksDataModelRequest),this.listenTo(this.externalNetworksDataModel,"sync",this._externalNetworksDataModelSync),this.scrollbar=new a(this.$el),this.updateScrollbar(!0),this._onChangeIsLoading(this,this.get("isLoading")),this.externalNetworksDataModel.isPopulated())this.updateComponents();else{if(!this.externalNetworksDataModel.isValid())return;this.externalNetworksDataModel.fetch()}},beforeRemove:function(){this.keyboardManager.remove(this.keyboardNamespace),this.scrollbar&&this.scrollbar.destroy()},resetFocus:function(){this.set("focusedView",null),this.deselect(this.keyboardViewName)},toggle:function(e){this.$el.toggle(e),e||this.resetFocus()},focus:function(){this.focusFirst()},focusFirst:function(){this.set("focusedView",this.selectFirst(this.keyboardViewName))},focusLast:function(){this.set("focusedView",this.selectLast(this.keyboardViewName))},focusNext:function(){this.set("focusedView",this.selectNext(this.keyboardViewName))},focusPrevious:function(){this.set("focusedView",this.selectPrevious(this.keyboardViewName))},isLastFocused:function(){return this.isLastSelected(this.keyboardViewName)},isFirstFocused:function(){return this.isFirstSelected(this.keyboardViewName)},updateScrollbar:function(e){this.rendered&&this.scrollbar&&s.defer(s.bind(this.scrollbar.update,this.scrollbar))},updateComponents:function(){this.collection.reset(s.map(this._getExternalNetworks(),function(e){return{component:e}}))},_setIsFocused:function(e){this.rendered&&this.set("isFocused",e)},_getExternalNetworks:function(){var e=this.get("isExternalSharingEnabled"),t=[{Constructor:p.Permalink,options:this._getPermalinkOptions,isExternal:!1},{Constructor:p.Embed,options:this._getEmbedOptions,isExternal:!1},{Constructor:p.Email,options:this._getEmailOptions,isExternal:!0},{Constructor:p.Flag,options:this._getFlagOptions,isExternal:!1},{Constructor:p.Facebook,options:this._getFacebookOptions,isExternal:!0},{Constructor:p.Twitter,options:this._getTwitterOptions,isExternal:!0},{Constructor:p.Pinterest,options:this._getPinterestOptions,isIncluded:this._isShowPinterest,isExternal:!0},{Constructor:p.Reddit,options:this._getRedditOptions,isExternal:!0}];return s.reduce(t,s.bind(function(t,i){var n;return!e&&i.isExternal?t:s.isFunction(i.isIncluded)&&!i.isIncluded.call(this)?t:(n=new i.Constructor(this._getBaseAndNetworkOptions(i.options.call(this))),t.push(n),t)},this),[])},_getPermalinkOptions:function(){return{}},_getEmbedOptions:function(){return{}},_getEmailOptions:function(){return{}},_getTwitterOptions:function(){var e=this.externalNetworksDataModel.get("twitter_username");return{isPopup:s.isEmpty(e),username:e}},_getFacebookOptions:function(){return{isPopup:!this.externalNetworksDataModel.get("has_facebook")}},_getPinterestOptions:function(){var e=this.externalNetworksDataModel.get("pinterest_share_window"),t=s.get(e,"url"),i=s.get(e,"dimensions");return{popupOptions:i,popupUrl:t}},_isShowPinterest:function(){return this.externalNetworksDataModel.get("show_pinterest")},_getRedditOptions:function(){return{}},_getFlagOptions:function(){return{}},_getBaseExternalNetworkOptions:function(){var e=this.externalNetworksDataModel.toJSON(),t=s.extend({},e,{id:s.get(e,"post_id")}),i=new l(t);return{postModel:i}},_getBaseAndNetworkOptions:function(e){return this._baseExternalNetworkOptions||(this._baseExternalNetworkOptions=this._getBaseExternalNetworkOptions()),s.extend({},this._baseExternalNetworkOptions,e)},_onKeyPressLeft:function(e){e.preventDefault(),this.focusPrevious()},_onKeyPressRight:function(e){e.preventDefault(),this.focusNext()},_onKeyPressBackspace:function(e){e.preventDefault()},_onChangeFocusedView:function(e,t){var i=this.previous("focusedView");i&&i.setFocused(!1),t&&t.setFocused(!0)},_onChangeIsFocused:function(e,t){t?(this.keyboardManager.add(this.keyboardNamespace,this),this.trigger("focus",this)):(this.set("focusedView",null),this.keyboardManager.remove(this.keyboardNamespace),this.trigger("blur",this))},_onCollectionChange:function(){this.resetFocus(),this.updateScrollbar()},_onShowSubview:function(e){this.trigger("share:subview:show",e)},_onShareSuccess:function(e){this.trigger("share:success",e)},_onShareFail:function(e){this.trigger("share:fail",e)},_onShareClick:function(e){this.trigger("share:click",e)},_onChangeIsLoading:function(e,t){this.networksLoaderView.set("loading",t)},_externalNetworksDataModelRequest:function(e){this.set("isLoading",!0)},_externalNetworksDataModelSync:function(e){this.set("isLoading",!1),this.updateComponents()}});e.exports=_},function(e,t,i){"use strict";var s=i(148),n=i(986),o=s.extend({model:n});e.exports=o},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{component:null}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(988),r=n.extend({className:"messaging-share-post-external-network",tagName:"a",attributes:{href:"#",tabIndex:1},events:{focus:"_onFocus",blur:"_onBlur",click:"_onClick"},defaults:{isFocused:!1,focusedClass:"is-focused"},template:o,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"onFocus","onBlur","onShareSuccess","onShareFail","onShareClick","onShowSubview")),this.component=this.model.get("component")},getTemplateData:function(){return{label:this.component.getLabel()}},afterRender:function(){this.listenTo(this,"change:isFocused",this._onChangeIsFocused),this.listenTo(this.component,"share:fail",this._onShareFail),this.listenToOnce(this.component,"share:success",this._onShareSuccess),this._setLinkClass(),this._setLinkHref()},remove:function(){this.stopListening(this.component)},setFocused:function(e){this.rendered&&this.set("isFocused",e)},_setLinkHref:function(){var e=this.component.getButtonHref();s.isEmpty(e)||this.$el.attr({href:e,target:"_blank"})},_setLinkClass:function(){this.$el.addClass("network--"+this.component.getName())},_onFocus:function(e){e.preventDefault(),s.isFunction(this.onFocus)&&this.onFocus(this,this.model)},_onBlur:function(e){e.preventDefault(),s.isFunction(this.onBlur)&&this.onBlur(this,this.model)},_onClick:function(e){this.onShareClick&&this.onShareClick(this.component),this.component.isTypeHref()||(e.preventDefault(),this.component.isTypeCallback()?this.component.onClickHandler(e):this.component.isTypePopup()?this._openShareWindow():this.component.isTypeSubview()&&this.component.getSubviewInstance().then(s.bind(function(e){s.isFunction(this.onShowSubview)&&this.onShowSubview(e)},this)).catch(s.bind(function(e){},this)))},_openShareWindow:function(){var e=this.component.getPopupUrl(),t=this.component.getPopupOptions(),i=this.component.getName();s.isEmpty(e)||window.open(e,i+"-share-dialog",t)},_onChangeIsFocused:function(e,t){this.$el.toggleClass(this.get("focusedClass"),t),t&&this.$el.focus()},_onShareSuccess:function(){s.isFunction(this.onShareSuccess)&&this.onShareSuccess(this.component)},_onShareFail:function(){s.isFunction(this.onShareFail)&&this.onShareFail(this.component)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(label);return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(990),n=i(997),o=i(998),r=i(999),a=i(1e3),l=i(1001),c=i(1004),u=i(1008);e.exports={Facebook:s,Reddit:n,Pinterest:o,Permalink:r,Embed:l,Flag:a,Email:c,Twitter:u}},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(130),r=i(991),a=i(993),l=r.extend({defaults:{isPopup:!0,username:null,getUsernameUrl:"/svc/facebook_status"},getName:function(){return"facebook"},getLabel:function(){return o("Facebook")},getType:function(){return this.get("isPopup")?r.TYPE_POPUP:r.TYPE_SUBVIEW},getPopupOptions:function(){return"width=626,height=436"},getPopupUrl:function(){var e=this.getPostTinyUrl()||this.getPostUrl();return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)},getSubviewConstructor:function(){return a},getSubviewOptions:function(){return{username:this.get("username")}},afterSubviewCreated:function(e){n.isEmpty(this.get("username"))&&this._getUsername().then(n.bind(function(t){this.set("username",t),e.set("username",t)},this))},_getUsername:function(){return s.ajax({url:this.get("getUsernameUrl"),method:"POST",withFormKey:!0})}});e.exports=l},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(150),r=i(173),a=i(992),l=r.extend({name:"BaseExternalNetwork",initialize:function(e){n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),n.extend(this,n.pick(e,"postModel"))},getName:function(){return null},getLabel:function(){return null},getType:function(){return l.TYPE_POPUP},getPopupUrl:function(){return null},getPopupOptions:function(){return null},getSubviewConstructor:function(){return null},getSubviewOptions:function(){return null},getButtonHref:function(){return null},onClickHandler:function(e){},getPostModel:function(){return this.postModel},getPostUrl:function(){return this.postModel.get("post_url")},getPostTinyUrl:function(){return this.postModel.get("post_tiny_url")},getShareUrl:function(){return"/svc/share/"+this.getName()},isTypePopup:function(){return this.isTypeEqual(l.TYPE_POPUP)},isTypeSubview:function(){return this.isTypeEqual(l.TYPE_SUBVIEW)},isTypeCallback:function(){return this.isTypeEqual(l.TYPE_CALLBACK)},isTypeHref:function(){return this.isTypeEqual(l.TYPE_HREF)},isTypeEqual:function(e){return this.getType()===e},createSubviewInstance:function(e){var t,i,s;return t=this.getSubviewConstructor(),n.isEmpty(t)?null:t.prototype instanceof a?(i=n.extend({},this.getSubviewOptions(),e),s=new t(i),this.listenToOnce(s,"remove",function(e){this.stopListening(e),this.afterSubviewRemoved(e)}),this.listenTo(s,"share",function(e,t){this.onSubviewShare(e,t)}),this.afterSubviewCreated(s),s):null},getSubviewInstance:function(e){var t=o.defer(),i=this.createSubviewInstance(e);return n.isEmpty(i)?t.reject("Could not create external network subview (subview constructor must extend ExternalNetworkEmbedSubview)."):t.resolve(i),t.promise},getShareRequestDataFromSubviewData:function(e){return e},sendShareRequest:function(e){return s.ajax({url:this.getShareUrl(),method:"POST",withFormKey:!0,data:e})},onSubviewShare:function(e,t){var i=this.getShareRequestDataFromSubviewData(e),s=n.extend({},this._getBaseShareRequestData(),i);return this._beforeShare(t,e),this.sendShareRequest(s).then(n.bind(function(){this._afterShareSuccess(t,e),this._afterShare(t,e)},this)).fail(n.bind(function(){this._afterShareFail(t,e),this._afterShare(t,e)},this))},afterSubviewCreated:function(e){},afterSubviewRemoved:function(e){},_getBaseShareRequestData:function(){var e=this.getPostModel(),t={post_id:e.get("post_id"),tumblelog_name:e.get("tumblelog_name")};return this.isTypeSubview()||n.extend(t,{share_fallback:!0}),t},_beforeShare:function(e,t){e.set({isSharing:!0,isShareSuccess:!1,isShareFail:!1}),this.trigger("share:start")},_afterShareSuccess:function(e,t){e.set({isShareSuccess:!0,isShareFail:!1}),e.onShareSuccess(t),this.trigger("share:success")},_afterShareFail:function(e,t){e.set({isShareFail:!0,isShareSuccess:!1}),e.onShareFail(t),this.trigger("share:fail")},_afterShare:function(e,t){e.set("isSharing",!1),e.afterShare(t),this.trigger("share:finished")}},{TYPE_POPUP:"popup",TYPE_SUBVIEW:"subview",TYPE_CALLBACK:"callback",TYPE_HREF:"href"});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(185),o=n.extend({defaults:{isSharing:!1,isShareSuccess:!1,isShareFail:!1},initialize:function(e){s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},getTitle:function(){return null},onShareSuccess:function(e){},onShareFail:function(e){},afterShare:function(e){},isShareSuccess:function(){return this.get("isShareSuccess")},isShareFail:function(){return this.get("isShareFail")},share:function(e){this.trigger("share",e,this)},close:function(){this.trigger("close",this)},remove:function(){return this.trigger("remove",this),n.prototype.remove.apply(this,arguments)}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(994),r=i(996),a=i(236),l=o.extend({className:"external-network-facebook-subview external-network-form-subview",template:r,mixins:[a],defaults:s.defaults({username:null,characterLimit:255},o.prototype.defaults),getTitle:function(){var e=this.get("username");return s.isEmpty(e)?n("Facebook"):n("Facebook (%1$s)",e)},afterRender:function(){this.listenTo(this,"change:username",this._onChangeUsername),s.defer(s.bind(this.focus,this)),o.prototype.afterRender.apply(this,arguments)},getTemplateData:function(){return{characterLimit:this.get("characterLimit")}},focus:function(){this.js$("message").focus()},onFormSubmit:function(e){var t=this.js$("message").val();this.share({message:t})},_onChangeUsername:function(){this.trigger("changeTitle",this.getTitle())}});e.exports=l},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(992),r=i(995),a=i(236),l=o.extend({tagName:"form",mixins:[a],className:"external-network-form-subview",defaults:s.defaults({isFormValid:!1,isShowConfetti:!0},o.prototype.defaults),events:{"click [data-js-success-container]":"_onSuccessContainerClick",submit:"_onFormSubmit"},initialize:function(e){s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),o.prototype.initialize.apply(this,arguments)},afterRender:function(){var e=this.getSubmitButtonElement();this.listenTo(this,"change:isFormValid",this._onChangeIsFormValid),this.listenTo(this,"change:isSharing",this._onChangeIsSharing),s.isEmpty(e)||(this.submitTextDefault=e.text(),this.submitTextSending=e.attr("data-text-sending")||n("Sending...")),this.validateForm(),this._setSubmitButtonState(),this._toggleElement(this.getShareFailElement(),!1),this._toggleElement(this.getShareSuccessElement(),!1)},getSubmitButtonElement:function(){return this.js$("submit-button")},getShareSuccessElement:function(){return this.js$("success-container")},getShareFailElement:function(){return this.js$("fail-container")},onShareSuccess:function(e){var t,i=this.getShareSuccessElement();this._toggleElement(i,!0),this._toggleElement(this.getShareFailElement(),!1),i&&this.get("isShowConfetti")&&(t=this._createConfettiView(),i.append(t.render().$el))},onShareFail:function(e){this._toggleElement(this.getShareFailElement(),!0),this._toggleElement(this.getShareSuccessElement(),!1)},isFormFieldsValid:function(){return!0},validateForm:function(){this.set("isFormValid",this.isFormFieldsValid())},setFormIsValid:function(e){this.set("isFormValid",e)},isFormValid:function(){return this.get("isFormValid")},onFormSubmit:function(e){},_createConfettiView:function(){return new r({className:"external-network-form-subview-confetti",autoParty:!0,amount:30,speed:.2})},_setSubmitButtonState:function(){var e=this.getSubmitButtonElement(),t=this.get("isFormValid"),i=this.get("isSharing"),s=!t||i;e.prop("disabled",s),e.text(i?this.submitTextSending:this.submitTextDefault)},_onChangeIsSharing:function(e,t){this._setSubmitButtonState()},_onChangeIsFormValid:function(e,t){this._setSubmitButtonState()},_onSuccessContainerClick:function(e){this.close()},_toggleElement:function(e,t){s.isEmpty(e)||e.toggleClass("visible",t)},_onFormSubmit:function(e){e.preventDefault(),this.onFormSubmit(e)}});e.exports=l},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(185),r=i(139),a=o.extend({id:"milestone-confetti",tagName:"canvas",defaults:{amount:100,autoParty:!1,colors:["#D95E40","#F2992E","#56BC8A","#529ECC","#A77DC2","#748089"],size:40,speed:.5,onDone:s.noop},__resize:function(){this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height())},_updateConfetti:function(e,t){this.confettiAngle+=.001,e.off||(e.tiltAngle+=e.tiltAngleIncrement,e.tilt=15*Math.sin(e.tiltAngle-t/3),e.y+=(Math.cos(this.confettiAngle+e.density)+.5*e.radius)*this.options.speed),e.y>this.el.height+20&&(this.isAnimating?(e.tilt=a.range(-10,10,!0),e.tileAngle=0,e.tiltAngleIncrement=a.range(.05,.1),e.x=Math.random()*this.el.width,e.y=-20):e.off||(e.off=!0,this.confettiOffscreen++))},_stopAnimating:function(){this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null),this.isAnimating=!1},_startAnimating:function(e){e=e||!1,this._stopAnimating(),this.animationInterval=setInterval(n.bind(this.draw,this),15),this.isAnimating=!!e||this.isAnimating},initialize:function(e){this.options=n.extend({},this.defaults,e||{}),this.colors=this.options.colors,this.$win=s(window),this.$parent=s(),this.context=this.el.getContext("2d"),this.animationInterval=null,this.confetti=[],this.confettiAngle=0,this.confettiOffscreen=0,this.isAnimating=!1},render:function(){return n.defer(n.bind(this.setup,this)),this},setup:function(){this.$parent=this.$el.parent(),this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height()),this.listenTo(r,"DOMEventor:flatresize",this.__resize);for(var e=this.options.size,t=.5*e,i=0,s=this.options.amount;i<s;i++)this.confetti.push({x:Math.random()*this.el.width,y:Math.random()*-this.el.height,radius:a.range(t,e),density:a.range(10,s),tilt:a.range(-10,10,!0),tiltAngle:0,tiltAngleIncrement:a.range(.05,.1),color:this.colors[a.range(0,this.colors.length-1,!0)],off:!1});this.options.autoParty&&this.party()},draw:function(){if(this.context.clearRect(0,0,this.el.width,this.el.height),this.confettiOffscreen===this.confetti.length)return this.trigger("confetti:animation:finished"),void this.remove();for(var e=5,t=0;t<this.confetti.length;t++){var i=this.confetti[t];this.context.beginPath(),this.context.lineWidth=.5*i.radius,this.context.strokeStyle=i.color,this.context.moveTo(i.x+i.tilt+i.radius/e,i.y),this.context.lineTo(i.x+i.tilt,i.y+i.tilt+i.radius/e),this.context.stroke(),this._updateConfetti(i,t)}},party:function(){return this.confettiOffscreen=0,this._startAnimating(!0),this},stopPartying:function(){return this.isAnimating=!1,this},remove:function(){return this._stopAnimating(),this.options.onDone(),o.prototype.remove.call(this)}},{range:function(e,t,i){i=i||!1;var s=(t-e)*Math.random()+e;return i?Math.round(s):s}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><textarea data-js-message maxlength="'+__e(characterLimit)+'" placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional Facebook message content"))+'"></textarea></div><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(130),n=i(991),o=n.extend({getName:function(){return"reddit"},getLabel:function(){return s("Reddit")},getPopupOptions:function(){return"scrollbars=1,width=860,height=600"},getPopupUrl:function(){return"https://reddit.com/submit?url="+encodeURIComponent(this.getPostUrl())}});e.exports=o},function(e,t,i){"use strict";var s=i(130),n=i(991),o=n.extend({defaults:{popupUrl:null,popupOptions:null},getName:function(){return"pinterest"},getLabel:function(){return s("Pinterest")},getPopupOptions:function(){return this.get("popupOptions")},getPopupUrl:function(){return this.get("popupUrl")}});e.exports=o},function(e,t,i){"use strict";var s=i(130),n=i(991),o=n.extend({getName:function(){return"permalink"},getLabel:function(){return s("Permalink")},getType:function(){return n.TYPE_HREF},getButtonHref:function(){return this.getPostUrl()}});e.exports=o},function(e,t,i){"use strict";var s=i(139),n=i(130),o=i(991),r=o.extend({getName:function(){return"flag"},getLabel:function(){return n("Report")},getType:function(){return o.TYPE_CALLBACK},onClickHandler:function(e){s.trigger("abuseform:open",{mode:"post",post:this.getPostModel()})}});e.exports=r},function(e,t,i){"use strict";var s=i(130),n=i(991),o=i(1002),r=n.extend({
getName:function(){return"embed"},getLabel:function(){return s("Embed")},getType:function(){return n.TYPE_SUBVIEW},getSubviewConstructor:function(){return o},getSubviewOptions:function(){return{embedCode:this.postModel.getEmbedCode()}}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(992),r=i(1003),a=i(236),l=o.extend({tagName:"form",className:"external-network-embed-subview external-network-form-subview",defaults:{embedCode:null},mixins:[a],events:{"click [data-js-embed-code]":"_onEmbedCodeClick"},template:r,getTitle:function(){return n("Embed")},getTemplateData:function(){return{embedCode:this.get("embedCode")}},afterRender:function(){s.defer(s.bind(this.selectEmbedCode,this))},selectEmbedCode:function(){var e=this.js$("embed-code");e.focus(),e.select()},_onEmbedCodeClick:function(e){this.selectEmbedCode()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><textarea spellcheck="false" readonly="readonly" data-js-embed-code class="embed-code textarea" aria-label="'+__e(__("Embed code"))+'">'+__e(embedCode)+"</textarea></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(991),r=i(1005),a=o.extend({getName:function(){return"email"},getLabel:function(){return n("Email")},getType:function(){return o.TYPE_SUBVIEW},getSubviewConstructor:function(){return r},getShareRequestDataFromSubviewData:function(e){var t={message:s.get(e,"message"),email_address:s.get(e,"email")};return s.get(e,"isAllowReply",!1)&&s.extend(t,{allow_reply_to:!0}),t}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(1006),r=i(994),a=i(1007),l=r.extend({className:"external-network-email-subview external-network-form-subview",template:a,events:s.defaults({"input [data-js-email]":"_onEmailInput"},r.prototype.events),getTitle:function(){return n("Email")},afterRender:function(){s.defer(s.bind(this.focus,this)),r.prototype.afterRender.apply(this,arguments)},focus:function(){this.js$("email").focus()},isFormFieldsValid:function(){return o.isEmail(this.js$("email").val())},onFormSubmit:function(e){var t,i,s;this.isFormValid()&&(t=this.js$("email").val(),i=this.js$("message").val(),s=this.js$("allow-reply-checkbox").is(":checked"),this.share({email:t,message:i,isAllowReply:s}))},_onEmailInput:function(e){this.validateForm()}});e.exports=l},function(e,t,i){"use strict";var s=i(8),n={isBlank:function(e){return""===s.trim(e)},minLength:function(e,t){return e.length>=t},maxLength:function(e,t){return e.length<=t},range:function(e,t,i){return e.length>=t&&e.length<=i},pattern:function(e,t){return!!new RegExp(t,"gi").test(e)},isEmail:function(e){return this.pattern(e,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},isUrl:function(e){return this.pattern(e,"^\\s*((https?:)?[/\\\\]+)?([a-z0-9_-]+\\.){1,}([a-z\\.]{2,6})(/[^\\s]*)?\\s*$")},equals:function(e,t){return e===t},isPhoneNumber:function(e){return e&&/^\d+$/.test(e)&&(10===e.length||11===e.length)},isPostalCode:function(e){return e&&/^\d+$/.test(e)&&(5===e.length||9===e.length)}};e.exports=n},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="form-main"><input type="email" data-js-email placeholder="'+__e(__("To email"))+'" class="email input" aria-label="'+__e(__("To email"))+'"><textarea maxlength="255" data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional email message content"))+'"></textarea><label class="reply-option"><span class="binary-switch reply-switch"><input type="checkbox" data-js-allow-reply-checkbox> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span> </span> '+__e(__("Let them reply to my email address"))+' </label></div><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(130),n=i(991),o=i(1009),r=n.extend({defaults:{isPopup:!0,username:null,urlToken:"[URL]"},getName:function(){return"twitter"},getLabel:function(){return s("Twitter")},getType:function(){return this.get("isPopup")?n.TYPE_POPUP:n.TYPE_SUBVIEW},getPopupUrl:function(){var e=this.getPostTinyUrl()||this.getPostUrl();return"https://twitter.com/intent/tweet?url="+encodeURIComponent(e)},getPopupOptions:function(){return"width=550,height=420"},getSubviewConstructor:function(){return o},getSubviewOptions:function(){return{username:this.get("username"),urlToken:this.get("urlToken")}}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(130),o=i(994),r=i(1010),a=i(236),l=o.extend({className:"external-network-twitter-subview external-network-form-subview",template:r,mixins:[a],defaults:s.defaults({username:null,urlToken:"[URL]",shortUrlLength:23,characterLimit:140,characterCount:0,characterCountExceedsLenghClass:"exceeds-length"},o.prototype.defaults),events:s.defaults({"input [data-js-message]":"_onMessageInput"},o.prototype.events),getTitle:function(){var e=this.get("username");return s.isEmpty(e)?n("Twitter"):n("Twitter (@%1$s)",e)},getTemplateData:function(){return{urlToken:this.get("urlToken")}},afterRender:function(){this.listenTo(this,"change:characterCount",this._onChangeCharacterCount),this._updateCharacterCount(),this._onChangeCharacterCount(this,this.get("characterCount")),s.defer(s.bind(this.focus,this)),o.prototype.afterRender.apply(this,arguments)},isFormFieldsValid:function(){var e=this.get("characterCount");return e>0&&e<=this.get("characterLimit")},onFormSubmit:function(e){this.isFormValid()&&this.share({message:this._getMessage()})},focus:function(){this.js$("message").focus()},_getMessage:function(){return this.js$("message").val()},_updateCharacterCount:function(){var e=this._calculateCharacterCount(this._getMessage());this.set("characterCount",e)},_updateCharacterCountContainer:function(e){var t=this.js$("character-count"),i=this.get("characterCountExceedsLenghClass"),s=this.get("characterLimit")-e;t.text(s).toggleClass(i,s<0)},_getUrlTokenCountFromMessage:function(e){var t=this.get("urlToken"),i=new RegExp(s.escapeRegExp(t),"ig"),n=e.match(i);return s.isEmpty(n)?0:n.length},_getAdditionalUrLengthFromMessage:function(e){var t=this.get("urlToken"),i=this.get("shortUrlLength"),s=this._getUrlTokenCountFromMessage(e);return 0===s?0:s*i-s*t.length},_calculateCharacterCount:function(e){return e.length+this._getAdditionalUrLengthFromMessage(e)},_onChangeCharacterCount:function(e,t){this._updateCharacterCountContainer(t)},_onMessageInput:function(e){this._updateCharacterCount(),this.validateForm()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<form class="form-main"><textarea data-js-message placeholder="'+__e(__("Message (Optional)"))+'" class="message textarea" aria-label="'+__e(__("Optional Twitter message content"))+'"> '+__e(urlToken)+'</textarea></form><div class="form-result form-result--fail" data-js-fail-container> '+__e(__("Something went screwy."))+' </div><footer class="footer"><button type="submit" class="button tx-button blue" data-js-submit-button data-js-text-sending="'+__e(__("Sending..."))+'">'+__e(__("Send"))+'</button><div data-js-character-count class="character-count"></div></footer><div class="form-result form-result--success" data-js-success-container> '+__e(__("Post shared!"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="networkView[]"></div><div data-subview="networksLoaderView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(1013),r=i(236),a=i(191),l=n.extend({className:"messaging-share-post-external-network-subview-wrapper",template:o,mixins:[r,a],events:{"click [data-js-back-button]":"_onBackButtonClick"},keycommands:{"keydown:escape":"_onKeyPressEscape"},initialize:function(e){s.extend(this.attributes,s.pick(e,s.keys(this.defaults))),s.extend(this,s.pick(e,"externalNetworkSubview"))},getTemplateData:function(){return{title:this.externalNetworkSubview.getTitle()}},afterRender:function(){this.externalNetworkSubview.render(),this.listenTo(this.externalNetworkSubview,"changeTitle",this._onSubviewChangeTitle),this.listenToOnce(this.externalNetworkSubview,"close",this._onSubviewClose),this.js$("external-network-subview").html(this.externalNetworkSubview.$el)},goBack:function(){this.trigger("goBack")},close:function(){this.trigger("close")},remove:function(){return this.externalNetworkSubview.remove(),n.prototype.remove.apply(this,arguments)},_onSubviewChangeTitle:function(e){this.js$("title").text(e)},_onSubviewClose:function(){this.close()},_onBackButtonClick:function(e){e.preventDefault(),this.goBack()},_onKeyPressEscape:function(e){e.preventDefault(),this.externalNetworkSubview.isShareSuccess()?this.close():this.goBack()}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="header"><a href="#" data-js-back-button class="back-button">'+__e(__("Back"))+'</a><div data-js-title class="title">'+__e(title)+'</div></div><div class="external-network-subview" data-js-external-network-subview></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(236),r=i(1015),a=n.extend({className:"messaging-share-post-error",mixins:[o],template:r,defaults:{title:null},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)))},setTitle:function(e){this.set("title",e)},getTemplateData:function(){return{title:this.get("title")}},afterRender:function(){this.listenTo(this,"change:title",this._onChangeTitle)},_onChangeTitle:function(e,t){this.js$("title").text(t)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<p data-js-title>"+__e(title)+"</p>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(760),o=i(605),r=n.extend({className:"conversation-compose-plugin conversation-compose-plugin--blog-selector",defaults:s.defaults({currentTumblelog:null},n.prototype.defaults),renderWithTemplate:s.noop,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,s.pick(e,s.keys(this.defaults)));var t=s.extend({className:"conversation-compose-plugin-blog-selector",showName:!1,showCaret:!1},s.pick(e,"collection","currentTumblelog","popoverOptions"));this.blogSelectorView=new o(t)},afterRender:function(){this.blogSelectorView.render(),this.$el.html(this.blogSelectorView.el)},getName:function(){return"blog-selector"},getBlogSelector:function(){return this.blogSelectorView}});e.exports=r},function(e,t,i){"use strict";var s=i(143),n=s.extend({defaults:{participant:null}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(143),o=n.extend({url:function(){return"/svc/post/share/"+this.get("tumblelog_name")+"/"+this.get("post_id")},defaults:{post_id:null,tumblelog_name:null,twitter_username:null,has_facebook:null,pinterest_share_window:null,show_pinterest:null,post_url:null},parse:function(e){return s.get(e,"response.share_popover_data",e)},isValid:function(){return!s.isEmpty(this.get("post_id"))&&!s.isEmpty(this.get("tumblelog_name"))},isPopulated:function(){return!s.isEmpty(this.get("post_url"))}});e.exports=o},,,,,,,,,,,,,,function(e,t,i){"use strict";var s=i(185),n=i(130),o=i(1033),r=s.extend({className:"overlay",template:o,getTemplateData:function(){return{messageText:n("This Tumblr may contain sensitive media."),linkText:n("Safe Mode is on")}}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="overlay-wrapper post_content"><div class="post_content_inner safemode"><p><span class="message">'+__e(messageText)+'</span><br><a class="link" href="/settings/account" target="_blank" data-js-theme-accent-color>'+__e(linkText)+"</a></p></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(173),r=i(139),a=i(579),l=i(580),c=i(1035),u=i(1037),h=o.extend({name:"AskComponent",initialize:function(e){e=e||{},this.user=e.user,this.user&&(this.blog=this.user.getChannel(),this.question=new u({recipient:null,anonymous:!1,question:""}),this.listenTo(r,"ask:form:open",this.presentAskForm),this.listenTo(this.question,"save:success",this.onSaveSuccess))},presentAskForm:function(e){return this.askFormView?this:(this.question.set("recipient",e.recipient),s("body").addClass("postforms-open"),r.trigger("drawer:suspend"),r.trigger("keycommands:suspend"),this.glass=new a,this.modal=new l,this.askFormView=new c({model:this.question,characterLimit:500,recipient:{name:e.recipient,allowAnonymous:e.allow_anonymous},sender:this.blog}),this.askFormView.render(),this.modal.setContentSubView(this.askFormView),this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this.glass.show().then(n.bind(this.modal.show,this.modal)),this.listenTo(this.askFormView,"close",this.dismissAskForm),this.listenTo(this.askFormView,"submit",this.submit),this)},beforeRemove:function(){this.dismissAskForm()},dismissAskForm:function(){this.askFormView&&(this.stopListening(this.askFormView),this.modal.hide(),this.modal.remove(),this.modal=null,this.glass.hide(),this.glass.remove(),this.glass=null,this.askFormView.remove(),this.askFormView=null,r.trigger("keycommands:resume"),r.trigger("drawer:resume"),r.trigger("ask:form:hidden"),s("body").removeClass("postforms-open"))},submit:function(e){this.question.set("anonymous",!!e.anonymous),this.question.set("question",e.question),this.question.save()},onSaveSuccess:function(){r.trigger("ask:form:success"),this.dismissAskForm()}});e.exports=h},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(209),r=i(185),a=i(191),l=i(236),c=i(1036),u=r.extend({className:"ask-form",template:c,mixins:[a,l],keycommands:{"keydown:enter":"preventNewlines","keydown:escape":"dismiss"},events:{"click button.close":"dismiss","change .ask-anonymously-switch":"toggleAnonymous","submit form":"submit","input .ask-question":"onTextAreaUpdate"},initialize:function(e){this.characterLimit=e.characterLimit,this.sender=e.sender,this.recipient=e.recipient,this.onTextAreaUpdate=n.throttle(n.bind(this.onTextAreaUpdate,this),100),this.listenTo(this.model,"change:isSaving",this.toggleSubmit),this.listenTo(this.model,"save:success",this.render),this.listenTo(this.model,"save:error",this.displayErrors)},getTemplateData:function(){var e={};return e.recipient=n.clone(this.recipient)||{},e.recipient.allow_anonymous=e.recipient.allowAnonymous,e.sender=this.sender.toJSON(),e.sender.avatar_url=o(this.sender.get("avatar_url"))(128),e.character_limit=this.characterLimit,e},dismiss:function(){this.trigger("close")},toggleSubmit:function(e,t){t?this.disableSubmit():this.enableSubmit()},toggleAnonymous:function(e){var t=this.$(e.target);this.isAnonymous=t.prop("checked");var i=this.$$(".post_avatar_link"),s=this.$$(".ask-from .tumblelog_name"),n=this.$$(".ask-from .anonymous");this.isAnonymous?(i.removeClass("use_blog_avatar"),s.hide(),n.show()):(i.addClass("use_blog_avatar"),s.show(),n.hide())},submit:function(e){e.preventDefault(),this.trigger("submit",{question:this.$$(".ask-question").val(),anonymous:this.isAnonymous})},preventNewlines:function(e){e.preventDefault()},onTextAreaUpdate:function(){var e=this.$$(".ask-question").val(),t=e;e.match(/\n/g)&&(e=e.replace(/\n/g,""));var i=n.trim(e).length;0<i&&i<=this.characterLimit?this.enableSubmit():this.disableSubmit(),e!==t&&this.$$(".ask-question").val(e);var s=this.characterLimit-e.length,o=this.$$(".ask-character-count");o.text(s),s<=100?(o.addClass("active"),o.removeClass("count-ok count-warning count-danger"),s>40?o.addClass("count-ok"):s>20?o.addClass("count-warning"):o.addClass("count-danger")):o.removeClass("active")},enableSubmit:function(){this.model.get("isSaving")||this.$$(".ask-button").prop("disabled",!1)},disableSubmit:function(){this.$$(".ask-button").prop("disabled",!0)},showMessages:function(e,t){var i=this.$$("."+e),o=i.get(0);o&&(i.removeClass("active").hide().empty(),"string"==typeof t&&(t=[t]),n.each(t,n.bind(function(e){var t=s("<li/>",{text:e});i.append(t)},this)),i.show(),n.defer(function(){i.addClass("active")}))},displayErrors:function(e){this.showMessages("errors-ask",e)}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="post_form_wrapper v_center_el"><div class="post_avatar"><a class="post_avatar_link use_blog_avatar animating" data-user-avatar-url="'+__e(sender.avatar_url)+'" data-avatar-url="'+__e(sender.avatar_url)+'" data-blog-url="'+__e(sender.blog_url)+'"><span class="post_avatar_link blog_avatar anonymous" data-anonymous-avatar-url="/images/anonymous_avatar_64.gif" style="background-image: url(/images/anonymous_avatar_64.gif)"></span> <span class="post_avatar_link blog_avatar new" style="background-image: url('+__e(sender.avatar_url)+')"></span></a></div><div class="post-container"><form enctype="multipart/form-data" class="active"><div class="post-container-inner post post-form--asks"><div class="post-form--header"><div class="controls-container"> ';var senderMarkup='<span class="ask-from"><span class="tumblelog_name">'+sender.name+'</span><span class="anonymous">'+__("anonymous")+"</span></span>",recipientMarkup='<span class="ask-recipient-label">'+recipient.name+"</span>";if(__p+=" "+(null==(__t=__('%1$s <span class="ask-to-label">to</span> %2$s',senderMarkup,recipientMarkup))?"":__t)+' <span class="ask-character-count"></span></div></div><div class="post-form--form post-content-text"><textarea class="ask-question" name="question" placeholder="'+__e(__("Ask me anything"))+'" maxlength="'+__e(character_limit)+'" autofocus></textarea></div><div class="post-form--bottom"><div class="post-form--controls"><div class="controls-container"><div class="control left"><button type="button" class="chrome flat close">'+__e(__("Close"))+"</button></div> ",recipient.allow_anonymous){__p+=' <div class="control right"><div class="ask-anonymously"> ';var randId=Math.floor(1e6*Math.random());__p+=' <label class="binary_switch"><input id="ask_anonymously_switch_'+__e(randId)+'" class="ask-anonymously-switch" type="checkbox" name="anonymous" value="1"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="ask-anonymously-label" for="ask_anonymously_switch_'+__e(randId)+'">'+__e(__("Ask anonymously"))+"</label></div></div> "}__p+=' <div class="control right"><button class="chrome blue ask-button" type="submit" disabled="disabled">'+__e(__("Ask"))+'</button></div></div></div><ul class="post-form--error-bar messages errors-ask"></ul></div></div></form></div></div>'}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(143),n=i(3),o=i(130),r=s.extend({urlRoot:"/svc/post/ask",validate:function(e){return n.trim(e.question)?this.isUrl(e.question)?{error:o("Sorry, but please don't include links in questions.")}:void 0:{error:o("You need to enter a question!")}},isUrl:function(e){return!!(e.match(/(http|https):\/\//i)||e.match(/www\./i)||e.match(/[a-zA-Z0-9]+(\.arpa|\.root|\.aero|\.biz|\.cat|\.com|\.coop|\.edu|\.gov|\.info|\.int|\.jobs|\.mil|\.mobi|\.museum|\.name|\.net|\.org|\.pro|\.travel|TLD|\.ac|\.ad|\.ae|\.af|\.ag|\.ai|\.al|\.am|\.an|\.ao|\.aq|\.ar|\.as|\.at|\.au|\.aw|\.ax|\.az|\.ba|\.bb|\.bd|\.be|\.bf|\.bg|\.bh|\.bi|\.bj|\.bm|\.bn|\.bo|\.br|\.bs|\.bt|\.bv|\.bw|\.by|\.bz|\.ca|\.cc|\.cd|\.cf|\.cg|\.ch|\.ci|\.ck|\.cl|\.cm|\.cn|\.co|\.cr|\.cu|\.cv|\.cx|\.cy|\.cz|\.de|\.dj|\.dk|\.dm|\.do|\.dz|\.ec|\.ee|\.eg|\.er|\.es|\.et|\.eu|\.fi|\.fj|\.fk|\.fm|\.fo|\.fr|\.ga|\.gb|\.gd|\.ge|\.gf|\.gg|\.gh|\.gi|\.gl|\.gm|\.gn|\.gp|\.gq|\.gr|\.gs|\.gt|\.gu|\.gw|\.gy|\.hk|\.hm|\.hn|\.hr|\.ht|\.hu|\.id|\.ie|\.il|\.im|\.in|\.io|\.iq|\.ir|\.is|\.it|\.je|\.jm|\.jo|\.jp|\.ke|\.kg|\.kh|\.ki|\.km|\.kn|\.kr|\.kw|\.ky|\.kz|\.la|\.lb|\.lc|\.li|\.lk|\.lr|\.ls|\.lt|\.lu|\.lv|\.ly|\.ma|\.mc|\.md|\.mg|\.mh|\.mk|\.ml|\.mm|\.mn|\.mo|\.mp|\.mq|\.mr|\.ms|\.mt|\.mu|\.mv|\.mw|\.mx|\.my|\.mz|\.na|\.nc|\.ne|\.nf|\.ng|\.ni|\.nl|\.no|\.np|\.nr|\.nu|\.nz|\.om|\.pa|\.pe|\.pf|\.pg|\.ph|\.pk|\.pl|\.pm|\.pn|\.pr|\.ps|\.pt|\.pw|\.py|\.qa|\.re|\.ro|\.ru|\.rw|\.sa|\.sb|\.sc|\.sd|\.se|\.sg|\.sh|\.si|\.sj|\.sk|\.sl|\.sm|\.sn|\.so|\.sr|\.st|\.su|\.sv|\.sy|\.sz|\.tc|\.td|\.tf|\.tg|\.th|\.tj|\.tk|\.tl|\.tm|\.tn|\.to|\.tp|\.tr|\.tt|\.tv|\.tw|\.tz|\.ua|\.ug|\.uk|\.um|\.us|\.uy|\.uz|\.va|\.vc|\.ve|\.vg|\.vi|\.vn|\.vu|\.wf|\.ws|\.ye|\.yt|\.yu|\.za|\.zm|\.zw)/i))},save:function(e,t){t=t||{};var i=t.success,o=t.error;t.success=n.bind(function(e,t){if(n.isEmpty(n.result(t.response,"errors")))this.trigger("save:success"),i&&i.call(null,e,t);else{var s=t.response.errors[0];this.trigger("save:error",s),o&&o.call(null,e,s)}this.set("isSaving",!1)},this),t.error=n.bind(function(e,t){this.trigger("save:error",t),o&&o.call(null,e,t)},this),this.set("isSaving",!0);var r=s.prototype.save.call(this,e,t);!r&&this.validationError&&(this.trigger("save:error",this.validationError.error),this.set("isSaving",!1))}});e.exports=r},function(e,t,i){"use strict";var s=i(173),n=i(1039),o=s.extend({name:"MobileNav",autoAppend:!0,view:function(){if(this.data)return new n(this.data)}});e.exports=o},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(178),r=i(139),a=i(138),l=i(137),c=i(235),u=i(189),h=i(1040),d=i(1041),p=i(1049),g=i(1059),_=o.extend({className:"mobile-header",mixins:[c,u],template:h,defaults:{logged_in:!1},initialize:function(e){e=n.extend({},e),n.extend(this.attributes,n.pick(e,n.keys(this.defaults))),this.subViews.logoTitle=new d(e),this.subViews.navMenu=new p(e),l.bool("mobile_web_sticky_header")&&this.setSticky(),this.subViews.search=new g(e)},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},setSticky:function(){s("body").addClass("sticky-header"),this.lastPosition=a.rect().windowScrollTop,this.listenTo(r,"DOMEventor:flatscroll",this.getScrollDirection)},getScrollDirection:function(e){e.windowScrollTop>45?n.delay(n.bind(function(){this.$el.addClass("sticky")},this),500):this.$el.removeClass("sticky"),this.lastPosition<e.windowScrollTop&&e.windowScrollTop>45?this.$el.addClass("hide-nav"):this.$el.removeClass("hide-nav"),this.lastPosition=e.windowScrollTop}});e.exports=_},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div data-subview="navMenu"></div><div data-subview="logoTitle"></div><div data-subview="search"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(137),r=i(235),a=i(189),l=i(1042),c=i(1043),u=i(1045),h=i(1047),d=n.extend({className:"nav-logo-title",mixins:[r,a],template:l,initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.subViews.logo=new c,o.bool("mobile_web_page_titles")&&this.get("page_title")&&this.get("logged_in")&&!this.get("search_term")?(this.subViews.pageTitle=new u(e),this.set("show_page_title",!0)):this.set("show_page_title",!1),this.set("show_search_field",!!this.get("search_term")),this.subViews.searchField=new h(e)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<div class="mobile-logo-wrapper',show_page_title&&(__p+=" show-page-title "),__p+=" ",!_.isUndefined(show_search_field)&&show_search_field&&(__p+=" show-search-field "),__p+='"><div data-subview="logo"></div><div data-subview="pageTitle"></div><div data-subview="searchField"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(178),n=i(1044),o=s.extend({template:n,className:"mobile-logo",render:function(){return this.$el.html(this.template()),this}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<a href="/" class="logo-link"><svg class="svg-logo" width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path class="inner" d="M13.4404585,32.9978573 L13.1859215,33 C5.40091922,33 3.7112324,27.2768093 3.7112324,23.9359304 L3.7112324,14.6527709 L0.644574576,14.6527709 C0.288572835,14.6527709 0,14.3641866 0,14.0082147 L0,9.6266323 C0,9.1644545 0.291787135,8.7523442 0.72736069,8.5979279 C4.72423734,7.1880393 5.97738627,3.70267176 6.16328007,1.05159549 C6.21292323,0.34336573 6.58403216,0 7.20071368,0 L11.7729503,0 C12.1289164,0 12.4175249,0.28854863 12.4175249,0.64452051 L12.4175249,8.0664341 L17.7675867,8.0664341 C18.1235885,8.0664341 18.4121613,8.3550185 18.4121613,8.7109547 L18.4121613,13.9746459 C18.4121613,14.3306178 18.1235885,14.6191665 17.7675867,14.6191665 L12.3906676,14.6191665 L12.3906676,23.2008456 C12.3906676,25.3559968 13.8110674,25.9521997 14.6886074,25.9521997 C15.5299686,25.9319513 16.3586512,25.6757572 16.7738319,25.5090561 C17.0821548,25.3853159 17.3529775,25.3033938 17.595693,25.3640676 C17.8213012,25.420456 17.9700163,25.5802291 18.0701239,25.8719917 L19.4885237,30.0155572 C19.6024885,30.3446026 19.702489,30.70361 19.464595,30.9576614 C18.3476967,32.1504243 15.7600055,32.9595389 13.4404585,32.9978573 L13.4404585,32.9978573 Z"></path></svg></a>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(189),r=i(1046),a=n.extend({template:r,className:"page-title",mixins:[o],initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e)},render:function(){return this.$el.html(this.template(this.toJSON())),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+=__e(page_title);return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(139),r=i(189),a=i(1048),l=i(432),c=n.extend({template:a,className:"search-field",mixins:[r],events:{"submit form":"__submitForm"},__submitForm:function(){this.toggleLoader(!0)},__handleSearchClick:function(){var e=this.$searchInput.val();this.$el.hasClass("search-term-exists")?e===this.get("search_term")?this.setFocus():this.$submitForm.trigger("submit"):!e&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.hideSearchField():e&&this.$mobileLogoWrapper.hasClass("show-search-field")?this.$submitForm.trigger("submit"):this.showSearchField()},__handleNsfwFilterClick:function(e){this.$searchNsfwFilterInput.val(e),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},__handleFilterChange:function(e){var t="top";"CREATED_DESC"===e.get("sort")&&(t="recent");var i=e.get("post_type").toLowerCase();this.$searchFilterSortInput.val(t),this.$searchFilterPostTypeInput.val(i),this.$searchNsfwFilterInput.val(e.get("filter_nsfw")),this.$submitForm.prop("action","/search/"+this.get("search_term")),this.$searchInput.prop("name",""),this.$submitForm.trigger("submit")},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.listenTo(o,"mobileHeader:search:click",this.__handleSearchClick),this.listenTo(o,"mobileHeader:nsfw:update",this.__handleNsfwFilterClick),this.listenTo(o,"mobileHeader:filter:update",this.__handleFilterChange),this.listenTo(o,"drawer:open",this.hideSearchField)},render:function(){return this.get("search_term")&&this.$el.addClass("search-term-exists"),this.$el.html(this.template(this.toJSON())),this.$searchInput=this.$(".search-input"),this.$searchNsfwFilterInput=this.$(".search-nsfw-filter-input"),this.$searchFilterSortInput=this.$(".filter-sort-input"),this.$searchFilterPostTypeInput=this.$(".filter-post-type-input"),this.$submitForm=this.$("form"),this.$mobileLogoWrapper=this.$el.parent(),this},toggleLoader:function(e){e?this.loader?this.loader.set("loading",!0):this.loader=new l({$container:this.$el,type:"bar",classModifiers:"top",loading:!0}):this.loader.set("loading",!1)},showSearchField:function(){this.$mobileLogoWrapper.addClass("show-search-field"),s.delay(s.bind(this.setFocus,this),250)},hideSearchField:function(){this.$searchInput.blur(),this.$mobileLogoWrapper.removeClass("show-search-field")},setFocus:function(){var e=2*this.$searchInput.val().length;this.$searchInput.focus(),this.$searchInput.get(0).setSelectionRange(e,e)}});e.exports=c},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<form action="/search" method="get"><input type="text" placeholder="'+__e(__("Search Tumblr"))+'" autocomplete="off" class="search-input" id="search-input" name="q" value="',search_term&&(__p+=__e(search_term)),__p+='"> <input type="hidden" class="search-nsfw-filter-input" name="filter_nsfw"> <input type="hidden" class="filter-sort-input" name="sort" value="top"> <input type="hidden" class="filter-post-type-input" name="filter_post_type" value="any"> '+(null==(__t=_subview("loader"))?"":__t)+" </form>";
return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(178),r=i(235),a=i(189),l=i(139),c=i(1050),u=i(1051),h=i(1057),d=o.extend({className:"nav-menu",template:c,mixins:[r,a],events:{"click .menu-burger":"__clickMenuBurger","click [data-subnav]":"__clickSubnav","click .sneeze-guard":"__clickSneezeGuard"},__clickSneezeGuard:function(e){e.preventDefault(),this.closeDrawer()},__clickSubnav:function(e){e.preventDefault(),this.openSubNav(n(e.currentTarget).data("subnav"))},__clickMenuBurger:function(e){e.preventDefault(),this.toggleDrawer()},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.get("drawer_open")&&this.openDrawer(),this.get("logged_in")?this.subViews.drawer=new u(e):this.subViews.drawer=new h(e),this.listenTo(l,"mobileHeader:search:click",this.closeDrawer)},render:function(){return this.$el.html(this.template()),this.$body=n("body"),this.$html=n("html"),this.attachSubViews(),this},toggleDrawer:function(){this.$el.hasClass("subnav-active")?this.closeSubNav():this.get("drawer_open")?this.closeDrawer():this.openDrawer()},openDrawer:function(){this.set("drawer_open",!0),this.$body.addClass("nav-drawer-open"),this.$html.addClass("nav-drawer-open"),this.$el.addClass("active"),l.trigger("drawer:open")},closeDrawer:function(){this.set("drawer_open",!1),this.$body.removeClass("nav-drawer-open"),this.$html.removeClass("nav-drawer-open"),this.$el.removeClass("active subnav-active"),l.trigger("drawer:closed")},openSubNav:function(e){this.$el.addClass("subnav-active"),l.trigger("drawer:subnav:open",e)},closeSubNav:function(){this.$el.removeClass("subnav-active"),l.trigger("drawer:subnav:close")}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="menu-burger"><div class="burger bun top"></div><div class="burger patty"></div><div class="burger bun bottom"></div></div><div class="drawer" data-subview="drawer"></div><div class="sneeze-guard"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(189),r=i(235),a=i(1052),l=i(1053),c=i(1055),u=n.extend({template:a,mixins:[r,o],className:"drawer logged-in",initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.subViews.primaryNav=new l(e),this.subViews.secondaryNav=new c(e)},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="nav-wrapper"><div data-subview="primaryNav"></div><div data-subview="secondaryNav"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(189),r=i(1054),a=n.extend({template:r,mixins:[o],className:"primary-nav",initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e)},render:function(){return this.$el.html(this.template(this.toJSON())),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<nav class="nav-site-sections"><a href="/dashboard" class="nav-item with-icon"><span class="nav-text nav-item-dashboard">'+__e(__("Dashboard"))+'</span></a><a href="/likes" class="nav-item with-icon"><span class="nav-count">',parseInt(likes,10)>0&&(__p+=__e(likes)),__p+=' </span><span class="nav-text nav-item-likes">'+__e(__("Likes"))+'</span></a><a href="/following" class="nav-item with-icon"><span class="nav-count">'+__e(following)+'</span><span class="nav-text nav-item-following">'+__e(__("Following"))+'</span></a><a href="/settings" class="nav-item with-icon" data-subnav="settings"><span class="nav-text nav-item-settings has-subnav">'+__e(__("Settings"))+'</span></a><a href="'+__e(url_prefix)+'/new/text" class="nav-item with-icon"><span class="nav-text nav-item-create-post">'+__e(__("Create a post"))+'</span></a></nav><nav class="nav-blog-list"><span class="nav-section-title">'+__e(__("Blogs"))+"</span> ",_.each(blogs,function(e){__p+=' <a href="'+__e(e.url)+'" class="nav-item"><img src="'+__e(e.avatar)+'" class="blog-avatar"><div class="blog-name-wrapper"><span class="blog-name">'+__e(e.name)+'</span><span class="blog-title">'+(null==(__t=e.safe_title)?"":__t)+"</span></div></a> "}),__p+=" </nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(189),r=i(139),a=n.extend({mixins:[o],className:"secondary-nav",templates:{settings:i(1056)},_getTemplate:function(e){if("settings"===e)return this.templates.settings(this.toJSON())},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.listenTo(r,"drawer:subnav:open",this.render)},render:function(e){return e&&this.$el.html(this._getTemplate(e)),this}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<nav class="nav-site-sections"><a href="/settings/password" class="nav-item"><span class="nav-text">'+__e(__("Change Password"))+'</span></a><a href="/settings/tfa" class="nav-item"><span class="nav-text">'+__e(__("Two Factor Authentication"))+'</span></a><a href="/help" class="nav-item"><span class="nav-text">'+__e(__("Help"))+'</span></a><a href="/settings/account" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Account"))+'</span></a><a href="/settings/notifications" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Notifications"))+'</span></a><a href="/settings/apps" class="nav-item" target="_blank"><span class="nav-text desktop-view">'+__e(__("Apps"))+"</span></a></nav>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(189),r=i(139),a=i(1058),l=n.extend({template:a,mixins:[o],className:"drawer logged-out",initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.listenToOnce(r,"drawer:open",this.downloadBackground)},downloadBackground:function(){var e=new Image,t=this.$splashBg.data("img-src");e.onload=s.bind(function(){this.$splashBg.css("background-image","url("+t+")"),this.$splashBg.addClass("loaded")},this),e.src=t},render:function(){return this.$el.html(this.template(this.toJSON())),this.$splashBg=this.$(".splash-bg"),this}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="splash-bg" data-img-src="'+__e(splash.image)+'"></div><div class="splash-sections"><div class="splash-section top"><a href="/login" class="splash-login">'+__e(__("Log in"))+'</a></div><div class="splash-section middle"><div class="middle-inner"><span class="splash-pitch">'+__e(__("Splash headline"))+'</span><a href="/register" class="signin tx-button blue" role="button">'+__e(__("Get started"))+"</a> ",has_app&&(__p+='<a href="'+__e(app_url)+'" class="tx-button get-the-app" role="button">'+__e(__("Get the app"))+"</a>"),__p+=' </div></div><div class="splash-section bottom"><a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-avatar" style="background-image:url('+__e(splash.avatar)+')"></a> <a href="'+__e(splash.url)+'" target="_blank" rel="nofollow" class="splash-name">'+__e(__("Posted by"))+"&nbsp;<strong>"+__e(splash.name)+"</strong></a></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(139),o=i(178),r=i(235),a=i(189),l=i(1060),c=i(1061),u=i(1063),h=i(1068),d=o.extend({className:"nav-search",mixins:[r,a],template:l,events:{"click .search-label":"__searchLabelClick","click .filter-icon":"__filterIconClick"},__searchLabelClick:function(){n.trigger("mobileHeader:search:click")},togglePopover:function(){this.popover||(this.popover=new u({pinnedTarget:this.subViews.filterIcon.$el,model:this.model}),this.popover.render(),this.listenTo(this.popover,"close",this.onPopoverClose))},onPopoverClose:function(){s.defer(s.bind(function(){this.popover=null},this))},__filterIconClick:function(){this.togglePopover()},onFilterChange:function(e){n.trigger("mobileHeader:filter:update",e),this.popover.hide()},bindEvents:function(){this.model&&(this.listenTo(this.model,"change:sort",this.onFilterChange),this.listenTo(this.model,"change:post_type",this.onFilterChange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterChange))},initialize:function(e){e=s.extend({},e),s.extend(this.attributes,e),this.get("logged_in")&&(this.subViews.filterIcon=new c,this.model=new h({showOriginalPostsSwitch:!1,showNsfwSwitch:!0,sort:this.get("filter_sort").toUpperCase(),post_type:this.get("filter_post_type").toUpperCase(),filter_nsfw:this.get("filter_nsfw")}),this.bindEvents())},render:function(){return this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this},teardown:function(){this.popover&&this.popover.teardown()}});e.exports=d},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<span class="toggle-filter"><div data-subview="filterIcon"></div><div data-subview="filters"></div></span><span class="search-label" for="search-input"></span>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(185),n=i(1062),o=s.extend({template:n,className:"filter-icon",render:function(){return this.$el.html(this.template()),this}});e.exports=o},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(1064),n=i(1066),o=s.extend({className:s.prototype.className+" blog-search-filters-popover",Subview:n});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(179).transition,r=i(243),a=i(235),l=i(242),c=i(191),u=i(1065),h=n.extend({className:"popover--blog-search",mixins:[a,l,c],template:u,keycommands:{"keydown:down":"targetNextLi","keydown:tab":"targetNextLi","keydown:up":"targetPrevLi","keydown:shift+tab":"targetPrevLi","keyup:enter":"selectLi"},defaults:{keycommands:!1,keyboardFocusClass:"keyboard_focus"},initialize:function(e){return this.options=s.defaults(e,this.defaults),this.Subview?(this.subview=new this.Subview(e),void this.bindEvents()):void this.remove()},render:function(){return this.$el.html(this.template()),this.$(".popover_inner").append(this.subview.render().$el),this.$main=this.$el.find(".popover"),s.delay(s.bind(function(){this.$main.addClass("popover--active"),this.bindClickOutside()},this),1),this},bindEvents:function(){this.listenTo(this.subview,"remove",this.hide),this.options.keycommands||this.disableKeys()},bindClickOutside:function(){this._popoverBase.autoTeardown&&(this.clickOutside=new r(this.el),this.clickOutside.on("click:outside",this.hide,this))},unbindClickOutside:function(){this.clickOutside&&(this.clickOutside.remove(),this.clickOutside=null)},targetNextLi:function(e){e.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.next().length?this.$active.next():this.$(".popover_menu_item").first()):this.$active=this.$(".popover_menu_item").first(),this.$active.addClass(this.options.keyboardFocusClass),this.scrollToActive()},targetPrevLi:function(e){e.preventDefault(),this.$active?(this.$active.removeClass(this.options.keyboardFocusClass),this.$active=this.$active.prev().length?this.$active.prev():this.$(".popover_menu_item").last()):this.$active=this.$(".popover_menu_item").last(),this.$active.addClass(this.options.keyboardFocusClass),this.scrollToActive()},selectLi:function(){this.$active&&this.trigger("itemSelected",this.$active)},scrollToActive:function(){this.$scrollable=this.$scrollable||this.$(".popover_inner"),this.$scrollable.scrollTop(this.$scrollable.scrollTop()+this.$active.position().top-this.$scrollable.height()+this.$active.outerHeight())},hide:function(){this.$main.removeClass("popover--active"),this.unbindClickOutside(),o(this.$el,s.bind(function(){this.subview.remove(),this.remove(),this.teardown()},this))}});e.exports=h},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"></div></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(185),o=i(1067),r=n.extend({template:o,events:{"click [data-filter]":"onFilterClick","click .sort_filter.toggle":"onToggleFilterClick","click .option-radio":"onCheckboxClick","change [type=checkbox]":"onCheckboxChange"},initialize:function(){this.bindEvents()},afterRender:function(){this.onPostTypeChange(),this.onSortChange(),this.onPostRoleChange(),this.onFilterNsfwChange()},bindEvents:function(){this.listenTo(this.model,"change:sort",this.onSortChange),this.listenTo(this.model,"change:post_type",this.onPostTypeChange),this.listenTo(this.model,"change:post_role",this.onPostRoleChange),this.listenTo(this.model,"change:filter_nsfw",this.onFilterNsfwChange)},onPostRoleChange:function(){this.$("#post_role").prop("checked",this.model.get("post_role")!==this.model.defaults.post_role)},onPostTypeChange:function(){this.$(".post_type_filter.active").removeClass("active"),this.$('[data-filter="post_type:'+this.model.get("post_type")+'"]').addClass("active")},onFilterNsfwChange:function(){this.$(".search-nsfw-filter-checkbox-input").prop("checked",this.model.get("filter_nsfw")!==this.model.defaults.filter_nsfw)},onSortChange:function(){this.$(".sort_filter.active").removeClass("active"),this.$('[data-filter="sort:'+this.model.get("sort")+'"]').addClass("active")},onFilterClick:function(e){var t=s(e.currentTarget).data("filter").split(":");this.model.set(t[0],t[1])},onCheckboxChange:function(e){var t=s(e.currentTarget),i=e.currentTarget.id,n=t.data("value"),o=t.prop("checked");this.model.set(i,o?n:this.model.defaults[i])},onCheckboxClick:function(e){e.stopPropagation()},onToggleFilterClick:function(e){var t=s(e.currentTarget).find("[type=checkbox]"),i=t.prop("checked");t.prop("checked",!i).trigger("change")}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter" data-filter="sort:POPULARITY_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Top Posts"))+' </span></li><li class="popover_menu_item sort_filter" data-filter="sort:CREATED_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("Recent Posts"))+" </span></li></ul> ",model.showOriginalPostsSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="post_role" id="post_role" data-value="ORIGINAL"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Original Posts"))+" </span></li></ul> "),__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item post_type_filter" data-filter="post_type:ANY"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> '+__e(__("All Types"))+' </span></li><li class="popover_menu_item post_type_filter post_text_filter" data-filter="post_type:TEXT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_text_small"></i> '+__e(__("Text"))+' </span></li><li class="popover_menu_item post_type_filter post_photo_filter" data-filter="post_type:PHOTO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_photo_small"></i> '+__e(__("Photo"))+' </span></li><li class="popover_menu_item post_type_filter post_quote_filter" data-filter="post_type:QUOTE"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_quote_small"></i> '+__e(__("Quote"))+' </span></li><li class="popover_menu_item post_type_filter post_link_filter" data-filter="post_type:LINK"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_link_small"></i> '+__e(__("Link"))+' </span></li><li class="popover_menu_item post_type_filter post_chat_filter" data-filter="post_type:CHAT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_chat_small"></i> '+__e(__("Chat"))+' </span></li><li class="popover_menu_item post_type_filter post_audio_filter" data-filter="post_type:AUDIO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_audio_small"></i> '+__e(__("Audio"))+' </span></li><li class="popover_menu_item post_type_filter post_video_filter" data-filter="post_type:VIDEO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_video_small"></i> '+__e(__("Video"))+" </span></li></ul> ",model.showNsfwSwitch&&(__p+=' <ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="filter_nsfw" id="filter_nsfw" data-value="true" class="search-nsfw-filter-checkbox-input"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div> '+__e(__("Safe search"))+" </span></li></ul> ");return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(139),o=i(143),r=i(148),a=o.extend({urlRoot:"/svc/search/blog_search",defaults:{next_offset:0,limit:10,sort:"CREATED_DESC",post_type:"ANY",term:"",unsetTerm:"",post_role:"ANY",filter_nsfw:!1,showOriginalPostsSwitch:!0,showNsfwSwitch:!1},initialize:function(){this.listenTo(this,"change:unsetTerm",this.onUnsetTermChange),this.listenTo(n,"peeprsearch:change:term",this.onTermSelect),this.listenTo(this,"change:term change:sort change:post_type change:post_role",this.resetSearch),this.posts=new r},resetSearch:function(){this.set(s.pick(this.defaults,["limit","next_offset"])),this.posts.reset(),this.trigger("search:reset")},reset:function(){this.posts.reset(),this.set(this.defaults),this.trigger("reset")},url:function(){return this.urlRoot+"/"+this.get("blogname")+"/"+this.get("term")},onTermSelect:function(e){this.search(e.term)},onUnsetTermChange:function(){n.trigger("peeprsearch:change:unsetTerm",{term:this.get("unsetTerm")})},search:function(e){e=e||this.get("unsetTerm"),e.length&&this.set("term",e)},fetch:function(){this.get("next_offset")<0||o.prototype.fetch.apply(this,arguments)},parse:function(e){return this.posts.length?s.each(e.response.posts,function(e){this.posts.add(e)},this):this.posts.reset(e.response.posts),delete e.response.posts,e.response},sync:function(e,t,i){"read"===e&&(i.data=this.pick("next_offset","limit","sort","post_type","post_role","filter_nsfw")),o.prototype.sync.apply(this,arguments)}});e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(173),r=i(139),a=i(132),l=i(1070),c=i(1071),u=o.extend({name:"YamPlusAd",counter:1,adConfiguration:{name:"LREC",sp:1197719223,ps:"LREC",ssl:1},initialize:function(e){this.listenTo(r,"darla:ready",this.setupFirstAd),this.listenTo(r,"darla:failure",this.checkAdexist),this.listenTo(r,"darla:success",this.checkAdexist),this.listenTo(r,"component:YamPlusAd",this.setupAd),window.DARLA_CONFIG||this.setupDarla()},$placeholderFor:function(e){return n("#yam-plus-ad-units-"+e)},canServeAds:function(){return window.DARLA},checkAdexist:function(e){if(this.canServeAds()&&e){var t=e[0].replace("LREC",""),i=this.$placeholderFor(t);0===i.find(".darla").length&&i.parents(".yamplus-unit-container").remove()}},setupDarla:function(){window.DARLA_CONFIG=l(this.setupFirstAd(!0)),c()},setupFirstAd:function(e){var t=n(".yam-plus-ad-container, .sidebar-ad-content").eq(0);if(!t.length)return null;var i=t.find(".yam-plus-ad-target"),s=i.attr("id"),o=t.attr("data-yam-ad-id"),r={dest:s,id:o};return e?r:this.setupAd(r)},setupAd:function(e){if(this.counter=this.counter+1,a.logSaw(this.name,"setupAd",window.DARLA),!this.canServeAds())return a.logSaw(this.name,"Cannot serve ads -- NO DARLA"),!1;e=s.defaults(e,{asz:"300x250",w:"300",h:"250",pos:"LREC-"+this.counter,id:!1,dest:!1,fdb:!0});var t="LRECP",i=s.defaults({name:t},this.adConfiguration);return a.logSaw(this.name,"DARLA.add",i),window.DARLA.add(i),window.DARLA.isAutoOn()||window.DARLA.startAuto(),window.DARLA.event("AUTO"),!0}});e.exports=u},function(e,t,i){"use strict";var s=i(3),n=i(139);e.exports=function(e){e=s.extend({dest:!1,id:!1},e);var t={positions:{DEFAULT:{w:"300",h:"250"},LREC:{dest:!1,id:!1}},events:{getEm:{ps:["LREC"],sp:1197719223},AUTO:{sp:1197719223,ps:{LREC:{autoRT:1e4,autoIV:1,autoMax:25,id:"LREC"}},autoStart:1,autoRT:1e4,autoDDG:1,ssl:!0,npv:!0}},onFailure:function(){n.trigger("darla:failure",arguments)},onSuccess:function(){n.trigger("darla:success",arguments)},onFinishParse:function(e,t){t.ps().forEach(function(e){""!==e.hasErr&&n.trigger("darla:failure",arguments)})}};return t.positions.LREC.dest=e.dest,t.positions.LREC.id=e.id,t}},function(e,t,i){"use strict";var s,n=("https:"===document.location.protocol?"https://":"http://")+"fc.yahoo.com/sdarla/php/client.php?f=1197719150",o=5,r=0,a=i(139),l=function e(){clearTimeout(s),s=null,window.DARLA&&!window.DARLA.inProgress()?a.trigger("darla:ready"):++r<o?s=setTimeout(e,1e3):a.trigger("darla:failure")};e.exports=function(){var e=document.createElement("script");e.async=!0;var t=document.getElementsByTagName("script")[0];e.src=n,t.parentNode.insertBefore(e,t),e.onload=l}},function(e,t,i){"use strict";var s=i(3),n=i(1073),o=n.extend({logKey:"dashboard_embed",logOptions:{init_event:!1},events:{"/^post:((?:un)?docked)$/":"handleEvent","post:embed:stateChange":"logStateChange"},handleEvent:function(e,t){var i=s.extend({},t);i.postData&&(i.post_id=i.postData.id,i.tumblelog=i.postData.tumblelog,delete i.postData),this.log(e,i)},logStateChange:function(e,t){if(!s.isEmpty(t)&&t.state&&t.postID&&t.service){if("tumblr"===t.service)return;this.log(t.state,{service:t.service,post_id:t.postID})}}});e.exports=o},function(e,t,i){"use strict";var s=i(7),n=i(3),o=i(174),r=i(139),a=i(132),l=[];l.push(i(1074));var c=/^\/(.+)\/([gimy]*)$/,u=o.extend({constructor:function(){this._eventHandlers=[],this.setupEndpoints(),this.initialize();var e=n.result(this,"events")||{};n.forEach(e,this._addEventHandlerByString,this);var t=n.result(this,"eventBus");this.listenTo(t,"all",this._handleEvent),a.log("LogLady","[instrument]",this.logKey)},logSpots:l,eventBus:r,_addEventHandlerByString:function(e,t){var i,s=t.match(c);if(s){var n=new RegExp(s[1],s[2]);i=function(e){var t=e.match(n);if(t){for(var i=new Array(t.length-1),s=0;s<t.length;s+=1)s>0&&(i[s-1]=t[s]);return i}}}else if("*"===t[t.length-1]){var o=t.substring(0,t.length-1);i=function(e){var t=e.indexOf(o);if(0===t)return[e.substring(o.length,e.length)]}}else i=function(e){return e===t?[e]:null};this._addEventHandler(e,i)},_addEventHandler:function(e,t){this._eventHandlers.push({method:e,matcher:t})},_handleEvent:function(e,t){for(var i,s,o,r=this._eventHandlers.length-1;r>=0;r--)i=this._eventHandlers[r],o=i.callback||this[i.method],o&&(s=i.matcher.call(this,e,t),n.isArray(s)&&(t&&t.loggingData&&s.push(n.cloneDeep(t.loggingData)),o.apply(this,s)))},setupEndpoints:function(){var e=n.result(this,"logSpots");this.loggers=n(e).map(function(e){return e(this)},this).compact().value()},initialize:n.noop,log:function(){for(var e=this.loggers.length-1;e>=0;e--){var t=this.loggers[e];t.trigger.apply(t,arguments)}}},{start:function(){return this._setupInstance||(this._setupInstance=new this),this._setupInstance}});n.extend(u.prototype,s.Events),e.exports=u},function(e,t,i){"use strict";function s(e){var t=n.result(e,"logKey"),i=n.result(e,"logEnv");if(t){var s=n.result(e,"logOptions")||{};return i&&(s.env=i),o.log(t,s)}}var n=i(3),o=i(1075);e.exports=s},function(e,t,i){"use strict";var s=i(1076),n=i(1086),o=new s({EventClass:n,event_payload_name:"payload",event_filter:function(){return!0},endpoint:function(){return[window.location.protocol,"//",window.location.hostname,"/services/cslog"].join("")}});e.exports=o},function(e,t,i){"use strict";function s(e){this.watching={},this.pending_events=[],this.endpoint=e.endpoint,this.overrides=e.overrides,e.event_payload_name&&(this.event_payload_name=e.event_payload_name),e.event_filter&&(this.event_filter=e.event_filter),e.payload_formatter&&(this.payload_formatter=e.payload_formatter),n.bindAll(this,"_flush_from_timeout"),this._flush_from_timeout();var t=e.EventClass||f;this.Log=_.extend({EventClass:t}),o(window).on("beforeunload.log_lady",n.bind(this._flush_on_unload,this)),this.set_flush_rate()}var n=i(3),o=i(8),r=i(7),a=(i(132),i(137)),l=i(928),c=l.getRealNow,u=i(1077),h=i(1078),d=i(1079),p=[].slice,g=i(1080),_=i(1082),f=i(1085),m=1e3;n.extend(s.prototype,r.Events,{initialize:n.noop,defaults:{flush_rate:15*m},min_flush_rate:function(){var e=n.map(this.watching,function(e){return n.result(e,"flush_rate")});return e.push(this.defaults.flush_rate),n.min(e)},set_flush_rate:function(e){return e&&(this.defaults.flush_rate=e),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var e=n.result(this,"endpoint"),t=this.build_payload();if(e&&!n.isEmpty(t)&&(!this.event_payload_name||!n.isEmpty(t[this.event_payload_name]))&&a.bool("log_lady"))return d(e,t,!this.unloading),this.last_flush_at=c(),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var e;for(var t in this.watching)e=this.watching[t],"function"==typeof e.unloaded&&e.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout);var e=this.flush();e!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},flush_is_overdue:function(){this.last_flush_at||(this.last_flush_at=c());var e=c()-this.last_flush_at;return e>this.flush_rate},watch:function(){var e,t,i,s=p.apply(arguments);for(i=0;i<s.length;i++)e=s[i],this.is_valid(e)&&(e.log_lady=this,this.watching[e.log_key]&&(t=this.watching[e.log_key],t&&n.isFunction(t.replaced)&&t.replaced(e)),this.watching[e.log_key]=e);return this.set_flush_rate(),this},unwatch:function(e){this.watching[e.log_key]&&e&&n.isFunction(e.replaced)&&e.replaced(),delete this.watching[e.log_key]},pending_log_events:function(){var e=this.pending_events;return this.pending_events=[],e},payload_formatter:function(e){return e},event_filter:function(){return!0},build_payload:function(){var e=n.merge({},this.watching,[this]),t=n(e).collect(function(e){return e.pending_log_events()}).flatten().filter(this.event_filter).collect(n.bind(function(e){return e.json},this)).value(),i={};return this.event_payload_name?i[this.event_payload_name]=this.payload_formatter(t):i=this.payload_formatter(t),i},is_valid:function(e){var t=!!e;return t&&(t=n.result(e,"log_key")),t&&(t=n.result(e,"uuid")),t&&(t=n.isFunction(e.pending_log_events)),t},log:function(e,t){if(e){if(!(e in this.watching)){t&&t.log_key&&console.warn("log key gets overridden by log name");var i=g("keys",e);t=n.extend({},i,t,{log_key:e});var s=new this.Log(t);this.watch(s)}return this.watching[e]}},new_uuid:h}),s.extend=u,s.Log=_,e.exports=s},function(e,t,i){"use strict";function s(e,t){var i,s=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},n.extend(i,s,t);var o=function(){this.constructor=i};return o.prototype=s.prototype,i.prototype=new o,e.defaults&&(n.extend(i.prototype.defaults,e.defaults),delete e.defaults),e&&n.extend(i.prototype,e),i.__super__=s.prototype,i}var n=i(3);e.exports=s},function(e,t){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}e.exports=i},function(e,t,i){"use strict";function s(e,t,i){return!!r.ajax({url:e,type:"POST",data:JSON.stringify(t),contentType:"text/plain",async:i})}function n(e,t,i){var n=window.navigator.sendBeacon(e,JSON.stringify(t));return n||(n=s(e,t,i)),n}var o,r=i(8);o=window.navigator&&window.navigator.sendBeacon?n:s,e.exports=o},function(e,t,i){"use strict";function s(){for(var e,t=r.apply(arguments),i=o,s=0;s<t.length;s++){if(e=t[s],!i||!n.has(i,e))return null;i=i[e]}return i}var n=i(3),o=i(1081),r=[].slice;e.exports=s},function(e,t,i){"use strict";var s,n=i(129),o=function(){return s||(s=n.get("Components/LogLady")),s};e.exports=o()},function(e,t,i){"use strict";function s(e,t){e.uuid?(t=e,e=t.uuid):t||!e||n.isString(e)||(t=e,e=void 0),this.options=n.extend({},this.defaults,t),delete this.options.log_key,delete this.options.env,delete this.options.uuid,l(this,"uuid",e||this._generate_uuid()),t.env||(t.env={}),n.each(t.flags,function(e){t.env.flags||(t.env.flags={}),t.env.flags[e]=r.bool(e)}),l(this,"env",t.env),this.log_key=t.log_key||this.log_key,this.events=[],this.event_count=0,this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||a.getRealNow()),delete this.options.started_at,this.initialize(t),this.options.init_event&&this.trigger("init")}var n=i(3),o=i(7),r=i(137),a=i(928),l=i(1083),c=i(1077),u=i(1078),h=i(1080),d=i(1085);n.extend(s.prototype,o.Events,{EventClass:d,initialize:n.noop,_generate_uuid:function(){return h("default_session")||u()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var e=this.pending_events;return this.pending_events=[],e},generate_relative_id:function(){return this.event_count},unloaded:function(e){e||(e={}),e=this.before_unloaded(e)||{},this.options.keep_counts&&n.extend(e,{event_counts:this.event_counts}),n.isEmpty(e)||this.trigger("unload",e)},
before_unloaded:function(e){return e},replaced:function(e){this.before_replaced(e);for(var t=this.pending_log_events();t.length;)this.log_lady.pending_events.push(t.shift())},before_replaced:n.noop,stop:function(){this.log_lady&&this.log_lady.unwatch(this)},trigger:function(e,t){var i=new this.EventClass(this,e,t);return this.options.keep_counts&&"init"!==e&&"unload"!==e&&(this.event_counts[e]||(this.event_counts[e]=0),this.event_counts[e]++),this.event_count+=1,this.pending_events.push(i),o.Events.trigger.call(this,e,i,this),this}}),s.extend=c,e.exports=s},function(e,t,i){"use strict";function s(e,t,i){n.isObject(i)&&o(i),Object.defineProperty(e,t,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var n=i(3),o=i(1084);e.exports=s},function(e,t){"use strict";function i(e){var t,n;Object.freeze(e);for(n in e)t=e[n],e.hasOwnProperty(n)&&null!==t&&"object"===("undefined"==typeof t?"undefined":s(t))&&!Object.isFrozen(t)&&i(t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=i},function(e,t,i){"use strict";function s(e,t,i){this.name=t,this.log_key=n.result(e,"log_key"),this.data=i||null;var s=r(),o=n.result(e,"generate_relative_id"),l=n.result(e,"env"),c=e.uuid,u={};u.log_key=this.log_key,u.uuid=c,u.event=this.name,u.ts=s,o!==!1&&void 0!==o&&(u.rid=o),u.elapsed=u.ts-a,u.data=this.data,u.env=l,this.json=u}var n=i(3),o=i(928),r=o.getRealNow,a=o.realStartedAt;e.exports=s},function(e,t,i){"use strict";function s(e){return o.isString(e)?e:JSON.stringify(e)}function n(e,t,i){this.name=t,this.log_key=o.result(e,"log_key"),this.data=i||null;var n=l(),r=o.result(e,"generate_relative_id"),u=o.result(e,"env"),h=e.uuid,d={category:this.log_key},p=8,g=new Array(p);g[0]=s(n),g[1]=s(c),g[2]=s(h),g[3]=s(r),g[4]=s(a.getElapsed(n)),g[5]=s(t),g[6]=s(i),g[7]=s(u),d.fields=g,this.json=d}var o=i(3),r=i(303),a=i(928),l=a.getRealNow,c=r.get("tmgioct");e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"helpform",events:{"helpform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"keycommands_trigger",events:{"keycommands:*":"handleEvent"},initialize:function(){this.hasLoggedJK=!1},handleEvent:function(e,t){if("jk"===e){if(this.hasLoggedJK)return;this.hasLoggedJK=!0}this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=i(137),o=s.extend({FLOW_VERSION_SINGLEFIELD:"singlefield",FLOW_VERSION_STANDARD:"standard",logKey:"loginregister",events:{"loginregister:*":"handleEvent"},initialize:function(){this.hasStartedFunnel=!1},logEnv:function(){return{actionType:"/login"===document.location.pathname?"login":"register",captchaType:"recaptcha",version:this._getFlowVersion()}},handleEvent:function(e,t){if("beginFlow"===e){if(this.hasStartedFunnel)return;this.hasStartedFunnel=!0}this.log(e,t)},_getFlowVersion:function(){return n.bool("oneid_force_newlandingpage")?this.FLOW_VERSION_SINGLEFIELD:this.FLOW_VERSION_STANDARD}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(1073),o=n.extend({logKey:"video_interactions",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"handleEvent"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},s.each(this.loggers,function(e){e.before_unloaded=s.bind(this.beforeUnloaded,this)},this)},handleEvent:function(e,t){if(!s.contains(this.excludedEvents,e)){var i=s.extend({},t);i.postData&&(i.post_id=i.postData.id,delete i.postData),this.log(e,i)}},cacheUnloadLog:function(e,t){this.unloadData[t.id]=t},beforeUnloaded:function(e){s.each(this.unloadData,function(e){this.handleEvent("unload",e)},this)},updateLogCache:function(e,t){var i=["elapsed","position"];this.unloadData[t.id]=s.extend(this.unloadData[t.id],s.pick(t,i))}});e.exports=o},function(e,t,i){"use strict";var s=i(3),n=i(1073),o=n.extend({logKey:"vendorbutton",logEnv:{referrer:document.location.pathname},events:{"VendorButton:*":"handleEvent"},handleEvent:function(e,t){var i=s.extend({},t);i.post_id=t.postData.id,i.root_post_id=t.postData.root_id,i.tumblelog=t.postData.tumblelog,delete i.postData,this.log(e,i)}});e.exports=o},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"dashboard_sharing",events:{"dashboard-share:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){t=t||{},this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"related_recommendations",logOptions:{init_event:!1},events:{"rapid-recommendations:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"explore_trending",logOptions:{init_event:!1},events:{"explore-trending:*":"log"},logEnv:{location:document.location.pathname}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"roadblock",events:{"roadblock:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"linkpost_interactions",logOptions:{init_event:!1},events:{"linkpost:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(3),n=i(129),o=i(1074),r=i(1078),a=i(1073),l=a.extend({logKey:"peepr",logEnv:{baseSessionId:n.get("Components/LogLady/default_session"),context:n.get("Context/name")},events:{"peepr:message:*":"logMessage","peepr:open":"logOpen","peepr:close":"logClose","peepr:log:*":"logMessage"},logMessage:function(e,t){this.log(e,t.payload)},logOpen:function(){this.logger()},logClose:function(){this._logger.stop(),this._logger=null},setupEndpoints:s.noop,logOptions:function(){return{uuid:r()}},logger:function(){return this._logger||(this._logger=o(this)),this._logger},log:function(){var e=this.logger();e.trigger.apply(e,arguments)}});e.exports=l},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"abuseform",events:{"abuseform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=i(129),o=s.extend({logKey:"recommended_blogs",logEnv:{context:n.get("Context/name"),location:document.location.pathname},logOptions:{init_event:!1},events:{"recommendedBlogs:*":"log"}});e.exports=o},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"tourguide_account",logEnv:{referrer:document.location.pathname},logOptions:{init_event:!1},events:{"TourGuideAccount:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"blocks",events:{"blocks:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"postform_interactions",logOptions:{init_event:!1},events:{"postform-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"header_search",logEnv:{referrer:document.location.pathname},events:{"header_search:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"gifsearch_interactions",logOptions:{init_event:!1},events:{"gifsearch:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){"unload"!==e&&this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(1073),o=s(n),r=i(1106),a=s(r),l=i(137),c=s(l),u=o.default.extend({logKey:"little_sister",logSpots:[],events:function(){return c.default.bool("little_sister_kill_switch")?{}:{"LSLog:*":"log"}},log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.pt,s=t.is_ad,n=t.video_details,o=t.extraData;i&&(a.default.log(i).trigger(e,{pt:i,eventName:e,video_details:n,extraData:o}),s&&a.default.flush())}});t.default=u},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=[];return(0,o.forEach)(e,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.pt,s=e.event_data,n=(0,o.find)(t,{pt:i});n||(n={pt:i,events:[]},t.push(n)),n.events.push(s)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.LsLogger=t.lsEndpoint=t.POST_TRACKER=void 0,t.logLadyFormat=n;var o=i(3),r=i(928),a=i(1076),l=s(a),c=i(1107),u=s(c),h=t.POST_TRACKER="pt",d=void 0;d="https://ls.srvcs.tumblr.com/services/bblog";var p=(t.lsEndpoint=d,t.LsLogger=l.default.extend({build_payload:function(){var e=l.default.prototype.build_payload.call(this),t=this.event_payload_name&&(0,o.isEmpty)(e[this.event_payload_name]);return(0,o.isEmpty)(e)||t?{}:(e.flushTime=(0,r.getRealNow)(),e)}})),g=new p({EventClass:u.default,event_payload_name:"trackers",event_filter:function(e){var t=e.data;return(0,o.has)(t,h)},payload_formatter:n,endpoint:d});t.default=g},function(e,t,i){"use strict";function s(e,t,i){this.name=t,this.log_key=n.result(e,"log_key"),this.data=i||{};var s=r(),o={pt:this.data.pt,event_data:{timestamp:s,eventString:this.data.eventName||t}};this.data.video_details&&(o.event_data.data=this.data.video_details),this.data.extraData&&(o.event_data.data=o.event_data.data||{},n.extend(o.event_data.data,this.data.extraData)),this.json=o}var n=i(3),o=i(928),r=o.getRealNow;e.exports=s},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(1073),o=s(n),r=i(1109),a=s(r),l=i(137),c=s(l),u=o.default.extend({logKey:"kraken",logSpots:[],events:function(){return c.default.bool("kraken_web_logging_library")?{"Kraken:*":"log"}:{}},log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.default.log("kraken").trigger(e,t),t.is_ad&&a.default.flush()}});t.default=u},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.default.groupBy(e,function(e){return u.default.has(e,p.POST_TRACKER)&&!!e.pt})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(0,p.logLadyFormat)(e),i=function(e){var t=e.kraken;return delete t.pt,t},s=function(e){return e.data=e.data||e.kraken.event_details,delete e.data.pt,delete e.kraken,e};return t.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pt,n=e.events;return{pt:t,krakenEvents:n.map(i),events:n.map(s)}})}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(function(e){var t=e.event_data;return{krakenEvents:t.kraken}})}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new d.default(window,e);return{language:t.language,manufacturer:t.vendor,os_version:t.osVersion,platform:t.platform,build_version:"",carrier:"",connection:"",model:""}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return{};var t=n(e),i=o(t[f]),s=r(t[m]);return Object.assign({krakenClientDetails:a()},i.length&&{trackers:i},s.length&&{krakenEvents:s})}Object.defineProperty(t,"__esModule",{value:!0});var c=i(3),u=s(c),h=i(1110),d=s(h),p=i(1106),g=i(1113),_=s(g),f="true",m="false",v=new p.LsLogger({EventClass:_.default,payload_formatter:l,event_filter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,i=e.name,s=t.pt;return!!s||g.allowedEventNames.includes(i)},endpoint:p.lsEndpoint});t.default=v},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=i(3),a=i(1111),l=s(a),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,e);var s=t.screen,o=t.location,a=t.navigator,c=a.appVersion,u=a.browserLanguage,h=a.cookieEnabled,d=a.onLine,p=a.language,g=a.languages,_=a.userAgent,f=a.vendor,m=new l.default(_).getResult(),v=m.browser,b=m.os,y=m.device,w=(new t.Date).getTime(),k=!0,C=t.outerWidth+"x"+t.outerHeight;(0,r.assign)(this,{appVersion:c,browserName:v.name,browserVersion:v.version,client:t,colorDepth:s.colorDepth,cookiesEnabled:h,createdAt:w,deviceModel:y.model,deviceType:y.type,deviceVendor:y.vendor,hasJavascript:k,isOnline:d,language:p||u,languages:g||[],location:o,osName:b.name,osVersion:b.version,resolution:C,screenHeight:s.height,screenWidth:s.width,userAgent:_,vendor:f},i)}return o(e,[{key:"toJSON",value:function(){var e=this.appVersion,t=this.colorDepth,i=this.cookiesEnabled,s=this.hasFlash,n=this.hasImages,o=this.hasJavascript,r=this.language,a=this.languages,l=this.isOnline,c=this.platform,u=this.plugins,h=this.resolution,d=this.screenHeight,p=this.screenWidth,g=this.createdAt,_=this.timezone,f=this.userAgent;return{app_version:e,color_depth:t,cookies_enabled:i,flash_enabled:s,images_enabled:n,javascript_enabled:o,language:r,languages:a,online:l,platform:c,plugins:u,resolution:h,screen_height:d,screen_width:p,time_zone_offset:_,timestamp:g,user_agent:f}}},{key:"screenType",get:function(){if(this.page)return this.page;var e=this.location.pathname,t={Dashboard:"/dashboard",Explore:"/explore",SearchResults:"/search"};for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];if((0,r.startsWith)(e,s))return i}return"Unknown"}},{key:"timezone",get:function(){return(new this.client.Date).getTimezoneOffset()}},{key:"isHeadlessBrowser",get:function(){var e=this,t=["_phantom","Buffer","callPhantom","domAutomation","domAutomationController","emit","spawn","webdriver"];return(0,r.some)(t,function(t){return!!e.client[t]})}},{key:"plugins",get:function(){return(0,r.map)(this.client.navigator.plugins,"name")}},{key:"hasImages",get:function(){var e=this.client.document.getElementById("clp_image");return!!e&&e.width>0}},{key:"hasFlash",get:function(){var e=this.client,t=e.ActiveXObject,i=e.navigator,s=!1;try{s=new t("ShockwaveFlash.ShockwaveFlash")}catch(e){s=i.mimeTypes["application/x-shockwave-flash"]&&i.mimeTypes["application/x-shockwave-flash"].enabledPlugin}return!!s}},{key:"platform",get:function(){var e=(0,r.get)(this,"client.navigator.platform"),t=["iPhone","iPod","iPad","iPhone Simulator","iPod Simulator","iPad Simulator"].includes(e),i=["Android"].includes(e);return t?"Web:iOS":i?"Web:Android":"Web"}}]),e}();t.default=c},function(e,t,i){var s;!function(n,o){"use strict";var r="0.7.12",a="",l="?",c="function",u="undefined",h="object",d="string",p="major",g="model",_="name",f="type",m="vendor",v="version",b="architecture",y="console",w="mobile",k="tablet",C="smarttv",x="wearable",S="embedded",T={extend:function(e,t){var i={};for(var s in e)t[s]&&t[s].length%2===0?i[s]=t[s].concat(e[s]):i[s]=e[s];return i},has:function(e,t){return"string"==typeof e&&t.toLowerCase().indexOf(e.toLowerCase())!==-1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===d?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},E={rgx:function(){for(var e,t,i,s,n,r,a,l=0,d=arguments;l<d.length&&!r;){var p=d[l],g=d[l+1];if(typeof e===u){e={};for(s in g)g.hasOwnProperty(s)&&(n=g[s],typeof n===h?e[n[0]]=o:e[n]=o)}for(t=i=0;t<p.length&&!r;)if(r=p[t++].exec(this.getUA()))for(s=0;s<g.length;s++)a=r[++i],n=g[s],typeof n===h&&n.length>0?2==n.length?typeof n[1]==c?e[n[0]]=n[1].call(this,a):e[n[0]]=n[1]:3==n.length?typeof n[1]!==c||n[1].exec&&n[1].test?e[n[0]]=a?a.replace(n[1],n[2]):o:e[n[0]]=a?n[1].call(this,a,n[2]):o:4==n.length&&(e[n[0]]=a?n[3].call(this,a.replace(n[1],n[2])):o):e[n]=a?a:o;l+=2}return e},str:function(e,t){for(var i in t)if(typeof t[i]===h&&t[i].length>0){for(var s=0;s<t[i].length;s++)if(T.has(t[i][s],e))return i===l?o:i}else if(T.has(t[i],e))return i===l?o:i;return e}},P={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},I={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[_,v],[/(opios)[\/\s]+([\w\.]+)/i],[[_,"Opera Mini"],v],[/\s(opr)\/([\w\.]+)/i],[[_,"Opera"],v],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[_,v],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[_,"IE"],v],[/(edge)\/((\d+)?[\w\.]+)/i],[_,v],[/(yabrowser)\/([\w\.]+)/i],[[_,"Yandex"],v],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],v],[/(micromessenger)\/([\w\.]+)/i],[[_,"WeChat"],v],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[v,[_,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[_,/(.+)/,"$1 WebView"],v],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[v,[_,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[_,v],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[_,"UCBrowser"],v],[/(dolfin)\/([\w\.]+)/i],[[_,"Dolphin"],v],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[_,"Chrome"],v],[/;fbav\/([\w\.]+);/i],[v,[_,"Facebook"]],[/fxios\/([\w\.-]+)/i],[v,[_,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[v,[_,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[v,_],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[_,[v,E.str,P.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[_,v],[/(navigator|netscape)\/([\w\.-]+)/i],[[_,"Netscape"],v],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[_,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,T.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[b,/ower/,"",T.lowerize]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[b,T.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[g,m,[f,k]],[/applecoremedia\/[\w\.]+ \((ipad)/],[g,[m,"Apple"],[f,k]],[/(apple\s{0,1}tv)/i],[[g,"Apple TV"],[m,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,g,[f,k]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[g,[m,"Amazon"],[f,k]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[g,E.str,P.device.amazon.model],[m,"Amazon"],[f,w]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[g,m,[f,w]],[/\((ip[honed|\s\w*]+);/i],[g,[m,"Apple"],[f,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,g,[f,w]],[/\(bb10;\s(\w+)/i],[g,[m,"BlackBerry"],[f,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[g,[m,"Asus"],[f,k]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[g,"Xperia Tablet"],[f,k]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[m,"Sony"],[g,"Xperia Phone"],[f,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,g,[f,y]],[/android.+;\s(shield)\sbuild/i],[g,[m,"Nvidia"],[f,y]],[/(playstation\s[34portablevi]+)/i],[g,[m,"Sony"],[f,y]],[/(sprint\s(\w+))/i],[[m,E.str,P.device.sprint.vendor],[g,E.str,P.device.sprint.model],[f,w]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[m,g,[f,k]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[m,[g,/_/g," "],[f,w]],[/(nexus\s9)/i],[g,[m,"HTC"],[f,k]],[/(nexus\s6p)/i],[g,[m,"Huawei"],[f,w]],[/(microsoft);\s(lumia[\s\w]+)/i],[m,g,[f,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[g,[m,"Microsoft"],[f,y]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[m,"Microsoft"],[f,w]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[g,[m,"Motorola"],[f,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[g,[m,"Motorola"],[f,k]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[m,T.trim],[g,T.trim],[f,C]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[m,"Samsung"],[f,C]],[/\(dtv[\);].+(aquos)/i],[g,[m,"Sharp"],[f,C]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],g,[f,k]],[/smart-tv.+(samsung)/i],[m,[f,C],g],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[m,"Samsung"],g,[f,w]],[/sie-(\w+)*/i],[g,[m,"Siemens"],[f,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[m,"Nokia"],g,[f,w]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[g,[m,"Acer"],[f,k]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],g,[f,k]],[/(lg) netcast\.tv/i],[m,g,[f,C]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[g,[m,"LG"],[f,w]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[g,[m,"Lenovo"],[f,k]],[/linux;.+((jolla));/i],[m,g,[f,w]],[/((pebble))app\/[\d\.]+\s/i],[m,g,[f,x]],[/android.+;\s(glass)\s\d/i],[g,[m,"Google"],[f,x]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[g,/_/g," "],[m,"Xiaomi"],[f,w]],[/android.+a000(1)\s+build/i],[g,[m,"OnePlus"],[f,w]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[f,T.lowerize],m,g]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[v,[_,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[_,v],[/rv\:([\w\.]+).*(gecko)/i],[v,_]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[_,v],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[_,[v,E.str,P.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[_,"Windows"],[v,E.str,P.os.windows.version]],[/\((bb)(10);/i],[[_,"BlackBerry"],v],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[_,v],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[_,"Symbian"],v],[/\((series40);/i],[_],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[_,"Firefox OS"],v],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[_,v],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[_,"Chromium OS"],v],[/(sunos)\s?([\w\.]+\d)*/i],[[_,"Solaris"],v],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[_,v],[/(haiku)\s(\w+)/i],[_,v],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[_,"iOS"],[v,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[_,"Mac OS"],[v,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[_,v]]},F=function(e,t){if(!(this instanceof F))return new F(e,t).getResult();var i=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:a),s=t?T.extend(I,t):I;return this.getBrowser=function(){var e=E.rgx.apply(this,s.browser);return e.major=T.major(e.version),e},this.getCPU=function(){return E.rgx.apply(this,s.cpu)},this.getDevice=function(){return E.rgx.apply(this,s.device)},this.getEngine=function(){return E.rgx.apply(this,s.engine)},this.getOS=function(){return E.rgx.apply(this,s.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};F.VERSION=r,F.BROWSER={NAME:_,MAJOR:p,VERSION:v},F.CPU={ARCHITECTURE:b},F.DEVICE={MODEL:g,VENDOR:m,TYPE:f,CONSOLE:y,MOBILE:w,SMARTTV:C,TABLET:k,WEARABLE:x,EMBEDDED:S},F.ENGINE={NAME:_,VERSION:v},F.OS={NAME:_,VERSION:v},typeof t!==u?(typeof e!==u&&e.exports&&(t=e.exports=F),t.UAParser=F):"function"===c&&i(1112)?(s=function(){return F}.call(t,i,t,e),!(s!==o&&(e.exports=s))):n.UAParser=F;var N=n.jQuery||n.Zepto;if(typeof N!==u){var A=new F;N.ua=A.getResult(),N.ua.get=function(){return A.getUA()},N.ua.set=function(e){A.setUA(e);var t=A.getResult();for(var i in t)N.ua[i]=t[i]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.allowedEventNames=void 0;var a=i(3),l=s(a),c=i(1107),u=s(c),h=i(1110),d=s(h),p=(t.allowedEventNames=["follow","impression","like","reblog","share","unfollow","unlike"],function(e){function t(e,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s)),a=r.data,c=a.extraData,u=a.eventDetails,h=a.eventString,p=a.ts,g=a._experiments,_=a._clientOverrides;r.experiments=g||{},r.overrides=_||{},delete r.data._experiments,delete r.data._clientOverrides;var f=new d.default(window,r.overrides);return r.json.event_data.kraken={event_name:h||r.name,client_session_id:f.sessionID||"",page:f.screenType||"Unknown",section:f.section||"",client_timestamp:p||Date.now(),event_details:Object.assign({},c,u,l.default.omit(r.data,"pt","extraData","eventDetails")),experiments:r.experiments},r}return r(t,e),t}(u.default));t.default=p},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"messaging_interactions",logOptions:{init_event:!1},events:{"messaging-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=i(129),o=s.extend({logKey:"verified_onboarding_blogs",logEnv:{context:n.get("Context/name"),location:document.location.pathname},logOptions:{init_event:!1},events:{"verifiedBlogs:*":"log"}});e.exports=o},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"reactivation",logOptions:{init_event:!1},events:{"reactivation:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"activity_links",logOptions:{init_event:!1},logEnv:{location:document.location.pathname},events:{"activityLinks:*":"handleEvent"},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"notes_interactions",logOptions:{init_event:!1},logEnv:{location:document.location.pathname},events:{"notes-interactions:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"postchrome_interactions",logOptions:{init_event:!1},events:{"postchrome-interactions:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"toastlog",events:{"toastlog:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"async_loading",events:{"async-loading:*":"log"}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"ads_interactions",logOptions:{init_event:!1},events:{"ads-interaction:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(1073),n=s.extend({logKey:"safe_mode",logOptions:{init_event:!1},events:{"safeMode:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(e,t){this.log(e,t)}});e.exports=n},function(e,t,i){"use strict";var s=i(196);s({"Tumblr.Prima.Upload":i(466),"Tumblr.Prima.Ligature":i(252),"Tumblr.Events":i(139),"Tumblr.Prima.Events":i(139),"Tumblr.Prima.Dialog":i(172),"Tumblr.Dialog":i(172),"Tumblr.PostMessageChannel":i(893),"Tumblr.Prima.DOMEventor":i(138),"Tumblr.Prima.gutterMediaManager":i(1125),"Tumblr.Prima.Vendor.when":i(150),"Tumblr.Prima.Vendor.sequence":i(198),"Tumblr.log_lady":i(1126),"Tumblr.Prima.logLady":i(1126),"Tumblr.Prima.Models.Post":i(308),"Tumblr.Prima.Models.Tumblelog":i(149),"Tumblr.Prima.CrtPlayer":i(548),"Tumblr.Prima.CrtControl":i(902),"Tumblr.Prima.BlogCard":i(615),"Tumblr.Prima.Url":i(224),"Tumblr.Prima.ToolTip":i(1129),"Tumblr.Prima.SharePopover":i(302),"Tumblr.Prima.Messaging.SharePost":i(973),"Tumblr.Prima.utils.caniuse":i(550),"Tumblr.Prima.ConfettiView":i(995),"Tumblr.Prima.FlatSelect":i(1132),"Tumblr.Prima.Mixins.loggingData":i(309),"Tumblr.Prima.Scrollbar":i(427),"Tumblr.Prima.MessageControlsPopover":i(1134),"Tumblr.Prima.Block":i(171),"Tumblr.Prima.SafeMode":i(1136),"Tumblr.Prima.PeeprSearch":i(1137),"Tumblr.Prima.MessagingPopover":i(1151),"Tumblr.Prima.currentUser":i(140),"Tumblr.Prima.AdsPaginationHelper":i(1158),"Tumblr.Prima.SortableView":i(275),"Tumblr.Prima.getLoggingPayloadFromNote":i(1159),"Tumblr.Prima.Snowman":i(621),"Tumblr.Prima.postActivityLoader":i(925),"Tumblr.Prima.KnightRiderLoader":i(290),"Tumblr.Prima.Lib.hosts":i(846),"Tumblr.Prima.LivePhotos":i(487),"Tumblr.Prima.Carousel":i(1160),"Tumblr.Prima.ExpandableTags":i(1165),"Tumblr.Prima.Translate":i(130),"Tumblr.Prima.NativeAudio":i(538),"Tumblr.Prima.CTAButton":i(1168),"Tumblr.Prima.StatusIndicator":i(688),"Tumblr.Prima.Utils.CanvasTools":i(221)}),e.exports=s},function(e,t,i){"use strict";var s=i(173),n=i(138),o=i(139),r=i(8),a=i(3),l=s.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:17,gutterWidth:300,maxViewWidth:300,
viewportTransitionWidth:990,initialize:function(){this.layoutHasGutter=this.$right_column().length>0,this.layoutHasGutter||(this.gutterMargin=-65)},$right_column:function(){return this._$right_column||(this._$right_column=r(".right_column")),this._$right_column},toggleBackground:function(e){this.layoutHasGutter&&(e?(this.$right_column().addClass("has_docked_post"),this.$right_column().on("click.gutterManager",a.bind(this.handleGutterClick,this))):(this.$right_column().removeClass("has_docked_post"),this.$right_column().off("click.gutterManager")))},putViewInGutter:function(e,t){return t=a.defaults(t||{},{winRect:n.rect(),gutterPosition:this.gutterPosition(),animation:null,dimRadar:!0,removeOnGutterClick:!1,onDock:a.noop,onUndock:a.noop,dockLoggingName:"post:docked",dockLoggingData:null,undockLoggingName:"post:undocked",undockLoggingData:null}),!!this.isDockable(e,t)&&(t.onDock=t.onDock||a.noop,this.gutteredView&&this.removeGutteredView(),this.gutteredView={view:e,options:t},t.onDock.call(e,t),t.dimRadar&&this.toggleBackground(!0),t.dockLoggingName&&t.dockLoggingData&&o.trigger(t.dockLoggingName,{loggingData:t.dockLoggingData}),this.gutteredView)},removeGutteredView:function(){if(this.gutteredView){var e=this.gutteredView.options,t=this.gutteredView.view;e.onUndock=e.onUndock||a.noop,e.onUndock.call(t,e),this.gutteredView=null,e.dimRadar&&this.toggleBackground(!1),e.undockLoggingName&&e.undockLoggingData&&o.trigger(e.undockLoggingName,{loggingData:e.undockLoggingData})}},isViewInGutter:function(e){return this.gutteredView&&this.gutteredView.view===e},isDockable:function(e,t){if(!this.gutteredView)return!0;var i=!this.gutteredView||this.gutteredView.options.alwaysEvict,s=t.alwaysEvict;return!(this.gutteredView.view===e||s&&!i)},handleGutterClick:function(e){this.gutteredView&&(e.preventDefault(),this.gutteredView.options.removeOnGutterClick&&this.removeGutteredView())},gutterPosition:function(){var e=n.rect(),t=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:t},s=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return e.windowWidth<s&&(i.width=s-e.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});e.exports=new l},function(e,t,i){"use strict";var s=i(1127);e.exports=s},function(e,t,i){"use strict";var s=i(139),n=i(1076),o=i(1085),r=i(1128),a=new n({EventClass:o,event_payload_name:"events",event_filter:r,endpoint:"/svc/log/lady"});s.on("Capture:push",function(e,t,i){a.log(e,{init_event:!1}).trigger(t,i)}),e.exports=a},function(e,t,i){"use strict";var s=i(3),n=i(1080),o=s.keys(n("keys"));e.exports=function(e){return o.indexOf(e.log_key)>=0}},function(e,t,i){"use strict";var s=i(173),n=i(1130),o=s.extend({name:"ToolTip",class_name:"tumblr_tooltip",initialize:function(e){this.toolTipView=new n(e)}});e.exports=o},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(178),r=i(1131),a=o.extend({class_name:"tumblr_tooltip",template:r,defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(e){this.options=e||{},this.options.selector=s.trim((e.selector||this.defaults.selector)+" "),this.options.class_name=e.class_name||this.defaults.class_name,this.options.offset=e.offset||this.defaults.offset,this.options.placement=e.placement||this.defaults.placement,this.tooltips=s(this.options.selector+"[data-tooltip]"),this.tooltips.on("remove",s.proxy(this.remove,this)),this.tooltips.on("mouseenter",n.bind(this.show,this)),this.tooltips.on("mouseleave",n.bind(this.hide,this))},show:function(e){var t=s(e.currentTarget);this.tooltip_template_data={tooltip:t.data("tooltip")};var i=s(this.tooltip(this.tooltip_template_data));t.append(i),this.setElement(i),this.delegateEvents(),i.removeClass("is_closed").addClass("is_open")},hide:function(e){var t=s(e.currentTarget),i=t.find("."+this.class_name);i.removeClass("is_open").addClass("is_closed"),i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",n.bind(function(e){this.remove(e)},this))},remove:function(e){s(e.currentTarget).remove()},tooltip:function(e){return this.class_name="tooltip_wrapper",this.attributes={text:e.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset},this.template(this.attributes)}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="tooltip_wrapper '+__e(placement)+" "+__e(class_name)+'" style="left:'+__e(left_css)+'"><div class="tooltip"> '+(null==(__t=text)?"":__t)+" </div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(173),n=i(1133),o=s.extend({name:"FlatSelect",view:function(e){return new n(e)}});e.exports=o},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(178),r=o.extend({el:"body",defaults:{},events:{"change .flat_select select":"__selectChange"},__selectChange:function(e){var t=s(e.currentTarget);this.updateSelect(t)},initialize:function(e){this.options=n.extend({},this.defaults,e)},updateSelect:function(e){var t=e.siblings("label");t.text(e.find(":selected").text())}});e.exports=r},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(139),r=i(235),a=i(242),l=i(129),c=i(1135),u=n.extend({className:"popover--message-controls-popover",mixins:[r,a],template:c,events:{'click [data-action="delete"]':"_delete",'click [data-action="block"]':"_block",'click [data-action="flag"]':"_flag"},initialize:function(e){this.options=s.extend({},e),this.showFlagAndBlock=this.options.blockString&&this._notUsersOwnBlog(),this.post=e.post},_getSender:function(){return!(!this.options.blockString||this.options.blockString.indexOf(":")!==-1)&&this.options.blockString},_notUsersOwnBlog:function(){var e=this._getSender();if(e){var t=l.get("Context/userinfo/channels");return t=s.pluck(t,"name"),!s.includes(t,e)}return!0},_delete:function(e){e.preventDefault(),this.post.delete(e)},_block:function(e){e.preventDefault(),this.post.block(e)},_flag:function(e){e.preventDefault();var t={mode:"message",post:this.post.model},i=this._getSender();i&&(t.sender=i),o.trigger("abuseform:open",t)},render:function(){return this.$el.html(this.template()),this},teardown:function(){return this.$el.remove(),this}});e.exports=u},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="popover popover_menu popover_gradient message-controls-popover"><div class="popover_inner"><ul> ',this.showFlagAndBlock&&(__p+=' <li class="popover_menu_item" data-action="block" data-block="'+__e(this.options.blockString)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Block"))+'</a></li><li class="popover_menu_item" data-action="flag"><a class="popover_menu_item_anchor" href="#">'+__e(__("Report"))+"</a></li> "),__p+=' <li class="popover_menu_item" data-action="delete" data-confirm="'+(null==(__t=__("Are you sure you want to delete this?"))?"":__t)+'"><a class="popover_menu_item_anchor" href="#">'+__e(__("Delete"))+"</a></li></ul></div></div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=[{id:"0",appeal:"OWNER_APPEAL_NSFW_NONE",readable:"none"},{id:"1",appeal:"OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE",readable:"available_prioritize"},{id:"2",appeal:"OWNER_APPEAL_NSFW_AVAILABLE",readable:"available"},{id:"3",appeal:"OWNER_APPEAL_NSFW_IN_REVIEW",readable:"in_review"},{id:"4",appeal:"OWNER_APPEAL_NSFW_COMPLETE",readable:"complete"}],n=i(8),o=i(3),r=i(130),a=i(139),l=i(172),c=function(e){this.xhr&&this.xhr.abort();var t=o.has(this.model,"attributes.blog.name")?this.model.attributes.blog.name:this.model.tumblelog.id;return this.xhr=n.ajax({method:"POST",url:"/svc/appeal",data:{post_id:this.model.get("id"),blog_name:t,state:e},withFormKey:!0}),this.xhr},u=function(e){return parseInt(o.find(s,{appeal:e}).id,10)},h={dismiss:function(e,t,i){var s=n(e.target).closest(".own-post-banner");this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_AVAILABLE")),this.xhr.done(o.bind(function(){s.slideUp()},this)),this.logAction("DismissButtonClicked",t)},request:function(e,t,i){var s=n(e.target).closest(".own-post-banner"),a=n(e.target).closest(".post_wrapper").find(".nsfw-eye");this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_IN_REVIEW")),this.xhr.done(o.bind(function(){a.attr("data-state",u("OWNER_APPEAL_NSFW_IN_REVIEW")),l.alert(r("Okay! We'll review the status of this and email you when we're done.")),s.slideUp()},this)),this.logAction("RequestReviewButtonClicked",t)},eyeTap:function(e,t,i){var s=n(e.currentTarget).attr("data-state"),a=n(e.target).closest(".post_wrapper").find(".own-post-banner"),h=n(e.target).closest(".post_wrapper").find(".nsfw-eye"),d={text:r("This is marked as sensitive content. If that seems like a mistake, you can request a review."),text_ok:r("Request Review"),text_cancel:r("Nevermind"),callback_ok:o.bind(function(){this._appealState=o.bind(c,i),this.xhr=this._appealState(u("OWNER_APPEAL_NSFW_IN_REVIEW")),this.xhr.done(o.bind(function(){o.delay(function(){l.alert(r("Okay! We'll review the status of this and email you when we're done."))},300),h.attr("data-state",u("OWNER_APPEAL_NSFW_IN_REVIEW")),a.slideUp()},this))},this)};switch(parseInt(s,10)){case u("OWNER_APPEAL_NSFW_IN_REVIEW"):l.alert(r("This post is still marked as sensitive, but is currently being reviewed."));break;case u("OWNER_APPEAL_NSFW_COMPLETE"):l.alert(r("After review, it was determined that this post contains sensitive content."));break;case u("OWNER_APPEAL_NSFW_AVAILABLE_PRIORITIZE"):case u("OWNER_APPEAL_NSFW_AVAILABLE"):l.confirm(d)}this.logAction("NsfwIndicatorClicked",t)},openPeepr:function(e,t){a.trigger("peepr-open-request",{tumblelog_name:e,post_id:t,editing_appearance:!1,should_bypass_safemode:!0}),this.logAction("ShowNsfwPostAnywaysClicked",t)},getAppealArray:function(){return s},logAction:function(e,t){(o.isNumber(t)||o.isString(t))&&a.trigger("safeMode:"+e,{loggingData:{postId:t}})}};e.exports=h},function(e,t,i){"use strict";function s(e){return new n(e)}var n=i(1138);e.exports=s},function(e,t,i){"use strict";var s=i(3),n=i(8),o=i(185),r=i(139),a=i(137),l=i(140),c=i(1139),u=i(1140),h=i(1142),d=i(1149),p=i(1068),g=o.extend({className:"peepr-blog-search",template:c,subviews:{filters:{constructor:u},input:{constructor:h}},events:{"submit .blog-search-form":"formSubmitHandler","click .blog-search-form":"onFormClick","click .clear-search":"clearSearch","click .toggle-search":"toggleSearch"},initialize:function(e){this.options=e,this.user=l(),this.searchActive=!1,this.blog=e.blog,this.model=new p({blogname:this.blog.tumblelog_name_or_id,themeParams:this.blog.get("global_theme_params"),isAdult:this.blog.get("nsfw"),isSafeModeEnabled:a.bool("safe_mode")&&this.user.get("safe_mode")}),s.each(this.subviews,function(e){e.options=e.options||{},e.options.model=this.model},this),this.bindEvents()},bindEvents:function(){this.listenTo(this.model.posts,"reset",this.onPostsReset),this.listenTo(this.model.posts,"add",this.onPostsAdd),this.listenTo(this.model,"search:reset",this.onSearchReset),this.listenTo(this.model,"change:next_offset",this.onOffsetChange),this.listenTo(this.model,"change:term",s.bind(this.log,this,"search-start",{})),this.listenTo(r,"indashblog:search:fetch-requested",this.onFetchRequested),this.listenTo(r,"indashblog:ready-animation-start",this.onPeeprReady)},onPeeprReady:function(){this.setWidth()},setWidth:function(){var e=this.$el.parents(".navigation_inner"),t=e.width(),i=e.find(".header_controls").outerWidth();this.$el.width(t-i)},onFetchRequested:function(e){this.model.fetch(e)},formSubmitHandler:function(e){e.preventDefault(),this.model.search()},onFormClick:function(e){e.stopPropagation()},toggleSearch:function(e){return e=s.defaults(e,{force:null,focus:!0}),this.model.get("term").length&&null===e.force?void this.clearSearch():(this.searchActive=s.isBoolean(e.force)?e.force:!this.searchActive,this.$el.toggleClass("show-search",this.searchActive),n(".indash_header_wrapper").toggleClass("search-active",this.searchActive),void(this.searchActive?e.focus&&s.delay(s.bind(this.input.focusInput,this.input),300):this.model.reset()))},clearSearch:function(){this.toggleSearch({force:!1}),r.trigger("indashblog:search:clear"),this.log("search-clear")},onSearchReset:function(){var e=this.model.get("term").length>0;this.$el.toggleClass("term-entered",e),e&&(r.trigger("indashblog:search:start"),this.searchActive||this.toggleSearch({focus:!1,force:!0}))},onPostsReset:function(e){e.length&&(r.trigger("indashblog:search:complete",e.toJSON()),this.log("search-complete"))},onOffsetChange:function(e,t){t>=0||(r.trigger("indashblog:search:results-end",this.model.posts.length?null:new d({model:this.model})),this.log("search-results-end"))},onPostsAdd:function(e){r.trigger("indashblog:search:post-added",e.toJSON())},log:function(e,t){var i={loggingData:s.defaults({blogname:this.blog.tumblelog_name_or_id,term:this.model.get("term"),sort:this.model.get("sort"),post_type:this.model.get("post_type"),post_role:this.model.get("post_role"),next_offset:this.model.get("next_offset")},t||{})};r.trigger("peepr-search:"+e,i)},remove:function(){this.model.stopListening(),o.prototype.remove.call(this)}});e.exports=g},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__j=Array.prototype.join;with(obj)__p+='<form class="blog-search-form"><div data-subview="filters"></div><i class="icon_arrow_thin_left clear-search nav_icon"></i> ',model.isSafeModeEnabled&&model.isAdult||(__p+=' <i class="icon_search toggle-search nav_icon"></i> '),__p+=' <div data-subview="input"></div></form>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(1141),r=i(1063),a=n.extend({className:"search-filters",template:o,events:{"click .show-filter-popover":"showPopover"},initialize:function(){this.listenTo(this.model,"search:reset",this.hidePopover)},showPopover:function(){this.popover||(this.popover=new r({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover,"close",this.onPopoverClose))},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){s.defer(s.bind(function(){this.popover=null},this))}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<i class="icon_filter show-filter-popover nav_icon"></i>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(139),r=i(236),a=i(1143),l=i(1147),c=i(1148),u=n.extend({className:"search-input",template:c,mixins:[r],$$cacheKeys:{"blog-search-input":".blog-search-input"},initialize:function(){this.autocompletePopover=null,this.bindEvents(),this.blogSearchAutocompleteModel=new l({blogname:this.model.get("blogname")})},afterRender:function(){this.blogSearchAutocompleteHelper=new a({model:this.blogSearchAutocompleteModel,el:this.$$(".blog-search-input")})},events:{"focus .blog-search-input":"inputFocusHandler","keyup .blog-search-input":"inputKeyUpHandler","blur .blog-search-input":"inputBlurHandler"},bindEvents:function(){this.listenTo(this.model,"change:term",this.onTermChange),this.listenTo(this.model,"reset",this.onModelReset)},inputKeyUpHandler:function(){this.model.set("unsetTerm",this.getTerm()),this.blogSearchAutocompleteModel.set("matchTerm",this.getTerm())},focusInput:function(){this.$$(".blog-search-input").focus(),this.blogSearchAutocompleteHelper.showPopover()},getTerm:function(){return s.trim(this.$$(".blog-search-input").val())},setTerm:function(e){this.$$(".blog-search-input").val(e).blur()},onTermChange:function(e,t){this.setTerm(t)},onModelReset:function(){this.setTerm("")},inputFocusHandler:function(){o.trigger("indashblog:keycommands:suspend",!0)},inputBlurHandler:function(){o.trigger("indashblog:keycommands:resume")}});e.exports=u},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(1144),r=n.extend({events:{click:"showPopover",blur:"onInputBlur"},initialize:function(){this.popover=null,this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:matchTerm",this.onMatchTermChange)},onMatchTermChange:function(){this.model.get("typeAheadMatches").length?this.showPopover():this.hidePopover()},showPopover:function(){this.model.getItems().then(s.bind(function(){!this.popover&&this.model.hasMatches()&&(this.popover=new o({pinnedTarget:this.$el,model:this.model,shift:{x:-this.getLeftOffset(),y:0},preventInteraction:!0,keycommands:!0}).render(),this.listenTo(this.popover,"close",this.onPopoverClose))},this))},getLeftOffset:function(){return this._leftOffset=this._leftOffset||this.$el.width()/2,this._leftOffset},onInputBlur:function(){s.delay(s.bind(this.hidePopover,this),100)},hidePopover:function(){this.popover&&this.popover.hide()},onPopoverClose:function(){s.defer(s.bind(function(){this.popover=null},this))}});e.exports=r},function(e,t,i){"use strict";var s=i(1064),n=i(1145),o=s.extend({className:s.prototype.className+" blog-search-autocomplete-popover",bindEvents:function(){s.prototype.bindEvents.apply(this,arguments),this.listenTo(this,"itemSelected",this.subview.selectTerm)},Subview:n});e.exports=o},function(e,t,i){"use strict";var s=i(8),n=i(139),o=i(185),r=i(1146),a=o.extend({template:r,events:{"click [data-term]":"onTermClick"},initialize:function(){this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:typeAheadMatches",this.render)},onTermClick:function(e){this.selectTerm(s(e.currentTarget))},selectTerm:function(e){n.trigger("peeprsearch:change:term",{term:e.attr("data-term")})}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<ul class="popover_inner_list search_filter_items"><li class="popover_header"> '+__e(__("Popular Tags:"))+" </li> ";for(var i=0;i<model.maxRender&&i<model.typeAheadMatches.length;i++)__p+=' <li class="popover_menu_item" data-term="'+__e(model.typeAheadMatches[i].tag)+'"><span class="popover_menu_item_anchor">#'+__e(model.typeAheadMatches[i].tag)+" </span></li> ";__p+=" </ul>"}return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(139),r=i(143),a=i(148),l=r.extend({defaults:{maxRender:20,matchTerm:"",typeAheadMatches:[]},urlRoot:"/svc/search/blog_search_typeahead",url:function(){return this.urlRoot+"/"+this.get("blogname")},initialize:function(){this.items=new a,this.fetched=!1,this.listenTo(o,"peeprsearch:change:unsetTerm",this.onUnsetTermChange),this.listenTo(this,"change:matchTerm sync",this.setMatches)},onUnsetTermChange:function(e){this.set("matchTerm",e.term)},hasMatches:function(){return this.items.length&&this.get("typeAheadMatches").length||!this.fetched},setMatches:function(){var e=this.get("matchTerm");if(!e.length)return void this.set("typeAheadMatches",this.items.toJSON());var t=this.items.filter(function(t){return t.get("tag").indexOf(e)>-1});this.set("typeAheadMatches",n.invoke(t,"toJSON"))},getItems:function(){if(this.items.length){var e=s.Deferred();return e.resolve(),e.promise()}return this.fetch(arguments)},parse:function(e){return this.items.reset(e.tags),this.fetched=!0,n.omit(e,"tags")}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<input type="text" class="blog-search-input" placeholder="'+__e(__("Search %s",model.blogname))+'">';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(8),n=i(3),o=i(139),r=i(185),a=i(1150),l=r.extend({className:"search-no-results",template:a,afterRender:function(){this.setHeight(),this.listenTo(o,"DOMEventor:flatresize",n.throttle(this.setHeight,300))},setHeight:function(){var e=s(".indash_blog .posts"),t=e.outerHeight()-e.height(),i=s(".indash_blog .header").height();this.$el.height(s(window).height()-i-t)}});e.exports=l},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<p class="no-results-text" style="color: '+__e(model.themeParams.title_color)+'">'+(null==(__t=__("Nothing here about<br/>%s.",_.escape(model.term)))?"":__t)+"</p>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";e.exports=i(1152)},function(e,t,i){"use strict";var s=i(3),n=i(139),o=i(137),r=i(185),a=i(1153),l=i(1157),c=i(688),u=r.extend({template:l,className:"messaging-popover-icon nav_icon",events:{click:"_onIconClick"},initialize:function(e){this.options=s.extend({},this.defaults,e),s.extend(this,s.pick(e,"model"))},subviews:{statusIndicator:{constructor:c,options:function(e){return{isOnline:e.model.get("isOnline"),canSeeUIFlag:o.bool("status_indicators_ui"),name:e.model.get("name")}}}},showPopover:function(){this.popover||(this.popover=new a({pinnedTarget:this.$el,model:this.model,preventInteraction:!0}),this.popover.render(),this.listenTo(this.popover.getView(),"messagingSelected",this._onMessagingSelected),this.listenTo(this.popover.getView(),"askSelected",this._onAskSelected),this.listenTo(this.popover,"close",this._onPopoverClose))},openMessaging:function(){n.trigger("messaging:conversation:open:tumblelogs",[this.model],"peepr")},openAsk:function(){n.trigger("ask:form:open",{recipient:this.model.get("name"),allow_anonymous:this.model.get("anonymous_asks")})},_onIconClick:function(){this.model.get("asks")?this.showPopover():this.openMessaging()},_onMessagingSelected:function(){this.openMessaging()},_onAskSelected:function(){this.openAsk()},_onPopoverClose:function(){this.stopListening(this.popover),this.stopListening(this.popover.getView()),this.popover=null}});e.exports=u},function(e,t,i){"use strict";var s=i(3),n=i(178),o=i(1154),r=i(235),a=i(242),l=i(1156),c=n.extend({className:"popover--messaging-peepr popover info_popover popover_gradient",template:l,mixins:[r,a],initialize:function(e){this.options=s.extend({},this.defaults,e),this.view=new o({model:this.model})},render:function(){return this.$el.html(this.template),this.$(".popover_inner").append(this.view.render().$el),this.listenTo(this.view,"popoverClose",this.teardown),this},teardown:function(){this.view.remove(),this.remove()},getView:function(){return this.view}});e.exports=c},function(e,t,i){"use strict";var s=i(3),n=i(185),o=i(1155),r=n.extend({tagName:"ul",template:o,events:{"click [data-js-ask]":"_onClickAsk","click [data-js-message]":"_onClickMessage"},getTemplateData:function(){return{hasMessaging:this.model.get("can_receive_messages")===!0,hasAsks:this.model.get("asks")===!0,hasSubmissions:this.model.get("submissions")===!0,url:this.model.get("url")}},_onClickMessage:function(e){e.preventDefault(),this.trigger("messagingSelected"),this.trigger("popoverClose")},_onClickAsk:function(e){e.preventDefault(),this.trigger("askSelected"),s.delay(s.bind(function(){this.trigger("popoverClose")},this),1)}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)hasMessaging&&(__p+=' <li data-js-message><a href="#">'+__e(_("Send a message"))+"</a></li> "),__p+=" ",hasAsks&&(__p+=' <li data-js-ask><a class="ask" href="'+__e(url)+'/ask">'+__e(_("Ask a question"))+"</a></li> "),__p+=" ",hasSubmissions&&(__p+=' <li data-js-submit><a class="submit" target="_blank" href="'+__e(url)+'/submit">'+__e(_("Submit"))+"</a></li> ");return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="popover_inner"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div data-subview="statusIndicator"></div> '+__e(_("Send a message"));return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(173),n=s.extend({name:"AdsPaginationHelper",defaults:{nextAdPos:0},initialize:function(){this.set(this.data)},getNextAdPos:function(){return this.get("nextAdPos")}});e.exports=n},function(e,t,i){"use strict";function s(e){var t=e.filter(function(e){return o.includes(r,e)});return t.join("_")}function n(e){var t=e.closest(".post"),i=o.get(t.data("json"),"post-id")||t.attr("data-post-id"),n=t.find(".note_link_current").data("count"),r=s(e.attr("class").split(" "));return{postId:i,noteCount:n,noteType:r}}var o=i(3),r=["like","reblog","answer","reply","photo","with_commentary"];e.exports=n},function(e,t,i){"use strict";var s=i(1161);e.exports=s},function(e,t,i){"use strict";var s=i(185),n=i(1162),o=i(3),r=i(1164),a=i(549),l=i(139),c=i(179),u=i(309),h=s.extend({className:"carousel-container",template:r,hasPeeked:!1,mixins:[u],subviews:{carouselPositionView:{constructor:n,options:function(e){return{photoCount:e.model.get("photoset_photos").length}}}},events:{"click .carousel-item-container a":"contentLinkClick"},initialize:function(e){e=e||{},this.currentItem=0,this.carouselLinkUrl=e.carousel_link_url,this.setupWatcher(),this.model.set("is_carousel",!0),this.model.set("carousel_index",this.currentItem)},afterRenderSubviews:function(){var e=this;o.defer(function(){e.imageWidth=e.carouselPositionView.$el.width(),window.parent.postMessage("resize_photoset_iframe;"+e.model.get("id")+";"+e.imageWidth,"*")}),this.carouselItemContainer=this.$(".carousel-item-container"),this.listenTo(this.carouselPositionView,"switchCarouselItem",this.processCarouselItemSwitch),this.listenTo(this.carouselPositionView,"peekLeft",this.peekLeft),this.listenTo(this.carouselPositionView,"peekRight",this.peekRight),this.peekIfInViewport(),this.listenTo(l,"DOMEventor:flatscroll",o.throttle(this.peekIfInViewport,500),this)},render:function(){return this.$el.html(this.template({post:this.model,carousel_link_url:this.carouselLinkUrl})),this},peekIfInViewport:function(){var e=this;!this.hasPeeked&&this.watcher&&this.watcher.isFullyInViewport&&(this.carouselItemContainer.addClass("peek-animation"),c.animation(this.carouselItemContainer,function(){e.carouselItemContainer.removeClass("peek-animation")}),this.hasPeeked=!0,this.stopListening(l,"DOMEventor:flatscroll"),this.watcher=null)},peekLeft:function(){var e=this.$(".carousel-wrapper");e.addClass("peek-left-animation"),c.animation(e,function(){e.removeClass("peek-left-animation")})},peekRight:function(){var e=this.$(".carousel-wrapper");e.addClass("peek-right-animation"),c.animation(e,function(){e.removeClass("peek-right-animation")})},processCarouselItemSwitch:function(e){this.model.get("pt")&&l.trigger("carousel:slide",{loggingData:this.loggingData({userAction:"slide",extraData:{offset:this.currentItem,target_offset:e}})}),this.carouselItemContainer.css({transform:"translate3d("+e*-this.imageWidth+"px, 0, 0)"}),this.currentItem=e,this.model.set("carousel_index",e)},setupWatcher:function(){this.watcher=a.create(this.$el,-100)},contentLinkClick:function(){this.model.get("pt")&&l.trigger("carousel:click_thru",{loggingData:this.loggingData({userAction:"click_thru",extraData:{offset:this.currentItem}})})}});e.exports=h},function(e,t,i){"use strict";var s=i(8),n=i(185),o=i(1163),r=n.extend({autoAppend:!0,template:o,events:{"click .carousel-button":"onCarouselButtonClick","click .carousel-arrow-right":"goToNextItem","click .carousel-arrow-left":"goToPrevItem"},initialize:function(e){e=e||{},this.photoCount=e.photoCount||0,this.currentItem=0},switchCarouselItem:function(e){this.trigger("switchCarouselItem",e)},goToItem:function(e){e>=0&&e<=this.photoCount-1?(this.$(".carousel-button").removeClass("current"),this.$('.carousel-button[data-carousel-button-index="'+e+'"]').addClass("current"),this.currentItem=e,this.switchCarouselItem(this.currentItem)):e<0?this.trigger("peekLeft"):e>this.photoCount-1&&this.trigger("peekRight")},goToNextItem:function(e){this.goToItem(this.currentItem+1)},goToPrevItem:function(e){this.goToItem(this.currentItem-1)},onCarouselButtonClick:function(e){var t=s(e.target).data("carousel-button-index");this.goToItem(t)},render:function(){return this.$el.html(this.template({photoCount:this.photoCount})),this}});e.exports=r},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){for(__p+='<div class="carousel-arrow carousel-arrow-left"></div><div class="carousel-arrow carousel-arrow-right"></div><div class="carousel-button-container"> ',i=0;i<photoCount;i++)__p+=' <span class="carousel-button'+__e(0===i?" current":"")+'" data-carousel-button-index="'+__e(i)+'">&#x25cf;</span> ';__p+=" </div>"}return __p}.toString()).apply(void 0,_values(_imports))},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+='<div class="carousel-wrapper"><div class="carousel-item-container"> ',_.forEach(post.get("photoset_photos"),function(e,t){__p+=" ",carousel_link_url&&(__p+=' <a target="_blank" href="'+__e(carousel_link_url)+'"> '),__p+=' <img class="carousel-item carousel-item-'+__e(t)+'" src="'+__e(e.high_res)+'" alt="'+__e(e.caption)+'"> ',carousel_link_url&&(__p+=" </a> "),__p+=" "}),__p+=' </div></div><div data-subview="carouselPositionView"></div>';return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(1166);e.exports=s},function(e,t,i){"use strict";var s=i(185),n=i(1167),o=i(139),r=i(8),a=s.extend({events:{"click .see-all-tags":"_expandTags",
"click .post_tag":"_clickTag"},hasExpandedTags:!1,template:n,_expandTags:function(e){o.trigger("postchrome-interactions:expand-tags-click",{loggingData:{action:"expand-tags-click"}}),this.hasExpandedTags=!0,this.$el.removeClass("fadeable"),this.$(".see-all-tags").remove()},render:function(){this.$el.append(this.template())},_clickTag:function(e){var t=r(e.target);o.trigger("postchrome-interactions:tag-click",{loggingData:{action:"tag-click",tag:t.text(),hasExpandedTags:this.hasExpandedTags?"true":"false",wasHidden:this.hasExpandedTags&&t.position().top>81?"true":"false",postId:this.model.get("id"),tagIndex:t.index()}})}});e.exports=a},function(module,exports,__webpack_require__){var _=__webpack_require__(3),_imports="undefined"!=typeof _?_.templateSettings.imports:{},_keys=_.keys,_values=_.values;module.exports=Function(_keys(_imports),"return "+function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<div class="see-all-tags"><span class="ellipses">...</span> '+__e(__("See all"))+" </div>";return __p}.toString()).apply(void 0,_values(_imports))},function(e,t,i){"use strict";var s=i(178),n=i(139),o=s.extend({events:{click:"_onLinkClick"},initialize:function(e){e&&e.postModel?this.postModelJSON=e.postModel.toJSON():this.postModelJSON=""},_onLinkClick:function(){this._triggerEvent("buttonClick")},_triggerEvent:function(e){n.trigger("CTAButton:"+e,{loggingData:{postData:this.postModelJSON,userAction:"action_click"}})}});e.exports=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);